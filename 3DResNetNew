{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "8d470da2",
   "metadata": {
    "papermill": {
     "duration": 0.013852,
     "end_time": "2024-10-22T08:26:35.088257",
     "exception": false,
     "start_time": "2024-10-22T08:26:35.074405",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "### <a href=\"https://www.kaggle.com/code/pietrocaforio/unimodal-ct-training-kaggle?scriptVersionId=197281783\" target=\"_blank\"><img align=\"left\" alt=\"Kaggle\" title=\"Open in Kaggle\" src=\"https://kaggle.com/static/images/open-in-kaggle.svg\"></a>"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "701f2297",
   "metadata": {
    "papermill": {
     "duration": 0.012531,
     "end_time": "2024-10-22T08:26:35.114802",
     "exception": false,
     "start_time": "2024-10-22T08:26:35.102271",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "# Train 3D unimodal CT"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "ef869560",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-22T08:26:35.142717Z",
     "iopub.status.busy": "2024-10-22T08:26:35.141820Z",
     "iopub.status.idle": "2024-10-22T08:26:38.869965Z",
     "shell.execute_reply": "2024-10-22T08:26:38.868498Z"
    },
    "papermill": {
     "duration": 3.745155,
     "end_time": "2024-10-22T08:26:38.872585",
     "exception": false,
     "start_time": "2024-10-22T08:26:35.127430",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Cloning into 'research-biocv-proj'...\r\n",
      "remote: Enumerating objects: 559, done.\u001b[K\r\n",
      "remote: Counting objects: 100% (104/104), done.\u001b[K\r\n",
      "remote: Compressing objects: 100% (86/86), done.\u001b[K\r\n",
      "remote: Total 559 (delta 60), reused 51 (delta 18), pack-reused 455 (from 1)\u001b[K\r\n",
      "Receiving objects: 100% (559/559), 5.56 MiB | 23.54 MiB/s, done.\r\n",
      "Resolving deltas: 100% (340/340), done.\r\n",
      "Branch 'dev' set up to track remote branch 'dev' from 'origin'.\r\n",
      "Switched to a new branch 'dev'\r\n"
     ]
    }
   ],
   "source": [
    "!git clone https://github.com/PietroCaforio/research-biocv-proj\n",
    "!cd research-biocv-proj && git switch dev"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "f3eaf477",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-22T08:26:38.904027Z",
     "iopub.status.busy": "2024-10-22T08:26:38.903635Z",
     "iopub.status.idle": "2024-10-22T08:26:40.428373Z",
     "shell.execute_reply": "2024-10-22T08:26:40.427400Z"
    },
    "papermill": {
     "duration": 1.542583,
     "end_time": "2024-10-22T08:26:40.430783",
     "exception": false,
     "start_time": "2024-10-22T08:26:38.888200",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Already up to date.\r\n"
     ]
    }
   ],
   "source": [
    "!cd research-biocv-proj && git pull"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "b5ae14cf",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-22T08:26:40.460898Z",
     "iopub.status.busy": "2024-10-22T08:26:40.460417Z",
     "iopub.status.idle": "2024-10-22T08:26:54.490996Z",
     "shell.execute_reply": "2024-10-22T08:26:54.489807Z"
    },
    "papermill": {
     "duration": 14.04827,
     "end_time": "2024-10-22T08:26:54.493445",
     "exception": false,
     "start_time": "2024-10-22T08:26:40.445175",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Requirement already satisfied: wandb in /opt/conda/lib/python3.10/site-packages (0.18.3)\r\n",
      "Requirement already satisfied: click!=8.0.0,>=7.1 in /opt/conda/lib/python3.10/site-packages (from wandb) (8.1.7)\r\n",
      "Requirement already satisfied: docker-pycreds>=0.4.0 in /opt/conda/lib/python3.10/site-packages (from wandb) (0.4.0)\r\n",
      "Requirement already satisfied: gitpython!=3.1.29,>=1.0.0 in /opt/conda/lib/python3.10/site-packages (from wandb) (3.1.43)\r\n",
      "Requirement already satisfied: platformdirs in /opt/conda/lib/python3.10/site-packages (from wandb) (3.11.0)\r\n",
      "Requirement already satisfied: protobuf!=4.21.0,!=5.28.0,<6,>=3.19.0 in /opt/conda/lib/python3.10/site-packages (from wandb) (3.20.3)\r\n",
      "Requirement already satisfied: psutil>=5.0.0 in /opt/conda/lib/python3.10/site-packages (from wandb) (5.9.3)\r\n",
      "Requirement already satisfied: pyyaml in /opt/conda/lib/python3.10/site-packages (from wandb) (6.0.2)\r\n",
      "Requirement already satisfied: requests<3,>=2.0.0 in /opt/conda/lib/python3.10/site-packages (from wandb) (2.32.3)\r\n",
      "Requirement already satisfied: sentry-sdk>=1.0.0 in /opt/conda/lib/python3.10/site-packages (from wandb) (2.15.0)\r\n",
      "Requirement already satisfied: setproctitle in /opt/conda/lib/python3.10/site-packages (from wandb) (1.3.3)\r\n",
      "Requirement already satisfied: setuptools in /opt/conda/lib/python3.10/site-packages (from wandb) (70.0.0)\r\n",
      "Requirement already satisfied: six>=1.4.0 in /opt/conda/lib/python3.10/site-packages (from docker-pycreds>=0.4.0->wandb) (1.16.0)\r\n",
      "Requirement already satisfied: gitdb<5,>=4.0.1 in /opt/conda/lib/python3.10/site-packages (from gitpython!=3.1.29,>=1.0.0->wandb) (4.0.11)\r\n",
      "Requirement already satisfied: charset-normalizer<4,>=2 in /opt/conda/lib/python3.10/site-packages (from requests<3,>=2.0.0->wandb) (3.3.2)\r\n",
      "Requirement already satisfied: idna<4,>=2.5 in /opt/conda/lib/python3.10/site-packages (from requests<3,>=2.0.0->wandb) (3.7)\r\n",
      "Requirement already satisfied: urllib3<3,>=1.21.1 in /opt/conda/lib/python3.10/site-packages (from requests<3,>=2.0.0->wandb) (1.26.18)\r\n",
      "Requirement already satisfied: certifi>=2017.4.17 in /opt/conda/lib/python3.10/site-packages (from requests<3,>=2.0.0->wandb) (2024.8.30)\r\n",
      "Requirement already satisfied: smmap<6,>=3.0.1 in /opt/conda/lib/python3.10/site-packages (from gitdb<5,>=4.0.1->gitpython!=3.1.29,>=1.0.0->wandb) (5.0.1)\r\n"
     ]
    }
   ],
   "source": [
    "!pip install wandb"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "23041d73",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-22T08:26:54.524874Z",
     "iopub.status.busy": "2024-10-22T08:26:54.524467Z",
     "iopub.status.idle": "2024-10-22T08:26:54.830958Z",
     "shell.execute_reply": "2024-10-22T08:26:54.829967Z"
    },
    "papermill": {
     "duration": 0.324946,
     "end_time": "2024-10-22T08:26:54.833426",
     "exception": false,
     "start_time": "2024-10-22T08:26:54.508480",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "from kaggle_secrets import UserSecretsClient\n",
    "user_secrets = UserSecretsClient()\n",
    "secret_value_0 = user_secrets.get_secret(\"3d_wandb_key\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "f2b66e1c",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-22T08:26:54.864449Z",
     "iopub.status.busy": "2024-10-22T08:26:54.863630Z",
     "iopub.status.idle": "2024-10-22T08:26:57.761051Z",
     "shell.execute_reply": "2024-10-22T08:26:57.760002Z"
    },
    "papermill": {
     "duration": 2.915106,
     "end_time": "2024-10-22T08:26:57.763267",
     "exception": false,
     "start_time": "2024-10-22T08:26:54.848161",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\u001b[34m\u001b[1mwandb\u001b[0m: Using wandb-core as the SDK backend. Please refer to https://wandb.me/wandb-core for more information.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: W&B API key is configured. Use \u001b[1m`wandb login --relogin`\u001b[0m to force relogin\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \u001b[33mWARNING\u001b[0m If you're specifying your api key in code, ensure this code is not shared publicly.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \u001b[33mWARNING\u001b[0m Consider setting the WANDB_API_KEY environment variable, or running `wandb login` from the command line.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Appending key for api.wandb.ai to your netrc file: /root/.netrc\n"
     ]
    },
    {
     "data": {
      "text/plain": [
       "True"
      ]
     },
     "execution_count": 5,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "import wandb\n",
    "wandb.login(key=secret_value_0)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "8b713929",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-22T08:26:57.794447Z",
     "iopub.status.busy": "2024-10-22T08:26:57.794124Z",
     "iopub.status.idle": "2024-10-22T08:27:04.428618Z",
     "shell.execute_reply": "2024-10-22T08:27:04.427563Z"
    },
    "papermill": {
     "duration": 6.652704,
     "end_time": "2024-10-22T08:27:04.431047",
     "exception": false,
     "start_time": "2024-10-22T08:26:57.778343",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "import sys\n",
    "from pathlib import Path\n",
    "\n",
    "# Add the 'data' directory to sys.path\n",
    "sys.path.append(str(Path('research-biocv-proj').resolve()))\n",
    "from data.unimodal3D import *\n",
    "from pathlib import Path\n",
    "\n",
    "import numpy as np\n",
    "import torch\n",
    "from torch.utils.data import DataLoader\n",
    "\n",
    "from sklearn.utils.class_weight import compute_class_weight"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "2100dd46",
   "metadata": {
    "papermill": {
     "duration": 0.01595,
     "end_time": "2024-10-22T08:27:04.463027",
     "exception": false,
     "start_time": "2024-10-22T08:27:04.447077",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "### Train ResNet model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "a2bb27cf",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-22T08:27:04.495409Z",
     "iopub.status.busy": "2024-10-22T08:27:04.494825Z",
     "iopub.status.idle": "2024-10-22T08:27:04.506291Z",
     "shell.execute_reply": "2024-10-22T08:27:04.505430Z"
    },
    "papermill": {
     "duration": 0.029886,
     "end_time": "2024-10-22T08:27:04.508151",
     "exception": false,
     "start_time": "2024-10-22T08:27:04.478265",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "class EarlyStopping:\n",
    "    \"\"\"Early stops the training if validation loss doesn't improve after a given patience.\"\"\"\n",
    "    def __init__(self, patience=7, verbose=False, delta=0, path='checkpoint.pt', trace_func=print):\n",
    "        \"\"\"\n",
    "        Args:\n",
    "            patience (int): How long to wait after last time validation loss improved.\n",
    "                            Default: 7\n",
    "            verbose (bool): If True, prints a message for each validation loss improvement. \n",
    "                            Default: False\n",
    "            delta (float): Minimum change in the monitored quantity to qualify as an improvement.\n",
    "                            Default: 0\n",
    "            path (str): Path for the checkpoint to be saved to.\n",
    "                            Default: 'checkpoint.pt'\n",
    "            trace_func (function): trace print function.\n",
    "                            Default: print            \n",
    "        \"\"\"\n",
    "        self.patience = patience\n",
    "        self.verbose = verbose\n",
    "        self.counter = 0\n",
    "        self.best_score = None\n",
    "        self.early_stop = False\n",
    "        self.val_loss_min = np.Inf\n",
    "        self.delta = delta\n",
    "        self.path = path\n",
    "        self.trace_func = trace_func\n",
    "    def __call__(self, val_loss, model):\n",
    "\n",
    "        score = -val_loss\n",
    "\n",
    "        if self.best_score is None:\n",
    "            self.best_score = score\n",
    "            self.save_checkpoint(val_loss, model)\n",
    "        elif score < self.best_score + self.delta:\n",
    "            self.counter += 1\n",
    "            self.trace_func(f'EarlyStopping counter: {self.counter} out of {self.patience}')\n",
    "            if self.counter >= self.patience:\n",
    "                self.early_stop = True\n",
    "        else:\n",
    "            self.best_score = score\n",
    "            self.save_checkpoint(val_loss, model)\n",
    "            self.counter = 0\n",
    "\n",
    "    def save_checkpoint(self, val_loss, model):\n",
    "        '''Saves model when validation loss decrease.'''\n",
    "        if self.verbose:\n",
    "            self.trace_func(f'Validation loss decreased ({self.val_loss_min:.6f} --> {val_loss:.6f}).  Saving model ...')\n",
    "        torch.save(model.state_dict(), self.path)\n",
    "        self.val_loss_min = val_loss"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "6ac75996",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-22T08:27:04.541509Z",
     "iopub.status.busy": "2024-10-22T08:27:04.541148Z",
     "iopub.status.idle": "2024-10-22T08:27:04.569560Z",
     "shell.execute_reply": "2024-10-22T08:27:04.568613Z"
    },
    "papermill": {
     "duration": 0.048733,
     "end_time": "2024-10-22T08:27:04.571776",
     "exception": false,
     "start_time": "2024-10-22T08:27:04.523043",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "def train(model,config, run_name=None):\n",
    "    wandb.init(\n",
    "        # set the wandb project where this run will be logged\n",
    "        project=\"CPTACUCEC_3D_unimodal_CT\",\n",
    "        name = run_name,\n",
    "        # track hyperparameters and run metadata\n",
    "        config=config\n",
    "    )\n",
    "    optimizer = optim.Adam(model.parameters(), lr=config[\"learning_rate\"], weight_decay=config[\"weight_decay\"])\n",
    "    if config[\"class_weights\"] is not None: \n",
    "        config[\"class_weights\"] = torch.tensor(config[\"class_weights\"], dtype=torch.float).to(device)\n",
    "    \n",
    "    if config[\"focal_loss\"] is not None:\n",
    "        criterion = FocalLoss(gamma = config[\"focal_loss\"])\n",
    "    else:\n",
    "        criterion = nn.CrossEntropyLoss(weight = config[\"class_weights\"])\n",
    "    \n",
    "    scheduler = optim.lr_scheduler.ReduceLROnPlateau(optimizer, 'min',factor = config[\"reduce_lr_factor\"], patience = config[\"patience\"])\n",
    "    # initialize the early_stopping object\n",
    "    early_stopping = None\n",
    "    if config[\"early_stop_patience\"] is not None:\n",
    "        early_stopping = EarlyStopping(patience=config[\"early_stop_patience\"], verbose=True)\n",
    "    \n",
    "    # Training loop\n",
    "    num_epochs = config[\"epochs\"]\n",
    "    for epoch in range(num_epochs):\n",
    "        model.train()\n",
    "        running_loss = 0.0\n",
    "        train_correct = 0\n",
    "        total = 0\n",
    "        correct_per_class = [0, 0, 0]  # For G1, G2, G3\n",
    "        total_per_class = [0, 0, 0]  # For G1, G2, G3\n",
    "        for batch in train_loader:\n",
    "            volumes = batch['volume'].float().to(device)\n",
    "            labels = batch['label'].long().to(device)\n",
    "            #print(f\"volumes batch dimensions: {volumes.size()}\")\n",
    "            optimizer.zero_grad()\n",
    "            outputs = model(volumes.unsqueeze(1))\n",
    "            \n",
    "            if config[\"focal_loss\"]:\n",
    "                softmax = torch.nn.Softmax(dim=-1)\n",
    "                loss = criterion(softmax(outputs), labels)\n",
    "            else:\n",
    "                loss = criterion(outputs, labels)\n",
    "            \n",
    "            _, predicted = torch.max(outputs, 1)\n",
    "            train_correct += (predicted == labels).sum().item()\n",
    "            loss.backward()\n",
    "            optimizer.step()\n",
    "            total += labels.size(0)\n",
    "            running_loss += loss.item()\n",
    "            \n",
    "            # Calculate accuracy per class\n",
    "            for i in range(3):  # We have 3 classes: G1 (0), G2 (1), G3 (2)\n",
    "                correct_per_class[i] += ((predicted == i) & (labels == i)).sum().item()\n",
    "                total_per_class[i] += (labels == i).sum().item()\n",
    "            #if epoch % 100 == 0:\n",
    "                #for num,volume in enumerate(batch[\"volume\"]):\n",
    "                    #np.save(f\"batch{epoch}_vol{num}\",volume)\n",
    "\n",
    "        train_accuracy = 100 * train_correct / total\n",
    "        class_accuracy = [(100 * correct_per_class[i] / total_per_class[i]) if total_per_class[i] > 0 else 0 for i in range(3)]\n",
    "        print(f\"Epoch {epoch+1}, Loss: {running_loss/len(train_loader)}\")\n",
    "        wandb.log({\"Train Accuracy\": train_accuracy, \"Train loss\": running_loss/len(train_loader), \"G1_TrainAcc\":class_accuracy[0], \"G2_TrainAcc\":class_accuracy[1], \"G3_TrainAcc\":class_accuracy[2]})\n",
    "\n",
    "        # Validation loop\n",
    "        model.eval()\n",
    "        val_loss = 0.0\n",
    "        correct = 0\n",
    "        total = 0\n",
    "        # Initialize counters for each class (G1, G2, G3)\n",
    "        correct_per_class = [0, 0, 0]  # For G1, G2, G3\n",
    "        total_per_class = [0, 0, 0]  # For G1, G2, G3\n",
    "\n",
    "        with torch.no_grad():\n",
    "            for batch in val_loader:\n",
    "                volumes = batch['volume'].float().to(device)\n",
    "                labels = batch['label'].long().to(device)\n",
    "                \n",
    "                outputs = model(volumes.unsqueeze(1))\n",
    "                if config[\"focal_loss\"]:\n",
    "                    softmax = torch.nn.Softmax(dim=-1)\n",
    "                    loss = criterion(softmax(outputs), labels)\n",
    "                else:\n",
    "                    loss = criterion(outputs, labels)\n",
    "                \n",
    "                val_loss += loss.item()\n",
    "                _, predicted = torch.max(outputs, 1)\n",
    "                total += labels.size(0)\n",
    "                correct += (predicted == labels).sum().item()\n",
    "\n",
    "                # Calculate accuracy per class\n",
    "                for i in range(3):  # We have 3 classes: G1 (0), G2 (1), G3 (2)\n",
    "                    correct_per_class[i] += ((predicted == i) & (labels == i)).sum().item()\n",
    "                    total_per_class[i] += (labels == i).sum().item()\n",
    "                #if epoch % 100 == 0:\n",
    "                    #for num,volume in enumerate(batch[\"volume\"]):\n",
    "                       # np.save(f\"batch{epoch}_vol{num}_validation\",volume)\n",
    "        scheduler.step(val_loss)\n",
    "        # Compute total accuracy and per-class accuracy\n",
    "        total_accuracy = 100 * correct / total\n",
    "        class_accuracy = [(100 * correct_per_class[i] / total_per_class[i]) if total_per_class[i] > 0 else 0 for i in range(3)]\n",
    "        print(f\"Validation Loss: {val_loss/len(val_loader)}, Total Accuracy: {total_accuracy:.2f}%\")\n",
    "        print(f\"Accuracy per class - G1: {class_accuracy[0]:.2f}%, G2: {class_accuracy[1]:.2f}%, G3: {class_accuracy[2]:.2f}%\")\n",
    "        # log metrics to wandb\n",
    "        wandb.log({\"Total Accuracy\": total_accuracy, \"Validation Loss\": val_loss/len(val_loader), \"G1_Acc\":class_accuracy[0], \"G2_Acc\":class_accuracy[1], \"G3_Acc\":class_accuracy[2]})\n",
    "        if config[\"early_stop_patience\"] is not None:\n",
    "            early_stopping(val_loss, model)\n",
    "        \n",
    "        if config[\"early_stop_patience\"] is not None:\n",
    "            if early_stopping.early_stop:\n",
    "                print(\"Early stopping\")\n",
    "                break\n",
    "    wandb.finish()   "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "16226a30",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-22T08:27:04.604335Z",
     "iopub.status.busy": "2024-10-22T08:27:04.603999Z",
     "iopub.status.idle": "2024-10-22T08:27:07.915341Z",
     "shell.execute_reply": "2024-10-22T08:27:07.914344Z"
    },
    "papermill": {
     "duration": 3.329571,
     "end_time": "2024-10-22T08:27:07.917829",
     "exception": false,
     "start_time": "2024-10-22T08:27:04.588258",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "import torch.nn as nn\n",
    "import torch.optim as optim\n",
    "from transformers import ResNetForImageClassification"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "c6b7f687",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-22T08:27:07.950910Z",
     "iopub.status.busy": "2024-10-22T08:27:07.949610Z",
     "iopub.status.idle": "2024-10-22T08:27:07.962353Z",
     "shell.execute_reply": "2024-10-22T08:27:07.961407Z"
    },
    "papermill": {
     "duration": 0.031351,
     "end_time": "2024-10-22T08:27:07.964457",
     "exception": false,
     "start_time": "2024-10-22T08:27:07.933106",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "import torch\n",
    "from torch.utils.data import Sampler\n",
    "import random\n",
    "\n",
    "class CustomBatchSampler(Sampler):\n",
    "    def __init__(self, dataset, batch_size=4):\n",
    "        #assert batch_size % 3 == 0, \"Batch size should be divisible by 3 (for 3 classes).\"\n",
    "        self.dataset = dataset\n",
    "        self.batch_size = batch_size\n",
    "        self.num_classes = 3  # G1, G2, G3\n",
    "        #self.samples_per_class = batch_size // self.num_classes\n",
    "        self.samples_per_class = {\n",
    "            0: 1, #G1\n",
    "            1: 2, #G2\n",
    "            2: 1  #G3\n",
    "        }\n",
    "        \n",
    "        # Group indices by class\n",
    "        self.class_indices = {\n",
    "            0: [],  # G1\n",
    "            1: [],  # G2\n",
    "            2: []   # G3\n",
    "        }\n",
    "        \n",
    "        for idx in range(len(self.dataset)):\n",
    "            label = self.dataset[idx][\"label\"]\n",
    "            self.class_indices[label].append(idx)\n",
    "        \n",
    "    def __iter__(self):\n",
    "        # Shuffle the class indices at the start of each epoch\n",
    "        for class_group in self.class_indices.values():\n",
    "            random.shuffle(class_group)\n",
    "        \n",
    "        # Number of batches we can create\n",
    "        num_batches = len(self.dataset) // self.batch_size\n",
    "        \n",
    "        for _ in range(num_batches):\n",
    "            batch_indices = []\n",
    "            \n",
    "            for class_label in range(self.num_classes):\n",
    "                # Sample 2 indices from each class\n",
    "                batch_indices.extend(random.sample(self.class_indices[class_label], self.samples_per_class[class_label]))\n",
    "                \n",
    "            yield batch_indices\n",
    "\n",
    "    def __len__(self):\n",
    "        return len(self.dataset) // self.batch_size"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "04e27e5f",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-22T08:27:07.996767Z",
     "iopub.status.busy": "2024-10-22T08:27:07.996089Z",
     "iopub.status.idle": "2024-10-22T08:27:08.000778Z",
     "shell.execute_reply": "2024-10-22T08:27:07.999874Z"
    },
    "papermill": {
     "duration": 0.022583,
     "end_time": "2024-10-22T08:27:08.002659",
     "exception": false,
     "start_time": "2024-10-22T08:27:07.980076",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "from torch.utils.data import DataLoader"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "7975cd16",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-22T08:27:08.035295Z",
     "iopub.status.busy": "2024-10-22T08:27:08.034991Z",
     "iopub.status.idle": "2024-10-22T08:27:09.019845Z",
     "shell.execute_reply": "2024-10-22T08:27:09.018555Z"
    },
    "papermill": {
     "duration": 1.004545,
     "end_time": "2024-10-22T08:27:09.022324",
     "exception": false,
     "start_time": "2024-10-22T08:27:08.017779",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "!export PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "id": "0cdb7b25",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-22T08:27:09.055621Z",
     "iopub.status.busy": "2024-10-22T08:27:09.055188Z",
     "iopub.status.idle": "2024-10-22T08:29:46.349294Z",
     "shell.execute_reply": "2024-10-22T08:29:46.348350Z"
    },
    "papermill": {
     "duration": 157.313248,
     "end_time": "2024-10-22T08:29:46.352000",
     "exception": false,
     "start_time": "2024-10-22T08:27:09.038752",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "train_dataset = UnimodalCTDataset3D(split='train',dataset_path = \"/kaggle/input/processed69cptacucec3d/processed_CPTACUCEC_3D_pad\" )\n",
    "val_dataset = UnimodalCTDataset3D(split='val',dataset_path = \"/kaggle/input/processed69cptacucec3d/processed_CPTACUCEC_3D_pad\")\n",
    "\n",
    "custom_sampler = CustomBatchSampler(train_dataset, batch_size = 4)\n",
    "\n",
    "\n",
    "\n",
    "train_loader = DataLoader(train_dataset, batch_sampler = custom_sampler)\n",
    "\n",
    "#train_loader = DataLoader(train_dataset, batch_size=5, shuffle=True)\n",
    "val_loader = DataLoader(val_dataset, batch_size=2, shuffle=False)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 14,
   "id": "cfea5c36",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-22T08:29:46.385559Z",
     "iopub.status.busy": "2024-10-22T08:29:46.384665Z",
     "iopub.status.idle": "2024-10-22T08:29:46.390127Z",
     "shell.execute_reply": "2024-10-22T08:29:46.389234Z"
    },
    "papermill": {
     "duration": 0.024259,
     "end_time": "2024-10-22T08:29:46.392163",
     "exception": false,
     "start_time": "2024-10-22T08:29:46.367904",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Training set stats:{'length': 223, 'class_frequency': {'G1': 29, 'G2': 138, 'G3': 56}}\n",
      "Validation set stats:{'length': 52, 'class_frequency': {'G1': 14, 'G2': 24, 'G3': 14}}\n"
     ]
    }
   ],
   "source": [
    "print(f\"Training set stats:{train_dataset.stats()}\")\n",
    "print(f\"Validation set stats:{val_dataset.stats()}\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 15,
   "id": "991635d6",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-22T08:29:46.424603Z",
     "iopub.status.busy": "2024-10-22T08:29:46.424077Z",
     "iopub.status.idle": "2024-10-22T08:29:50.694482Z",
     "shell.execute_reply": "2024-10-22T08:29:50.693695Z"
    },
    "papermill": {
     "duration": 4.28909,
     "end_time": "2024-10-22T08:29:50.696878",
     "exception": false,
     "start_time": "2024-10-22T08:29:46.407788",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "labels = []\n",
    "for sample in train_dataset:\n",
    "    labels.append(sample[\"label\"])\n",
    "labels = np.array(labels)\n",
    "class_weights = compute_class_weight(\"balanced\", classes=np.unique(labels), y=labels)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 16,
   "id": "ed5270aa",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-22T08:29:50.729094Z",
     "iopub.status.busy": "2024-10-22T08:29:50.728742Z",
     "iopub.status.idle": "2024-10-22T08:29:50.734082Z",
     "shell.execute_reply": "2024-10-22T08:29:50.733140Z"
    },
    "papermill": {
     "duration": 0.024056,
     "end_time": "2024-10-22T08:29:50.736488",
     "exception": false,
     "start_time": "2024-10-22T08:29:50.712432",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[2.56321839 0.53864734 1.32738095]\n"
     ]
    }
   ],
   "source": [
    "print(class_weights)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "054fc1ae",
   "metadata": {
    "papermill": {
     "duration": 0.014656,
     "end_time": "2024-10-22T08:29:50.766605",
     "exception": false,
     "start_time": "2024-10-22T08:29:50.751949",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "### 3D Resnet-18"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 17,
   "id": "b2212df3",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-22T08:29:50.798786Z",
     "iopub.status.busy": "2024-10-22T08:29:50.797843Z",
     "iopub.status.idle": "2024-10-22T08:29:52.253787Z",
     "shell.execute_reply": "2024-10-22T08:29:52.252912Z"
    },
    "papermill": {
     "duration": 1.474427,
     "end_time": "2024-10-22T08:29:52.256162",
     "exception": false,
     "start_time": "2024-10-22T08:29:50.781735",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "import torchvision.models as models"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 18,
   "id": "2c466687",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-22T08:29:52.291492Z",
     "iopub.status.busy": "2024-10-22T08:29:52.290563Z",
     "iopub.status.idle": "2024-10-22T08:29:52.297412Z",
     "shell.execute_reply": "2024-10-22T08:29:52.296564Z"
    },
    "papermill": {
     "duration": 0.026544,
     "end_time": "2024-10-22T08:29:52.299474",
     "exception": false,
     "start_time": "2024-10-22T08:29:52.272930",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "class ResNet3D(nn.Module):\n",
    "    def __init__(self, num_classes):\n",
    "        super(ResNet3D, self).__init__()\n",
    "        self.model = models.video.r3d_18(pretrained=True)  # 3D ResNet18\n",
    "        self.model.stem[0] = nn.Conv3d(1, 64, kernel_size=(7, 7, 7), stride=(2, 2, 2), padding=(3, 3, 3), bias=False)\n",
    "        self.model.fc = nn.Linear(self.model.fc.in_features, num_classes)\n",
    "    \n",
    "    def forward(self, x):\n",
    "        return self.model(x)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "52899bda",
   "metadata": {
    "papermill": {
     "duration": 0.015569,
     "end_time": "2024-10-22T08:29:52.330679",
     "exception": false,
     "start_time": "2024-10-22T08:29:52.315110",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "## ResNet34-3D"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 19,
   "id": "b91f0428",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-22T08:29:52.363659Z",
     "iopub.status.busy": "2024-10-22T08:29:52.363217Z",
     "iopub.status.idle": "2024-10-22T08:29:52.401545Z",
     "shell.execute_reply": "2024-10-22T08:29:52.400727Z"
    },
    "papermill": {
     "duration": 0.05736,
     "end_time": "2024-10-22T08:29:52.403532",
     "exception": false,
     "start_time": "2024-10-22T08:29:52.346172",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "import math\n",
    "from functools import partial\n",
    "\n",
    "import torch\n",
    "import torch.nn as nn\n",
    "import torch.nn.functional as F\n",
    "\n",
    "\n",
    "def get_inplanes():\n",
    "    return [64, 128, 256, 512]\n",
    "\n",
    "\n",
    "def conv3x3x3(in_planes, out_planes, stride=1):\n",
    "    return nn.Conv3d(in_planes,\n",
    "                     out_planes,\n",
    "                     kernel_size=3,\n",
    "                     stride=stride,\n",
    "                     padding=1,\n",
    "                     bias=False)\n",
    "\n",
    "\n",
    "def conv1x1x1(in_planes, out_planes, stride=1):\n",
    "    return nn.Conv3d(in_planes,\n",
    "                     out_planes,\n",
    "                     kernel_size=1,\n",
    "                     stride=stride,\n",
    "                     bias=False)\n",
    "\n",
    "\n",
    "class BasicBlock(nn.Module):\n",
    "    expansion = 1\n",
    "\n",
    "    def __init__(self, in_planes, planes, stride=1, downsample=None):\n",
    "        super().__init__()\n",
    "\n",
    "        self.conv1 = conv3x3x3(in_planes, planes, stride)\n",
    "        self.bn1 = nn.BatchNorm3d(planes)\n",
    "        self.relu = nn.ReLU(inplace=True)\n",
    "        self.conv2 = conv3x3x3(planes, planes)\n",
    "        self.bn2 = nn.BatchNorm3d(planes)\n",
    "        self.downsample = downsample\n",
    "        self.stride = stride\n",
    "\n",
    "    def forward(self, x):\n",
    "        residual = x\n",
    "\n",
    "        out = self.conv1(x)\n",
    "        out = self.bn1(out)\n",
    "        out = self.relu(out)\n",
    "\n",
    "        out = self.conv2(out)\n",
    "        out = self.bn2(out)\n",
    "\n",
    "        if self.downsample is not None:\n",
    "            residual = self.downsample(x)\n",
    "\n",
    "        out += residual\n",
    "        out = self.relu(out)\n",
    "\n",
    "        return out\n",
    "\n",
    "\n",
    "class Bottleneck(nn.Module):\n",
    "    expansion = 4\n",
    "\n",
    "    def __init__(self, in_planes, planes, stride=1, downsample=None):\n",
    "        super().__init__()\n",
    "\n",
    "        self.conv1 = conv1x1x1(in_planes, planes)\n",
    "        self.bn1 = nn.BatchNorm3d(planes)\n",
    "        self.conv2 = conv3x3x3(planes, planes, stride)\n",
    "        self.bn2 = nn.BatchNorm3d(planes)\n",
    "        self.conv3 = conv1x1x1(planes, planes * self.expansion)\n",
    "        self.bn3 = nn.BatchNorm3d(planes * self.expansion)\n",
    "        self.relu = nn.ReLU(inplace=True)\n",
    "        self.downsample = downsample\n",
    "        self.stride = stride\n",
    "\n",
    "    def forward(self, x):\n",
    "        residual = x\n",
    "\n",
    "        out = self.conv1(x)\n",
    "        out = self.bn1(out)\n",
    "        out = self.relu(out)\n",
    "\n",
    "        out = self.conv2(out)\n",
    "        out = self.bn2(out)\n",
    "        out = self.relu(out)\n",
    "\n",
    "        out = self.conv3(out)\n",
    "        out = self.bn3(out)\n",
    "\n",
    "        if self.downsample is not None:\n",
    "            residual = self.downsample(x)\n",
    "\n",
    "        out += residual\n",
    "        out = self.relu(out)\n",
    "\n",
    "        return out\n",
    "\n",
    "\n",
    "class ResNet(nn.Module):\n",
    "\n",
    "    def __init__(self,\n",
    "                 block,\n",
    "                 layers,\n",
    "                 block_inplanes,\n",
    "                 n_input_channels=3,\n",
    "                 conv1_t_size=7,\n",
    "                 conv1_t_stride=1,\n",
    "                 no_max_pool=False,\n",
    "                 shortcut_type='B',\n",
    "                 widen_factor=1.0,\n",
    "                 n_classes=400):\n",
    "        super().__init__()\n",
    "\n",
    "        block_inplanes = [int(x * widen_factor) for x in block_inplanes]\n",
    "\n",
    "        self.in_planes = block_inplanes[0]\n",
    "        self.no_max_pool = no_max_pool\n",
    "\n",
    "        self.conv1 = nn.Conv3d(n_input_channels,\n",
    "                               self.in_planes,\n",
    "                               kernel_size=(conv1_t_size, 7, 7),\n",
    "                               stride=(conv1_t_stride, 2, 2),\n",
    "                               padding=(conv1_t_size // 2, 3, 3),\n",
    "                               bias=False)\n",
    "        self.bn1 = nn.BatchNorm3d(self.in_planes)\n",
    "        self.relu = nn.ReLU(inplace=True)\n",
    "        self.maxpool = nn.MaxPool3d(kernel_size=3, stride=2, padding=1)\n",
    "        self.layer1 = self._make_layer(block, block_inplanes[0], layers[0],\n",
    "                                       shortcut_type)\n",
    "        self.layer2 = self._make_layer(block,\n",
    "                                       block_inplanes[1],\n",
    "                                       layers[1],\n",
    "                                       shortcut_type,\n",
    "                                       stride=2)\n",
    "        self.layer3 = self._make_layer(block,\n",
    "                                       block_inplanes[2],\n",
    "                                       layers[2],\n",
    "                                       shortcut_type,\n",
    "                                       stride=2)\n",
    "        self.layer4 = self._make_layer(block,\n",
    "                                       block_inplanes[3],\n",
    "                                       layers[3],\n",
    "                                       shortcut_type,\n",
    "                                       stride=2)\n",
    "\n",
    "        self.avgpool = nn.AdaptiveAvgPool3d((1, 1, 1))\n",
    "        self.fc = nn.Linear(block_inplanes[3] * block.expansion, n_classes)\n",
    "\n",
    "        for m in self.modules():\n",
    "            if isinstance(m, nn.Conv3d):\n",
    "                nn.init.kaiming_normal_(m.weight,\n",
    "                                        mode='fan_out',\n",
    "                                        nonlinearity='relu')\n",
    "            elif isinstance(m, nn.BatchNorm3d):\n",
    "                nn.init.constant_(m.weight, 1)\n",
    "                nn.init.constant_(m.bias, 0)\n",
    "\n",
    "    def _downsample_basic_block(self, x, planes, stride):\n",
    "        out = F.avg_pool3d(x, kernel_size=1, stride=stride)\n",
    "        zero_pads = torch.zeros(out.size(0), planes - out.size(1), out.size(2),\n",
    "                                out.size(3), out.size(4))\n",
    "        if isinstance(out.data, torch.cuda.FloatTensor):\n",
    "            zero_pads = zero_pads.cuda()\n",
    "\n",
    "        out = torch.cat([out.data, zero_pads], dim=1)\n",
    "\n",
    "        return out\n",
    "\n",
    "    def _make_layer(self, block, planes, blocks, shortcut_type, stride=1):\n",
    "        downsample = None\n",
    "        if stride != 1 or self.in_planes != planes * block.expansion:\n",
    "            if shortcut_type == 'A':\n",
    "                downsample = partial(self._downsample_basic_block,\n",
    "                                     planes=planes * block.expansion,\n",
    "                                     stride=stride)\n",
    "            else:\n",
    "                downsample = nn.Sequential(\n",
    "                    conv1x1x1(self.in_planes, planes * block.expansion, stride),\n",
    "                    nn.BatchNorm3d(planes * block.expansion))\n",
    "\n",
    "        layers = []\n",
    "        layers.append(\n",
    "            block(in_planes=self.in_planes,\n",
    "                  planes=planes,\n",
    "                  stride=stride,\n",
    "                  downsample=downsample))\n",
    "        self.in_planes = planes * block.expansion\n",
    "        for i in range(1, blocks):\n",
    "            layers.append(block(self.in_planes, planes))\n",
    "\n",
    "        return nn.Sequential(*layers)\n",
    "\n",
    "    def forward(self, x):\n",
    "        x = self.conv1(x)\n",
    "        x = self.bn1(x)\n",
    "        x = self.relu(x)\n",
    "        if not self.no_max_pool:\n",
    "            x = self.maxpool(x)\n",
    "\n",
    "        x = self.layer1(x)\n",
    "        x = self.layer2(x)\n",
    "        x = self.layer3(x)\n",
    "        x = self.layer4(x)\n",
    "\n",
    "        x = self.avgpool(x)\n",
    "\n",
    "        x = x.view(x.size(0), -1)\n",
    "        x = self.fc(x)\n",
    "\n",
    "        return x\n",
    "\n",
    "\n",
    "def generate_model(model_depth, **kwargs):\n",
    "    assert model_depth in [10, 18, 34, 50, 101, 152, 200]\n",
    "\n",
    "    if model_depth == 10:\n",
    "        model = ResNet(BasicBlock, [1, 1, 1, 1], get_inplanes(), **kwargs)\n",
    "    elif model_depth == 18:\n",
    "        model = ResNet(BasicBlock, [2, 2, 2, 2], get_inplanes(), **kwargs)\n",
    "    elif model_depth == 34:\n",
    "        model = ResNet(BasicBlock, [3, 4, 6, 3], get_inplanes(), **kwargs)\n",
    "    elif model_depth == 50:\n",
    "        model = ResNet(Bottleneck, [3, 4, 6, 3], get_inplanes(), **kwargs)\n",
    "    elif model_depth == 101:\n",
    "        model = ResNet(Bottleneck, [3, 4, 23, 3], get_inplanes(), **kwargs)\n",
    "    elif model_depth == 152:\n",
    "        model = ResNet(Bottleneck, [3, 8, 36, 3], get_inplanes(), **kwargs)\n",
    "    elif model_depth == 200:\n",
    "        model = ResNet(Bottleneck, [3, 24, 36, 3], get_inplanes(), **kwargs)\n",
    "\n",
    "    return model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 20,
   "id": "de085d45",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-22T08:29:52.436309Z",
     "iopub.status.busy": "2024-10-22T08:29:52.435428Z",
     "iopub.status.idle": "2024-10-22T08:29:52.439663Z",
     "shell.execute_reply": "2024-10-22T08:29:52.438780Z"
    },
    "papermill": {
     "duration": 0.022434,
     "end_time": "2024-10-22T08:29:52.441496",
     "exception": false,
     "start_time": "2024-10-22T08:29:52.419062",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "#model = ResNet3D(num_classes = 3)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 21,
   "id": "1c7013ed",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-22T08:29:52.476541Z",
     "iopub.status.busy": "2024-10-22T08:29:52.475790Z",
     "iopub.status.idle": "2024-10-22T08:29:53.565144Z",
     "shell.execute_reply": "2024-10-22T08:29:53.564306Z"
    },
    "papermill": {
     "duration": 1.109472,
     "end_time": "2024-10-22T08:29:53.567397",
     "exception": false,
     "start_time": "2024-10-22T08:29:52.457925",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "model = generate_model(34, n_input_channels = 3, n_classes = 700)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 22,
   "id": "c88c4b78",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-22T08:29:53.600399Z",
     "iopub.status.busy": "2024-10-22T08:29:53.599529Z",
     "iopub.status.idle": "2024-10-22T08:31:42.498728Z",
     "shell.execute_reply": "2024-10-22T08:31:42.497683Z"
    },
    "papermill": {
     "duration": 108.91834,
     "end_time": "2024-10-22T08:31:42.501310",
     "exception": false,
     "start_time": "2024-10-22T08:29:53.582970",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Retrieving notices: ...working... done\r\n",
      "Channels:\r\n",
      " - rapidsai\r\n",
      " - nvidia\r\n",
      " - nodefaults\r\n",
      " - conda-forge\r\n",
      " - defaults\r\n",
      " - pytorch\r\n",
      "Platform: linux-64\r\n",
      "Collecting package metadata (repodata.json): \\ \b\b| \b\b/ \b\b- \b\b\\ \b\b| \b\b/ \b\b- \b\b\\ \b\b| \b\b/ \b\b- \b\b\\ \b\b| \b\b/ \b\b- \b\b\\ \b\b| \b\b/ \b\b- \b\b\\ \b\b| \b\b/ \b\b- \b\b\\ \b\b| \b\b/ \b\b- \b\b\\ \b\b| \b\b/ \b\b- \b\b\\ \b\b| \b\b/ \b\b- \b\b\\ \b\b| \b\b/ \b\b- \b\b\\ \b\b| \b\b/ \b\b- \b\b\\ \b\b| \b\b/ \b\b- \b\b\\ \b\b| \b\b/ \b\b- \b\b\\ \b\b| \b\b/ \b\b- \b\b\\ \b\b| \b\b/ \b\b- \b\b\\ \b\b| \b\b/ \b\b- \b\b\\ \b\b| \b\b/ \b\b- \b\b\\ \b\b| \b\b/ \b\b- \b\b\\ \b\b| \b\b/ \b\b- \b\b\\ \b\b| \b\b/ \b\b- \b\b\\ \b\bdone\r\n",
      "Solving environment: / \b\b- \b\b\\ \b\b| \b\b/ \b\b- \b\b\\ \b\b| \b\b/ \b\b- \b\b\\ \b\b| \b\b/ \b\b- \b\b\\ \b\b| \b\b/ \b\b- \b\b\\ \b\b| \b\b/ \b\b- \b\b\\ \b\b| \b\b/ \b\b- \b\b\\ \b\b| \b\b/ \b\b- \b\b\\ \b\b| \b\b/ \b\b- \b\b\\ \b\b| \b\bdone\r\n",
      "\r\n",
      "## Package Plan ##\r\n",
      "\r\n",
      "  environment location: /opt/conda\r\n",
      "\r\n",
      "  added / updated specs:\r\n",
      "    - gdown\r\n",
      "\r\n",
      "\r\n",
      "The following packages will be downloaded:\r\n",
      "\r\n",
      "    package                    |            build\r\n",
      "    ---------------------------|-----------------\r\n",
      "    conda-24.9.2               |  py310hff52083_0         895 KB  conda-forge\r\n",
      "    filelock-3.16.1            |     pyhd8ed1ab_0          17 KB  conda-forge\r\n",
      "    gdown-5.2.0                |     pyhd8ed1ab_0          21 KB  conda-forge\r\n",
      "    ------------------------------------------------------------\r\n",
      "                                           Total:         933 KB\r\n",
      "\r\n",
      "The following NEW packages will be INSTALLED:\r\n",
      "\r\n",
      "  filelock           conda-forge/noarch::filelock-3.16.1-pyhd8ed1ab_0 \r\n",
      "  gdown              conda-forge/noarch::gdown-5.2.0-pyhd8ed1ab_0 \r\n",
      "\r\n",
      "The following packages will be UPDATED:\r\n",
      "\r\n",
      "  conda                              24.9.0-py310hff52083_0 --> 24.9.2-py310hff52083_0 \r\n",
      "\r\n",
      "\r\n",
      "\r\n",
      "Downloading and Extracting Packages:\r\n",
      "conda-24.9.2         | 895 KB    |                                       |   0% \r\n",
      "gdown-5.2.0          | 21 KB     |                                       |   0% \u001b[A\r\n",
      "\r\n",
      "conda-24.9.2         | 895 KB    | #################8                    |  48% \r\n",
      "gdown-5.2.0          | 21 KB     | ##################################### | 100% \u001b[A\r\n",
      "gdown-5.2.0          | 21 KB     | ##################################### | 100% \u001b[A\r\n",
      "\r\n",
      "filelock-3.16.1      | 17 KB     | ##################################### | 100% \u001b[A\u001b[A\r\n",
      "\r\n",
      "\r\n",
      "                                                                                \u001b[A\r\n",
      "\r\n",
      "\r\n",
      "Preparing transaction: - \b\bdone\r\n",
      "Verifying transaction: | \b\b/ \b\bdone\r\n",
      "Executing transaction: \\ \b\b| \b\b/ \b\b- \b\b\\ \b\b| \b\b/ \b\b- \b\b\\ \b\b| \b\b/ \b\b- \b\b\\ \b\b| \b\b/ \b\b- \b\b\\ \b\b| \b\b/ \b\b- \b\b\\ \b\b| \b\b/ \b\b- \b\b\\ \b\b| \b\b/ \b\b- \b\b\\ \b\b| \b\b/ \b\b- \b\b\\ \b\b| \b\b/ \b\b- \b\b\\ \b\b| \b\b/ \b\b- \b\b\\ \b\b| \b\b/ \b\b- \b\b\\ \b\b| \b\b/ \b\bdone\r\n"
     ]
    }
   ],
   "source": [
    "#Install package to load pretrained weights from google drive\n",
    "!conda install -y gdown"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 23,
   "id": "0f84491b",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-22T08:31:42.560622Z",
     "iopub.status.busy": "2024-10-22T08:31:42.559831Z",
     "iopub.status.idle": "2024-10-22T08:32:41.449002Z",
     "shell.execute_reply": "2024-10-22T08:32:41.447912Z"
    },
    "papermill": {
     "duration": 58.921648,
     "end_time": "2024-10-22T08:32:41.451435",
     "exception": false,
     "start_time": "2024-10-22T08:31:42.529787",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "/opt/conda/lib/python3.10/site-packages/gdown/__main__.py:140: FutureWarning: Option `--id` was deprecated in version 4.3.1 and will be removed in 5.0. You don't need to pass it anymore to use a file ID.\r\n",
      "  warnings.warn(\r\n",
      "Downloading...\r\n",
      "From (original): https://drive.google.com/uc?id=1fFN5J2He6eTqMPRl_M9gFtFfpUmhtQc9\r\n",
      "From (redirected): https://drive.google.com/uc?id=1fFN5J2He6eTqMPRl_M9gFtFfpUmhtQc9&confirm=t&uuid=8019ca4c-17e3-4606-bc43-e59fc76f2842\r\n",
      "To: /kaggle/working/r3d34_K_200ep.pth\r\n",
      "100%|████████████████████████████████████████| 511M/511M [00:51<00:00, 9.99MB/s]\r\n"
     ]
    }
   ],
   "source": [
    "!gdown --id 1fFN5J2He6eTqMPRl_M9gFtFfpUmhtQc9"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 24,
   "id": "e24da736",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-22T08:32:41.530744Z",
     "iopub.status.busy": "2024-10-22T08:32:41.529999Z",
     "iopub.status.idle": "2024-10-22T08:32:41.945550Z",
     "shell.execute_reply": "2024-10-22T08:32:41.944697Z"
    },
    "papermill": {
     "duration": 0.457613,
     "end_time": "2024-10-22T08:32:41.948122",
     "exception": false,
     "start_time": "2024-10-22T08:32:41.490509",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/tmp/ipykernel_23/1842076349.py:1: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.\n",
      "  pretrain = torch.load(\"/kaggle/working/r3d34_K_200ep.pth\", map_location='cpu')\n"
     ]
    }
   ],
   "source": [
    "\n",
    "pretrain = torch.load(\"/kaggle/working/r3d34_K_200ep.pth\", map_location='cpu')\n",
    "\n",
    "model.load_state_dict(pretrain['state_dict'])\n",
    "block_inplanes = get_inplanes()\n",
    "model.conv1 = nn.Conv3d(1,\n",
    "                        block_inplanes[0],\n",
    "                        kernel_size=(7, 7, 7),\n",
    "                        stride=(1, 2, 2),\n",
    "                        padding=(7 // 2, 3, 3),\n",
    "                        bias=False)\n",
    "model.conv1.weight = torch.nn.Parameter(pretrain['state_dict'][\"conv1.weight\"].mean(dim=1, keepdim=True))\n",
    "model.fc = nn.Linear(model.fc.in_features,3)\n",
    "\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 25,
   "id": "a036e8a7",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-22T08:32:42.032810Z",
     "iopub.status.busy": "2024-10-22T08:32:42.032017Z",
     "iopub.status.idle": "2024-10-22T08:32:42.323538Z",
     "shell.execute_reply": "2024-10-22T08:32:42.322628Z"
    },
    "papermill": {
     "duration": 0.333556,
     "end_time": "2024-10-22T08:32:42.325626",
     "exception": false,
     "start_time": "2024-10-22T08:32:41.992070",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "ResNet(\n",
       "  (conv1): Conv3d(1, 64, kernel_size=(7, 7, 7), stride=(1, 2, 2), padding=(3, 3, 3), bias=False)\n",
       "  (bn1): BatchNorm3d(64, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n",
       "  (relu): ReLU(inplace=True)\n",
       "  (maxpool): MaxPool3d(kernel_size=3, stride=2, padding=1, dilation=1, ceil_mode=False)\n",
       "  (layer1): Sequential(\n",
       "    (0): BasicBlock(\n",
       "      (conv1): Conv3d(64, 64, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1), bias=False)\n",
       "      (bn1): BatchNorm3d(64, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n",
       "      (relu): ReLU(inplace=True)\n",
       "      (conv2): Conv3d(64, 64, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1), bias=False)\n",
       "      (bn2): BatchNorm3d(64, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n",
       "    )\n",
       "    (1): BasicBlock(\n",
       "      (conv1): Conv3d(64, 64, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1), bias=False)\n",
       "      (bn1): BatchNorm3d(64, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n",
       "      (relu): ReLU(inplace=True)\n",
       "      (conv2): Conv3d(64, 64, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1), bias=False)\n",
       "      (bn2): BatchNorm3d(64, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n",
       "    )\n",
       "    (2): BasicBlock(\n",
       "      (conv1): Conv3d(64, 64, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1), bias=False)\n",
       "      (bn1): BatchNorm3d(64, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n",
       "      (relu): ReLU(inplace=True)\n",
       "      (conv2): Conv3d(64, 64, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1), bias=False)\n",
       "      (bn2): BatchNorm3d(64, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n",
       "    )\n",
       "  )\n",
       "  (layer2): Sequential(\n",
       "    (0): BasicBlock(\n",
       "      (conv1): Conv3d(64, 128, kernel_size=(3, 3, 3), stride=(2, 2, 2), padding=(1, 1, 1), bias=False)\n",
       "      (bn1): BatchNorm3d(128, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n",
       "      (relu): ReLU(inplace=True)\n",
       "      (conv2): Conv3d(128, 128, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1), bias=False)\n",
       "      (bn2): BatchNorm3d(128, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n",
       "      (downsample): Sequential(\n",
       "        (0): Conv3d(64, 128, kernel_size=(1, 1, 1), stride=(2, 2, 2), bias=False)\n",
       "        (1): BatchNorm3d(128, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n",
       "      )\n",
       "    )\n",
       "    (1): BasicBlock(\n",
       "      (conv1): Conv3d(128, 128, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1), bias=False)\n",
       "      (bn1): BatchNorm3d(128, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n",
       "      (relu): ReLU(inplace=True)\n",
       "      (conv2): Conv3d(128, 128, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1), bias=False)\n",
       "      (bn2): BatchNorm3d(128, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n",
       "    )\n",
       "    (2): BasicBlock(\n",
       "      (conv1): Conv3d(128, 128, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1), bias=False)\n",
       "      (bn1): BatchNorm3d(128, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n",
       "      (relu): ReLU(inplace=True)\n",
       "      (conv2): Conv3d(128, 128, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1), bias=False)\n",
       "      (bn2): BatchNorm3d(128, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n",
       "    )\n",
       "    (3): BasicBlock(\n",
       "      (conv1): Conv3d(128, 128, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1), bias=False)\n",
       "      (bn1): BatchNorm3d(128, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n",
       "      (relu): ReLU(inplace=True)\n",
       "      (conv2): Conv3d(128, 128, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1), bias=False)\n",
       "      (bn2): BatchNorm3d(128, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n",
       "    )\n",
       "  )\n",
       "  (layer3): Sequential(\n",
       "    (0): BasicBlock(\n",
       "      (conv1): Conv3d(128, 256, kernel_size=(3, 3, 3), stride=(2, 2, 2), padding=(1, 1, 1), bias=False)\n",
       "      (bn1): BatchNorm3d(256, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n",
       "      (relu): ReLU(inplace=True)\n",
       "      (conv2): Conv3d(256, 256, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1), bias=False)\n",
       "      (bn2): BatchNorm3d(256, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n",
       "      (downsample): Sequential(\n",
       "        (0): Conv3d(128, 256, kernel_size=(1, 1, 1), stride=(2, 2, 2), bias=False)\n",
       "        (1): BatchNorm3d(256, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n",
       "      )\n",
       "    )\n",
       "    (1): BasicBlock(\n",
       "      (conv1): Conv3d(256, 256, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1), bias=False)\n",
       "      (bn1): BatchNorm3d(256, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n",
       "      (relu): ReLU(inplace=True)\n",
       "      (conv2): Conv3d(256, 256, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1), bias=False)\n",
       "      (bn2): BatchNorm3d(256, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n",
       "    )\n",
       "    (2): BasicBlock(\n",
       "      (conv1): Conv3d(256, 256, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1), bias=False)\n",
       "      (bn1): BatchNorm3d(256, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n",
       "      (relu): ReLU(inplace=True)\n",
       "      (conv2): Conv3d(256, 256, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1), bias=False)\n",
       "      (bn2): BatchNorm3d(256, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n",
       "    )\n",
       "    (3): BasicBlock(\n",
       "      (conv1): Conv3d(256, 256, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1), bias=False)\n",
       "      (bn1): BatchNorm3d(256, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n",
       "      (relu): ReLU(inplace=True)\n",
       "      (conv2): Conv3d(256, 256, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1), bias=False)\n",
       "      (bn2): BatchNorm3d(256, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n",
       "    )\n",
       "    (4): BasicBlock(\n",
       "      (conv1): Conv3d(256, 256, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1), bias=False)\n",
       "      (bn1): BatchNorm3d(256, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n",
       "      (relu): ReLU(inplace=True)\n",
       "      (conv2): Conv3d(256, 256, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1), bias=False)\n",
       "      (bn2): BatchNorm3d(256, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n",
       "    )\n",
       "    (5): BasicBlock(\n",
       "      (conv1): Conv3d(256, 256, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1), bias=False)\n",
       "      (bn1): BatchNorm3d(256, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n",
       "      (relu): ReLU(inplace=True)\n",
       "      (conv2): Conv3d(256, 256, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1), bias=False)\n",
       "      (bn2): BatchNorm3d(256, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n",
       "    )\n",
       "  )\n",
       "  (layer4): Sequential(\n",
       "    (0): BasicBlock(\n",
       "      (conv1): Conv3d(256, 512, kernel_size=(3, 3, 3), stride=(2, 2, 2), padding=(1, 1, 1), bias=False)\n",
       "      (bn1): BatchNorm3d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n",
       "      (relu): ReLU(inplace=True)\n",
       "      (conv2): Conv3d(512, 512, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1), bias=False)\n",
       "      (bn2): BatchNorm3d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n",
       "      (downsample): Sequential(\n",
       "        (0): Conv3d(256, 512, kernel_size=(1, 1, 1), stride=(2, 2, 2), bias=False)\n",
       "        (1): BatchNorm3d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n",
       "      )\n",
       "    )\n",
       "    (1): BasicBlock(\n",
       "      (conv1): Conv3d(512, 512, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1), bias=False)\n",
       "      (bn1): BatchNorm3d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n",
       "      (relu): ReLU(inplace=True)\n",
       "      (conv2): Conv3d(512, 512, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1), bias=False)\n",
       "      (bn2): BatchNorm3d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n",
       "    )\n",
       "    (2): BasicBlock(\n",
       "      (conv1): Conv3d(512, 512, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1), bias=False)\n",
       "      (bn1): BatchNorm3d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n",
       "      (relu): ReLU(inplace=True)\n",
       "      (conv2): Conv3d(512, 512, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1), bias=False)\n",
       "      (bn2): BatchNorm3d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n",
       "    )\n",
       "  )\n",
       "  (avgpool): AdaptiveAvgPool3d(output_size=(1, 1, 1))\n",
       "  (fc): Linear(in_features=512, out_features=3, bias=True)\n",
       ")"
      ]
     },
     "execution_count": 25,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "device = torch.device(\"cuda\" if torch.cuda.is_available() else \"cpu\")\n",
    "model.to(device)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 26,
   "id": "6792ccd2",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-22T08:32:42.406424Z",
     "iopub.status.busy": "2024-10-22T08:32:42.405523Z",
     "iopub.status.idle": "2024-10-22T08:32:54.179607Z",
     "shell.execute_reply": "2024-10-22T08:32:54.178600Z"
    },
    "papermill": {
     "duration": 11.817,
     "end_time": "2024-10-22T08:32:54.182139",
     "exception": false,
     "start_time": "2024-10-22T08:32:42.365139",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Collecting focal_loss_torch\r\n",
      "  Downloading focal_loss_torch-0.1.2-py3-none-any.whl.metadata (2.2 kB)\r\n",
      "Requirement already satisfied: torch in /opt/conda/lib/python3.10/site-packages (from focal_loss_torch) (2.4.0)\r\n",
      "Requirement already satisfied: numpy in /opt/conda/lib/python3.10/site-packages (from focal_loss_torch) (1.26.4)\r\n",
      "Requirement already satisfied: filelock in /opt/conda/lib/python3.10/site-packages (from torch->focal_loss_torch) (3.15.1)\r\n",
      "Requirement already satisfied: typing-extensions>=4.8.0 in /opt/conda/lib/python3.10/site-packages (from torch->focal_loss_torch) (4.12.2)\r\n",
      "Requirement already satisfied: sympy in /opt/conda/lib/python3.10/site-packages (from torch->focal_loss_torch) (1.13.3)\r\n",
      "Requirement already satisfied: networkx in /opt/conda/lib/python3.10/site-packages (from torch->focal_loss_torch) (3.3)\r\n",
      "Requirement already satisfied: jinja2 in /opt/conda/lib/python3.10/site-packages (from torch->focal_loss_torch) (3.1.4)\r\n",
      "Requirement already satisfied: fsspec in /opt/conda/lib/python3.10/site-packages (from torch->focal_loss_torch) (2024.6.1)\r\n",
      "Requirement already satisfied: MarkupSafe>=2.0 in /opt/conda/lib/python3.10/site-packages (from jinja2->torch->focal_loss_torch) (2.1.5)\r\n",
      "Requirement already satisfied: mpmath<1.4,>=1.1.0 in /opt/conda/lib/python3.10/site-packages (from sympy->torch->focal_loss_torch) (1.3.0)\r\n",
      "Downloading focal_loss_torch-0.1.2-py3-none-any.whl (4.5 kB)\r\n",
      "Installing collected packages: focal_loss_torch\r\n",
      "Successfully installed focal_loss_torch-0.1.2\r\n"
     ]
    }
   ],
   "source": [
    "#https://github.com/mathiaszinnen/focal_loss_torch/tree/main\n",
    "!pip install focal_loss_torch"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 27,
   "id": "0b2a74d0",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-22T08:32:54.264372Z",
     "iopub.status.busy": "2024-10-22T08:32:54.263930Z",
     "iopub.status.idle": "2024-10-22T17:21:13.759893Z",
     "shell.execute_reply": "2024-10-22T17:21:13.758952Z"
    },
    "papermill": {
     "duration": 31699.539404,
     "end_time": "2024-10-22T17:21:13.761906",
     "exception": false,
     "start_time": "2024-10-22T08:32:54.222502",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\u001b[34m\u001b[1mwandb\u001b[0m: Currently logged in as: \u001b[33mpietro-caforio\u001b[0m (\u001b[33mpietro-caforio-politecnico-di-milano\u001b[0m). Use \u001b[1m`wandb login --relogin`\u001b[0m to force relogin\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Tracking run with wandb version 0.18.3\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run data is saved locally in \u001b[35m\u001b[1m/kaggle/working/wandb/run-20241022_083254-3lhmacz2\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run \u001b[1m`wandb offline`\u001b[0m to turn off syncing.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Syncing run \u001b[33mResNet3D-34 customsampler121 pretrained\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: ⭐️ View project at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/CPTACUCEC_3D_unimodal_CT\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: 🚀 View run at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/CPTACUCEC_3D_unimodal_CT/runs/3lhmacz2\u001b[0m\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Epoch 1, Loss: 1.2814850828864357\n",
      "Validation Loss: 1.2973017600866465, Total Accuracy: 26.92%\n",
      "Accuracy per class - G1: 78.57%, G2: 0.00%, G3: 21.43%\n",
      "Epoch 2, Loss: 1.2347496542063627\n",
      "Validation Loss: 1.3234155338544111, Total Accuracy: 26.92%\n",
      "Accuracy per class - G1: 78.57%, G2: 0.00%, G3: 21.43%\n",
      "Epoch 3, Loss: 1.2266153628175909\n",
      "Validation Loss: 1.310364769055293, Total Accuracy: 26.92%\n",
      "Accuracy per class - G1: 85.71%, G2: 0.00%, G3: 14.29%\n",
      "Epoch 4, Loss: 1.2167701905423944\n",
      "Validation Loss: 1.3068436682224274, Total Accuracy: 25.00%\n",
      "Accuracy per class - G1: 92.86%, G2: 0.00%, G3: 0.00%\n",
      "Epoch 5, Loss: 1.2069857467304577\n",
      "Validation Loss: 1.3143147390622358, Total Accuracy: 25.00%\n",
      "Accuracy per class - G1: 78.57%, G2: 0.00%, G3: 14.29%\n",
      "Epoch 6, Loss: 1.2311432892625982\n",
      "Validation Loss: 1.3311706597988422, Total Accuracy: 23.08%\n",
      "Accuracy per class - G1: 78.57%, G2: 0.00%, G3: 7.14%\n",
      "Epoch 7, Loss: 1.1666682416742498\n",
      "Validation Loss: 1.3181745111942291, Total Accuracy: 25.00%\n",
      "Accuracy per class - G1: 85.71%, G2: 0.00%, G3: 7.14%\n",
      "Epoch 8, Loss: 1.1860134189779108\n",
      "Validation Loss: 1.3282796717607057, Total Accuracy: 25.00%\n",
      "Accuracy per class - G1: 85.71%, G2: 0.00%, G3: 7.14%\n",
      "Epoch 9, Loss: 1.1984864137389444\n",
      "Validation Loss: 1.3126060045682466, Total Accuracy: 26.92%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 0.00%\n",
      "Epoch 10, Loss: 1.1610702644694935\n",
      "Validation Loss: 1.3459557547019079, Total Accuracy: 25.00%\n",
      "Accuracy per class - G1: 85.71%, G2: 0.00%, G3: 7.14%\n",
      "Epoch 11, Loss: 1.1535755721005527\n",
      "Validation Loss: 1.2972373962402344, Total Accuracy: 32.69%\n",
      "Accuracy per class - G1: 100.00%, G2: 12.50%, G3: 0.00%\n",
      "Epoch 12, Loss: 1.1111665909940547\n",
      "Validation Loss: 1.360844687773631, Total Accuracy: 28.85%\n",
      "Accuracy per class - G1: 85.71%, G2: 8.33%, G3: 7.14%\n",
      "Epoch 13, Loss: 1.13139048056169\n",
      "Validation Loss: 1.3433266167457287, Total Accuracy: 38.46%\n",
      "Accuracy per class - G1: 100.00%, G2: 25.00%, G3: 0.00%\n",
      "Epoch 14, Loss: 1.1234425577250393\n",
      "Validation Loss: 1.3419864865449758, Total Accuracy: 44.23%\n",
      "Accuracy per class - G1: 92.86%, G2: 41.67%, G3: 0.00%\n",
      "Epoch 15, Loss: 1.09559209021655\n",
      "Validation Loss: 1.3193987883054292, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 50.00%, G2: 50.00%, G3: 0.00%\n",
      "Epoch 16, Loss: 1.1381917964328419\n",
      "Validation Loss: 1.3641547835790193, Total Accuracy: 44.23%\n",
      "Accuracy per class - G1: 92.86%, G2: 41.67%, G3: 0.00%\n",
      "Epoch 17, Loss: 1.037440555745905\n",
      "Validation Loss: 1.374415716299644, Total Accuracy: 42.31%\n",
      "Accuracy per class - G1: 92.86%, G2: 33.33%, G3: 7.14%\n",
      "Epoch 18, Loss: 1.0664639592170715\n",
      "Validation Loss: 1.377452206153136, Total Accuracy: 42.31%\n",
      "Accuracy per class - G1: 71.43%, G2: 50.00%, G3: 0.00%\n",
      "Epoch 19, Loss: 1.0747861461205916\n",
      "Validation Loss: 1.3595172373148112, Total Accuracy: 40.38%\n",
      "Accuracy per class - G1: 64.29%, G2: 50.00%, G3: 0.00%\n",
      "Epoch 20, Loss: 1.036441690271551\n",
      "Validation Loss: 1.361515074968338, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 50.00%, G2: 50.00%, G3: 0.00%\n",
      "Epoch 21, Loss: 1.0365200346166437\n",
      "Validation Loss: 1.3805486514018133, Total Accuracy: 42.31%\n",
      "Accuracy per class - G1: 71.43%, G2: 50.00%, G3: 0.00%\n",
      "Epoch 22, Loss: 1.0127012198621577\n",
      "Validation Loss: 1.3807950684657464, Total Accuracy: 40.38%\n",
      "Accuracy per class - G1: 64.29%, G2: 50.00%, G3: 0.00%\n",
      "Epoch 23, Loss: 1.0499271945519881\n",
      "Validation Loss: 1.3607128858566284, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 50.00%, G2: 50.00%, G3: 0.00%\n",
      "Epoch 24, Loss: 1.0071388233791698\n",
      "Validation Loss: 1.3694126468438368, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 50.00%, G2: 50.00%, G3: 0.00%\n",
      "Epoch 25, Loss: 0.9755594080144708\n",
      "Validation Loss: 1.3918727544637828, Total Accuracy: 38.46%\n",
      "Accuracy per class - G1: 57.14%, G2: 50.00%, G3: 0.00%\n",
      "Epoch 26, Loss: 0.9883064497600902\n",
      "Validation Loss: 1.394835692185622, Total Accuracy: 38.46%\n",
      "Accuracy per class - G1: 57.14%, G2: 50.00%, G3: 0.00%\n",
      "Epoch 27, Loss: 0.9538921800526705\n",
      "Validation Loss: 1.3941812882056603, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 50.00%, G2: 50.00%, G3: 0.00%\n",
      "Epoch 28, Loss: 0.9651473663069985\n",
      "Validation Loss: 1.3706393906703362, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 50.00%, G2: 50.00%, G3: 0.00%\n",
      "Epoch 29, Loss: 0.9775744275613265\n",
      "Validation Loss: 1.3883065833495214, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 50.00%, G2: 50.00%, G3: 0.00%\n",
      "Epoch 30, Loss: 0.9658562638542869\n",
      "Validation Loss: 1.3544703148878539, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 50.00%, G2: 50.00%, G3: 0.00%\n",
      "Epoch 31, Loss: 0.9582732894203879\n",
      "Validation Loss: 1.3822574707177968, Total Accuracy: 38.46%\n",
      "Accuracy per class - G1: 50.00%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 32, Loss: 0.9049149610779502\n",
      "Validation Loss: 1.4118447945668147, Total Accuracy: 38.46%\n",
      "Accuracy per class - G1: 50.00%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 33, Loss: 0.9250131715427745\n",
      "Validation Loss: 1.397896177493609, Total Accuracy: 38.46%\n",
      "Accuracy per class - G1: 50.00%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 34, Loss: 0.9385349609635093\n",
      "Validation Loss: 1.358374806550833, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 50.00%, G2: 50.00%, G3: 0.00%\n",
      "Epoch 35, Loss: 0.9071693778038025\n",
      "Validation Loss: 1.3719629828746502, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 50.00%, G2: 50.00%, G3: 0.00%\n",
      "Epoch 36, Loss: 0.8901154149662365\n",
      "Validation Loss: 1.3752736426316774, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 50.00%, G2: 50.00%, G3: 0.00%\n",
      "Epoch 37, Loss: 0.8916123173453591\n",
      "Validation Loss: 1.3983232447734246, Total Accuracy: 34.62%\n",
      "Accuracy per class - G1: 35.71%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 38, Loss: 0.8456047014756636\n",
      "Validation Loss: 1.3874105788194215, Total Accuracy: 38.46%\n",
      "Accuracy per class - G1: 50.00%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 39, Loss: 0.8906106840480458\n",
      "Validation Loss: 1.3798100558611064, Total Accuracy: 38.46%\n",
      "Accuracy per class - G1: 50.00%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 40, Loss: 0.8375762039964849\n",
      "Validation Loss: 1.4266294309726129, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 41, Loss: 0.8604092251170765\n",
      "Validation Loss: 1.3978771429795485, Total Accuracy: 38.46%\n",
      "Accuracy per class - G1: 50.00%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 42, Loss: 0.8426109844988042\n",
      "Validation Loss: 1.335036195241488, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 50.00%, G2: 50.00%, G3: 0.00%\n",
      "Epoch 43, Loss: 0.798336171020161\n",
      "Validation Loss: 1.3936134347548852, Total Accuracy: 38.46%\n",
      "Accuracy per class - G1: 50.00%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 44, Loss: 0.7885950099338185\n",
      "Validation Loss: 1.35907644033432, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 50.00%, G2: 50.00%, G3: 0.00%\n",
      "Epoch 45, Loss: 0.826043980771845\n",
      "Validation Loss: 1.419952697478808, Total Accuracy: 34.62%\n",
      "Accuracy per class - G1: 35.71%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 46, Loss: 0.8279165105386214\n",
      "Validation Loss: 1.3966212410193224, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 47, Loss: 0.8068870089270852\n",
      "Validation Loss: 1.3792752715257497, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 50.00%, G2: 50.00%, G3: 0.00%\n",
      "Epoch 48, Loss: 0.8706249085339632\n",
      "Validation Loss: 1.336929426743434, Total Accuracy: 38.46%\n",
      "Accuracy per class - G1: 50.00%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 49, Loss: 0.8504549687558954\n",
      "Validation Loss: 1.3774542143711677, Total Accuracy: 38.46%\n",
      "Accuracy per class - G1: 50.00%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 50, Loss: 0.86151531717994\n",
      "Validation Loss: 1.3948628558562353, Total Accuracy: 34.62%\n",
      "Accuracy per class - G1: 35.71%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 51, Loss: 0.8201748165217313\n",
      "Validation Loss: 1.3775940720851605, Total Accuracy: 38.46%\n",
      "Accuracy per class - G1: 50.00%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 52, Loss: 0.8258707349950617\n",
      "Validation Loss: 1.3704237502354841, Total Accuracy: 34.62%\n",
      "Accuracy per class - G1: 35.71%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 53, Loss: 0.7717249751091003\n",
      "Validation Loss: 1.3900026381015778, Total Accuracy: 38.46%\n",
      "Accuracy per class - G1: 50.00%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 54, Loss: 0.8155281489545648\n",
      "Validation Loss: 1.3623295701467073, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 50.00%, G2: 50.00%, G3: 0.00%\n",
      "Epoch 55, Loss: 0.7981578642671758\n",
      "Validation Loss: 1.3498631578225355, Total Accuracy: 38.46%\n",
      "Accuracy per class - G1: 50.00%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 56, Loss: 0.8255365734750574\n",
      "Validation Loss: 1.395286541718703, Total Accuracy: 38.46%\n",
      "Accuracy per class - G1: 50.00%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 57, Loss: 0.8205703095956283\n",
      "Validation Loss: 1.370460957288742, Total Accuracy: 38.46%\n",
      "Accuracy per class - G1: 50.00%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 58, Loss: 0.8291180437261408\n",
      "Validation Loss: 1.368387364424192, Total Accuracy: 38.46%\n",
      "Accuracy per class - G1: 50.00%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 59, Loss: 0.8131790681318803\n",
      "Validation Loss: 1.3553381172510295, Total Accuracy: 38.46%\n",
      "Accuracy per class - G1: 50.00%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 60, Loss: 0.8001780065623196\n",
      "Validation Loss: 1.3647934267154107, Total Accuracy: 38.46%\n",
      "Accuracy per class - G1: 50.00%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 61, Loss: 0.8158303434198553\n",
      "Validation Loss: 1.3452207881670732, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 50.00%, G2: 50.00%, G3: 0.00%\n",
      "Epoch 62, Loss: 0.8191147777167234\n",
      "Validation Loss: 1.3607260699455554, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 50.00%, G2: 50.00%, G3: 0.00%\n",
      "Epoch 63, Loss: 0.8145958748730746\n",
      "Validation Loss: 1.390574118265739, Total Accuracy: 38.46%\n",
      "Accuracy per class - G1: 50.00%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 64, Loss: 0.7579398306933316\n",
      "Validation Loss: 1.3619666626820197, Total Accuracy: 38.46%\n",
      "Accuracy per class - G1: 50.00%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 65, Loss: 0.8035483333197507\n",
      "Validation Loss: 1.3460491276704347, Total Accuracy: 38.46%\n",
      "Accuracy per class - G1: 50.00%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 66, Loss: 0.7408672278577632\n",
      "Validation Loss: 1.3868569204440484, Total Accuracy: 38.46%\n",
      "Accuracy per class - G1: 50.00%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 67, Loss: 0.7611095959489996\n",
      "Validation Loss: 1.3292496754572942, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 50.00%, G2: 50.00%, G3: 0.00%\n",
      "Epoch 68, Loss: 0.7931044979528947\n",
      "Validation Loss: 1.3758242428302765, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 69, Loss: 0.7951099742542613\n",
      "Validation Loss: 1.3708434746815608, Total Accuracy: 38.46%\n",
      "Accuracy per class - G1: 50.00%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 70, Loss: 0.7641309851949866\n",
      "Validation Loss: 1.3834164784504817, Total Accuracy: 38.46%\n",
      "Accuracy per class - G1: 50.00%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 71, Loss: 0.7953781203790145\n",
      "Validation Loss: 1.3505282929310432, Total Accuracy: 38.46%\n",
      "Accuracy per class - G1: 50.00%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 72, Loss: 0.7748536684296348\n",
      "Validation Loss: 1.3534863178546612, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 73, Loss: 0.7869269436055963\n",
      "Validation Loss: 1.3587821194758782, Total Accuracy: 38.46%\n",
      "Accuracy per class - G1: 50.00%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 74, Loss: 0.7873589201406999\n",
      "Validation Loss: 1.3384444094621217, Total Accuracy: 38.46%\n",
      "Accuracy per class - G1: 50.00%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 75, Loss: 0.7800481151450764\n",
      "Validation Loss: 1.3342740719134991, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 76, Loss: 0.7609507219357924\n",
      "Validation Loss: 1.3338781893253326, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 77, Loss: 0.7144689619541168\n",
      "Validation Loss: 1.3534769805578084, Total Accuracy: 38.46%\n",
      "Accuracy per class - G1: 50.00%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 78, Loss: 0.7446196366440166\n",
      "Validation Loss: 1.3678875084106739, Total Accuracy: 38.46%\n",
      "Accuracy per class - G1: 50.00%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 79, Loss: 0.7217569134452126\n",
      "Validation Loss: 1.3691447285505443, Total Accuracy: 38.46%\n",
      "Accuracy per class - G1: 50.00%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 80, Loss: 0.7607521642338145\n",
      "Validation Loss: 1.3372696936130524, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 81, Loss: 0.7605900726535103\n",
      "Validation Loss: 1.3668162478850439, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 82, Loss: 0.7447956231507388\n",
      "Validation Loss: 1.367477671458171, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 50.00%, G2: 50.00%, G3: 0.00%\n",
      "Epoch 83, Loss: 0.7567382389848882\n",
      "Validation Loss: 1.3520813378003926, Total Accuracy: 34.62%\n",
      "Accuracy per class - G1: 35.71%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 84, Loss: 0.7637168396602977\n",
      "Validation Loss: 1.3611748493634737, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 85, Loss: 0.721155892718922\n",
      "Validation Loss: 1.3216302280242627, Total Accuracy: 34.62%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 0.00%\n",
      "Epoch 86, Loss: 0.7470706809650768\n",
      "Validation Loss: 1.340061176281709, Total Accuracy: 38.46%\n",
      "Accuracy per class - G1: 50.00%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 87, Loss: 0.7889230056242509\n",
      "Validation Loss: 1.3212769490021925, Total Accuracy: 34.62%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 0.00%\n",
      "Epoch 88, Loss: 0.7426265494389968\n",
      "Validation Loss: 1.3427317302960615, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 50.00%, G2: 50.00%, G3: 0.00%\n",
      "Epoch 89, Loss: 0.7355944026600231\n",
      "Validation Loss: 1.3570892352324266, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 50.00%, G2: 50.00%, G3: 0.00%\n",
      "Epoch 90, Loss: 0.7642118231816726\n",
      "Validation Loss: 1.331203586780108, Total Accuracy: 34.62%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 0.00%\n",
      "Epoch 91, Loss: 0.7195878494869579\n",
      "Validation Loss: 1.3558154151989863, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 92, Loss: 0.7550164726647464\n",
      "Validation Loss: 1.3336556760164409, Total Accuracy: 34.62%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 0.00%\n",
      "Epoch 93, Loss: 0.7468033584681424\n",
      "Validation Loss: 1.3556137130810664, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 94, Loss: 0.765169923955744\n",
      "Validation Loss: 1.3720127550455241, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 95, Loss: 0.7474159522490068\n",
      "Validation Loss: 1.356012156376472, Total Accuracy: 38.46%\n",
      "Accuracy per class - G1: 50.00%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 96, Loss: 0.7432431264357133\n",
      "Validation Loss: 1.3694149003579066, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 97, Loss: 0.7167475120587783\n",
      "Validation Loss: 1.3970536910570586, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 98, Loss: 0.7179457653652538\n",
      "Validation Loss: 1.3523960480323205, Total Accuracy: 38.46%\n",
      "Accuracy per class - G1: 50.00%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 99, Loss: 0.698700857704336\n",
      "Validation Loss: 1.369595589546057, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 100, Loss: 0.7077725914391604\n",
      "Validation Loss: 1.3583107957473168, Total Accuracy: 32.69%\n",
      "Accuracy per class - G1: 28.57%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 101, Loss: 0.739157127792185\n",
      "Validation Loss: 1.3529125199868128, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 50.00%, G2: 50.00%, G3: 0.00%\n",
      "Epoch 102, Loss: 0.7042015715078874\n",
      "Validation Loss: 1.3685098817715278, Total Accuracy: 32.69%\n",
      "Accuracy per class - G1: 28.57%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 103, Loss: 0.7399244752797214\n",
      "Validation Loss: 1.3645362899853632, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 104, Loss: 0.6845866533842954\n",
      "Validation Loss: 1.3728708578990056, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 105, Loss: 0.7398591670123014\n",
      "Validation Loss: 1.3535006848665385, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 106, Loss: 0.7444034934043884\n",
      "Validation Loss: 1.3672640174627304, Total Accuracy: 34.62%\n",
      "Accuracy per class - G1: 35.71%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 107, Loss: 0.6840306867252697\n",
      "Validation Loss: 1.3473265652473156, Total Accuracy: 38.46%\n",
      "Accuracy per class - G1: 50.00%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 108, Loss: 0.7196364478631453\n",
      "Validation Loss: 1.3594359961839824, Total Accuracy: 32.69%\n",
      "Accuracy per class - G1: 28.57%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 109, Loss: 0.740608770197088\n",
      "Validation Loss: 1.323637033884342, Total Accuracy: 34.62%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 0.00%\n",
      "Epoch 110, Loss: 0.7669217353517359\n",
      "Validation Loss: 1.3412476938504438, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 111, Loss: 0.7626954490488226\n",
      "Validation Loss: 1.3773089486819048, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 112, Loss: 0.7483722887255929\n",
      "Validation Loss: 1.3354009894224315, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 113, Loss: 0.7104510047219016\n",
      "Validation Loss: 1.3679933341649861, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 114, Loss: 0.7050542262467471\n",
      "Validation Loss: 1.337626113341405, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 115, Loss: 0.7404234804890373\n",
      "Validation Loss: 1.3447291254997253, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 116, Loss: 0.7485506014390425\n",
      "Validation Loss: 1.3597957228238766, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 117, Loss: 0.7486017194661228\n",
      "Validation Loss: 1.3530029127231011, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 118, Loss: 0.7426364828239788\n",
      "Validation Loss: 1.3472302957223012, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 119, Loss: 0.7019179951060902\n",
      "Validation Loss: 1.3625484521572406, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 120, Loss: 0.7725253587419336\n",
      "Validation Loss: 1.3804533664996808, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 121, Loss: 0.728541493957693\n",
      "Validation Loss: 1.3697556486496558, Total Accuracy: 38.46%\n",
      "Accuracy per class - G1: 50.00%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 122, Loss: 0.7422474844889208\n",
      "Validation Loss: 1.3610888364223332, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 123, Loss: 0.7425634855573827\n",
      "Validation Loss: 1.3663345048060784, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 124, Loss: 0.7029044205492193\n",
      "Validation Loss: 1.3462841029350574, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 125, Loss: 0.7591431021690369\n",
      "Validation Loss: 1.340189319390517, Total Accuracy: 34.62%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 0.00%\n",
      "Epoch 126, Loss: 0.7185931921005249\n",
      "Validation Loss: 1.3629837185144424, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 127, Loss: 0.7159067061814395\n",
      "Validation Loss: 1.3155773809322944, Total Accuracy: 34.62%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 0.00%\n",
      "Epoch 128, Loss: 0.7210991664366289\n",
      "Validation Loss: 1.373041542676779, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 129, Loss: 0.7184823968193748\n",
      "Validation Loss: 1.3597948046830983, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 130, Loss: 0.7200733504512093\n",
      "Validation Loss: 1.3518662406848028, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 131, Loss: 0.7032631234689193\n",
      "Validation Loss: 1.3399217472626612, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 132, Loss: 0.6967372032729062\n",
      "Validation Loss: 1.325770080089569, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 133, Loss: 0.7180054388263009\n",
      "Validation Loss: 1.3197888800731072, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 134, Loss: 0.7826760086146268\n",
      "Validation Loss: 1.3457307242430174, Total Accuracy: 34.62%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 0.00%\n",
      "Epoch 135, Loss: 0.7328772821209647\n",
      "Validation Loss: 1.3351851495412679, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 136, Loss: 0.738756103407253\n",
      "Validation Loss: 1.3584309438100228, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 137, Loss: 0.6926879769021814\n",
      "Validation Loss: 1.356950120284007, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 138, Loss: 0.7015877425670624\n",
      "Validation Loss: 1.3202747060702398, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 139, Loss: 0.7050881006500938\n",
      "Validation Loss: 1.3330579285438244, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 140, Loss: 0.7386071822860024\n",
      "Validation Loss: 1.3291613562748983, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 141, Loss: 0.7055733984166925\n",
      "Validation Loss: 1.3287121401383326, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 142, Loss: 0.7265577224167911\n",
      "Validation Loss: 1.3509432856853192, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 143, Loss: 0.7214270998131145\n",
      "Validation Loss: 1.3254031378489275, Total Accuracy: 34.62%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 0.00%\n",
      "Epoch 144, Loss: 0.6612165743654425\n",
      "Validation Loss: 1.324820637702942, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 145, Loss: 0.6955388004129583\n",
      "Validation Loss: 1.3699315969760602, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 146, Loss: 0.7257806973023848\n",
      "Validation Loss: 1.352514998270915, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 147, Loss: 0.6993310180577365\n",
      "Validation Loss: 1.3586620848912458, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 148, Loss: 0.6886879005215385\n",
      "Validation Loss: 1.3317560003353999, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 149, Loss: 0.6950438385659998\n",
      "Validation Loss: 1.3527289904080904, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 150, Loss: 0.7287264292890375\n",
      "Validation Loss: 1.3807214521444762, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 151, Loss: 0.7062424843961542\n",
      "Validation Loss: 1.3323713403481703, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 152, Loss: 0.7180242175405676\n",
      "Validation Loss: 1.3396470248699188, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 153, Loss: 0.7041849304329265\n",
      "Validation Loss: 1.3619764149188995, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 154, Loss: 0.6900712522593412\n",
      "Validation Loss: 1.3617238333592048, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 155, Loss: 0.7321462896737185\n",
      "Validation Loss: 1.350912747474817, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 156, Loss: 0.7323942135680805\n",
      "Validation Loss: 1.368971281326734, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 157, Loss: 0.6782868965105577\n",
      "Validation Loss: 1.3564871985178728, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 158, Loss: 0.6899569327181035\n",
      "Validation Loss: 1.3412808168392916, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 159, Loss: 0.7063892998478629\n",
      "Validation Loss: 1.3421609516327198, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 160, Loss: 0.6831596867604689\n",
      "Validation Loss: 1.3740592346741602, Total Accuracy: 32.69%\n",
      "Accuracy per class - G1: 28.57%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 161, Loss: 0.720259844714945\n",
      "Validation Loss: 1.3243714777322917, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 162, Loss: 0.7724347439679232\n",
      "Validation Loss: 1.3383209510491445, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 163, Loss: 0.7170570313930511\n",
      "Validation Loss: 1.3414235023351817, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 164, Loss: 0.7323356265371496\n",
      "Validation Loss: 1.3093952376108904, Total Accuracy: 34.62%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 0.00%\n",
      "Epoch 165, Loss: 0.6812224740331824\n",
      "Validation Loss: 1.3367934754261603, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 166, Loss: 0.652772662856362\n",
      "Validation Loss: 1.3545987560198858, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 167, Loss: 0.7094423120672052\n",
      "Validation Loss: 1.3702650024340703, Total Accuracy: 32.69%\n",
      "Accuracy per class - G1: 28.57%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 168, Loss: 0.7241318962790749\n",
      "Validation Loss: 1.336125720005769, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 169, Loss: 0.6891138537363573\n",
      "Validation Loss: 1.3263457990609682, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 170, Loss: 0.6955703220584176\n",
      "Validation Loss: 1.3416581543592305, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 171, Loss: 0.6476469939405268\n",
      "Validation Loss: 1.338791230550179, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 172, Loss: 0.7134834278713573\n",
      "Validation Loss: 1.3361169718779051, Total Accuracy: 34.62%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 0.00%\n",
      "Epoch 173, Loss: 0.6824391310865229\n",
      "Validation Loss: 1.3238510168515718, Total Accuracy: 34.62%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 0.00%\n",
      "Epoch 174, Loss: 0.6895512830127369\n",
      "Validation Loss: 1.3179954439401627, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 175, Loss: 0.7168336001309481\n",
      "Validation Loss: 1.3457291997396028, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 176, Loss: 0.6732049302621321\n",
      "Validation Loss: 1.3240543111012533, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 177, Loss: 0.6939632979306307\n",
      "Validation Loss: 1.3466061330758607, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 178, Loss: 0.6772682238708843\n",
      "Validation Loss: 1.3427342222287104, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 179, Loss: 0.6474761258472096\n",
      "Validation Loss: 1.3399437780563648, Total Accuracy: 32.69%\n",
      "Accuracy per class - G1: 28.57%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 180, Loss: 0.7493201250379736\n",
      "Validation Loss: 1.304943330012835, Total Accuracy: 34.62%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 0.00%\n",
      "Epoch 181, Loss: 0.6741900059309873\n",
      "Validation Loss: 1.3199869852799635, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 182, Loss: 0.7057409611615267\n",
      "Validation Loss: 1.3498895878975208, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 183, Loss: 0.7042534589767456\n",
      "Validation Loss: 1.3192675400238771, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 184, Loss: 0.6867882143367421\n",
      "Validation Loss: 1.321737283697495, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 185, Loss: 0.6889628399502147\n",
      "Validation Loss: 1.3600736902310298, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 186, Loss: 0.678488028049469\n",
      "Validation Loss: 1.335646709570518, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 187, Loss: 0.6480566198175604\n",
      "Validation Loss: 1.3283394093696888, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 188, Loss: 0.6683393017812209\n",
      "Validation Loss: 1.329781160904811, Total Accuracy: 34.62%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 0.00%\n",
      "Epoch 189, Loss: 0.6533314737406644\n",
      "Validation Loss: 1.3416180874292667, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 190, Loss: 0.6952646694400094\n",
      "Validation Loss: 1.3223043978214264, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 191, Loss: 0.6598419081081044\n",
      "Validation Loss: 1.3407831008617694, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 192, Loss: 0.6641374452547594\n",
      "Validation Loss: 1.3336368249012873, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 193, Loss: 0.7242922154339877\n",
      "Validation Loss: 1.3508847034894502, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 194, Loss: 0.649291411855004\n",
      "Validation Loss: 1.3312612198866332, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 195, Loss: 0.7067050489512356\n",
      "Validation Loss: 1.3375483522048364, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 196, Loss: 0.7759808426553553\n",
      "Validation Loss: 1.2986403130567992, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 197, Loss: 0.674148996851661\n",
      "Validation Loss: 1.3442083115761096, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 198, Loss: 0.6767772024328058\n",
      "Validation Loss: 1.3279050508370767, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 199, Loss: 0.6830632356080142\n",
      "Validation Loss: 1.332647626216595, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 200, Loss: 0.6712624127214605\n",
      "Validation Loss: 1.3177860986727934, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 201, Loss: 0.7007173754952171\n",
      "Validation Loss: 1.3369764571006482, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 202, Loss: 0.6964209356091239\n",
      "Validation Loss: 1.3529015676333354, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 203, Loss: 0.6282237036661669\n",
      "Validation Loss: 1.3489857224317698, Total Accuracy: 32.69%\n",
      "Accuracy per class - G1: 28.57%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 204, Loss: 0.6769146507436579\n",
      "Validation Loss: 1.3415001046199064, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 205, Loss: 0.6772081488912756\n",
      "Validation Loss: 1.3264017701148987, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 206, Loss: 0.6692157702012496\n",
      "Validation Loss: 1.3232458852804625, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 207, Loss: 0.6689309759573503\n",
      "Validation Loss: 1.33213648887781, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 208, Loss: 0.6868370879780162\n",
      "Validation Loss: 1.2952693849802017, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 209, Loss: 0.6664140582084656\n",
      "Validation Loss: 1.3364606190186281, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 210, Loss: 0.6644542769952254\n",
      "Validation Loss: 1.3551040142774582, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 211, Loss: 0.6922274345701391\n",
      "Validation Loss: 1.3187807007477834, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 212, Loss: 0.6430846046317708\n",
      "Validation Loss: 1.332119814478434, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 213, Loss: 0.6953256840055639\n",
      "Validation Loss: 1.3601855715880027, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 214, Loss: 0.670925914699381\n",
      "Validation Loss: 1.3522698913629239, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 215, Loss: 0.6738508040254766\n",
      "Validation Loss: 1.3207611372837653, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 216, Loss: 0.6779754909602078\n",
      "Validation Loss: 1.300207331776619, Total Accuracy: 34.62%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 0.00%\n",
      "Epoch 217, Loss: 0.6653329090638594\n",
      "Validation Loss: 1.3379648213203137, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 218, Loss: 0.6765734623778951\n",
      "Validation Loss: 1.3204360478199446, Total Accuracy: 32.69%\n",
      "Accuracy per class - G1: 28.57%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 219, Loss: 0.662443529475819\n",
      "Validation Loss: 1.345535676066692, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 220, Loss: 0.6611808278343895\n",
      "Validation Loss: 1.3294772918407733, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 221, Loss: 0.6309895493767478\n",
      "Validation Loss: 1.3138740062713623, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 222, Loss: 0.6144237572496588\n",
      "Validation Loss: 1.3674903042041338, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 223, Loss: 0.6699387696656314\n",
      "Validation Loss: 1.32288635464815, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 224, Loss: 0.6355083097111095\n",
      "Validation Loss: 1.3448905188303728, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 225, Loss: 0.6364699970592153\n",
      "Validation Loss: 1.305979581979605, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 226, Loss: 0.6373975103551691\n",
      "Validation Loss: 1.340778534228985, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 227, Loss: 0.6427340962670066\n",
      "Validation Loss: 1.339656534103247, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 228, Loss: 0.6430722783912312\n",
      "Validation Loss: 1.351957224882566, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 229, Loss: 0.6907216743989424\n",
      "Validation Loss: 1.3539695143699646, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 230, Loss: 0.6662337406115099\n",
      "Validation Loss: 1.3292128695891454, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 231, Loss: 0.6340608911080794\n",
      "Validation Loss: 1.3521175797169025, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 232, Loss: 0.6452121794223785\n",
      "Validation Loss: 1.3275352716445923, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 233, Loss: 0.6469665852459994\n",
      "Validation Loss: 1.3461795162696104, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 234, Loss: 0.6620713065971028\n",
      "Validation Loss: 1.3194483931248004, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 235, Loss: 0.6921194932677529\n",
      "Validation Loss: 1.3358065325480242, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 236, Loss: 0.6484284628521312\n",
      "Validation Loss: 1.3426074133469508, Total Accuracy: 34.62%\n",
      "Accuracy per class - G1: 35.71%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 237, Loss: 0.6266426129774614\n",
      "Validation Loss: 1.3613008020015864, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 238, Loss: 0.659589745239778\n",
      "Validation Loss: 1.3387276725127146, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 239, Loss: 0.6649848780848763\n",
      "Validation Loss: 1.30439486182653, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 240, Loss: 0.709626751054417\n",
      "Validation Loss: 1.3359816120221064, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 241, Loss: 0.6568386934020303\n",
      "Validation Loss: 1.3245386939782362, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 242, Loss: 0.633888563784686\n",
      "Validation Loss: 1.3085560374535048, Total Accuracy: 34.62%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 0.00%\n",
      "Epoch 243, Loss: 0.6560285064307126\n",
      "Validation Loss: 1.3035987867758825, Total Accuracy: 34.62%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 0.00%\n",
      "Epoch 244, Loss: 0.6462152578613974\n",
      "Validation Loss: 1.3027127385139465, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 245, Loss: 0.6683065983382138\n",
      "Validation Loss: 1.3313289376405568, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 246, Loss: 0.5928873587738384\n",
      "Validation Loss: 1.3169547078701167, Total Accuracy: 32.69%\n",
      "Accuracy per class - G1: 28.57%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 247, Loss: 0.6595176702195947\n",
      "Validation Loss: 1.3261699229478836, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 248, Loss: 0.6819283442063765\n",
      "Validation Loss: 1.3128050428170424, Total Accuracy: 34.62%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 0.00%\n",
      "Epoch 249, Loss: 0.6649471960284493\n",
      "Validation Loss: 1.3161996110127523, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 250, Loss: 0.6279887947169217\n",
      "Validation Loss: 1.3438545901041765, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 251, Loss: 0.666619619998065\n",
      "Validation Loss: 1.327805899656736, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 252, Loss: 0.6106975116512993\n",
      "Validation Loss: 1.2963158534123347, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 253, Loss: 0.6592616552656347\n",
      "Validation Loss: 1.3250061605985348, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 254, Loss: 0.6376228045333515\n",
      "Validation Loss: 1.3323066165814033, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 255, Loss: 0.6255938920107755\n",
      "Validation Loss: 1.3098277334983532, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 256, Loss: 0.6376975178718567\n",
      "Validation Loss: 1.3175952010429823, Total Accuracy: 32.69%\n",
      "Accuracy per class - G1: 28.57%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 257, Loss: 0.6097050720995123\n",
      "Validation Loss: 1.2853722858887453, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 258, Loss: 0.6223763427951119\n",
      "Validation Loss: 1.3188031545052161, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 259, Loss: 0.6194682375951247\n",
      "Validation Loss: 1.322063101025728, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 260, Loss: 0.598670648986643\n",
      "Validation Loss: 1.2997619360685349, Total Accuracy: 34.62%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 0.00%\n",
      "Epoch 261, Loss: 0.6491084440187974\n",
      "Validation Loss: 1.3339947840342155, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 262, Loss: 0.6142368083650416\n",
      "Validation Loss: 1.3133320326988513, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 263, Loss: 0.6454543606801466\n",
      "Validation Loss: 1.36929675248953, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 264, Loss: 0.6674116627736525\n",
      "Validation Loss: 1.3063471282903965, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 265, Loss: 0.6402530626817183\n",
      "Validation Loss: 1.3183672680304601, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 266, Loss: 0.6267618005925959\n",
      "Validation Loss: 1.2893594893125386, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 267, Loss: 0.6219839648766952\n",
      "Validation Loss: 1.312437308522371, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 268, Loss: 0.6248777785084464\n",
      "Validation Loss: 1.3570061876223638, Total Accuracy: 34.62%\n",
      "Accuracy per class - G1: 35.71%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 269, Loss: 0.6507668858224696\n",
      "Validation Loss: 1.3452398180961609, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 270, Loss: 0.6261823242360895\n",
      "Validation Loss: 1.318289801478386, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 271, Loss: 0.6973030832680789\n",
      "Validation Loss: 1.3611072978148093, Total Accuracy: 34.62%\n",
      "Accuracy per class - G1: 35.71%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 272, Loss: 0.6227101835337552\n",
      "Validation Loss: 1.3387547295827131, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 273, Loss: 0.6696879321878607\n",
      "Validation Loss: 1.3121383098455577, Total Accuracy: 34.62%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 0.00%\n",
      "Epoch 274, Loss: 0.6430320512164723\n",
      "Validation Loss: 1.3379778449351971, Total Accuracy: 32.69%\n",
      "Accuracy per class - G1: 28.57%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 275, Loss: 0.638948261195963\n",
      "Validation Loss: 1.319194956467702, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 276, Loss: 0.6436351147564975\n",
      "Validation Loss: 1.3057269557164266, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 277, Loss: 0.6286520654504949\n",
      "Validation Loss: 1.2995987351124103, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 278, Loss: 0.6214009030298753\n",
      "Validation Loss: 1.3122046566926515, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 279, Loss: 0.6205854508009824\n",
      "Validation Loss: 1.311754359648778, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 280, Loss: 0.6165148496627808\n",
      "Validation Loss: 1.3260126343140235, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 281, Loss: 0.6540175026113336\n",
      "Validation Loss: 1.3343553783801885, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 282, Loss: 0.6522321901538155\n",
      "Validation Loss: 1.3177701028493733, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 283, Loss: 0.6231696052984758\n",
      "Validation Loss: 1.3467678771569178, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 284, Loss: 0.6285626731135628\n",
      "Validation Loss: 1.3100307010687315, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 285, Loss: 0.6529734546487982\n",
      "Validation Loss: 1.2949670060322835, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 286, Loss: 0.6049837069077926\n",
      "Validation Loss: 1.3175703447598677, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 287, Loss: 0.6111904415217313\n",
      "Validation Loss: 1.2745558241238961, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 288, Loss: 0.6198289090936834\n",
      "Validation Loss: 1.2928934051440313, Total Accuracy: 34.62%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 0.00%\n",
      "Epoch 289, Loss: 0.6361046769402244\n",
      "Validation Loss: 1.321271273952264, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 290, Loss: 0.6215667740865187\n",
      "Validation Loss: 1.270735012797209, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 291, Loss: 0.5919640508565036\n",
      "Validation Loss: 1.31253394140647, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 292, Loss: 0.6473054306073622\n",
      "Validation Loss: 1.292783912557822, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 293, Loss: 0.6262199418111281\n",
      "Validation Loss: 1.2923567638947413, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 294, Loss: 0.6413771645589308\n",
      "Validation Loss: 1.311305819795682, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 295, Loss: 0.5555616617202759\n",
      "Validation Loss: 1.2924057050393178, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 296, Loss: 0.6352314483035695\n",
      "Validation Loss: 1.3226248117593618, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 297, Loss: 0.6497771479866722\n",
      "Validation Loss: 1.3213475082929318, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 298, Loss: 0.6347863787954504\n",
      "Validation Loss: 1.3100607142998622, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 299, Loss: 0.5953627174550836\n",
      "Validation Loss: 1.310099170758174, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n",
      "Epoch 300, Loss: 0.6145839149301703\n",
      "Validation Loss: 1.306651933835103, Total Accuracy: 36.54%\n",
      "Accuracy per class - G1: 42.86%, G2: 50.00%, G3: 7.14%\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\u001b[34m\u001b[1mwandb\u001b[0m:                                                                                \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run history:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc ▇▇█▃▃▃▃▂▂▃▂▂▂▂▃▂▂▂▂▂▂▂▂▂▂▁▂▂▂▂▁▂▂▂▂▂▂▂▂▂\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc ▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc ▁███████████████████████████████████████\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc ▁▁▂▄▇▇▇▇█▇▇▇▇▇▇▇▇▇▇▇▆▇▇████▇██▇███▇█▇█▇█\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc █▁▁▁▁▁▃▃▃▃▃▃▃▃▃▃▃▃▃▃▃▃▃▃▃▃▃▃▃▃▃▃▃▃▃▃▃▃▃▃\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc ▁▁▁▁▄▄▅▄▅▅▅▅▆▅▆▅▅▆▇▆█▆▇▆▇▅▇▆▆▇▇█▆▇▇▇▇▇▇█\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy ▁▃████▆█▇▇▇▇▇▇▆▇▇▇▇▇▇▇▇▆▆▇▇▇▇▇▇▇▇▇▇▇▇▆▅▇\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy ▁▁▁▂▄▅▆▆▆▅▆▆▆▆▆█▇▇▇█▇▇▆▇▇▇▇▆▇▇▇▇██████▇█\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss █▇█▇▄▃▃▃▃▂▃▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▁▂▂▂▁▂▂▁▁▁▁▁▁▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss ▆█▆▅█▅▅▅▅▄▄▃▅▅▃▃▅▄▄▄▄▅▄▃▄▃▃▅▄▄▂▂▃▃▃▃▃▃▃▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run summary:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc 42.85714\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc 100\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc 50\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc 81.81818\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc 7.14286\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc 78.18182\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy 36.53846\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy 85.45455\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss 0.61458\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss 1.30665\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: 🚀 View run \u001b[33mResNet3D-34 customsampler121 pretrained\u001b[0m at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/CPTACUCEC_3D_unimodal_CT/runs/3lhmacz2\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: ⭐️ View project at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/CPTACUCEC_3D_unimodal_CT\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Synced 5 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Find logs at: \u001b[35m\u001b[1m./wandb/run-20241022_083254-3lhmacz2/logs\u001b[0m\n"
     ]
    }
   ],
   "source": [
    "from focal_loss.focal_loss import FocalLoss\n",
    "config={\n",
    "    \"learning_rate\": 1e-7,\n",
    "    \"architecture\": \"ResNet3D-34 customsampler121 pretrained\",\n",
    "    \"epochs\": 300,\n",
    "    \"weight_decay\": 1e-6,\n",
    "    \"reduce_lr_factor\": 0.25,\n",
    "    \"patience\": 40,\n",
    "    \"class_weights\": None,\n",
    "    \"early_stop_patience\": None,\n",
    "    \"focal_loss\": None\n",
    "    }\n",
    "train(model, config, run_name = config[\"architecture\"])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 28,
   "id": "2a7e815a",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-22T17:21:13.953715Z",
     "iopub.status.busy": "2024-10-22T17:21:13.952906Z",
     "iopub.status.idle": "2024-10-22T17:21:13.960669Z",
     "shell.execute_reply": "2024-10-22T17:21:13.959714Z"
    },
    "papermill": {
     "duration": 0.103193,
     "end_time": "2024-10-22T17:21:13.962606",
     "exception": false,
     "start_time": "2024-10-22T17:21:13.859413",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "'\\nfrom focal_loss.focal_loss import FocalLoss\\nconfig={\\n    \"learning_rate\": 1e-7,\\n    \"architecture\": \"ResNet3D-34 FocalLoss pretrained\",\\n    \"epochs\": 400,\\n    \"weight_decay\": 1e-6,\\n    \"reduce_lr_factor\": 0.25,\\n    \"patience\": 40,\\n    \"class_weights\": None,\\n    \"early_stop_patience\": None,\\n    \"focal_loss\": 3\\n    }\\ntrain(model, config, run_name = config[\"architecture\"])\\n'"
      ]
     },
     "execution_count": 28,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "\"\"\"\n",
    "from focal_loss.focal_loss import FocalLoss\n",
    "config={\n",
    "    \"learning_rate\": 1e-7,\n",
    "    \"architecture\": \"ResNet3D-34 FocalLoss pretrained\",\n",
    "    \"epochs\": 400,\n",
    "    \"weight_decay\": 1e-6,\n",
    "    \"reduce_lr_factor\": 0.25,\n",
    "    \"patience\": 40,\n",
    "    \"class_weights\": None,\n",
    "    \"early_stop_patience\": None,\n",
    "    \"focal_loss\": 3\n",
    "    }\n",
    "train(model, config, run_name = config[\"architecture\"])\n",
    "\"\"\"\n"
   ]
  }
 ],
 "metadata": {
  "kaggle": {
   "accelerator": "gpu",
   "dataSources": [
    {
     "datasetId": 5664308,
     "sourceId": 9547833,
     "sourceType": "datasetVersion"
    },
    {
     "datasetId": 5863281,
     "sourceId": 9609374,
     "sourceType": "datasetVersion"
    },
    {
     "datasetId": 5893136,
     "sourceId": 9648843,
     "sourceType": "datasetVersion"
    }
   ],
   "dockerImageVersionId": 30787,
   "isGpuEnabled": true,
   "isInternetEnabled": true,
   "language": "python",
   "sourceType": "notebook"
  },
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.14"
  },
  "papermill": {
   "default_parameters": {},
   "duration": 32085.915326,
   "end_time": "2024-10-22T17:21:17.246821",
   "environment_variables": {},
   "exception": null,
   "input_path": "__notebook__.ipynb",
   "output_path": "__notebook__.ipynb",
   "parameters": {},
   "start_time": "2024-10-22T08:26:31.331495",
   "version": "2.6.0"
  },
  "widgets": {
   "application/vnd.jupyter.widget-state+json": {
    "state": {
     "0f74e50d11824c589594423e545fb4fd": {
      "model_module": "@jupyter-widgets/controls",
      "model_module_version": "1.5.0",
      "model_name": "DescriptionStyleModel",
      "state": {
       "_model_module": "@jupyter-widgets/controls",
       "_model_module_version": "1.5.0",
       "_model_name": "DescriptionStyleModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/base",
       "_view_module_version": "1.2.0",
       "_view_name": "StyleView",
       "description_width": ""
      }
     },
     "143ad20d35434be89f39cdac70e0081d": {
      "model_module": "@jupyter-widgets/controls",
      "model_module_version": "1.5.0",
      "model_name": "DescriptionStyleModel",
      "state": {
       "_model_module": "@jupyter-widgets/controls",
       "_model_module_version": "1.5.0",
       "_model_name": "DescriptionStyleModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/base",
       "_view_module_version": "1.2.0",
       "_view_name": "StyleView",
       "description_width": ""
      }
     },
     "148dbfbb28564c9392b3e506f8ad78d6": {
      "model_module": "@jupyter-widgets/controls",
      "model_module_version": "1.5.0",
      "model_name": "HBoxModel",
      "state": {
       "_dom_classes": [],
       "_model_module": "@jupyter-widgets/controls",
       "_model_module_version": "1.5.0",
       "_model_name": "HBoxModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/controls",
       "_view_module_version": "1.5.0",
       "_view_name": "HBoxView",
       "box_style": "",
       "children": [
        "IPY_MODEL_6a4a435278744922ba00185fa0628e06",
        "IPY_MODEL_a290bba08f9542f9bf35798535d390d9",
        "IPY_MODEL_4dc614faa4bd4cf9a688353619da2b0e"
       ],
       "layout": "IPY_MODEL_655f98d76beb4cfdbd790f0620af4fce"
      }
     },
     "19c4b812c58d4ab6bc3cd5d7bea9fdf8": {
      "model_module": "@jupyter-widgets/base",
      "model_module_version": "1.2.0",
      "model_name": "LayoutModel",
      "state": {
       "_model_module": "@jupyter-widgets/base",
       "_model_module_version": "1.2.0",
       "_model_name": "LayoutModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/base",
       "_view_module_version": "1.2.0",
       "_view_name": "LayoutView",
       "align_content": null,
       "align_items": null,
       "align_self": null,
       "border": null,
       "bottom": null,
       "display": null,
       "flex": null,
       "flex_flow": null,
       "grid_area": null,
       "grid_auto_columns": null,
       "grid_auto_flow": null,
       "grid_auto_rows": null,
       "grid_column": null,
       "grid_gap": null,
       "grid_row": null,
       "grid_template_areas": null,
       "grid_template_columns": null,
       "grid_template_rows": null,
       "height": null,
       "justify_content": null,
       "justify_items": null,
       "left": null,
       "margin": null,
       "max_height": null,
       "max_width": null,
       "min_height": null,
       "min_width": null,
       "object_fit": null,
       "object_position": null,
       "order": null,
       "overflow": null,
       "overflow_x": null,
       "overflow_y": null,
       "padding": null,
       "right": null,
       "top": null,
       "visibility": null,
       "width": null
      }
     },
     "4dc614faa4bd4cf9a688353619da2b0e": {
      "model_module": "@jupyter-widgets/controls",
      "model_module_version": "1.5.0",
      "model_name": "HTMLModel",
      "state": {
       "_dom_classes": [],
       "_model_module": "@jupyter-widgets/controls",
       "_model_module_version": "1.5.0",
       "_model_name": "HTMLModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/controls",
       "_view_module_version": "1.5.0",
       "_view_name": "HTMLView",
       "description": "",
       "description_tooltip": null,
       "layout": "IPY_MODEL_19c4b812c58d4ab6bc3cd5d7bea9fdf8",
       "placeholder": "​",
       "style": "IPY_MODEL_b13021f1f89f4786a7353648fc1a5884",
       "value": " 46.8M/46.8M [00:03&lt;00:00, 15.1MB/s]"
      }
     },
     "5aabee46e73c4e1e949fe611f697add0": {
      "model_module": "@jupyter-widgets/controls",
      "model_module_version": "1.5.0",
      "model_name": "ProgressStyleModel",
      "state": {
       "_model_module": "@jupyter-widgets/controls",
       "_model_module_version": "1.5.0",
       "_model_name": "ProgressStyleModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/base",
       "_view_module_version": "1.2.0",
       "_view_name": "StyleView",
       "bar_color": null,
       "description_width": ""
      }
     },
     "5e578b3fcc5c437791b41c60ead2f373": {
      "model_module": "@jupyter-widgets/base",
      "model_module_version": "1.2.0",
      "model_name": "LayoutModel",
      "state": {
       "_model_module": "@jupyter-widgets/base",
       "_model_module_version": "1.2.0",
       "_model_name": "LayoutModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/base",
       "_view_module_version": "1.2.0",
       "_view_name": "LayoutView",
       "align_content": null,
       "align_items": null,
       "align_self": null,
       "border": null,
       "bottom": null,
       "display": null,
       "flex": null,
       "flex_flow": null,
       "grid_area": null,
       "grid_auto_columns": null,
       "grid_auto_flow": null,
       "grid_auto_rows": null,
       "grid_column": null,
       "grid_gap": null,
       "grid_row": null,
       "grid_template_areas": null,
       "grid_template_columns": null,
       "grid_template_rows": null,
       "height": null,
       "justify_content": null,
       "justify_items": null,
       "left": null,
       "margin": null,
       "max_height": null,
       "max_width": null,
       "min_height": null,
       "min_width": null,
       "object_fit": null,
       "object_position": null,
       "order": null,
       "overflow": null,
       "overflow_x": null,
       "overflow_y": null,
       "padding": null,
       "right": null,
       "top": null,
       "visibility": null,
       "width": null
      }
     },
     "6213dd8318994913b79d296acfb123b7": {
      "model_module": "@jupyter-widgets/controls",
      "model_module_version": "1.5.0",
      "model_name": "FloatProgressModel",
      "state": {
       "_dom_classes": [],
       "_model_module": "@jupyter-widgets/controls",
       "_model_module_version": "1.5.0",
       "_model_name": "FloatProgressModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/controls",
       "_view_module_version": "1.5.0",
       "_view_name": "ProgressView",
       "bar_style": "success",
       "description": "",
       "description_tooltip": null,
       "layout": "IPY_MODEL_5e578b3fcc5c437791b41c60ead2f373",
       "max": 69548,
       "min": 0,
       "orientation": "horizontal",
       "style": "IPY_MODEL_5aabee46e73c4e1e949fe611f697add0",
       "value": 69548
      }
     },
     "62de300bb21143b68602e94c74e3f39b": {
      "model_module": "@jupyter-widgets/base",
      "model_module_version": "1.2.0",
      "model_name": "LayoutModel",
      "state": {
       "_model_module": "@jupyter-widgets/base",
       "_model_module_version": "1.2.0",
       "_model_name": "LayoutModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/base",
       "_view_module_version": "1.2.0",
       "_view_name": "LayoutView",
       "align_content": null,
       "align_items": null,
       "align_self": null,
       "border": null,
       "bottom": null,
       "display": null,
       "flex": null,
       "flex_flow": null,
       "grid_area": null,
       "grid_auto_columns": null,
       "grid_auto_flow": null,
       "grid_auto_rows": null,
       "grid_column": null,
       "grid_gap": null,
       "grid_row": null,
       "grid_template_areas": null,
       "grid_template_columns": null,
       "grid_template_rows": null,
       "height": null,
       "justify_content": null,
       "justify_items": null,
       "left": null,
       "margin": null,
       "max_height": null,
       "max_width": null,
       "min_height": null,
       "min_width": null,
       "object_fit": null,
       "object_position": null,
       "order": null,
       "overflow": null,
       "overflow_x": null,
       "overflow_y": null,
       "padding": null,
       "right": null,
       "top": null,
       "visibility": null,
       "width": null
      }
     },
     "655f98d76beb4cfdbd790f0620af4fce": {
      "model_module": "@jupyter-widgets/base",
      "model_module_version": "1.2.0",
      "model_name": "LayoutModel",
      "state": {
       "_model_module": "@jupyter-widgets/base",
       "_model_module_version": "1.2.0",
       "_model_name": "LayoutModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/base",
       "_view_module_version": "1.2.0",
       "_view_name": "LayoutView",
       "align_content": null,
       "align_items": null,
       "align_self": null,
       "border": null,
       "bottom": null,
       "display": null,
       "flex": null,
       "flex_flow": null,
       "grid_area": null,
       "grid_auto_columns": null,
       "grid_auto_flow": null,
       "grid_auto_rows": null,
       "grid_column": null,
       "grid_gap": null,
       "grid_row": null,
       "grid_template_areas": null,
       "grid_template_columns": null,
       "grid_template_rows": null,
       "height": null,
       "justify_content": null,
       "justify_items": null,
       "left": null,
       "margin": null,
       "max_height": null,
       "max_width": null,
       "min_height": null,
       "min_width": null,
       "object_fit": null,
       "object_position": null,
       "order": null,
       "overflow": null,
       "overflow_x": null,
       "overflow_y": null,
       "padding": null,
       "right": null,
       "top": null,
       "visibility": null,
       "width": null
      }
     },
     "6a4a435278744922ba00185fa0628e06": {
      "model_module": "@jupyter-widgets/controls",
      "model_module_version": "1.5.0",
      "model_name": "HTMLModel",
      "state": {
       "_dom_classes": [],
       "_model_module": "@jupyter-widgets/controls",
       "_model_module_version": "1.5.0",
       "_model_name": "HTMLModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/controls",
       "_view_module_version": "1.5.0",
       "_view_name": "HTMLView",
       "description": "",
       "description_tooltip": null,
       "layout": "IPY_MODEL_f1e9deee886e441990c8086b244101b2",
       "placeholder": "​",
       "style": "IPY_MODEL_143ad20d35434be89f39cdac70e0081d",
       "value": "model.safetensors: 100%"
      }
     },
     "70c0081ec8cf4159b2cd1184eae53b5d": {
      "model_module": "@jupyter-widgets/base",
      "model_module_version": "1.2.0",
      "model_name": "LayoutModel",
      "state": {
       "_model_module": "@jupyter-widgets/base",
       "_model_module_version": "1.2.0",
       "_model_name": "LayoutModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/base",
       "_view_module_version": "1.2.0",
       "_view_name": "LayoutView",
       "align_content": null,
       "align_items": null,
       "align_self": null,
       "border": null,
       "bottom": null,
       "display": null,
       "flex": null,
       "flex_flow": null,
       "grid_area": null,
       "grid_auto_columns": null,
       "grid_auto_flow": null,
       "grid_auto_rows": null,
       "grid_column": null,
       "grid_gap": null,
       "grid_row": null,
       "grid_template_areas": null,
       "grid_template_columns": null,
       "grid_template_rows": null,
       "height": null,
       "justify_content": null,
       "justify_items": null,
       "left": null,
       "margin": null,
       "max_height": null,
       "max_width": null,
       "min_height": null,
       "min_width": null,
       "object_fit": null,
       "object_position": null,
       "order": null,
       "overflow": null,
       "overflow_x": null,
       "overflow_y": null,
       "padding": null,
       "right": null,
       "top": null,
       "visibility": null,
       "width": null
      }
     },
     "7dd733ad658b48359feb02f8c0436c62": {
      "model_module": "@jupyter-widgets/base",
      "model_module_version": "1.2.0",
      "model_name": "LayoutModel",
      "state": {
       "_model_module": "@jupyter-widgets/base",
       "_model_module_version": "1.2.0",
       "_model_name": "LayoutModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/base",
       "_view_module_version": "1.2.0",
       "_view_name": "LayoutView",
       "align_content": null,
       "align_items": null,
       "align_self": null,
       "border": null,
       "bottom": null,
       "display": null,
       "flex": null,
       "flex_flow": null,
       "grid_area": null,
       "grid_auto_columns": null,
       "grid_auto_flow": null,
       "grid_auto_rows": null,
       "grid_column": null,
       "grid_gap": null,
       "grid_row": null,
       "grid_template_areas": null,
       "grid_template_columns": null,
       "grid_template_rows": null,
       "height": null,
       "justify_content": null,
       "justify_items": null,
       "left": null,
       "margin": null,
       "max_height": null,
       "max_width": null,
       "min_height": null,
       "min_width": null,
       "object_fit": null,
       "object_position": null,
       "order": null,
       "overflow": null,
       "overflow_x": null,
       "overflow_y": null,
       "padding": null,
       "right": null,
       "top": null,
       "visibility": null,
       "width": null
      }
     },
     "7f4be5cd22f64a6ebf8629388d9fe314": {
      "model_module": "@jupyter-widgets/controls",
      "model_module_version": "1.5.0",
      "model_name": "HBoxModel",
      "state": {
       "_dom_classes": [],
       "_model_module": "@jupyter-widgets/controls",
       "_model_module_version": "1.5.0",
       "_model_name": "HBoxModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/controls",
       "_view_module_version": "1.5.0",
       "_view_name": "HBoxView",
       "box_style": "",
       "children": [
        "IPY_MODEL_f98e6a28a77b460aa5b9c367684afbf6",
        "IPY_MODEL_6213dd8318994913b79d296acfb123b7",
        "IPY_MODEL_97a6dfab7007407cac133d69ba3394c0"
       ],
       "layout": "IPY_MODEL_7fe107f7ec564556bbd41a700510e787"
      }
     },
     "7fe107f7ec564556bbd41a700510e787": {
      "model_module": "@jupyter-widgets/base",
      "model_module_version": "1.2.0",
      "model_name": "LayoutModel",
      "state": {
       "_model_module": "@jupyter-widgets/base",
       "_model_module_version": "1.2.0",
       "_model_name": "LayoutModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/base",
       "_view_module_version": "1.2.0",
       "_view_name": "LayoutView",
       "align_content": null,
       "align_items": null,
       "align_self": null,
       "border": null,
       "bottom": null,
       "display": null,
       "flex": null,
       "flex_flow": null,
       "grid_area": null,
       "grid_auto_columns": null,
       "grid_auto_flow": null,
       "grid_auto_rows": null,
       "grid_column": null,
       "grid_gap": null,
       "grid_row": null,
       "grid_template_areas": null,
       "grid_template_columns": null,
       "grid_template_rows": null,
       "height": null,
       "justify_content": null,
       "justify_items": null,
       "left": null,
       "margin": null,
       "max_height": null,
       "max_width": null,
       "min_height": null,
       "min_width": null,
       "object_fit": null,
       "object_position": null,
       "order": null,
       "overflow": null,
       "overflow_x": null,
       "overflow_y": null,
       "padding": null,
       "right": null,
       "top": null,
       "visibility": null,
       "width": null
      }
     },
     "8c90ff6ae7f44ed1a6a8496e9269d845": {
      "model_module": "@jupyter-widgets/controls",
      "model_module_version": "1.5.0",
      "model_name": "ProgressStyleModel",
      "state": {
       "_model_module": "@jupyter-widgets/controls",
       "_model_module_version": "1.5.0",
       "_model_name": "ProgressStyleModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/base",
       "_view_module_version": "1.2.0",
       "_view_name": "StyleView",
       "bar_color": null,
       "description_width": ""
      }
     },
     "97a6dfab7007407cac133d69ba3394c0": {
      "model_module": "@jupyter-widgets/controls",
      "model_module_version": "1.5.0",
      "model_name": "HTMLModel",
      "state": {
       "_dom_classes": [],
       "_model_module": "@jupyter-widgets/controls",
       "_model_module_version": "1.5.0",
       "_model_name": "HTMLModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/controls",
       "_view_module_version": "1.5.0",
       "_view_name": "HTMLView",
       "description": "",
       "description_tooltip": null,
       "layout": "IPY_MODEL_70c0081ec8cf4159b2cd1184eae53b5d",
       "placeholder": "​",
       "style": "IPY_MODEL_e7c6b1c1c6304d2ca4e35472b1f690b4",
       "value": " 69.5k/69.5k [00:00&lt;00:00, 326kB/s]"
      }
     },
     "a290bba08f9542f9bf35798535d390d9": {
      "model_module": "@jupyter-widgets/controls",
      "model_module_version": "1.5.0",
      "model_name": "FloatProgressModel",
      "state": {
       "_dom_classes": [],
       "_model_module": "@jupyter-widgets/controls",
       "_model_module_version": "1.5.0",
       "_model_name": "FloatProgressModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/controls",
       "_view_module_version": "1.5.0",
       "_view_name": "ProgressView",
       "bar_style": "success",
       "description": "",
       "description_tooltip": null,
       "layout": "IPY_MODEL_7dd733ad658b48359feb02f8c0436c62",
       "max": 46812324,
       "min": 0,
       "orientation": "horizontal",
       "style": "IPY_MODEL_8c90ff6ae7f44ed1a6a8496e9269d845",
       "value": 46812324
      }
     },
     "b13021f1f89f4786a7353648fc1a5884": {
      "model_module": "@jupyter-widgets/controls",
      "model_module_version": "1.5.0",
      "model_name": "DescriptionStyleModel",
      "state": {
       "_model_module": "@jupyter-widgets/controls",
       "_model_module_version": "1.5.0",
       "_model_name": "DescriptionStyleModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/base",
       "_view_module_version": "1.2.0",
       "_view_name": "StyleView",
       "description_width": ""
      }
     },
     "e7c6b1c1c6304d2ca4e35472b1f690b4": {
      "model_module": "@jupyter-widgets/controls",
      "model_module_version": "1.5.0",
      "model_name": "DescriptionStyleModel",
      "state": {
       "_model_module": "@jupyter-widgets/controls",
       "_model_module_version": "1.5.0",
       "_model_name": "DescriptionStyleModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/base",
       "_view_module_version": "1.2.0",
       "_view_name": "StyleView",
       "description_width": ""
      }
     },
     "f1e9deee886e441990c8086b244101b2": {
      "model_module": "@jupyter-widgets/base",
      "model_module_version": "1.2.0",
      "model_name": "LayoutModel",
      "state": {
       "_model_module": "@jupyter-widgets/base",
       "_model_module_version": "1.2.0",
       "_model_name": "LayoutModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/base",
       "_view_module_version": "1.2.0",
       "_view_name": "LayoutView",
       "align_content": null,
       "align_items": null,
       "align_self": null,
       "border": null,
       "bottom": null,
       "display": null,
       "flex": null,
       "flex_flow": null,
       "grid_area": null,
       "grid_auto_columns": null,
       "grid_auto_flow": null,
       "grid_auto_rows": null,
       "grid_column": null,
       "grid_gap": null,
       "grid_row": null,
       "grid_template_areas": null,
       "grid_template_columns": null,
       "grid_template_rows": null,
       "height": null,
       "justify_content": null,
       "justify_items": null,
       "left": null,
       "margin": null,
       "max_height": null,
       "max_width": null,
       "min_height": null,
       "min_width": null,
       "object_fit": null,
       "object_position": null,
       "order": null,
       "overflow": null,
       "overflow_x": null,
       "overflow_y": null,
       "padding": null,
       "right": null,
       "top": null,
       "visibility": null,
       "width": null
      }
     },
     "f98e6a28a77b460aa5b9c367684afbf6": {
      "model_module": "@jupyter-widgets/controls",
      "model_module_version": "1.5.0",
      "model_name": "HTMLModel",
      "state": {
       "_dom_classes": [],
       "_model_module": "@jupyter-widgets/controls",
       "_model_module_version": "1.5.0",
       "_model_name": "HTMLModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/controls",
       "_view_module_version": "1.5.0",
       "_view_name": "HTMLView",
       "description": "",
       "description_tooltip": null,
       "layout": "IPY_MODEL_62de300bb21143b68602e94c74e3f39b",
       "placeholder": "​",
       "style": "IPY_MODEL_0f74e50d11824c589594423e545fb4fd",
       "value": "config.json: 100%"
      }
     }
    },
    "version_major": 2,
    "version_minor": 0
   }
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
