# MSc Thesis on Multimodal Biomedical Computervision Cancer Grading

## Preprocessed Datasets

* [Preprocessed57PatientsCPTAC-PDA](https://drive.google.com/file/d/1vE8PcgubAyb7EzWB2-L_iqCMeCApj3u0/view?usp=drive_link)
* [Preprocessed57PatientsCPTAC-PDA (Kaggle)](https://www.kaggle.com/datasets/pietrocaforio/preprocessed57patientscptacpda/)

## Setup

### Environment Setup

1. Conda is required.
2. run `make deps` to setup the environment and the pre-commit configurations.
3. If running on Windows, update the `OPENSLIDE_PATH` in `util/data_util.py` and `scripts/preprocess_parallel.py` to your local Windows openslide binary path (This repo is not guaranteed to work on windows).

### Download Raw Datasets
#### Radiology data:
1. Download the `nbia-data-retriever` from [NBIA Data Retriever Wiki](https://wiki.cancerimagingarchive.net/display/NBIA/Installing+the+NBIA+Data+Retriever).

2. CPTAC-PDA:
   * `cd data/raw/CPTAC_PDA_77`
   * `nbia-data-retriever --cli CT.tcia -d ./`
   * `cd data/raw`
   * `nbia-data-retriever --cli Segmentations.tcia -d ./`

3. CPTAC-UCEC:
   * `cd data/raw/69PatientsCPTACUCEC`
   * `nbia-data-retriever --cli manifest-1728901427271.tcia -d ./`

4. It might be necessary to fix metadata.csv generated by nbia-data-retriever with the following regex:
   * Filter: `(\d+),(\d+) KB`
   * Substitute: `$1.$2 KB`
   * Filter: `(\d+),(\d+) MB`
   * Substitute: `$1.$2 MB`
#### Histopathology data:
1. Install kaggle cli: `pip install kaggle`
2. Download the histopathology dataset: `kaggle datasets download -d cietropaforio/cptacpdahisto`
3. Unzip: `unzip cptacpdahisto.zip`

## Preprocessing
#### Radiology:
1. CPTAC-PDA:
   * `cd scripts`
   * `./run_shell_commands/run_preprocess_CPTAC_PDA_71_3D.sh`

2. CPTAC-UCEC:
   * `cd scripts`
   * `./run_shell_commands/run_preprocess_CPTAC_UCEC3D.sh`
#### Histopathology:
1. Clone the CLAM repository: `git clone https://github.com/mahmoodlab/CLAM.git`
2. Patch the histologies: ` python create_patches_fp.py --source ./path-to-cptacpdahisto --save_dir ./CPTAC_PDA_PATCH --patch_size 224 --preset bwh_biopsy.csv --seg --patch --stitch
`
3. cd into "research-biocv-proj/scripts" folder and run: `./run_shell_commands/run_setup_wsi.sh`
