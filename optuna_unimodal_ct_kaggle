{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "30c204ec",
   "metadata": {
    "papermill": {
     "duration": 0.013649,
     "end_time": "2024-10-08T10:15:30.569172",
     "exception": false,
     "start_time": "2024-10-08T10:15:30.555523",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "<a href=\"https://www.kaggle.com/code/pietrocaforio/unimodal-ct-training-kaggle?scriptVersionId=199214851\" target=\"_blank\"><img align=\"left\" alt=\"Kaggle\" title=\"Open in Kaggle\" src=\"https://kaggle.com/static/images/open-in-kaggle.svg\"></a>"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "a470dcbd",
   "metadata": {
    "papermill": {
     "duration": 0.012345,
     "end_time": "2024-10-08T10:15:30.595591",
     "exception": false,
     "start_time": "2024-10-08T10:15:30.583246",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "# Train unimodal CT"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "1d7fa584",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-08T10:15:30.622944Z",
     "iopub.status.busy": "2024-10-08T10:15:30.622175Z",
     "iopub.status.idle": "2024-10-08T10:15:34.092194Z",
     "shell.execute_reply": "2024-10-08T10:15:34.091059Z"
    },
    "papermill": {
     "duration": 3.486355,
     "end_time": "2024-10-08T10:15:34.094597",
     "exception": false,
     "start_time": "2024-10-08T10:15:30.608242",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Cloning into 'research-biocv-proj'...\r\n",
      "remote: Enumerating objects: 446, done.\u001b[K\r\n",
      "remote: Counting objects: 100% (238/238), done.\u001b[K\r\n",
      "remote: Compressing objects: 100% (171/171), done.\u001b[K\r\n",
      "remote: Total 446 (delta 132), reused 135 (delta 45), pack-reused 208 (from 1)\u001b[K\r\n",
      "Receiving objects: 100% (446/446), 5.28 MiB | 10.96 MiB/s, done.\r\n",
      "Resolving deltas: 100% (254/254), done.\r\n",
      "Branch 'dev' set up to track remote branch 'dev' from 'origin'.\r\n",
      "Switched to a new branch 'dev'\r\n"
     ]
    }
   ],
   "source": [
    "!git clone https://github.com/PietroCaforio/research-biocv-proj\n",
    "!cd research-biocv-proj && git switch dev"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "6f21fd72",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-08T10:15:34.125235Z",
     "iopub.status.busy": "2024-10-08T10:15:34.124856Z",
     "iopub.status.idle": "2024-10-08T10:15:35.433904Z",
     "shell.execute_reply": "2024-10-08T10:15:35.432714Z"
    },
    "papermill": {
     "duration": 1.327046,
     "end_time": "2024-10-08T10:15:35.436450",
     "exception": false,
     "start_time": "2024-10-08T10:15:34.109404",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Already up to date.\r\n"
     ]
    }
   ],
   "source": [
    "!cd research-biocv-proj && git pull"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "be144a70",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-08T10:15:35.467774Z",
     "iopub.status.busy": "2024-10-08T10:15:35.467071Z",
     "iopub.status.idle": "2024-10-08T10:15:47.991524Z",
     "shell.execute_reply": "2024-10-08T10:15:47.990340Z"
    },
    "papermill": {
     "duration": 12.542683,
     "end_time": "2024-10-08T10:15:47.993999",
     "exception": false,
     "start_time": "2024-10-08T10:15:35.451316",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Requirement already satisfied: wandb in /opt/conda/lib/python3.10/site-packages (0.18.3)\r\n",
      "Requirement already satisfied: click!=8.0.0,>=7.1 in /opt/conda/lib/python3.10/site-packages (from wandb) (8.1.7)\r\n",
      "Requirement already satisfied: docker-pycreds>=0.4.0 in /opt/conda/lib/python3.10/site-packages (from wandb) (0.4.0)\r\n",
      "Requirement already satisfied: gitpython!=3.1.29,>=1.0.0 in /opt/conda/lib/python3.10/site-packages (from wandb) (3.1.43)\r\n",
      "Requirement already satisfied: platformdirs in /opt/conda/lib/python3.10/site-packages (from wandb) (3.11.0)\r\n",
      "Requirement already satisfied: protobuf!=4.21.0,!=5.28.0,<6,>=3.19.0 in /opt/conda/lib/python3.10/site-packages (from wandb) (3.20.3)\r\n",
      "Requirement already satisfied: psutil>=5.0.0 in /opt/conda/lib/python3.10/site-packages (from wandb) (5.9.3)\r\n",
      "Requirement already satisfied: pyyaml in /opt/conda/lib/python3.10/site-packages (from wandb) (6.0.2)\r\n",
      "Requirement already satisfied: requests<3,>=2.0.0 in /opt/conda/lib/python3.10/site-packages (from wandb) (2.32.3)\r\n",
      "Requirement already satisfied: sentry-sdk>=1.0.0 in /opt/conda/lib/python3.10/site-packages (from wandb) (2.15.0)\r\n",
      "Requirement already satisfied: setproctitle in /opt/conda/lib/python3.10/site-packages (from wandb) (1.3.3)\r\n",
      "Requirement already satisfied: setuptools in /opt/conda/lib/python3.10/site-packages (from wandb) (70.0.0)\r\n",
      "Requirement already satisfied: six>=1.4.0 in /opt/conda/lib/python3.10/site-packages (from docker-pycreds>=0.4.0->wandb) (1.16.0)\r\n",
      "Requirement already satisfied: gitdb<5,>=4.0.1 in /opt/conda/lib/python3.10/site-packages (from gitpython!=3.1.29,>=1.0.0->wandb) (4.0.11)\r\n",
      "Requirement already satisfied: charset-normalizer<4,>=2 in /opt/conda/lib/python3.10/site-packages (from requests<3,>=2.0.0->wandb) (3.3.2)\r\n",
      "Requirement already satisfied: idna<4,>=2.5 in /opt/conda/lib/python3.10/site-packages (from requests<3,>=2.0.0->wandb) (3.7)\r\n",
      "Requirement already satisfied: urllib3<3,>=1.21.1 in /opt/conda/lib/python3.10/site-packages (from requests<3,>=2.0.0->wandb) (1.26.18)\r\n",
      "Requirement already satisfied: certifi>=2017.4.17 in /opt/conda/lib/python3.10/site-packages (from requests<3,>=2.0.0->wandb) (2024.8.30)\r\n",
      "Requirement already satisfied: smmap<6,>=3.0.1 in /opt/conda/lib/python3.10/site-packages (from gitdb<5,>=4.0.1->gitpython!=3.1.29,>=1.0.0->wandb) (5.0.1)\r\n"
     ]
    }
   ],
   "source": [
    "!pip install wandb"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "1e77db5b",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-08T10:15:48.025575Z",
     "iopub.status.busy": "2024-10-08T10:15:48.025229Z",
     "iopub.status.idle": "2024-10-08T10:15:48.260505Z",
     "shell.execute_reply": "2024-10-08T10:15:48.259734Z"
    },
    "papermill": {
     "duration": 0.253678,
     "end_time": "2024-10-08T10:15:48.262805",
     "exception": false,
     "start_time": "2024-10-08T10:15:48.009127",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "from kaggle_secrets import UserSecretsClient\n",
    "user_secrets = UserSecretsClient()\n",
    "secret_value_0 = user_secrets.get_secret(\"wandb_api_key\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "e8320f7e",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-08T10:15:48.294205Z",
     "iopub.status.busy": "2024-10-08T10:15:48.293543Z",
     "iopub.status.idle": "2024-10-08T10:15:50.082913Z",
     "shell.execute_reply": "2024-10-08T10:15:50.081977Z"
    },
    "papermill": {
     "duration": 1.807101,
     "end_time": "2024-10-08T10:15:50.084904",
     "exception": false,
     "start_time": "2024-10-08T10:15:48.277803",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\u001b[34m\u001b[1mwandb\u001b[0m: Using wandb-core as the SDK backend. Please refer to https://wandb.me/wandb-core for more information.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: W&B API key is configured. Use \u001b[1m`wandb login --relogin`\u001b[0m to force relogin\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \u001b[33mWARNING\u001b[0m If you're specifying your api key in code, ensure this code is not shared publicly.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \u001b[33mWARNING\u001b[0m Consider setting the WANDB_API_KEY environment variable, or running `wandb login` from the command line.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Appending key for api.wandb.ai to your netrc file: /root/.netrc\n"
     ]
    },
    {
     "data": {
      "text/plain": [
       "True"
      ]
     },
     "execution_count": 5,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "import wandb\n",
    "wandb.login(key=secret_value_0)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "b1ca2aad",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-08T10:15:50.116617Z",
     "iopub.status.busy": "2024-10-08T10:15:50.116298Z",
     "iopub.status.idle": "2024-10-08T10:15:54.479589Z",
     "shell.execute_reply": "2024-10-08T10:15:54.478566Z"
    },
    "papermill": {
     "duration": 4.381862,
     "end_time": "2024-10-08T10:15:54.482093",
     "exception": false,
     "start_time": "2024-10-08T10:15:50.100231",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "import sys\n",
    "from pathlib import Path\n",
    "\n",
    "# Add the 'data' directory to sys.path\n",
    "sys.path.append(str(Path('research-biocv-proj').resolve()))\n",
    "from data.unimodal import *\n",
    "from pathlib import Path\n",
    "\n",
    "import numpy as np\n",
    "import torch\n",
    "from torch.utils.data import DataLoader\n",
    "\n",
    "from sklearn.utils.class_weight import compute_class_weight"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "a71f5067",
   "metadata": {
    "papermill": {
     "duration": 0.015141,
     "end_time": "2024-10-08T10:15:54.512807",
     "exception": false,
     "start_time": "2024-10-08T10:15:54.497666",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "### Train ResNet model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "dea904e1",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-08T10:15:54.545829Z",
     "iopub.status.busy": "2024-10-08T10:15:54.544712Z",
     "iopub.status.idle": "2024-10-08T10:16:06.354378Z",
     "shell.execute_reply": "2024-10-08T10:16:06.353374Z"
    },
    "papermill": {
     "duration": 11.828922,
     "end_time": "2024-10-08T10:16:06.356844",
     "exception": false,
     "start_time": "2024-10-08T10:15:54.527922",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Collecting focal_loss_torch\r\n",
      "  Downloading focal_loss_torch-0.1.2-py3-none-any.whl.metadata (2.2 kB)\r\n",
      "Requirement already satisfied: torch in /opt/conda/lib/python3.10/site-packages (from focal_loss_torch) (2.4.0)\r\n",
      "Requirement already satisfied: numpy in /opt/conda/lib/python3.10/site-packages (from focal_loss_torch) (1.26.4)\r\n",
      "Requirement already satisfied: filelock in /opt/conda/lib/python3.10/site-packages (from torch->focal_loss_torch) (3.15.1)\r\n",
      "Requirement already satisfied: typing-extensions>=4.8.0 in /opt/conda/lib/python3.10/site-packages (from torch->focal_loss_torch) (4.12.2)\r\n",
      "Requirement already satisfied: sympy in /opt/conda/lib/python3.10/site-packages (from torch->focal_loss_torch) (1.13.3)\r\n",
      "Requirement already satisfied: networkx in /opt/conda/lib/python3.10/site-packages (from torch->focal_loss_torch) (3.3)\r\n",
      "Requirement already satisfied: jinja2 in /opt/conda/lib/python3.10/site-packages (from torch->focal_loss_torch) (3.1.4)\r\n",
      "Requirement already satisfied: fsspec in /opt/conda/lib/python3.10/site-packages (from torch->focal_loss_torch) (2024.6.1)\r\n",
      "Requirement already satisfied: MarkupSafe>=2.0 in /opt/conda/lib/python3.10/site-packages (from jinja2->torch->focal_loss_torch) (2.1.5)\r\n",
      "Requirement already satisfied: mpmath<1.4,>=1.1.0 in /opt/conda/lib/python3.10/site-packages (from sympy->torch->focal_loss_torch) (1.3.0)\r\n",
      "Downloading focal_loss_torch-0.1.2-py3-none-any.whl (4.5 kB)\r\n",
      "Installing collected packages: focal_loss_torch\r\n",
      "Successfully installed focal_loss_torch-0.1.2\r\n"
     ]
    }
   ],
   "source": [
    "#https://github.com/mathiaszinnen/focal_loss_torch/tree/main\n",
    "!pip install focal_loss_torch"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "e0e83361",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-08T10:16:06.391639Z",
     "iopub.status.busy": "2024-10-08T10:16:06.390674Z",
     "iopub.status.idle": "2024-10-08T10:16:06.408072Z",
     "shell.execute_reply": "2024-10-08T10:16:06.407168Z"
    },
    "papermill": {
     "duration": 0.03724,
     "end_time": "2024-10-08T10:16:06.410036",
     "exception": false,
     "start_time": "2024-10-08T10:16:06.372796",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "class EarlyStopping:\n",
    "    \"\"\"Early stops the training if validation loss doesn't improve after a given patience.\"\"\"\n",
    "    def __init__(self, patience=7, verbose=False, delta=0, path='checkpoint.pt', trace_func=print):\n",
    "        \"\"\"\n",
    "        Args:\n",
    "            patience (int): How long to wait after last time validation loss improved.\n",
    "                            Default: 7\n",
    "            verbose (bool): If True, prints a message for each validation loss improvement. \n",
    "                            Default: False\n",
    "            delta (float): Minimum change in the monitored quantity to qualify as an improvement.\n",
    "                            Default: 0\n",
    "            path (str): Path for the checkpoint to be saved to.\n",
    "                            Default: 'checkpoint.pt'\n",
    "            trace_func (function): trace print function.\n",
    "                            Default: print            \n",
    "        \"\"\"\n",
    "        self.patience = patience\n",
    "        self.verbose = verbose\n",
    "        self.counter = 0\n",
    "        self.best_score = None\n",
    "        self.early_stop = False\n",
    "        self.val_loss_min = np.Inf\n",
    "        self.delta = delta\n",
    "        self.path = path\n",
    "        self.trace_func = trace_func\n",
    "    def __call__(self, val_loss, model):\n",
    "\n",
    "        score = -val_loss\n",
    "\n",
    "        if self.best_score is None:\n",
    "            self.best_score = score\n",
    "            self.save_checkpoint(val_loss, model)\n",
    "        elif score < self.best_score + self.delta:\n",
    "            self.counter += 1\n",
    "            self.trace_func(f'EarlyStopping counter: {self.counter} out of {self.patience}')\n",
    "            if self.counter >= self.patience:\n",
    "                self.early_stop = True\n",
    "        else:\n",
    "            self.best_score = score\n",
    "            self.save_checkpoint(val_loss, model)\n",
    "            self.counter = 0\n",
    "\n",
    "    def save_checkpoint(self, val_loss, model):\n",
    "        '''Saves model when validation loss decrease.'''\n",
    "        if self.verbose:\n",
    "            self.trace_func(f'Validation loss decreased ({self.val_loss_min:.6f} --> {val_loss:.6f}).  Saving model ...')\n",
    "        torch.save(model.state_dict(), self.path)\n",
    "        self.val_loss_min = val_loss"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "5f68f73b",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-08T10:16:06.444133Z",
     "iopub.status.busy": "2024-10-08T10:16:06.443787Z",
     "iopub.status.idle": "2024-10-08T10:16:06.476612Z",
     "shell.execute_reply": "2024-10-08T10:16:06.475581Z"
    },
    "papermill": {
     "duration": 0.053033,
     "end_time": "2024-10-08T10:16:06.478956",
     "exception": false,
     "start_time": "2024-10-08T10:16:06.425923",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "from focal_loss.focal_loss import FocalLoss\n",
    "\n",
    "def train(model, train_loader,val_loader, config, run_name=None):\n",
    "    \n",
    "    wandb.init(\n",
    "        # set the wandb project where this run will be logged\n",
    "        project=\"optuna_unimodal_ct_training\",\n",
    "        name = run_name,\n",
    "        # track hyperparameters and run metadata\n",
    "        config=config\n",
    "    )\n",
    "    device = torch.device(\"cuda\" if torch.cuda.is_available() else \"cpu\")\n",
    "    if config[\"class_weights\"] is not None: \n",
    "        config[\"class_weights\"] = torch.tensor(config[\"class_weights\"], dtype=torch.float).to(device) \n",
    "    optimizer = optim.Adam(model.parameters(), lr=config[\"learning_rate\"], weight_decay=config[\"weight_decay\"])\n",
    "    if config[\"focal_loss\"] is not None:\n",
    "        \n",
    "        criterion = FocalLoss(gamma = config[\"focal_loss\"])\n",
    "    else:\n",
    "        criterion = nn.CrossEntropyLoss(weight = config[\"class_weights\"])\n",
    "    scheduler = optim.lr_scheduler.ReduceLROnPlateau(optimizer, 'min',factor = config[\"reduce_lr_factor\"], patience = config[\"patience\"])\n",
    "    \n",
    "    # initialize the early_stopping object\n",
    "    early_stopping = EarlyStopping(patience=config[\"early_stop_patience\"], verbose=True)\n",
    "    \n",
    "    # Training loop\n",
    "    num_epochs = config[\"epochs\"]\n",
    "    for epoch in range(num_epochs):\n",
    "        model.train()\n",
    "        running_loss = 0.0\n",
    "        train_correct = 0\n",
    "        total = 0\n",
    "        correct_per_class = [0, 0, 0]  # For G1, G2, G3\n",
    "        total_per_class = [0, 0, 0]  # For G1, G2, G3\n",
    "        for batch in train_loader:\n",
    "            frames = batch['frame'].float().to(device)\n",
    "            labels = batch['label'].long().to(device)\n",
    "            \n",
    "            optimizer.zero_grad()\n",
    "            outputs = model(frames)\n",
    "            if config[\"focal_loss\"]:\n",
    "                softmax = torch.nn.Softmax(dim=-1)\n",
    "                loss = criterion(softmax(outputs.logits), labels)\n",
    "            else:\n",
    "                loss = criterion(outputs.logits, labels)\n",
    "\n",
    "            \n",
    "            _, predicted = torch.max(outputs.logits, 1)\n",
    "            train_correct += (predicted == labels).sum().item()\n",
    "            loss.backward()\n",
    "            optimizer.step()\n",
    "            total += labels.size(0)\n",
    "            running_loss += loss.item()\n",
    "            \n",
    "            # Calculate accuracy per class\n",
    "            for i in range(3):  # We have 3 classes: G1 (0), G2 (1), G3 (2)\n",
    "                correct_per_class[i] += ((predicted == i) & (labels == i)).sum().item()\n",
    "                total_per_class[i] += (labels == i).sum().item()\n",
    "\n",
    "        train_accuracy = 100 * train_correct / total\n",
    "        class_accuracy = [(100 * correct_per_class[i] / total_per_class[i]) if total_per_class[i] > 0 else 0 for i in range(3)]\n",
    "        print(f\"Epoch {epoch+1}, Loss: {running_loss/len(train_loader)}\")\n",
    "        wandb.log({\"Train Accuracy\": train_accuracy, \"Train loss\": running_loss/len(train_loader), \"G1_TrainAcc\":class_accuracy[0], \"G2_TrainAcc\":class_accuracy[1], \"G3_TrainAcc\":class_accuracy[2]})\n",
    "\n",
    "        # Validation loop\n",
    "        model.eval()\n",
    "        val_loss = 0.0\n",
    "        correct = 0\n",
    "        total = 0\n",
    "        # Initialize counters for each class (G1, G2, G3)\n",
    "        correct_per_class = [0, 0, 0]  # For G1, G2, G3\n",
    "        total_per_class = [0, 0, 0]  # For G1, G2, G3\n",
    "        val_labels = []\n",
    "        val_predictions = []\n",
    "\n",
    "\n",
    "        with torch.no_grad():\n",
    "            for batch in val_loader:\n",
    "                frames = batch['frame'].float().to(device)\n",
    "                labels = batch['label'].long().to(device)\n",
    "\n",
    "                outputs = model(frames)\n",
    "                \n",
    "                if config[\"focal_loss\"]:\n",
    "                    softmax = torch.nn.Softmax(dim=-1)\n",
    "                    loss = criterion(softmax(outputs.logits), labels)\n",
    "                else:\n",
    "                    loss = criterion(outputs.logits, labels)\n",
    "\n",
    "                val_loss += loss.item()\n",
    "                _, predicted = torch.max(outputs.logits, 1)\n",
    "                total += labels.size(0)\n",
    "                correct += (predicted == labels).sum().item()\n",
    "\n",
    "                # Calculate accuracy per class\n",
    "                for i in range(3):  # We have 3 classes: G1 (0), G2 (1), G3 (2)\n",
    "                    correct_per_class[i] += ((predicted == i) & (labels == i)).sum().item()\n",
    "                    total_per_class[i] += (labels == i).sum().item()\n",
    "                \n",
    "                val_labels.extend(labels.cpu().tolist())\n",
    "                val_predictions.extend(predicted.cpu().tolist())\n",
    "        \n",
    "        scheduler.step(val_loss)\n",
    "        \n",
    "        # Compute total accuracy and per-class accuracy\n",
    "       \n",
    "        total_accuracy = 100 * correct / total\n",
    "        class_accuracy = [(100 * correct_per_class[i] / total_per_class[i]) if total_per_class[i] > 0 else 0 for i in range(3)]\n",
    "        print(f\"Validation Loss: {val_loss/len(val_loader)}, Total Accuracy: {total_accuracy:.2f}%\")\n",
    "        print(f\"Accuracy per class - G1: {class_accuracy[0]:.2f}%, G2: {class_accuracy[1]:.2f}%, G3: {class_accuracy[2]:.2f}%\")\n",
    "        # log metrics to wandb\n",
    "        wandb.log({\n",
    "            \"Total Accuracy\": total_accuracy, \n",
    "            \"Validation Loss\": val_loss/len(val_loader), \n",
    "            \"G1_Acc\":class_accuracy[0], \n",
    "            \"G2_Acc\":class_accuracy[1], \n",
    "            \"G3_Acc\":class_accuracy[2]\n",
    "        })\n",
    "        \n",
    "        \n",
    "        early_stopping(val_loss, model)\n",
    "        \n",
    "        if early_stopping.early_stop:\n",
    "            print(\"Early stopping\")\n",
    "            break\n",
    "    wandb.finish()\n",
    "    return "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "5ff63212",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-08T10:16:06.516704Z",
     "iopub.status.busy": "2024-10-08T10:16:06.516386Z",
     "iopub.status.idle": "2024-10-08T10:16:08.632611Z",
     "shell.execute_reply": "2024-10-08T10:16:08.631848Z"
    },
    "papermill": {
     "duration": 2.13773,
     "end_time": "2024-10-08T10:16:08.634899",
     "exception": false,
     "start_time": "2024-10-08T10:16:06.497169",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "import torch.nn as nn\n",
    "import torch.optim as optim\n",
    "from transformers import ResNetForImageClassification\n",
    "from sklearn.model_selection import StratifiedGroupKFold #For crossvalidation"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "c01ae5ab",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-08T10:16:08.668037Z",
     "iopub.status.busy": "2024-10-08T10:16:08.667528Z",
     "iopub.status.idle": "2024-10-08T10:16:18.430316Z",
     "shell.execute_reply": "2024-10-08T10:16:18.429312Z"
    },
    "papermill": {
     "duration": 9.781831,
     "end_time": "2024-10-08T10:16:18.432641",
     "exception": false,
     "start_time": "2024-10-08T10:16:08.650810",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "train_dataset = UnimodalCTDataset(split='all',dataset_path = \"/kaggle/input/preprocessed57patientscptacpda/processed/\" )"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "2012391b",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-08T10:16:18.465309Z",
     "iopub.status.busy": "2024-10-08T10:16:18.464923Z",
     "iopub.status.idle": "2024-10-08T10:16:18.468778Z",
     "shell.execute_reply": "2024-10-08T10:16:18.468041Z"
    },
    "papermill": {
     "duration": 0.022276,
     "end_time": "2024-10-08T10:16:18.470715",
     "exception": false,
     "start_time": "2024-10-08T10:16:18.448439",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "#print(f\"Training set stats:{train_dataset.stats()}\")\n",
    "#print(f\"Validation set stats:{val_dataset.stats()}\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "id": "79c50970",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-08T10:16:18.502709Z",
     "iopub.status.busy": "2024-10-08T10:16:18.502429Z",
     "iopub.status.idle": "2024-10-08T10:16:18.508170Z",
     "shell.execute_reply": "2024-10-08T10:16:18.507268Z"
    },
    "papermill": {
     "duration": 0.023814,
     "end_time": "2024-10-08T10:16:18.509965",
     "exception": false,
     "start_time": "2024-10-08T10:16:18.486151",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "'\\nlabels = []\\nfor sample in train_dataset:\\n    labels.append(sample[\"label\"])\\nlabels = np.array(labels)\\nclass_weights = compute_class_weight(\"balanced\", classes=np.unique(labels), y=labels)\\n'"
      ]
     },
     "execution_count": 13,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "\"\"\"\n",
    "labels = []\n",
    "for sample in train_dataset:\n",
    "    labels.append(sample[\"label\"])\n",
    "labels = np.array(labels)\n",
    "class_weights = compute_class_weight(\"balanced\", classes=np.unique(labels), y=labels)\n",
    "\"\"\""
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 14,
   "id": "316db673",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-08T10:16:18.541794Z",
     "iopub.status.busy": "2024-10-08T10:16:18.541522Z",
     "iopub.status.idle": "2024-10-08T10:16:18.545444Z",
     "shell.execute_reply": "2024-10-08T10:16:18.544531Z"
    },
    "papermill": {
     "duration": 0.022017,
     "end_time": "2024-10-08T10:16:18.547373",
     "exception": false,
     "start_time": "2024-10-08T10:16:18.525356",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "#print(class_weights)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 15,
   "id": "7bd80300",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-08T10:16:18.580185Z",
     "iopub.status.busy": "2024-10-08T10:16:18.579610Z",
     "iopub.status.idle": "2024-10-08T10:16:18.583462Z",
     "shell.execute_reply": "2024-10-08T10:16:18.582630Z"
    },
    "papermill": {
     "duration": 0.022037,
     "end_time": "2024-10-08T10:16:18.585398",
     "exception": false,
     "start_time": "2024-10-08T10:16:18.563361",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "#train_dataset = UnimodalCTDataset(split='train',dataset_path = \"/kaggle/input/oversampling57patientscptacpda/processed_oversampling/\" )\n",
    "#val_dataset = UnimodalCTDataset(split='val',dataset_path = \"/kaggle/input/oversampling57patientscptacpda/processed_oversampling/\")\n",
    "\n",
    "#train_loader = DataLoader(train_dataset, batch_size=32, shuffle=True)\n",
    "#val_loader = DataLoader(val_dataset, batch_size=32, shuffle=False)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 16,
   "id": "afcce500",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-08T10:16:18.617875Z",
     "iopub.status.busy": "2024-10-08T10:16:18.617358Z",
     "iopub.status.idle": "2024-10-08T10:16:18.621245Z",
     "shell.execute_reply": "2024-10-08T10:16:18.620393Z"
    },
    "papermill": {
     "duration": 0.022276,
     "end_time": "2024-10-08T10:16:18.623186",
     "exception": false,
     "start_time": "2024-10-08T10:16:18.600910",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "#print(f\"Training set stats:{train_dataset.stats()}\")\n",
    "#print(f\"Validation set stats:{val_dataset.stats()}\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 17,
   "id": "70a3fd52",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-08T10:16:18.656630Z",
     "iopub.status.busy": "2024-10-08T10:16:18.656328Z",
     "iopub.status.idle": "2024-10-08T10:16:18.660281Z",
     "shell.execute_reply": "2024-10-08T10:16:18.659480Z"
    },
    "papermill": {
     "duration": 0.022906,
     "end_time": "2024-10-08T10:16:18.662248",
     "exception": false,
     "start_time": "2024-10-08T10:16:18.639342",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "#total = train_dataset.stats()[\"length\"]\n",
    "#most_frequent = max(train_dataset.stats()[\"class_frequency\"].values())\n",
    "#freq_dict = train_dataset.stats()[\"class_frequency\"]\n",
    "#target_volume_depth= {}\n",
    "#for index in freq_dict.keys():\n",
    "#    target_volume_depth[index] = int((total/3 ) * most_frequent / freq_dict[index])\n",
    "#print(target_volume_depth)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "71d58e65",
   "metadata": {
    "papermill": {
     "duration": 0.015409,
     "end_time": "2024-10-08T10:16:18.693480",
     "exception": false,
     "start_time": "2024-10-08T10:16:18.678071",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "### Resnet-50"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 18,
   "id": "428da0ee",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-08T10:16:18.725920Z",
     "iopub.status.busy": "2024-10-08T10:16:18.725620Z",
     "iopub.status.idle": "2024-10-08T10:16:18.729483Z",
     "shell.execute_reply": "2024-10-08T10:16:18.728594Z"
    },
    "papermill": {
     "duration": 0.022317,
     "end_time": "2024-10-08T10:16:18.731527",
     "exception": false,
     "start_time": "2024-10-08T10:16:18.709210",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "#model = ResNetForImageClassification.from_pretrained('microsoft/resnet-50')\n",
    "#model.classifier[-1] = nn.Linear(model.classifier[-1].in_features, UnimodalCTDataset.num_classes) #Adjusting the final layer to the unimodal number of classes"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 19,
   "id": "fa414106",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-08T10:16:18.764180Z",
     "iopub.status.busy": "2024-10-08T10:16:18.763801Z",
     "iopub.status.idle": "2024-10-08T10:16:18.767473Z",
     "shell.execute_reply": "2024-10-08T10:16:18.766650Z"
    },
    "papermill": {
     "duration": 0.022142,
     "end_time": "2024-10-08T10:16:18.769445",
     "exception": false,
     "start_time": "2024-10-08T10:16:18.747303",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "#device = torch.device(\"cuda\" if torch.cuda.is_available() else \"cpu\")\n",
    "#model.to(device)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 20,
   "id": "baaed820",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-08T10:16:18.802860Z",
     "iopub.status.busy": "2024-10-08T10:16:18.802091Z",
     "iopub.status.idle": "2024-10-08T10:16:18.807971Z",
     "shell.execute_reply": "2024-10-08T10:16:18.807146Z"
    },
    "papermill": {
     "duration": 0.024693,
     "end_time": "2024-10-08T10:16:18.809751",
     "exception": false,
     "start_time": "2024-10-08T10:16:18.785058",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "'\\nconfig={\\n    \"learning_rate\": 1e-4,\\n    \"architecture\": \"microsoft/resnet-50 new1\",\\n    \"epochs\": 100,\\n    \"weight_decay\": 1e-4,\\n    \"reduce_lr_factor\": 0.2,\\n    \"patience\": 10,\\n    \"class_weights\": class_weights\\n    }\\ntrain(model, config, run_name = config[\"architecture\"])\\n'"
      ]
     },
     "execution_count": 20,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "\"\"\"\n",
    "config={\n",
    "    \"learning_rate\": 1e-4,\n",
    "    \"architecture\": \"microsoft/resnet-50 new1\",\n",
    "    \"epochs\": 100,\n",
    "    \"weight_decay\": 1e-4,\n",
    "    \"reduce_lr_factor\": 0.2,\n",
    "    \"patience\": 10,\n",
    "    \"class_weights\": class_weights\n",
    "    }\n",
    "train(model, config, run_name = config[\"architecture\"])\n",
    "\"\"\""
   ]
  },
  {
   "cell_type": "markdown",
   "id": "5e5fe37c",
   "metadata": {
    "papermill": {
     "duration": 0.015291,
     "end_time": "2024-10-08T10:16:18.840450",
     "exception": false,
     "start_time": "2024-10-08T10:16:18.825159",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "### Resnet-18"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 21,
   "id": "9a591dd5",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-08T10:16:18.873347Z",
     "iopub.status.busy": "2024-10-08T10:16:18.872542Z",
     "iopub.status.idle": "2024-10-08T10:16:18.878368Z",
     "shell.execute_reply": "2024-10-08T10:16:18.877472Z"
    },
    "papermill": {
     "duration": 0.024275,
     "end_time": "2024-10-08T10:16:18.880225",
     "exception": false,
     "start_time": "2024-10-08T10:16:18.855950",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "'\\nconfig={\\n    \"learning_rate\": 1e-7,\\n    \"architecture\": \"microsoft/resnet-18\",\\n    \"run_name\": \"microsoft/resnet-18 NOOVERSAMPLING FOCALLOSS\",\\n    \"epochs\": 800,\\n    \"weight_decay\": 1e-6,\\n    \"reduce_lr_factor\": 0.25,\\n    \"patience\": 20,\\n    \"early_stop_patience\": 40,\\n    \"class_weights\": None,\\n    \"focal_loss\": 2\\n    }\\n\\n'"
      ]
     },
     "execution_count": 21,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "\"\"\"\n",
    "config={\n",
    "    \"learning_rate\": 1e-7,\n",
    "    \"architecture\": \"microsoft/resnet-18\",\n",
    "    \"run_name\": \"microsoft/resnet-18 NOOVERSAMPLING FOCALLOSS\",\n",
    "    \"epochs\": 800,\n",
    "    \"weight_decay\": 1e-6,\n",
    "    \"reduce_lr_factor\": 0.25,\n",
    "    \"patience\": 20,\n",
    "    \"early_stop_patience\": 40,\n",
    "    \"class_weights\": None,\n",
    "    \"focal_loss\": 2\n",
    "    }\n",
    "\n",
    "\"\"\"\n",
    "\n",
    "\n"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "ba14ca5c",
   "metadata": {
    "papermill": {
     "duration": 0.015695,
     "end_time": "2024-10-08T10:16:18.911491",
     "exception": false,
     "start_time": "2024-10-08T10:16:18.895796",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "### Resnet-34"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 22,
   "id": "5566a58a",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-08T10:16:18.944466Z",
     "iopub.status.busy": "2024-10-08T10:16:18.944164Z",
     "iopub.status.idle": "2024-10-08T10:16:18.947834Z",
     "shell.execute_reply": "2024-10-08T10:16:18.947133Z"
    },
    "papermill": {
     "duration": 0.022395,
     "end_time": "2024-10-08T10:16:18.949723",
     "exception": false,
     "start_time": "2024-10-08T10:16:18.927328",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "#model = ResNetForImageClassification.from_pretrained('microsoft/resnet-34')\n",
    "#model.classifier[-1] = nn.Linear(model.classifier[-1].in_features, UnimodalCTDataset.num_classes) #Adjusting the final layer to the unimodal number of classes"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 23,
   "id": "73087f78",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-08T10:16:18.982376Z",
     "iopub.status.busy": "2024-10-08T10:16:18.982088Z",
     "iopub.status.idle": "2024-10-08T10:16:18.985699Z",
     "shell.execute_reply": "2024-10-08T10:16:18.984902Z"
    },
    "papermill": {
     "duration": 0.021964,
     "end_time": "2024-10-08T10:16:18.987559",
     "exception": false,
     "start_time": "2024-10-08T10:16:18.965595",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "#device = torch.device(\"cuda\" if torch.cuda.is_available() else \"cpu\")\n",
    "#model.to(device)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 24,
   "id": "cec33306",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-08T10:16:19.021629Z",
     "iopub.status.busy": "2024-10-08T10:16:19.021321Z",
     "iopub.status.idle": "2024-10-08T10:16:19.027311Z",
     "shell.execute_reply": "2024-10-08T10:16:19.026486Z"
    },
    "papermill": {
     "duration": 0.024678,
     "end_time": "2024-10-08T10:16:19.029239",
     "exception": false,
     "start_time": "2024-10-08T10:16:19.004561",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "'\\nconfig={\\n    \"learning_rate\": 5e-8,\\n    \"architecture\": \"microsoft/resnet-34\",\\n    \"run_name\": \"microsoft/resnet-34 NOOVERSAMPLING FOCALLOSS fold: \",\\n    \"epochs\": 2,\\n    \"weight_decay\": 1e-6,\\n    \"reduce_lr_factor\": 0.25,\\n    \"patience\": 20,\\n    \"early_stop_patience\": 40,\\n    \"class_weights\": None,\\n    \"focal_loss\": 5\\n    }\\n\\n'"
      ]
     },
     "execution_count": 24,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "\"\"\"\n",
    "config={\n",
    "    \"learning_rate\": 5e-8,\n",
    "    \"architecture\": \"microsoft/resnet-34\",\n",
    "    \"run_name\": \"microsoft/resnet-34 NOOVERSAMPLING FOCALLOSS fold: \",\n",
    "    \"epochs\": 2,\n",
    "    \"weight_decay\": 1e-6,\n",
    "    \"reduce_lr_factor\": 0.25,\n",
    "    \"patience\": 20,\n",
    "    \"early_stop_patience\": 40,\n",
    "    \"class_weights\": None,\n",
    "    \"focal_loss\": 5\n",
    "    }\n",
    "\n",
    "\"\"\"\n",
    "\n",
    "\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 25,
   "id": "ad8b8d3c",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-08T10:16:19.062707Z",
     "iopub.status.busy": "2024-10-08T10:16:19.062447Z",
     "iopub.status.idle": "2024-10-08T10:16:19.068087Z",
     "shell.execute_reply": "2024-10-08T10:16:19.067229Z"
    },
    "papermill": {
     "duration": 0.024448,
     "end_time": "2024-10-08T10:16:19.069937",
     "exception": false,
     "start_time": "2024-10-08T10:16:19.045489",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "{'length': 3294, 'class_frequency': {'G1': 287, 'G2': 2076, 'G3': 931}}"
      ]
     },
     "execution_count": 25,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "train_dataset.stats()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 26,
   "id": "e6144458",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-08T10:16:19.104481Z",
     "iopub.status.busy": "2024-10-08T10:16:19.104123Z",
     "iopub.status.idle": "2024-10-08T10:16:19.108119Z",
     "shell.execute_reply": "2024-10-08T10:16:19.107233Z"
    },
    "papermill": {
     "duration": 0.023412,
     "end_time": "2024-10-08T10:16:19.110006",
     "exception": false,
     "start_time": "2024-10-08T10:16:19.086594",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "#!pip install optuna-integration"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 27,
   "id": "dac94866",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-08T10:16:19.144606Z",
     "iopub.status.busy": "2024-10-08T10:16:19.143812Z",
     "iopub.status.idle": "2024-10-08T14:52:01.747278Z",
     "shell.execute_reply": "2024-10-08T14:52:01.746177Z"
    },
    "papermill": {
     "duration": 16542.622901,
     "end_time": "2024-10-08T14:52:01.749302",
     "exception": false,
     "start_time": "2024-10-08T10:16:19.126401",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "[I 2024-10-08 10:16:19,266] A new study created in memory with name: no-name-ec43db62-9172-46d0-968f-b7b1dece80ec\n"
     ]
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "70fa1aacaf37432689afeba2cbd8cb13",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "config.json:   0%|          | 0.00/69.5k [00:00<?, ?B/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "9edcf7b6ef714171b8b9e28d0059f0b2",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "model.safetensors:   0%|          | 0.00/46.8M [00:00<?, ?B/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\u001b[34m\u001b[1mwandb\u001b[0m: Currently logged in as: \u001b[33mpietro-caforio\u001b[0m (\u001b[33mpietro-caforio-politecnico-di-milano\u001b[0m). Use \u001b[1m`wandb login --relogin`\u001b[0m to force relogin\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Tracking run with wandb version 0.18.3\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run data is saved locally in \u001b[35m\u001b[1m/kaggle/working/wandb/run-20241008_101620-yqf8jxu2\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run \u001b[1m`wandb offline`\u001b[0m to turn off syncing.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Syncing run \u001b[33moptuna_run_0 microsoft/resnet-18 NOOVERSAMPLING FOCALLOS1\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: ⭐️ View project at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: 🚀 View run at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/yqf8jxu2\u001b[0m\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Epoch 1, Loss: 0.31200522310044393\n",
      "Validation Loss: 0.48187750506968724, Total Accuracy: 51.85%\n",
      "Accuracy per class - G1: 0.00%, G2: 79.62%, G3: 0.00%\n",
      "Validation loss decreased (inf --> 10.119428).  Saving model ...\n",
      "Epoch 2, Loss: 0.3026982775653701\n",
      "Validation Loss: 0.4748088855828558, Total Accuracy: 56.17%\n",
      "Accuracy per class - G1: 0.00%, G2: 86.26%, G3: 0.00%\n",
      "Validation loss decreased (10.119428 --> 9.970987).  Saving model ...\n",
      "Epoch 3, Loss: 0.29708791048411864\n",
      "Validation Loss: 0.48176055845050586, Total Accuracy: 56.17%\n",
      "Accuracy per class - G1: 0.00%, G2: 86.26%, G3: 0.00%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 4, Loss: 0.28541356720120076\n",
      "Validation Loss: 0.48788961998763536, Total Accuracy: 54.17%\n",
      "Accuracy per class - G1: 0.00%, G2: 83.18%, G3: 0.00%\n",
      "EarlyStopping counter: 2 out of 40\n",
      "Epoch 5, Loss: 0.28129409630614594\n",
      "Validation Loss: 0.4803310581261203, Total Accuracy: 52.16%\n",
      "Accuracy per class - G1: 0.00%, G2: 80.09%, G3: 0.00%\n",
      "EarlyStopping counter: 3 out of 40\n",
      "Epoch 6, Loss: 0.2674079147807087\n",
      "Validation Loss: 0.4672043158539704, Total Accuracy: 55.40%\n",
      "Accuracy per class - G1: 0.00%, G2: 85.07%, G3: 0.00%\n",
      "Validation loss decreased (9.970987 --> 9.811291).  Saving model ...\n",
      "Epoch 7, Loss: 0.26166039687323284\n",
      "Validation Loss: 0.47325101654444424, Total Accuracy: 53.70%\n",
      "Accuracy per class - G1: 0.00%, G2: 82.46%, G3: 0.00%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 8, Loss: 0.253759242324944\n",
      "Validation Loss: 0.46982509021957714, Total Accuracy: 54.63%\n",
      "Accuracy per class - G1: 0.00%, G2: 83.89%, G3: 0.00%\n",
      "EarlyStopping counter: 2 out of 40\n",
      "Epoch 9, Loss: 0.2488555337291166\n",
      "Validation Loss: 0.47141589579128085, Total Accuracy: 53.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 82.23%, G3: 0.00%\n",
      "EarlyStopping counter: 3 out of 40\n",
      "Epoch 10, Loss: 0.24230442258966975\n",
      "Validation Loss: 0.4771338639159997, Total Accuracy: 53.09%\n",
      "Accuracy per class - G1: 0.00%, G2: 81.52%, G3: 0.00%\n",
      "EarlyStopping counter: 4 out of 40\n",
      "Epoch 11, Loss: 0.23442147941474456\n",
      "Validation Loss: 0.46637942056570736, Total Accuracy: 51.85%\n",
      "Accuracy per class - G1: 0.00%, G2: 79.62%, G3: 0.00%\n",
      "Validation loss decreased (9.811291 --> 9.793968).  Saving model ...\n",
      "Epoch 12, Loss: 0.226499324642032\n",
      "Validation Loss: 0.4636053348048812, Total Accuracy: 53.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 82.23%, G3: 0.00%\n",
      "Validation loss decreased (9.793968 --> 9.735712).  Saving model ...\n",
      "Epoch 13, Loss: 0.2229780218148806\n",
      "Validation Loss: 0.4678202551745233, Total Accuracy: 53.09%\n",
      "Accuracy per class - G1: 0.00%, G2: 81.52%, G3: 0.00%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 14, Loss: 0.2177161802369428\n",
      "Validation Loss: 0.46285464490453404, Total Accuracy: 53.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 82.23%, G3: 0.00%\n",
      "Validation loss decreased (9.735712 --> 9.719948).  Saving model ...\n",
      "Epoch 15, Loss: 0.21070547006934523\n",
      "Validation Loss: 0.4604302037152506, Total Accuracy: 55.09%\n",
      "Accuracy per class - G1: 0.00%, G2: 84.60%, G3: 0.00%\n",
      "Validation loss decreased (9.719948 --> 9.669034).  Saving model ...\n",
      "Epoch 16, Loss: 0.20532744835658245\n",
      "Validation Loss: 0.45154226074616116, Total Accuracy: 53.70%\n",
      "Accuracy per class - G1: 0.00%, G2: 82.46%, G3: 0.00%\n",
      "Validation loss decreased (9.669034 --> 9.482387).  Saving model ...\n",
      "Epoch 17, Loss: 0.20059791135500712\n",
      "Validation Loss: 0.4509567157143638, Total Accuracy: 53.09%\n",
      "Accuracy per class - G1: 0.00%, G2: 81.52%, G3: 0.00%\n",
      "Validation loss decreased (9.482387 --> 9.470091).  Saving model ...\n",
      "Epoch 18, Loss: 0.19562637473804406\n",
      "Validation Loss: 0.47343704299557776, Total Accuracy: 51.23%\n",
      "Accuracy per class - G1: 0.00%, G2: 78.67%, G3: 0.00%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 19, Loss: 0.19080956711108427\n",
      "Validation Loss: 0.4524336429756312, Total Accuracy: 51.39%\n",
      "Accuracy per class - G1: 0.00%, G2: 78.91%, G3: 0.00%\n",
      "EarlyStopping counter: 2 out of 40\n",
      "Epoch 20, Loss: 0.1867589077138039\n",
      "Validation Loss: 0.46276329386801945, Total Accuracy: 50.46%\n",
      "Accuracy per class - G1: 0.00%, G2: 77.49%, G3: 0.00%\n",
      "EarlyStopping counter: 3 out of 40\n",
      "Epoch 21, Loss: 0.18197368480354906\n",
      "Validation Loss: 0.4501759387730133, Total Accuracy: 51.54%\n",
      "Accuracy per class - G1: 0.00%, G2: 79.15%, G3: 0.00%\n",
      "Validation loss decreased (9.470091 --> 9.453695).  Saving model ...\n",
      "Epoch 22, Loss: 0.17792739781988673\n",
      "Validation Loss: 0.4642582863924049, Total Accuracy: 48.61%\n",
      "Accuracy per class - G1: 0.00%, G2: 74.64%, G3: 0.00%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 23, Loss: 0.17352016368903309\n",
      "Validation Loss: 0.45162721164524555, Total Accuracy: 51.39%\n",
      "Accuracy per class - G1: 0.00%, G2: 78.91%, G3: 0.00%\n",
      "EarlyStopping counter: 2 out of 40\n",
      "Epoch 24, Loss: 0.16948962534766598\n",
      "Validation Loss: 0.4574483699564423, Total Accuracy: 51.39%\n",
      "Accuracy per class - G1: 0.00%, G2: 78.91%, G3: 0.00%\n",
      "EarlyStopping counter: 3 out of 40\n",
      "Epoch 25, Loss: 0.16522336526807532\n",
      "Validation Loss: 0.4603233091710579, Total Accuracy: 47.99%\n",
      "Accuracy per class - G1: 0.00%, G2: 73.70%, G3: 0.00%\n",
      "EarlyStopping counter: 4 out of 40\n",
      "Epoch 26, Loss: 0.16215572120195412\n",
      "Validation Loss: 0.46886334550522624, Total Accuracy: 46.60%\n",
      "Accuracy per class - G1: 0.00%, G2: 71.56%, G3: 0.00%\n",
      "EarlyStopping counter: 5 out of 40\n",
      "Epoch 27, Loss: 0.15752153403787728\n",
      "Validation Loss: 0.4586676072684072, Total Accuracy: 48.92%\n",
      "Accuracy per class - G1: 0.00%, G2: 75.12%, G3: 0.00%\n",
      "EarlyStopping counter: 6 out of 40\n",
      "Epoch 28, Loss: 0.15463473432394395\n",
      "Validation Loss: 0.46257259137928486, Total Accuracy: 48.15%\n",
      "Accuracy per class - G1: 0.00%, G2: 73.93%, G3: 0.00%\n",
      "EarlyStopping counter: 7 out of 40\n",
      "Epoch 29, Loss: 0.15085627623351225\n",
      "Validation Loss: 0.45977226538317545, Total Accuracy: 46.30%\n",
      "Accuracy per class - G1: 0.00%, G2: 71.09%, G3: 0.00%\n",
      "EarlyStopping counter: 8 out of 40\n",
      "Epoch 30, Loss: 0.1472218832876309\n",
      "Validation Loss: 0.44766469831977573, Total Accuracy: 48.15%\n",
      "Accuracy per class - G1: 0.00%, G2: 73.93%, G3: 0.00%\n",
      "Validation loss decreased (9.453695 --> 9.400959).  Saving model ...\n",
      "Epoch 31, Loss: 0.14445168587816767\n",
      "Validation Loss: 0.44377998173946426, Total Accuracy: 49.69%\n",
      "Accuracy per class - G1: 0.00%, G2: 76.30%, G3: 0.00%\n",
      "Validation loss decreased (9.400959 --> 9.319380).  Saving model ...\n",
      "Epoch 32, Loss: 0.14194349800965872\n",
      "Validation Loss: 0.451375443843149, Total Accuracy: 46.60%\n",
      "Accuracy per class - G1: 0.00%, G2: 71.33%, G3: 0.54%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 33, Loss: 0.13891560781791987\n",
      "Validation Loss: 0.46551547075311345, Total Accuracy: 45.52%\n",
      "Accuracy per class - G1: 0.00%, G2: 69.91%, G3: 0.00%\n",
      "EarlyStopping counter: 2 out of 40\n",
      "Epoch 34, Loss: 0.13591969780713678\n",
      "Validation Loss: 0.4558876669477849, Total Accuracy: 44.75%\n",
      "Accuracy per class - G1: 0.00%, G2: 68.48%, G3: 0.54%\n",
      "EarlyStopping counter: 3 out of 40\n",
      "Epoch 35, Loss: 0.13197264398436948\n",
      "Validation Loss: 0.4578429645903054, Total Accuracy: 47.69%\n",
      "Accuracy per class - G1: 0.00%, G2: 73.22%, G3: 0.00%\n",
      "EarlyStopping counter: 4 out of 40\n",
      "Epoch 36, Loss: 0.12862671175635004\n",
      "Validation Loss: 0.46596338635399226, Total Accuracy: 44.75%\n",
      "Accuracy per class - G1: 0.00%, G2: 68.72%, G3: 0.00%\n",
      "EarlyStopping counter: 5 out of 40\n",
      "Epoch 37, Loss: 0.12715755295322603\n",
      "Validation Loss: 0.4784210847602004, Total Accuracy: 44.14%\n",
      "Accuracy per class - G1: 0.00%, G2: 67.77%, G3: 0.00%\n",
      "EarlyStopping counter: 6 out of 40\n",
      "Epoch 38, Loss: 0.12556209711425276\n",
      "Validation Loss: 0.4624748283198902, Total Accuracy: 43.67%\n",
      "Accuracy per class - G1: 0.00%, G2: 67.06%, G3: 0.00%\n",
      "EarlyStopping counter: 7 out of 40\n",
      "Epoch 39, Loss: 0.12301885525146163\n",
      "Validation Loss: 0.4688161847492059, Total Accuracy: 42.44%\n",
      "Accuracy per class - G1: 0.00%, G2: 64.93%, G3: 0.54%\n",
      "EarlyStopping counter: 8 out of 40\n",
      "Epoch 40, Loss: 0.11904852873230555\n",
      "Validation Loss: 0.47437876666940393, Total Accuracy: 42.75%\n",
      "Accuracy per class - G1: 0.00%, G2: 65.64%, G3: 0.00%\n",
      "EarlyStopping counter: 9 out of 40\n",
      "Epoch 41, Loss: 0.11707146663263619\n",
      "Validation Loss: 0.47603299247012254, Total Accuracy: 43.21%\n",
      "Accuracy per class - G1: 0.00%, G2: 66.35%, G3: 0.00%\n",
      "EarlyStopping counter: 10 out of 40\n",
      "Epoch 42, Loss: 0.11661859511970038\n",
      "Validation Loss: 0.4775009417817706, Total Accuracy: 42.13%\n",
      "Accuracy per class - G1: 0.00%, G2: 64.69%, G3: 0.00%\n",
      "EarlyStopping counter: 11 out of 40\n",
      "Epoch 43, Loss: 0.11158267242542233\n",
      "Validation Loss: 0.47009445017292384, Total Accuracy: 44.91%\n",
      "Accuracy per class - G1: 0.00%, G2: 68.96%, G3: 0.00%\n",
      "EarlyStopping counter: 12 out of 40\n",
      "Epoch 44, Loss: 0.11129834534353521\n",
      "Validation Loss: 0.4706414085591123, Total Accuracy: 41.05%\n",
      "Accuracy per class - G1: 0.00%, G2: 63.03%, G3: 0.00%\n",
      "EarlyStopping counter: 13 out of 40\n",
      "Epoch 45, Loss: 0.10725874615361891\n",
      "Validation Loss: 0.46778934431217967, Total Accuracy: 43.21%\n",
      "Accuracy per class - G1: 0.00%, G2: 66.11%, G3: 0.54%\n",
      "EarlyStopping counter: 14 out of 40\n",
      "Epoch 46, Loss: 0.10626303485359054\n",
      "Validation Loss: 0.445587970759897, Total Accuracy: 43.83%\n",
      "Accuracy per class - G1: 0.00%, G2: 66.59%, G3: 1.62%\n",
      "EarlyStopping counter: 15 out of 40\n",
      "Epoch 47, Loss: 0.10702894376703055\n",
      "Validation Loss: 0.4629176766389892, Total Accuracy: 45.99%\n",
      "Accuracy per class - G1: 0.00%, G2: 70.62%, G3: 0.00%\n",
      "EarlyStopping counter: 16 out of 40\n",
      "Epoch 48, Loss: 0.10095232307731387\n",
      "Validation Loss: 0.4607780382391952, Total Accuracy: 45.99%\n",
      "Accuracy per class - G1: 0.00%, G2: 70.62%, G3: 0.00%\n",
      "EarlyStopping counter: 17 out of 40\n",
      "Epoch 49, Loss: 0.10026903890342598\n",
      "Validation Loss: 0.47082461833599065, Total Accuracy: 39.97%\n",
      "Accuracy per class - G1: 0.00%, G2: 60.90%, G3: 1.08%\n",
      "EarlyStopping counter: 18 out of 40\n",
      "Epoch 50, Loss: 0.09777191339666585\n",
      "Validation Loss: 0.4631682530577694, Total Accuracy: 43.67%\n",
      "Accuracy per class - G1: 0.00%, G2: 66.82%, G3: 0.54%\n",
      "EarlyStopping counter: 19 out of 40\n",
      "Epoch 51, Loss: 0.09475932948022003\n",
      "Validation Loss: 0.4771272557831946, Total Accuracy: 42.59%\n",
      "Accuracy per class - G1: 0.00%, G2: 65.40%, G3: 0.00%\n",
      "EarlyStopping counter: 20 out of 40\n",
      "Epoch 52, Loss: 0.09513905998992633\n",
      "Validation Loss: 0.4906011371917668, Total Accuracy: 42.44%\n",
      "Accuracy per class - G1: 0.00%, G2: 65.17%, G3: 0.00%\n",
      "EarlyStopping counter: 21 out of 40\n",
      "Epoch 53, Loss: 0.09454888751707881\n",
      "Validation Loss: 0.4722182033140035, Total Accuracy: 40.59%\n",
      "Accuracy per class - G1: 0.00%, G2: 61.85%, G3: 1.08%\n",
      "EarlyStopping counter: 22 out of 40\n",
      "Epoch 54, Loss: 0.09352100348795753\n",
      "Validation Loss: 0.46393393725156784, Total Accuracy: 40.90%\n",
      "Accuracy per class - G1: 0.00%, G2: 62.56%, G3: 0.54%\n",
      "EarlyStopping counter: 23 out of 40\n",
      "Epoch 55, Loss: 0.09178904758160372\n",
      "Validation Loss: 0.4671324680426291, Total Accuracy: 43.52%\n",
      "Accuracy per class - G1: 0.00%, G2: 66.59%, G3: 0.54%\n",
      "EarlyStopping counter: 24 out of 40\n",
      "Epoch 56, Loss: 0.09184386338814195\n",
      "Validation Loss: 0.4670159922291835, Total Accuracy: 40.74%\n",
      "Accuracy per class - G1: 0.00%, G2: 62.32%, G3: 0.54%\n",
      "EarlyStopping counter: 25 out of 40\n",
      "Epoch 57, Loss: 0.09187962038509817\n",
      "Validation Loss: 0.48399159489643007, Total Accuracy: 39.81%\n",
      "Accuracy per class - G1: 0.00%, G2: 61.14%, G3: 0.00%\n",
      "EarlyStopping counter: 26 out of 40\n",
      "Epoch 58, Loss: 0.08850817440683584\n",
      "Validation Loss: 0.46597015635953065, Total Accuracy: 39.51%\n",
      "Accuracy per class - G1: 0.00%, G2: 59.95%, G3: 1.62%\n",
      "EarlyStopping counter: 27 out of 40\n",
      "Epoch 59, Loss: 0.0886149832821754\n",
      "Validation Loss: 0.4601585612233196, Total Accuracy: 42.28%\n",
      "Accuracy per class - G1: 0.00%, G2: 64.69%, G3: 0.54%\n",
      "EarlyStopping counter: 28 out of 40\n",
      "Epoch 60, Loss: 0.0856966971453414\n",
      "Validation Loss: 0.4735915619170382, Total Accuracy: 38.43%\n",
      "Accuracy per class - G1: 0.00%, G2: 58.77%, G3: 0.54%\n",
      "EarlyStopping counter: 29 out of 40\n",
      "Epoch 61, Loss: 0.08722892448485615\n",
      "Validation Loss: 0.4871485496738127, Total Accuracy: 40.28%\n",
      "Accuracy per class - G1: 0.00%, G2: 61.61%, G3: 0.54%\n",
      "EarlyStopping counter: 30 out of 40\n",
      "Epoch 62, Loss: 0.08469075776905899\n",
      "Validation Loss: 0.49083241004319417, Total Accuracy: 37.19%\n",
      "Accuracy per class - G1: 0.00%, G2: 56.64%, G3: 1.08%\n",
      "EarlyStopping counter: 31 out of 40\n",
      "Epoch 63, Loss: 0.08668262174869158\n",
      "Validation Loss: 0.4739840961105767, Total Accuracy: 37.81%\n",
      "Accuracy per class - G1: 0.00%, G2: 57.35%, G3: 1.62%\n",
      "EarlyStopping counter: 32 out of 40\n",
      "Epoch 64, Loss: 0.08378280784530812\n",
      "Validation Loss: 0.47893003569472403, Total Accuracy: 38.89%\n",
      "Accuracy per class - G1: 0.00%, G2: 59.00%, G3: 1.62%\n",
      "EarlyStopping counter: 33 out of 40\n",
      "Epoch 65, Loss: 0.08186171522521112\n",
      "Validation Loss: 0.4714330569619224, Total Accuracy: 38.43%\n",
      "Accuracy per class - G1: 0.00%, G2: 58.29%, G3: 1.62%\n",
      "EarlyStopping counter: 34 out of 40\n",
      "Epoch 66, Loss: 0.083972787103021\n",
      "Validation Loss: 0.48676706486869425, Total Accuracy: 38.27%\n",
      "Accuracy per class - G1: 0.00%, G2: 58.53%, G3: 0.54%\n",
      "EarlyStopping counter: 35 out of 40\n",
      "Epoch 67, Loss: 0.08369947265250137\n",
      "Validation Loss: 0.4778948435116382, Total Accuracy: 38.43%\n",
      "Accuracy per class - G1: 0.00%, G2: 58.77%, G3: 0.54%\n",
      "EarlyStopping counter: 36 out of 40\n",
      "Epoch 68, Loss: 0.08153208111783108\n",
      "Validation Loss: 0.46683487074360963, Total Accuracy: 41.67%\n",
      "Accuracy per class - G1: 0.00%, G2: 63.74%, G3: 0.54%\n",
      "EarlyStopping counter: 37 out of 40\n",
      "Epoch 69, Loss: 0.07979166207004743\n",
      "Validation Loss: 0.4796856203604312, Total Accuracy: 40.12%\n",
      "Accuracy per class - G1: 0.00%, G2: 60.90%, G3: 1.62%\n",
      "EarlyStopping counter: 38 out of 40\n",
      "Epoch 70, Loss: 0.07883556456450956\n",
      "Validation Loss: 0.4725039971194097, Total Accuracy: 39.97%\n",
      "Accuracy per class - G1: 0.00%, G2: 61.14%, G3: 0.54%\n",
      "EarlyStopping counter: 39 out of 40\n",
      "Epoch 71, Loss: 0.08198203106062958\n",
      "Validation Loss: 0.4917829360458113, Total Accuracy: 37.04%\n",
      "Accuracy per class - G1: 0.00%, G2: 55.92%, G3: 2.16%\n",
      "EarlyStopping counter: 40 out of 40\n",
      "Early stopping\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\u001b[34m\u001b[1mwandb\u001b[0m:                                                                                \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run history:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc ▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc ▁▁▁▁▂▃▃▃▄▄▅▅▅▅▆▆▆▆▆▆▇▇▇▇▇▇▇▇████████████\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc ▆█▇█▆▇▇▆▆▆▆▆▅▅▅▅▆▅▄▅▃▃▃▃▄▄▃▂▃▃▂▂▃▂▁▂▂▂▂▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc ▁▂▃▃▄▄▅▅▅▅▅▆▅▆▆▆▇▆▆▇▇▇▇▇▇▇▇▇██▇▇▇▇█▇███▇\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc ▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▃▁▁▃▁▁▁▃▆▃▁▃▃▁▆▃▆▆▃▃█\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc ▁▁▁▁▁▁▁▁▁▂▂▂▂▃▃▃▄▄▅▅▆▆▆▆▇▇▇▇▇▇██████████\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy ▆█▇▇█▇▇▆▇▇▇▆▆▆▅▄▅▆▄▄▃▃▃▃▄▃▃▄▂▃▂▂▂▃▁▁▁▂▁▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy ▁▁▁▂▂▂▂▂▃▃▃▃▄▄▅▅▅▅▆▆▆▆▆▇▇▇▇▇▇▇▇▇████████\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss ██▇▇▇▆▆▆▆▅▅▅▅▄▄▄▄▃▃▃▂▂▂▂▂▂▂▂▁▁▁▁▁▁▁▁▁▁▁▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss ▇▆▇▅▅▆▅▄▄▄▆▄▂▄▂▄▄▂▁▂▃▄▅▆▆▅▅▁▄▄▄▆▄▅█▆▇▆█▇\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run summary:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc 0\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc 90.2439\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc 55.92417\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc 98.24667\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc 2.16216\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc 76.54155\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy 37.03704\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy 91.38322\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss 0.08198\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss 0.49178\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: 🚀 View run \u001b[33moptuna_run_0 microsoft/resnet-18 NOOVERSAMPLING FOCALLOS1\u001b[0m at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/yqf8jxu2\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: ⭐️ View project at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Synced 5 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Find logs at: \u001b[35m\u001b[1m./wandb/run-20241008_101620-yqf8jxu2/logs\u001b[0m\n",
      "[I 2024-10-08 10:39:53,643] Trial 0 finished with value: 0.18755980861244023 and parameters: {'learning_rate': 4.4484576810406364e-08, 'weight_decay': 7.079020613343579e-05, 'focal_loss': 3.011021376243912}. Best is trial 0 with value: 0.18755980861244023.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Tracking run with wandb version 0.18.3\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run data is saved locally in \u001b[35m\u001b[1m/kaggle/working/wandb/run-20241008_103954-meddkc7t\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run \u001b[1m`wandb offline`\u001b[0m to turn off syncing.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Syncing run \u001b[33moptuna_run_1 microsoft/resnet-18 NOOVERSAMPLING FOCALLOS2\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: ⭐️ View project at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: 🚀 View run at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/meddkc7t\u001b[0m\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Epoch 1, Loss: 0.6042630974068699\n",
      "Validation Loss: 0.7680869386309669, Total Accuracy: 22.53%\n",
      "Accuracy per class - G1: 0.00%, G2: 20.62%, G3: 31.89%\n",
      "Validation loss decreased (inf --> 16.129826).  Saving model ...\n",
      "Epoch 2, Loss: 0.5304750168179891\n",
      "Validation Loss: 0.7685432505039942, Total Accuracy: 22.84%\n",
      "Accuracy per class - G1: 0.00%, G2: 21.80%, G3: 30.27%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 3, Loss: 0.47568508336342963\n",
      "Validation Loss: 0.8041258099533263, Total Accuracy: 22.07%\n",
      "Accuracy per class - G1: 0.00%, G2: 21.80%, G3: 27.57%\n",
      "EarlyStopping counter: 2 out of 40\n",
      "Epoch 4, Loss: 0.4244026958224285\n",
      "Validation Loss: 0.8025441453570411, Total Accuracy: 22.22%\n",
      "Accuracy per class - G1: 0.00%, G2: 22.75%, G3: 25.95%\n",
      "EarlyStopping counter: 3 out of 40\n",
      "Epoch 5, Loss: 0.38545647514871806\n",
      "Validation Loss: 0.8420664639700026, Total Accuracy: 21.91%\n",
      "Accuracy per class - G1: 0.00%, G2: 22.04%, G3: 26.49%\n",
      "EarlyStopping counter: 4 out of 40\n",
      "Epoch 6, Loss: 0.3503166900341769\n",
      "Validation Loss: 0.8713103433450063, Total Accuracy: 20.52%\n",
      "Accuracy per class - G1: 0.00%, G2: 20.62%, G3: 24.86%\n",
      "EarlyStopping counter: 5 out of 40\n",
      "Epoch 7, Loss: 0.31880879940756834\n",
      "Validation Loss: 0.85962946500097, Total Accuracy: 21.14%\n",
      "Accuracy per class - G1: 0.00%, G2: 22.27%, G3: 23.24%\n",
      "EarlyStopping counter: 6 out of 40\n",
      "Epoch 8, Loss: 0.2918961358716689\n",
      "Validation Loss: 0.8878867143676394, Total Accuracy: 21.14%\n",
      "Accuracy per class - G1: 0.00%, G2: 23.22%, G3: 21.08%\n",
      "EarlyStopping counter: 7 out of 40\n",
      "Epoch 9, Loss: 0.2700695686311607\n",
      "Validation Loss: 0.866835410396258, Total Accuracy: 21.30%\n",
      "Accuracy per class - G1: 0.00%, G2: 23.70%, G3: 20.54%\n",
      "EarlyStopping counter: 8 out of 40\n",
      "Epoch 10, Loss: 0.24748800048627048\n",
      "Validation Loss: 0.8977154493331909, Total Accuracy: 20.83%\n",
      "Accuracy per class - G1: 0.00%, G2: 24.64%, G3: 16.76%\n",
      "EarlyStopping counter: 9 out of 40\n",
      "Epoch 11, Loss: 0.2283457043659256\n",
      "Validation Loss: 0.9334372665200915, Total Accuracy: 21.14%\n",
      "Accuracy per class - G1: 0.00%, G2: 24.17%, G3: 18.92%\n",
      "EarlyStopping counter: 10 out of 40\n",
      "Epoch 12, Loss: 0.21420838172177234\n",
      "Validation Loss: 0.9434409872407005, Total Accuracy: 21.60%\n",
      "Accuracy per class - G1: 0.00%, G2: 27.01%, G3: 14.05%\n",
      "EarlyStopping counter: 11 out of 40\n",
      "Epoch 13, Loss: 0.19727492368364907\n",
      "Validation Loss: 0.9392737370161783, Total Accuracy: 22.99%\n",
      "Accuracy per class - G1: 0.00%, G2: 29.15%, G3: 14.05%\n",
      "EarlyStopping counter: 12 out of 40\n",
      "Epoch 14, Loss: 0.1874552401433508\n",
      "Validation Loss: 0.9901797764358067, Total Accuracy: 21.60%\n",
      "Accuracy per class - G1: 0.00%, G2: 29.38%, G3: 8.65%\n",
      "EarlyStopping counter: 13 out of 40\n",
      "Epoch 15, Loss: 0.17157523836716113\n",
      "Validation Loss: 0.9925398677587509, Total Accuracy: 21.30%\n",
      "Accuracy per class - G1: 0.00%, G2: 26.54%, G3: 14.05%\n",
      "EarlyStopping counter: 14 out of 40\n",
      "Epoch 16, Loss: 0.15921642972403263\n",
      "Validation Loss: 0.9875473933560508, Total Accuracy: 22.99%\n",
      "Accuracy per class - G1: 0.00%, G2: 31.99%, G3: 7.57%\n",
      "EarlyStopping counter: 15 out of 40\n",
      "Epoch 17, Loss: 0.14903608197907367\n",
      "Validation Loss: 1.0046788794653756, Total Accuracy: 23.15%\n",
      "Accuracy per class - G1: 0.00%, G2: 32.23%, G3: 7.57%\n",
      "EarlyStopping counter: 16 out of 40\n",
      "Epoch 18, Loss: 0.1449275232223143\n",
      "Validation Loss: 1.0062475807610012, Total Accuracy: 22.69%\n",
      "Accuracy per class - G1: 0.00%, G2: 32.23%, G3: 5.95%\n",
      "EarlyStopping counter: 17 out of 40\n",
      "Epoch 19, Loss: 0.13093563977135234\n",
      "Validation Loss: 1.023301519098736, Total Accuracy: 22.22%\n",
      "Accuracy per class - G1: 0.00%, G2: 31.52%, G3: 5.95%\n",
      "EarlyStopping counter: 18 out of 40\n",
      "Epoch 20, Loss: 0.1251731239349009\n",
      "Validation Loss: 1.012478857522919, Total Accuracy: 23.46%\n",
      "Accuracy per class - G1: 0.00%, G2: 34.83%, G3: 2.70%\n",
      "EarlyStopping counter: 19 out of 40\n",
      "Epoch 21, Loss: 0.11847851811403251\n",
      "Validation Loss: 0.9988923030240195, Total Accuracy: 24.54%\n",
      "Accuracy per class - G1: 0.00%, G2: 37.20%, G3: 1.08%\n",
      "EarlyStopping counter: 20 out of 40\n",
      "Epoch 22, Loss: 0.11108224650463426\n",
      "Validation Loss: 1.0433877312711306, Total Accuracy: 24.07%\n",
      "Accuracy per class - G1: 0.00%, G2: 36.49%, G3: 1.08%\n",
      "EarlyStopping counter: 21 out of 40\n",
      "Epoch 23, Loss: 0.10256671788821738\n",
      "Validation Loss: 1.075224947361719, Total Accuracy: 22.38%\n",
      "Accuracy per class - G1: 0.00%, G2: 32.46%, G3: 4.32%\n",
      "EarlyStopping counter: 22 out of 40\n",
      "Epoch 24, Loss: 0.10140170919966984\n",
      "Validation Loss: 1.1049906065066655, Total Accuracy: 22.53%\n",
      "Accuracy per class - G1: 0.00%, G2: 33.65%, G3: 2.16%\n",
      "EarlyStopping counter: 23 out of 40\n",
      "Epoch 25, Loss: 0.1008362255272377\n",
      "Validation Loss: 1.02792904738869, Total Accuracy: 24.23%\n",
      "Accuracy per class - G1: 0.00%, G2: 36.49%, G3: 1.62%\n",
      "EarlyStopping counter: 24 out of 40\n",
      "Epoch 26, Loss: 0.09474098233573408\n",
      "Validation Loss: 1.1047990016994023, Total Accuracy: 23.92%\n",
      "Accuracy per class - G1: 0.00%, G2: 36.26%, G3: 1.08%\n",
      "EarlyStopping counter: 25 out of 40\n",
      "Epoch 27, Loss: 0.09517253006258643\n",
      "Validation Loss: 1.1039022519474937, Total Accuracy: 23.46%\n",
      "Accuracy per class - G1: 0.00%, G2: 35.07%, G3: 2.16%\n",
      "EarlyStopping counter: 26 out of 40\n",
      "Epoch 28, Loss: 0.09176643426159778\n",
      "Validation Loss: 1.0714232651960283, Total Accuracy: 23.77%\n",
      "Accuracy per class - G1: 0.00%, G2: 36.02%, G3: 1.08%\n",
      "EarlyStopping counter: 27 out of 40\n",
      "Epoch 29, Loss: 0.08663732230842831\n",
      "Validation Loss: 1.1107828276497977, Total Accuracy: 24.07%\n",
      "Accuracy per class - G1: 0.00%, G2: 36.49%, G3: 1.08%\n",
      "EarlyStopping counter: 28 out of 40\n",
      "Epoch 30, Loss: 0.08383616760193584\n",
      "Validation Loss: 1.1712549314612435, Total Accuracy: 22.69%\n",
      "Accuracy per class - G1: 0.00%, G2: 34.36%, G3: 1.08%\n",
      "EarlyStopping counter: 29 out of 40\n",
      "Epoch 31, Loss: 0.08071741003947086\n",
      "Validation Loss: 1.0630114883894013, Total Accuracy: 24.69%\n",
      "Accuracy per class - G1: 0.00%, G2: 37.68%, G3: 0.54%\n",
      "EarlyStopping counter: 30 out of 40\n",
      "Epoch 32, Loss: 0.07745912271630333\n",
      "Validation Loss: 1.0839448447028797, Total Accuracy: 24.69%\n",
      "Accuracy per class - G1: 0.00%, G2: 37.68%, G3: 0.54%\n",
      "EarlyStopping counter: 31 out of 40\n",
      "Epoch 33, Loss: 0.07867391012519238\n",
      "Validation Loss: 1.106396398019223, Total Accuracy: 24.69%\n",
      "Accuracy per class - G1: 0.00%, G2: 37.68%, G3: 0.54%\n",
      "EarlyStopping counter: 32 out of 40\n",
      "Epoch 34, Loss: 0.07407523772443633\n",
      "Validation Loss: 1.1525962558530627, Total Accuracy: 23.77%\n",
      "Accuracy per class - G1: 0.00%, G2: 36.26%, G3: 0.54%\n",
      "EarlyStopping counter: 33 out of 40\n",
      "Epoch 35, Loss: 0.07190998508987656\n",
      "Validation Loss: 1.1339295311343103, Total Accuracy: 25.15%\n",
      "Accuracy per class - G1: 0.00%, G2: 38.39%, G3: 0.54%\n",
      "EarlyStopping counter: 34 out of 40\n",
      "Epoch 36, Loss: 0.06786315354058542\n",
      "Validation Loss: 1.1594106913322495, Total Accuracy: 24.07%\n",
      "Accuracy per class - G1: 0.00%, G2: 36.73%, G3: 0.54%\n",
      "EarlyStopping counter: 35 out of 40\n",
      "Epoch 37, Loss: 0.06903528000216887\n",
      "Validation Loss: 1.150719672086693, Total Accuracy: 24.38%\n",
      "Accuracy per class - G1: 0.00%, G2: 37.20%, G3: 0.54%\n",
      "EarlyStopping counter: 36 out of 40\n",
      "Epoch 38, Loss: 0.06374604335750442\n",
      "Validation Loss: 1.2004244558158375, Total Accuracy: 24.23%\n",
      "Accuracy per class - G1: 0.00%, G2: 36.97%, G3: 0.54%\n",
      "EarlyStopping counter: 37 out of 40\n",
      "Epoch 39, Loss: 0.06350701620959374\n",
      "Validation Loss: 1.1477019641371, Total Accuracy: 24.85%\n",
      "Accuracy per class - G1: 0.00%, G2: 37.91%, G3: 0.54%\n",
      "EarlyStopping counter: 38 out of 40\n",
      "Epoch 40, Loss: 0.06116233977029122\n",
      "Validation Loss: 1.1847491636872292, Total Accuracy: 24.85%\n",
      "Accuracy per class - G1: 0.00%, G2: 37.91%, G3: 0.54%\n",
      "EarlyStopping counter: 39 out of 40\n",
      "Epoch 41, Loss: 0.060745688222617986\n",
      "Validation Loss: 1.148685267993382, Total Accuracy: 25.31%\n",
      "Accuracy per class - G1: 0.00%, G2: 38.63%, G3: 0.54%\n",
      "EarlyStopping counter: 40 out of 40\n",
      "Early stopping\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\u001b[34m\u001b[1mwandb\u001b[0m:                                                                                \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run history:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc ▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc ▁▃▃▄▄▄▅▅▅▅▅▅▆▆▆▆▇▇▇▇▇▇█▇███▇████████████\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc ▁▁▁▂▂▁▂▂▂▃▂▃▄▄▃▅▆▆▅▇▇▇▆▆▇▇▇▇▇▆███▇█▇▇▇██\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc ▁▂▂▄▄▅▆▆▆▇▇▇▇▇▇▇▇▇██████████████████████\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc ██▇▇▇▆▆▆▅▅▅▄▄▃▄▃▃▂▂▁▁▁▂▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc ▁▂▂▃▄▅▅▆▆▆▇▇▇▇▇▇████████████████████████\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy ▄▄▃▃▃▁▂▂▂▁▂▃▅▃▂▅▅▄▃▅▇▆▄▄▆▆▅▆▆▄▇▇▇▆█▆▇▆▇█\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy ▁▂▂▃▄▅▅▆▆▆▇▇▇▇▇▇▇▇██████████████████████\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss █▇▆▆▅▅▄▄▄▃▃▃▃▃▂▂▂▂▂▂▂▂▂▂▂▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss ▁▁▂▂▂▃▂▃▃▃▄▄▄▅▅▅▅▅▅▅▅▅▆▆▅▆▆▆▇█▆▆▆▇▇▇▇█▇▇\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run summary:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc 0\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc 97.56098\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc 38.62559\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc 99.39541\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc 0.54054\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc 97.98928\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy 25.30864\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy 98.82842\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss 0.06075\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss 1.14869\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: 🚀 View run \u001b[33moptuna_run_1 microsoft/resnet-18 NOOVERSAMPLING FOCALLOS2\u001b[0m at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/meddkc7t\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: ⭐️ View project at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Synced 5 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Find logs at: \u001b[35m\u001b[1m./wandb/run-20241008_103954-meddkc7t/logs\u001b[0m\n",
      "[I 2024-10-08 10:52:17,085] Trial 1 finished with value: 0.13618912911699332 and parameters: {'learning_rate': 2.5198189101121873e-07, 'weight_decay': 1.5692645574903536e-07, 'focal_loss': 1.7255193939670836}. Best is trial 0 with value: 0.18755980861244023.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Tracking run with wandb version 0.18.3\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run data is saved locally in \u001b[35m\u001b[1m/kaggle/working/wandb/run-20241008_105217-77pobd4w\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run \u001b[1m`wandb offline`\u001b[0m to turn off syncing.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Syncing run \u001b[33moptuna_run_2 microsoft/resnet-18 NOOVERSAMPLING FOCALLOS3\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: ⭐️ View project at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: 🚀 View run at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/77pobd4w\u001b[0m\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Epoch 1, Loss: 0.1653792530477765\n",
      "Validation Loss: 0.18280557170510292, Total Accuracy: 53.70%\n",
      "Accuracy per class - G1: 9.76%, G2: 69.91%, G3: 26.49%\n",
      "Validation loss decreased (inf --> 3.838917).  Saving model ...\n",
      "Epoch 2, Loss: 0.10855390068637319\n",
      "Validation Loss: 0.22411482417512507, Total Accuracy: 44.44%\n",
      "Accuracy per class - G1: 4.88%, G2: 55.69%, G3: 27.57%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 3, Loss: 0.08098590064300112\n",
      "Validation Loss: 0.2607399565832956, Total Accuracy: 41.98%\n",
      "Accuracy per class - G1: 4.88%, G2: 51.90%, G3: 27.57%\n",
      "EarlyStopping counter: 2 out of 40\n",
      "Epoch 4, Loss: 0.06361267379069903\n",
      "Validation Loss: 0.290865730316866, Total Accuracy: 40.59%\n",
      "Accuracy per class - G1: 0.00%, G2: 51.90%, G3: 23.78%\n",
      "EarlyStopping counter: 3 out of 40\n",
      "Epoch 5, Loss: 0.050889152001185586\n",
      "Validation Loss: 0.3081489649734327, Total Accuracy: 38.12%\n",
      "Accuracy per class - G1: 0.00%, G2: 51.66%, G3: 15.68%\n",
      "EarlyStopping counter: 4 out of 40\n",
      "Epoch 6, Loss: 0.04204712534345776\n",
      "Validation Loss: 0.3247147215796368, Total Accuracy: 37.19%\n",
      "Accuracy per class - G1: 0.00%, G2: 51.90%, G3: 11.89%\n",
      "EarlyStopping counter: 5 out of 40\n",
      "Epoch 7, Loss: 0.035989619028496456\n",
      "Validation Loss: 0.3522097184544518, Total Accuracy: 37.65%\n",
      "Accuracy per class - G1: 0.00%, G2: 50.47%, G3: 16.76%\n",
      "EarlyStopping counter: 6 out of 40\n",
      "Epoch 8, Loss: 0.03087253425360085\n",
      "Validation Loss: 0.3730814140290022, Total Accuracy: 36.11%\n",
      "Accuracy per class - G1: 0.00%, G2: 50.00%, G3: 12.43%\n",
      "EarlyStopping counter: 7 out of 40\n",
      "Epoch 9, Loss: 0.025801492608096225\n",
      "Validation Loss: 0.41253287961617824, Total Accuracy: 34.57%\n",
      "Accuracy per class - G1: 0.00%, G2: 49.76%, G3: 7.57%\n",
      "EarlyStopping counter: 8 out of 40\n",
      "Epoch 10, Loss: 0.022046549200832127\n",
      "Validation Loss: 0.42021807305337416, Total Accuracy: 34.88%\n",
      "Accuracy per class - G1: 0.00%, G2: 49.53%, G3: 9.19%\n",
      "EarlyStopping counter: 9 out of 40\n",
      "Epoch 11, Loss: 0.019585723730634493\n",
      "Validation Loss: 0.4352485565468669, Total Accuracy: 35.03%\n",
      "Accuracy per class - G1: 0.00%, G2: 49.29%, G3: 10.27%\n",
      "EarlyStopping counter: 10 out of 40\n",
      "Epoch 12, Loss: 0.01779350397704416\n",
      "Validation Loss: 0.46004972030364333, Total Accuracy: 33.64%\n",
      "Accuracy per class - G1: 0.00%, G2: 48.82%, G3: 6.49%\n",
      "EarlyStopping counter: 11 out of 40\n",
      "Epoch 13, Loss: 0.014978533201144043\n",
      "Validation Loss: 0.4512784142668049, Total Accuracy: 34.26%\n",
      "Accuracy per class - G1: 0.00%, G2: 49.76%, G3: 6.49%\n",
      "EarlyStopping counter: 12 out of 40\n",
      "Epoch 14, Loss: 0.013282835029110492\n",
      "Validation Loss: 0.4353507064903776, Total Accuracy: 33.80%\n",
      "Accuracy per class - G1: 0.00%, G2: 50.24%, G3: 3.78%\n",
      "EarlyStopping counter: 13 out of 40\n",
      "Epoch 15, Loss: 0.011793357959712845\n",
      "Validation Loss: 0.4835362562554933, Total Accuracy: 33.49%\n",
      "Accuracy per class - G1: 0.00%, G2: 49.53%, G3: 4.32%\n",
      "EarlyStopping counter: 14 out of 40\n",
      "Epoch 16, Loss: 0.011150745854499829\n",
      "Validation Loss: 0.49574647418090273, Total Accuracy: 32.87%\n",
      "Accuracy per class - G1: 0.00%, G2: 49.53%, G3: 2.16%\n",
      "EarlyStopping counter: 15 out of 40\n",
      "Epoch 17, Loss: 0.009714277618261704\n",
      "Validation Loss: 0.4920895266834469, Total Accuracy: 33.33%\n",
      "Accuracy per class - G1: 0.00%, G2: 49.76%, G3: 3.24%\n",
      "EarlyStopping counter: 16 out of 40\n",
      "Epoch 18, Loss: 0.008809711955240872\n",
      "Validation Loss: 0.5340953732929414, Total Accuracy: 32.72%\n",
      "Accuracy per class - G1: 0.00%, G2: 49.29%, G3: 2.16%\n",
      "EarlyStopping counter: 17 out of 40\n",
      "Epoch 19, Loss: 0.008056723243411047\n",
      "Validation Loss: 0.5178397993690201, Total Accuracy: 32.87%\n",
      "Accuracy per class - G1: 0.00%, G2: 49.76%, G3: 1.62%\n",
      "EarlyStopping counter: 18 out of 40\n",
      "Epoch 20, Loss: 0.006892746050718678\n",
      "Validation Loss: 0.5514807897353811, Total Accuracy: 32.72%\n",
      "Accuracy per class - G1: 0.00%, G2: 49.53%, G3: 1.62%\n",
      "EarlyStopping counter: 19 out of 40\n",
      "Epoch 21, Loss: 0.006728877630421376\n",
      "Validation Loss: 0.5526438889847625, Total Accuracy: 32.56%\n",
      "Accuracy per class - G1: 0.00%, G2: 49.05%, G3: 2.16%\n",
      "EarlyStopping counter: 20 out of 40\n",
      "Epoch 22, Loss: 0.006172868925292629\n",
      "Validation Loss: 0.5182326298229218, Total Accuracy: 32.56%\n",
      "Accuracy per class - G1: 0.00%, G2: 50.00%, G3: 0.00%\n",
      "EarlyStopping counter: 21 out of 40\n",
      "Epoch 23, Loss: 0.005755960916068001\n",
      "Validation Loss: 0.5647375813374916, Total Accuracy: 32.25%\n",
      "Accuracy per class - G1: 0.00%, G2: 49.29%, G3: 0.54%\n",
      "EarlyStopping counter: 22 out of 40\n",
      "Epoch 24, Loss: 0.005338722169511469\n",
      "Validation Loss: 0.5974360048283069, Total Accuracy: 32.25%\n",
      "Accuracy per class - G1: 0.00%, G2: 49.05%, G3: 1.08%\n",
      "EarlyStopping counter: 23 out of 40\n",
      "Epoch 25, Loss: 0.005096068140119314\n",
      "Validation Loss: 0.5734175797330127, Total Accuracy: 32.56%\n",
      "Accuracy per class - G1: 0.00%, G2: 49.29%, G3: 1.62%\n",
      "EarlyStopping counter: 24 out of 40\n",
      "Epoch 26, Loss: 0.005224716072587903\n",
      "Validation Loss: 0.6082800005429557, Total Accuracy: 31.64%\n",
      "Accuracy per class - G1: 0.00%, G2: 47.16%, G3: 3.24%\n",
      "EarlyStopping counter: 25 out of 40\n",
      "Epoch 27, Loss: 0.004672514290144914\n",
      "Validation Loss: 0.5946273134267401, Total Accuracy: 32.41%\n",
      "Accuracy per class - G1: 0.00%, G2: 49.53%, G3: 0.54%\n",
      "EarlyStopping counter: 26 out of 40\n",
      "Epoch 28, Loss: 0.004414623653718147\n",
      "Validation Loss: 0.6342782620340586, Total Accuracy: 32.10%\n",
      "Accuracy per class - G1: 0.00%, G2: 48.58%, G3: 1.62%\n",
      "EarlyStopping counter: 27 out of 40\n",
      "Epoch 29, Loss: 0.0040685786186795995\n",
      "Validation Loss: 0.6048970667068803, Total Accuracy: 32.41%\n",
      "Accuracy per class - G1: 0.00%, G2: 49.76%, G3: 0.00%\n",
      "EarlyStopping counter: 28 out of 40\n",
      "Epoch 30, Loss: 0.003986232383849929\n",
      "Validation Loss: 0.587265486585065, Total Accuracy: 32.25%\n",
      "Accuracy per class - G1: 0.00%, G2: 49.29%, G3: 0.54%\n",
      "EarlyStopping counter: 29 out of 40\n",
      "Epoch 31, Loss: 0.0038617402034620925\n",
      "Validation Loss: 0.6123943768131236, Total Accuracy: 32.25%\n",
      "Accuracy per class - G1: 0.00%, G2: 49.29%, G3: 0.54%\n",
      "EarlyStopping counter: 30 out of 40\n",
      "Epoch 32, Loss: 0.0037962513350242055\n",
      "Validation Loss: 0.6130690653586671, Total Accuracy: 32.41%\n",
      "Accuracy per class - G1: 0.00%, G2: 49.76%, G3: 0.00%\n",
      "EarlyStopping counter: 31 out of 40\n",
      "Epoch 33, Loss: 0.003933551466002701\n",
      "Validation Loss: 0.6480825512803027, Total Accuracy: 32.25%\n",
      "Accuracy per class - G1: 0.00%, G2: 48.82%, G3: 1.62%\n",
      "EarlyStopping counter: 32 out of 40\n",
      "Epoch 34, Loss: 0.0031220719431448414\n",
      "Validation Loss: 0.650230344218601, Total Accuracy: 32.10%\n",
      "Accuracy per class - G1: 0.00%, G2: 49.05%, G3: 0.54%\n",
      "EarlyStopping counter: 33 out of 40\n",
      "Epoch 35, Loss: 0.003605145456112293\n",
      "Validation Loss: 0.6330807066655585, Total Accuracy: 32.56%\n",
      "Accuracy per class - G1: 0.00%, G2: 50.00%, G3: 0.00%\n",
      "EarlyStopping counter: 34 out of 40\n",
      "Epoch 36, Loss: 0.0033331455477704124\n",
      "Validation Loss: 0.6584117781104786, Total Accuracy: 32.41%\n",
      "Accuracy per class - G1: 0.00%, G2: 49.76%, G3: 0.00%\n",
      "EarlyStopping counter: 35 out of 40\n",
      "Epoch 37, Loss: 0.003466022436518267\n",
      "Validation Loss: 0.6587600531943497, Total Accuracy: 32.10%\n",
      "Accuracy per class - G1: 0.00%, G2: 49.05%, G3: 0.54%\n",
      "EarlyStopping counter: 36 out of 40\n",
      "Epoch 38, Loss: 0.0027115227989796325\n",
      "Validation Loss: 0.6733826777254719, Total Accuracy: 31.94%\n",
      "Accuracy per class - G1: 0.00%, G2: 48.58%, G3: 1.08%\n",
      "EarlyStopping counter: 37 out of 40\n",
      "Epoch 39, Loss: 0.0025769369424242213\n",
      "Validation Loss: 0.6666781841666394, Total Accuracy: 32.10%\n",
      "Accuracy per class - G1: 0.00%, G2: 49.05%, G3: 0.54%\n",
      "EarlyStopping counter: 38 out of 40\n",
      "Epoch 40, Loss: 0.0024589425715875915\n",
      "Validation Loss: 0.6783308889273376, Total Accuracy: 32.10%\n",
      "Accuracy per class - G1: 0.00%, G2: 49.05%, G3: 0.54%\n",
      "EarlyStopping counter: 39 out of 40\n",
      "Epoch 41, Loss: 0.002695176760940981\n",
      "Validation Loss: 0.6601167920355996, Total Accuracy: 31.94%\n",
      "Accuracy per class - G1: 0.00%, G2: 49.05%, G3: 0.00%\n",
      "EarlyStopping counter: 40 out of 40\n",
      "Early stopping\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\u001b[34m\u001b[1mwandb\u001b[0m:                                                                                \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run history:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc █▅▅▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc ▁▄▆▆▇▇▇▇▇▇██████████████████████████████\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc █▄▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▁▂▁▂▂▂▂▂▂▂▂▂▁▂▂\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc ▁▄▆▇▇▇▇▇████████████████████████████████\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc ███▇▅▄▅▄▃▃▄▃▃▂▂▂▂▂▁▁▂▁▁▁▁▂▁▁▁▁▁▁▁▁▁▁▁▁▁▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc ▁▃▅▆▇▇▇▇▇███████████████████████████████\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy █▅▄▄▃▃▃▂▂▂▂▂▂▂▂▁▂▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy ▁▄▅▆▇▇▇▇████████████████████████████████\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss █▆▄▄▃▃▂▂▂▂▂▂▂▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss ▁▂▂▃▃▃▃▄▄▄▅▅▅▅▅▅▅▆▆▆▆▆▆▇▇▇▇▇▇▇▇▇██▇█████\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run summary:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc 0\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc 100\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc 49.05213\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc 100\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc 0\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc 100\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy 31.94444\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy 100\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss 0.0027\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss 0.66012\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: 🚀 View run \u001b[33moptuna_run_2 microsoft/resnet-18 NOOVERSAMPLING FOCALLOS3\u001b[0m at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/77pobd4w\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: ⭐️ View project at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Synced 5 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Find logs at: \u001b[35m\u001b[1m./wandb/run-20241008_105217-77pobd4w/logs\u001b[0m\n",
      "[I 2024-10-08 11:04:58,222] Trial 2 finished with value: 0.16140350877192983 and parameters: {'learning_rate': 5.845090719334166e-07, 'weight_decay': 3.537967476357015e-07, 'focal_loss': 4.156652545282692}. Best is trial 0 with value: 0.18755980861244023.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Tracking run with wandb version 0.18.3\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run data is saved locally in \u001b[35m\u001b[1m/kaggle/working/wandb/run-20241008_110458-9w86x1zd\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run \u001b[1m`wandb offline`\u001b[0m to turn off syncing.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Syncing run \u001b[33moptuna_run_3 microsoft/resnet-18 NOOVERSAMPLING FOCALLOS4\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: ⭐️ View project at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: 🚀 View run at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/9w86x1zd\u001b[0m\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Epoch 1, Loss: 0.14100196122764105\n",
      "Validation Loss: 0.5451832722340312, Total Accuracy: 34.26%\n",
      "Accuracy per class - G1: 0.00%, G2: 27.01%, G3: 58.38%\n",
      "Validation loss decreased (inf --> 11.448849).  Saving model ...\n",
      "Epoch 2, Loss: 0.08297504525048187\n",
      "Validation Loss: 0.5988383903389886, Total Accuracy: 31.64%\n",
      "Accuracy per class - G1: 0.00%, G2: 27.96%, G3: 47.03%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 3, Loss: 0.055533278015363646\n",
      "Validation Loss: 0.7387707087965238, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 28.91%, G3: 34.05%\n",
      "EarlyStopping counter: 2 out of 40\n",
      "Epoch 4, Loss: 0.04111395524926933\n",
      "Validation Loss: 0.7519648108808767, Total Accuracy: 29.48%\n",
      "Accuracy per class - G1: 0.00%, G2: 37.44%, G3: 17.84%\n",
      "EarlyStopping counter: 3 out of 40\n",
      "Epoch 5, Loss: 0.031207202877624924\n",
      "Validation Loss: 0.7895261479452962, Total Accuracy: 29.48%\n",
      "Accuracy per class - G1: 0.00%, G2: 39.10%, G3: 14.05%\n",
      "EarlyStopping counter: 4 out of 40\n",
      "Epoch 6, Loss: 0.02499025067067649\n",
      "Validation Loss: 0.8844926094725019, Total Accuracy: 29.32%\n",
      "Accuracy per class - G1: 0.00%, G2: 41.23%, G3: 8.65%\n",
      "EarlyStopping counter: 5 out of 40\n",
      "Epoch 7, Loss: 0.020236559885453028\n",
      "Validation Loss: 0.8941299726831771, Total Accuracy: 29.32%\n",
      "Accuracy per class - G1: 0.00%, G2: 40.28%, G3: 10.81%\n",
      "EarlyStopping counter: 6 out of 40\n",
      "Epoch 8, Loss: 0.016533580232770687\n",
      "Validation Loss: 0.8454814073407934, Total Accuracy: 30.09%\n",
      "Accuracy per class - G1: 0.00%, G2: 43.13%, G3: 7.03%\n",
      "EarlyStopping counter: 7 out of 40\n",
      "Epoch 9, Loss: 0.013892374775675407\n",
      "Validation Loss: 0.9316625978708977, Total Accuracy: 29.94%\n",
      "Accuracy per class - G1: 0.00%, G2: 43.13%, G3: 6.49%\n",
      "EarlyStopping counter: 8 out of 40\n",
      "Epoch 10, Loss: 0.011414589955056289\n",
      "Validation Loss: 1.0176958476326294, Total Accuracy: 29.94%\n",
      "Accuracy per class - G1: 0.00%, G2: 42.89%, G3: 7.03%\n",
      "EarlyStopping counter: 9 out of 40\n",
      "Epoch 11, Loss: 0.009812921784952822\n",
      "Validation Loss: 1.0269824613240504, Total Accuracy: 30.09%\n",
      "Accuracy per class - G1: 0.00%, G2: 42.89%, G3: 7.57%\n",
      "EarlyStopping counter: 10 out of 40\n",
      "Epoch 12, Loss: 0.009300894286281553\n",
      "Validation Loss: 1.0465917582401918, Total Accuracy: 29.94%\n",
      "Accuracy per class - G1: 0.00%, G2: 43.36%, G3: 5.95%\n",
      "EarlyStopping counter: 11 out of 40\n",
      "Epoch 13, Loss: 0.007904424402211984\n",
      "Validation Loss: 1.0538028543815017, Total Accuracy: 29.78%\n",
      "Accuracy per class - G1: 0.00%, G2: 42.89%, G3: 6.49%\n",
      "EarlyStopping counter: 12 out of 40\n",
      "Epoch 14, Loss: 0.00667618906001998\n",
      "Validation Loss: 1.098047293500886, Total Accuracy: 29.94%\n",
      "Accuracy per class - G1: 0.00%, G2: 43.13%, G3: 6.49%\n",
      "EarlyStopping counter: 13 out of 40\n",
      "Epoch 15, Loss: 0.006071402851200427\n",
      "Validation Loss: 1.0793768982181238, Total Accuracy: 29.78%\n",
      "Accuracy per class - G1: 0.00%, G2: 43.84%, G3: 4.32%\n",
      "EarlyStopping counter: 14 out of 40\n",
      "Epoch 16, Loss: 0.0051348026749307675\n",
      "Validation Loss: 1.1329542440584017, Total Accuracy: 29.78%\n",
      "Accuracy per class - G1: 0.00%, G2: 42.89%, G3: 6.49%\n",
      "EarlyStopping counter: 15 out of 40\n",
      "Epoch 17, Loss: 0.0046565924653312165\n",
      "Validation Loss: 1.0803488749744636, Total Accuracy: 29.63%\n",
      "Accuracy per class - G1: 0.00%, G2: 43.60%, G3: 4.32%\n",
      "EarlyStopping counter: 16 out of 40\n",
      "Epoch 18, Loss: 0.004182150827283152\n",
      "Validation Loss: 1.0925537195234072, Total Accuracy: 29.63%\n",
      "Accuracy per class - G1: 0.00%, G2: 43.60%, G3: 4.32%\n",
      "EarlyStopping counter: 17 out of 40\n",
      "Epoch 19, Loss: 0.0037274495025266365\n",
      "Validation Loss: 1.1626195207105152, Total Accuracy: 29.94%\n",
      "Accuracy per class - G1: 0.00%, G2: 44.08%, G3: 4.32%\n",
      "EarlyStopping counter: 18 out of 40\n",
      "Epoch 20, Loss: 0.0029934922707300768\n",
      "Validation Loss: 1.133914151339836, Total Accuracy: 29.48%\n",
      "Accuracy per class - G1: 0.00%, G2: 43.36%, G3: 4.32%\n",
      "EarlyStopping counter: 19 out of 40\n",
      "Epoch 21, Loss: 0.0028123810455337704\n",
      "Validation Loss: 1.1694940849695177, Total Accuracy: 29.48%\n",
      "Accuracy per class - G1: 0.00%, G2: 43.36%, G3: 4.32%\n",
      "EarlyStopping counter: 20 out of 40\n",
      "Epoch 22, Loss: 0.0027510311253963553\n",
      "Validation Loss: 1.2328585004877477, Total Accuracy: 29.63%\n",
      "Accuracy per class - G1: 0.00%, G2: 43.60%, G3: 4.32%\n",
      "EarlyStopping counter: 21 out of 40\n",
      "Epoch 23, Loss: 0.0029059513955915638\n",
      "Validation Loss: 1.2337189413873213, Total Accuracy: 29.48%\n",
      "Accuracy per class - G1: 0.00%, G2: 43.36%, G3: 4.32%\n",
      "EarlyStopping counter: 22 out of 40\n",
      "Epoch 24, Loss: 0.0024563758472732483\n",
      "Validation Loss: 1.1947746722892458, Total Accuracy: 29.63%\n",
      "Accuracy per class - G1: 0.00%, G2: 43.84%, G3: 3.78%\n",
      "EarlyStopping counter: 23 out of 40\n",
      "Epoch 25, Loss: 0.0023513411463473937\n",
      "Validation Loss: 1.185590051225431, Total Accuracy: 30.25%\n",
      "Accuracy per class - G1: 0.00%, G2: 45.26%, G3: 2.70%\n",
      "EarlyStopping counter: 24 out of 40\n",
      "Epoch 26, Loss: 0.0022298749893937394\n",
      "Validation Loss: 1.2113621767743357, Total Accuracy: 29.01%\n",
      "Accuracy per class - G1: 0.00%, G2: 43.36%, G3: 2.70%\n",
      "EarlyStopping counter: 25 out of 40\n",
      "Epoch 27, Loss: 0.0024462014146384796\n",
      "Validation Loss: 1.1780625338488746, Total Accuracy: 30.71%\n",
      "Accuracy per class - G1: 0.00%, G2: 46.21%, G3: 2.16%\n",
      "EarlyStopping counter: 26 out of 40\n",
      "Epoch 28, Loss: 0.0019401049883811768\n",
      "Validation Loss: 1.250519876767482, Total Accuracy: 29.78%\n",
      "Accuracy per class - G1: 0.00%, G2: 44.55%, G3: 2.70%\n",
      "EarlyStopping counter: 27 out of 40\n",
      "Epoch 29, Loss: 0.0019655844055716486\n",
      "Validation Loss: 1.2387309867356504, Total Accuracy: 31.02%\n",
      "Accuracy per class - G1: 0.00%, G2: 46.45%, G3: 2.70%\n",
      "EarlyStopping counter: 28 out of 40\n",
      "Epoch 30, Loss: 0.0016709012168751333\n",
      "Validation Loss: 1.2493768981657922, Total Accuracy: 29.78%\n",
      "Accuracy per class - G1: 0.00%, G2: 44.08%, G3: 3.78%\n",
      "EarlyStopping counter: 29 out of 40\n",
      "Epoch 31, Loss: 0.00152612135202781\n",
      "Validation Loss: 1.2583849658590875, Total Accuracy: 29.94%\n",
      "Accuracy per class - G1: 0.00%, G2: 44.31%, G3: 3.78%\n",
      "EarlyStopping counter: 30 out of 40\n",
      "Epoch 32, Loss: 0.0016825329870019242\n",
      "Validation Loss: 1.2837692328418295, Total Accuracy: 29.17%\n",
      "Accuracy per class - G1: 0.00%, G2: 43.36%, G3: 3.24%\n",
      "EarlyStopping counter: 31 out of 40\n",
      "Epoch 33, Loss: 0.0014717102430182993\n",
      "Validation Loss: 1.235994385832566, Total Accuracy: 29.94%\n",
      "Accuracy per class - G1: 0.00%, G2: 44.79%, G3: 2.70%\n",
      "EarlyStopping counter: 32 out of 40\n",
      "Epoch 34, Loss: 0.0014527095341493926\n",
      "Validation Loss: 1.2932165562552178, Total Accuracy: 30.56%\n",
      "Accuracy per class - G1: 0.00%, G2: 45.73%, G3: 2.70%\n",
      "EarlyStopping counter: 33 out of 40\n",
      "Epoch 35, Loss: 0.0016317447340284217\n",
      "Validation Loss: 1.2142740910750858, Total Accuracy: 31.17%\n",
      "Accuracy per class - G1: 0.00%, G2: 47.16%, G3: 1.62%\n",
      "EarlyStopping counter: 34 out of 40\n",
      "Epoch 36, Loss: 0.0012668250388106757\n",
      "Validation Loss: 1.317001578409136, Total Accuracy: 30.09%\n",
      "Accuracy per class - G1: 0.00%, G2: 45.02%, G3: 2.70%\n",
      "EarlyStopping counter: 35 out of 40\n",
      "Epoch 37, Loss: 0.0013238096158076302\n",
      "Validation Loss: 1.2887035502963478, Total Accuracy: 30.09%\n",
      "Accuracy per class - G1: 0.00%, G2: 45.02%, G3: 2.70%\n",
      "EarlyStopping counter: 36 out of 40\n",
      "Epoch 38, Loss: 0.0012447800503409725\n",
      "Validation Loss: 1.297238610452041, Total Accuracy: 31.02%\n",
      "Accuracy per class - G1: 0.00%, G2: 46.68%, G3: 2.16%\n",
      "EarlyStopping counter: 37 out of 40\n",
      "Epoch 39, Loss: 0.0013236844307653248\n",
      "Validation Loss: 1.241664604450177, Total Accuracy: 29.63%\n",
      "Accuracy per class - G1: 0.00%, G2: 44.08%, G3: 3.24%\n",
      "EarlyStopping counter: 38 out of 40\n",
      "Epoch 40, Loss: 0.0010612228108957096\n",
      "Validation Loss: 1.2284795297864115, Total Accuracy: 30.40%\n",
      "Accuracy per class - G1: 0.00%, G2: 46.21%, G3: 1.08%\n",
      "EarlyStopping counter: 39 out of 40\n",
      "Epoch 41, Loss: 0.0012258056434452061\n",
      "Validation Loss: 1.3512484752683944, Total Accuracy: 30.71%\n",
      "Accuracy per class - G1: 0.00%, G2: 45.97%, G3: 2.70%\n",
      "EarlyStopping counter: 40 out of 40\n",
      "Early stopping\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\u001b[34m\u001b[1mwandb\u001b[0m:                                                                                \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run history:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc ▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc ▁▄▆▆▇▇▇█████████████████████████████████\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc ▁▁▂▅▅▆▆▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇█▇█▇▇▇▇██▇▇█▇█\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc ▁▄▅▆▇▇██████████████████████████████████\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc █▇▅▃▃▂▂▂▂▂▂▂▂▂▁▂▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc ▁▄▅▆▆▇▇▇▇▇█▇████████████████████████████\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy █▅▁▂▂▂▂▃▃▃▃▃▃▃▃▃▂▂▃▂▂▂▂▂▃▂▄▃▄▃▃▂▃▃▄▃▃▄▂▄\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy ▁▄▅▆▇▇▇█████████████████████████████████\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss █▅▄▃▃▂▂▂▂▂▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss ▁▁▃▃▃▄▄▄▄▅▅▅▅▆▆▆▆▆▆▆▆▇▇▇▇▇▆▇▇▇▇▇▇▇▇█▇█▇█\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run summary:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc 0\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc 100\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc 45.97156\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc 100\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc 2.7027\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc 99.59786\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy 30.70988\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy 99.88662\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss 0.00123\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss 1.35125\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: 🚀 View run \u001b[33moptuna_run_3 microsoft/resnet-18 NOOVERSAMPLING FOCALLOS4\u001b[0m at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/9w86x1zd\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: ⭐️ View project at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Synced 5 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Find logs at: \u001b[35m\u001b[1m./wandb/run-20241008_110458-9w86x1zd/logs\u001b[0m\n",
      "[I 2024-10-08 11:17:19,071] Trial 3 finished with value: 0.16360276364378207 and parameters: {'learning_rate': 8.439417229617311e-07, 'weight_decay': 3.287748485715137e-06, 'focal_loss': 4.507548454599847}. Best is trial 0 with value: 0.18755980861244023.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Tracking run with wandb version 0.18.3\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run data is saved locally in \u001b[35m\u001b[1m/kaggle/working/wandb/run-20241008_111719-y2slwgcg\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run \u001b[1m`wandb offline`\u001b[0m to turn off syncing.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Syncing run \u001b[33moptuna_run_4 microsoft/resnet-18 NOOVERSAMPLING FOCALLOS5\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: ⭐️ View project at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: 🚀 View run at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/y2slwgcg\u001b[0m\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Epoch 1, Loss: 0.4153366939849164\n",
      "Validation Loss: 0.5101216172888166, Total Accuracy: 13.58%\n",
      "Accuracy per class - G1: 90.24%, G2: 12.09%, G3: 0.00%\n",
      "Validation loss decreased (inf --> 10.712554).  Saving model ...\n",
      "Epoch 2, Loss: 0.40386863142611035\n",
      "Validation Loss: 0.4960100366955712, Total Accuracy: 12.35%\n",
      "Accuracy per class - G1: 95.12%, G2: 9.48%, G3: 0.54%\n",
      "Validation loss decreased (10.712554 --> 10.416211).  Saving model ...\n",
      "Epoch 3, Loss: 0.3953856660659055\n",
      "Validation Loss: 0.48642824377332416, Total Accuracy: 15.28%\n",
      "Accuracy per class - G1: 68.29%, G2: 16.59%, G3: 0.54%\n",
      "Validation loss decreased (10.416211 --> 10.214993).  Saving model ...\n",
      "Epoch 4, Loss: 0.3877840796148921\n",
      "Validation Loss: 0.49828081932805834, Total Accuracy: 14.04%\n",
      "Accuracy per class - G1: 82.93%, G2: 13.27%, G3: 0.54%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 5, Loss: 0.37692983717803497\n",
      "Validation Loss: 0.4844146292834055, Total Accuracy: 15.90%\n",
      "Accuracy per class - G1: 78.05%, G2: 16.82%, G3: 0.00%\n",
      "Validation loss decreased (10.214993 --> 10.172707).  Saving model ...\n",
      "Epoch 6, Loss: 0.3709890052496669\n",
      "Validation Loss: 0.4907261324780328, Total Accuracy: 14.51%\n",
      "Accuracy per class - G1: 90.24%, G2: 13.27%, G3: 0.54%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 7, Loss: 0.3630696316081357\n",
      "Validation Loss: 0.49351337197281064, Total Accuracy: 13.27%\n",
      "Accuracy per class - G1: 82.93%, G2: 12.32%, G3: 0.00%\n",
      "EarlyStopping counter: 2 out of 40\n",
      "Epoch 8, Loss: 0.3578698509428875\n",
      "Validation Loss: 0.4826221622171856, Total Accuracy: 15.12%\n",
      "Accuracy per class - G1: 82.93%, G2: 15.17%, G3: 0.00%\n",
      "Validation loss decreased (10.172707 --> 10.135065).  Saving model ...\n",
      "Epoch 9, Loss: 0.34922967905021574\n",
      "Validation Loss: 0.48797817741121563, Total Accuracy: 13.73%\n",
      "Accuracy per class - G1: 85.37%, G2: 12.80%, G3: 0.00%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 10, Loss: 0.3409591116100909\n",
      "Validation Loss: 0.473090655037335, Total Accuracy: 15.74%\n",
      "Accuracy per class - G1: 73.17%, G2: 17.06%, G3: 0.00%\n",
      "Validation loss decreased (10.135065 --> 9.934904).  Saving model ...\n",
      "Epoch 11, Loss: 0.33393797062965763\n",
      "Validation Loss: 0.48450606919470285, Total Accuracy: 14.20%\n",
      "Accuracy per class - G1: 82.93%, G2: 13.51%, G3: 0.54%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 12, Loss: 0.3288614688867546\n",
      "Validation Loss: 0.4885539025777862, Total Accuracy: 12.96%\n",
      "Accuracy per class - G1: 90.24%, G2: 10.90%, G3: 0.54%\n",
      "EarlyStopping counter: 2 out of 40\n",
      "Epoch 13, Loss: 0.31975419621869744\n",
      "Validation Loss: 0.4702443445012683, Total Accuracy: 15.74%\n",
      "Accuracy per class - G1: 75.61%, G2: 16.82%, G3: 0.00%\n",
      "Validation loss decreased (9.934904 --> 9.875131).  Saving model ...\n",
      "Epoch 14, Loss: 0.3138028142682041\n",
      "Validation Loss: 0.487767151423863, Total Accuracy: 14.35%\n",
      "Accuracy per class - G1: 82.93%, G2: 13.74%, G3: 0.54%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 15, Loss: 0.3085650903991906\n",
      "Validation Loss: 0.4661138334444591, Total Accuracy: 16.20%\n",
      "Accuracy per class - G1: 70.73%, G2: 18.01%, G3: 0.00%\n",
      "Validation loss decreased (9.875131 --> 9.788391).  Saving model ...\n",
      "Epoch 16, Loss: 0.30342805259917155\n",
      "Validation Loss: 0.4690917531649272, Total Accuracy: 15.74%\n",
      "Accuracy per class - G1: 65.85%, G2: 17.54%, G3: 0.54%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 17, Loss: 0.29918364695755834\n",
      "Validation Loss: 0.5050738418386096, Total Accuracy: 13.58%\n",
      "Accuracy per class - G1: 85.37%, G2: 12.32%, G3: 0.54%\n",
      "EarlyStopping counter: 2 out of 40\n",
      "Epoch 18, Loss: 0.29108383659138737\n",
      "Validation Loss: 0.4784734014953886, Total Accuracy: 15.90%\n",
      "Accuracy per class - G1: 80.49%, G2: 16.35%, G3: 0.54%\n",
      "EarlyStopping counter: 3 out of 40\n",
      "Epoch 19, Loss: 0.28682443158454207\n",
      "Validation Loss: 0.48775162015642437, Total Accuracy: 15.90%\n",
      "Accuracy per class - G1: 85.37%, G2: 16.11%, G3: 0.00%\n",
      "EarlyStopping counter: 4 out of 40\n",
      "Epoch 20, Loss: 0.28515506419072667\n",
      "Validation Loss: 0.4886365206468673, Total Accuracy: 13.43%\n",
      "Accuracy per class - G1: 85.37%, G2: 12.09%, G3: 0.54%\n",
      "EarlyStopping counter: 5 out of 40\n",
      "Epoch 21, Loss: 0.2773658051548234\n",
      "Validation Loss: 0.4716349747918901, Total Accuracy: 16.67%\n",
      "Accuracy per class - G1: 70.73%, G2: 18.01%, G3: 1.62%\n",
      "EarlyStopping counter: 6 out of 40\n",
      "Epoch 22, Loss: 0.27071170203657036\n",
      "Validation Loss: 0.4812187069938296, Total Accuracy: 17.75%\n",
      "Accuracy per class - G1: 82.93%, G2: 19.19%, G3: 0.00%\n",
      "EarlyStopping counter: 7 out of 40\n",
      "Epoch 23, Loss: 0.2689280689480793\n",
      "Validation Loss: 0.4848977660848981, Total Accuracy: 16.98%\n",
      "Accuracy per class - G1: 78.05%, G2: 18.25%, G3: 0.54%\n",
      "EarlyStopping counter: 8 out of 40\n",
      "Epoch 24, Loss: 0.26444416466247606\n",
      "Validation Loss: 0.5020399519375393, Total Accuracy: 16.36%\n",
      "Accuracy per class - G1: 82.93%, G2: 16.82%, G3: 0.54%\n",
      "EarlyStopping counter: 9 out of 40\n",
      "Epoch 25, Loss: 0.2561973999422717\n",
      "Validation Loss: 0.4710748969089417, Total Accuracy: 19.29%\n",
      "Accuracy per class - G1: 58.54%, G2: 23.93%, G3: 0.00%\n",
      "EarlyStopping counter: 10 out of 40\n",
      "Epoch 26, Loss: 0.25224005655351894\n",
      "Validation Loss: 0.4806420519238427, Total Accuracy: 17.75%\n",
      "Accuracy per class - G1: 58.54%, G2: 21.56%, G3: 0.00%\n",
      "EarlyStopping counter: 11 out of 40\n",
      "Epoch 27, Loss: 0.24947187914905777\n",
      "Validation Loss: 0.49235560638563974, Total Accuracy: 16.98%\n",
      "Accuracy per class - G1: 68.29%, G2: 19.43%, G3: 0.00%\n",
      "EarlyStopping counter: 12 out of 40\n",
      "Epoch 28, Loss: 0.2465781641293721\n",
      "Validation Loss: 0.4767190778539294, Total Accuracy: 19.14%\n",
      "Accuracy per class - G1: 80.49%, G2: 21.56%, G3: 0.00%\n",
      "EarlyStopping counter: 13 out of 40\n",
      "Epoch 29, Loss: 0.24196690626173134\n",
      "Validation Loss: 0.4973534806853249, Total Accuracy: 18.67%\n",
      "Accuracy per class - G1: 75.61%, G2: 21.33%, G3: 0.00%\n",
      "EarlyStopping counter: 14 out of 40\n",
      "Epoch 30, Loss: 0.23721382147576436\n",
      "Validation Loss: 0.49924022597926004, Total Accuracy: 17.59%\n",
      "Accuracy per class - G1: 65.85%, G2: 20.62%, G3: 0.00%\n",
      "EarlyStopping counter: 15 out of 40\n",
      "Epoch 31, Loss: 0.23314244578401727\n",
      "Validation Loss: 0.4877633196966989, Total Accuracy: 18.52%\n",
      "Accuracy per class - G1: 63.41%, G2: 22.04%, G3: 0.54%\n",
      "EarlyStopping counter: 16 out of 40\n",
      "Epoch 32, Loss: 0.22963439179472175\n",
      "Validation Loss: 0.4832873699210939, Total Accuracy: 21.30%\n",
      "Accuracy per class - G1: 51.22%, G2: 27.73%, G3: 0.00%\n",
      "EarlyStopping counter: 17 out of 40\n",
      "Epoch 33, Loss: 0.22459019558975496\n",
      "Validation Loss: 0.4825413305135, Total Accuracy: 21.91%\n",
      "Accuracy per class - G1: 56.10%, G2: 27.96%, G3: 0.54%\n",
      "EarlyStopping counter: 18 out of 40\n",
      "Epoch 34, Loss: 0.22129208567630815\n",
      "Validation Loss: 0.4853613866227014, Total Accuracy: 22.22%\n",
      "Accuracy per class - G1: 53.66%, G2: 28.91%, G3: 0.00%\n",
      "EarlyStopping counter: 19 out of 40\n",
      "Epoch 35, Loss: 0.21665723621845245\n",
      "Validation Loss: 0.4962176290296373, Total Accuracy: 20.83%\n",
      "Accuracy per class - G1: 60.98%, G2: 26.07%, G3: 0.00%\n",
      "EarlyStopping counter: 20 out of 40\n",
      "Epoch 36, Loss: 0.21565580080790692\n",
      "Validation Loss: 0.5076648394266764, Total Accuracy: 20.68%\n",
      "Accuracy per class - G1: 60.98%, G2: 25.83%, G3: 0.00%\n",
      "EarlyStopping counter: 21 out of 40\n",
      "Epoch 37, Loss: 0.21095600293343325\n",
      "Validation Loss: 0.48806439623946235, Total Accuracy: 22.22%\n",
      "Accuracy per class - G1: 36.59%, G2: 30.57%, G3: 0.00%\n",
      "EarlyStopping counter: 22 out of 40\n",
      "Epoch 38, Loss: 0.21072297911328006\n",
      "Validation Loss: 0.5052122211172467, Total Accuracy: 21.60%\n",
      "Accuracy per class - G1: 60.98%, G2: 27.25%, G3: 0.00%\n",
      "EarlyStopping counter: 23 out of 40\n",
      "Epoch 39, Loss: 0.2067089314202228\n",
      "Validation Loss: 0.49908639845393954, Total Accuracy: 20.06%\n",
      "Accuracy per class - G1: 46.34%, G2: 26.30%, G3: 0.00%\n",
      "EarlyStopping counter: 24 out of 40\n",
      "Epoch 40, Loss: 0.20699015708572893\n",
      "Validation Loss: 0.499210210783141, Total Accuracy: 21.14%\n",
      "Accuracy per class - G1: 60.98%, G2: 26.30%, G3: 0.54%\n",
      "EarlyStopping counter: 25 out of 40\n",
      "Epoch 41, Loss: 0.20451313257217407\n",
      "Validation Loss: 0.49977300138700576, Total Accuracy: 21.30%\n",
      "Accuracy per class - G1: 46.34%, G2: 28.20%, G3: 0.00%\n",
      "EarlyStopping counter: 26 out of 40\n",
      "Epoch 42, Loss: 0.20257198325840822\n",
      "Validation Loss: 0.5051588203225817, Total Accuracy: 20.06%\n",
      "Accuracy per class - G1: 41.46%, G2: 26.54%, G3: 0.54%\n",
      "EarlyStopping counter: 27 out of 40\n",
      "Epoch 43, Loss: 0.20134465360497855\n",
      "Validation Loss: 0.5078673213720322, Total Accuracy: 21.76%\n",
      "Accuracy per class - G1: 31.71%, G2: 30.33%, G3: 0.00%\n",
      "EarlyStopping counter: 28 out of 40\n",
      "Epoch 44, Loss: 0.2004574325429388\n",
      "Validation Loss: 0.5173293848832449, Total Accuracy: 20.37%\n",
      "Accuracy per class - G1: 48.78%, G2: 26.30%, G3: 0.54%\n",
      "EarlyStopping counter: 29 out of 40\n",
      "Epoch 45, Loss: 0.19805928382528834\n",
      "Validation Loss: 0.5161038026923225, Total Accuracy: 21.91%\n",
      "Accuracy per class - G1: 39.02%, G2: 29.86%, G3: 0.00%\n",
      "EarlyStopping counter: 30 out of 40\n",
      "Epoch 46, Loss: 0.19695251031094288\n",
      "Validation Loss: 0.5082196664242518, Total Accuracy: 23.61%\n",
      "Accuracy per class - G1: 39.02%, G2: 32.46%, G3: 0.00%\n",
      "EarlyStopping counter: 31 out of 40\n",
      "Epoch 47, Loss: 0.19414803897400937\n",
      "Validation Loss: 0.5033514059725261, Total Accuracy: 22.99%\n",
      "Accuracy per class - G1: 34.15%, G2: 31.99%, G3: 0.00%\n",
      "EarlyStopping counter: 32 out of 40\n",
      "Epoch 48, Loss: 0.1945682297269982\n",
      "Validation Loss: 0.5320516831818081, Total Accuracy: 19.44%\n",
      "Accuracy per class - G1: 51.22%, G2: 24.64%, G3: 0.54%\n",
      "EarlyStopping counter: 33 out of 40\n",
      "Epoch 49, Loss: 0.19396429158836961\n",
      "Validation Loss: 0.5377087699515479, Total Accuracy: 21.76%\n",
      "Accuracy per class - G1: 51.22%, G2: 28.44%, G3: 0.00%\n",
      "EarlyStopping counter: 34 out of 40\n",
      "Epoch 50, Loss: 0.18994608889502215\n",
      "Validation Loss: 0.5046942688169933, Total Accuracy: 23.46%\n",
      "Accuracy per class - G1: 24.39%, G2: 33.65%, G3: 0.00%\n",
      "EarlyStopping counter: 35 out of 40\n",
      "Epoch 51, Loss: 0.18958855151052934\n",
      "Validation Loss: 0.5190263674372718, Total Accuracy: 23.92%\n",
      "Accuracy per class - G1: 36.59%, G2: 33.18%, G3: 0.00%\n",
      "EarlyStopping counter: 36 out of 40\n",
      "Epoch 52, Loss: 0.18524690259651966\n",
      "Validation Loss: 0.5190584475085849, Total Accuracy: 21.45%\n",
      "Accuracy per class - G1: 26.83%, G2: 30.33%, G3: 0.00%\n",
      "EarlyStopping counter: 37 out of 40\n",
      "Epoch 53, Loss: 0.18699344112930527\n",
      "Validation Loss: 0.5245711931160518, Total Accuracy: 21.45%\n",
      "Accuracy per class - G1: 43.90%, G2: 28.67%, G3: 0.00%\n",
      "EarlyStopping counter: 38 out of 40\n",
      "Epoch 54, Loss: 0.18765638768672943\n",
      "Validation Loss: 0.5293959698506764, Total Accuracy: 24.38%\n",
      "Accuracy per class - G1: 34.15%, G2: 34.12%, G3: 0.00%\n",
      "EarlyStopping counter: 39 out of 40\n",
      "Epoch 55, Loss: 0.18152888047407909\n",
      "Validation Loss: 0.5445903944117683, Total Accuracy: 22.69%\n",
      "Accuracy per class - G1: 41.46%, G2: 30.81%, G3: 0.00%\n",
      "EarlyStopping counter: 40 out of 40\n",
      "Early stopping\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\u001b[34m\u001b[1mwandb\u001b[0m:                                                                                \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run history:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc ██▅█▇▇▆▇█▆▆▅▇▇▇▇▆▇▄▄▇▅▅▄▄▅▅▂▅▃▃▂▂▂▄▁▂▁▃▃\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc ▁▁▃▅▅▆▄▅▅▆▅█▄▆▇▆▇▆▆▆▆▆▆▆█▆█▆█▆▆▆▆▆▆▆█▆▆▇\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc ▂▁▃▂▃▂▃▂▃▂▃▂▃▃▂▂▃▄▄▃▄▄▄▄▅▆▇▆▆▆▆▇▆█▅██▇▇▇\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc ▁▁▁▁▁▁▂▂▂▂▂▃▃▃▃▄▄▄▄▅▅▅▆▆▆▆▆▇▇▇▇▇▇▇▇█████\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc ▁████▁▁██▁███▁█▁██▁▁▁▁█▁█▁▁▁█▁█▁▁▁█▁▁▁▁▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc ▁▁▁▂▂▂▂▂▂▃▃▃▃▃▃▄▄▄▄▅▅▅▅▆▅▆▆▆▆▇▇▇▇▇▇█████\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy ▁▂▂▃▂▂▁▃▂▁▂▃▃▃▃▃▄▃▃▅▃▅▅▄▄▆▆▅▆▆▆▆▆█▇▆▇█▆█\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy ▁▁▁▁▁▂▂▂▂▃▃▃▄▄▄▄▅▅▅▅▆▆▆▆▆▆▇▇▇▇▇▇▇▇▇█████\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss ██▇▇▇▆▆▆▆▆▅▅▅▅▄▄▄▄▄▃▃▃▃▃▃▂▂▂▂▂▂▂▁▁▁▁▁▁▁▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss ▅▃▄▂▃▂▃▁▂▃▃▁▂▃▁▂▄▁▂▃▄▄▃▂▂▃▄▄▄▄▅▅▅▄▇▄▆▆▆█\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run summary:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc 41.46341\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc 97.96748\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc 30.80569\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc 63.30109\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc 0\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc 55.89812\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy 22.68519\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy 64.43689\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss 0.18153\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss 0.54459\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: 🚀 View run \u001b[33moptuna_run_4 microsoft/resnet-18 NOOVERSAMPLING FOCALLOS5\u001b[0m at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/y2slwgcg\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: ⭐️ View project at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Synced 5 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Find logs at: \u001b[35m\u001b[1m./wandb/run-20241008_111719-y2slwgcg/logs\u001b[0m\n",
      "[I 2024-10-08 11:33:44,839] Trial 4 finished with value: 0.15640348975426688 and parameters: {'learning_rate': 3.8440258456747014e-08, 'weight_decay': 1.2872519103061419e-05, 'focal_loss': 3.19880481452284}. Best is trial 0 with value: 0.18755980861244023.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Tracking run with wandb version 0.18.3\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run data is saved locally in \u001b[35m\u001b[1m/kaggle/working/wandb/run-20241008_113345-l9udgupe\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run \u001b[1m`wandb offline`\u001b[0m to turn off syncing.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Syncing run \u001b[33moptuna_run_5 microsoft/resnet-18 NOOVERSAMPLING FOCALLOS6\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: ⭐️ View project at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: 🚀 View run at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/l9udgupe\u001b[0m\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Epoch 1, Loss: 0.4749000787016857\n",
      "Validation Loss: 0.5475055128335953, Total Accuracy: 27.01%\n",
      "Accuracy per class - G1: 26.83%, G2: 38.63%, G3: 0.54%\n",
      "Validation loss decreased (inf --> 11.497616).  Saving model ...\n",
      "Epoch 2, Loss: 0.4406398462961955\n",
      "Validation Loss: 0.5545355432799884, Total Accuracy: 25.31%\n",
      "Accuracy per class - G1: 21.95%, G2: 36.73%, G3: 0.00%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 3, Loss: 0.41384293910968734\n",
      "Validation Loss: 0.5512640781345821, Total Accuracy: 27.16%\n",
      "Accuracy per class - G1: 19.51%, G2: 39.81%, G3: 0.00%\n",
      "EarlyStopping counter: 2 out of 40\n",
      "Epoch 4, Loss: 0.3896660449275051\n",
      "Validation Loss: 0.5508799524534316, Total Accuracy: 27.16%\n",
      "Accuracy per class - G1: 17.07%, G2: 40.05%, G3: 0.00%\n",
      "EarlyStopping counter: 3 out of 40\n",
      "Epoch 5, Loss: 0.3637302322200982\n",
      "Validation Loss: 0.5594810712195578, Total Accuracy: 26.85%\n",
      "Accuracy per class - G1: 19.51%, G2: 39.34%, G3: 0.00%\n",
      "EarlyStopping counter: 4 out of 40\n",
      "Epoch 6, Loss: 0.3433489860540413\n",
      "Validation Loss: 0.5565597748472577, Total Accuracy: 27.31%\n",
      "Accuracy per class - G1: 17.07%, G2: 40.28%, G3: 0.00%\n",
      "EarlyStopping counter: 5 out of 40\n",
      "Epoch 7, Loss: 0.3247600978756525\n",
      "Validation Loss: 0.5634634633149419, Total Accuracy: 28.09%\n",
      "Accuracy per class - G1: 17.07%, G2: 41.47%, G3: 0.00%\n",
      "EarlyStopping counter: 6 out of 40\n",
      "Epoch 8, Loss: 0.30651881249554186\n",
      "Validation Loss: 0.5684156552666709, Total Accuracy: 27.01%\n",
      "Accuracy per class - G1: 17.07%, G2: 39.81%, G3: 0.00%\n",
      "EarlyStopping counter: 7 out of 40\n",
      "Epoch 9, Loss: 0.293766011315656\n",
      "Validation Loss: 0.568564718677884, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 17.07%, G2: 42.18%, G3: 0.00%\n",
      "EarlyStopping counter: 8 out of 40\n",
      "Epoch 10, Loss: 0.27507090191525146\n",
      "Validation Loss: 0.5802975144414675, Total Accuracy: 27.47%\n",
      "Accuracy per class - G1: 14.63%, G2: 40.76%, G3: 0.00%\n",
      "EarlyStopping counter: 9 out of 40\n",
      "Epoch 11, Loss: 0.2601042041577489\n",
      "Validation Loss: 0.5837640191117922, Total Accuracy: 27.16%\n",
      "Accuracy per class - G1: 14.63%, G2: 40.28%, G3: 0.00%\n",
      "EarlyStopping counter: 10 out of 40\n",
      "Epoch 12, Loss: 0.2475885639348662\n",
      "Validation Loss: 0.5791008571783701, Total Accuracy: 28.86%\n",
      "Accuracy per class - G1: 9.76%, G2: 43.36%, G3: 0.00%\n",
      "EarlyStopping counter: 11 out of 40\n",
      "Epoch 13, Loss: 0.23801077004656734\n",
      "Validation Loss: 0.584814981690475, Total Accuracy: 29.63%\n",
      "Accuracy per class - G1: 9.76%, G2: 44.55%, G3: 0.00%\n",
      "EarlyStopping counter: 12 out of 40\n",
      "Epoch 14, Loss: 0.22640812468816\n",
      "Validation Loss: 0.6198948742378325, Total Accuracy: 26.54%\n",
      "Accuracy per class - G1: 14.63%, G2: 39.34%, G3: 0.00%\n",
      "EarlyStopping counter: 13 out of 40\n",
      "Epoch 15, Loss: 0.21275265981633978\n",
      "Validation Loss: 0.6095190229160445, Total Accuracy: 28.86%\n",
      "Accuracy per class - G1: 7.32%, G2: 43.60%, G3: 0.00%\n",
      "EarlyStopping counter: 14 out of 40\n",
      "Epoch 16, Loss: 0.2028677449168929\n",
      "Validation Loss: 0.6105366760776156, Total Accuracy: 29.32%\n",
      "Accuracy per class - G1: 4.88%, G2: 44.55%, G3: 0.00%\n",
      "EarlyStopping counter: 15 out of 40\n",
      "Epoch 17, Loss: 0.1952300942446812\n",
      "Validation Loss: 0.6140686885586807, Total Accuracy: 28.70%\n",
      "Accuracy per class - G1: 4.88%, G2: 43.60%, G3: 0.00%\n",
      "EarlyStopping counter: 16 out of 40\n",
      "Epoch 18, Loss: 0.18597836307732454\n",
      "Validation Loss: 0.6225885482771056, Total Accuracy: 29.01%\n",
      "Accuracy per class - G1: 4.88%, G2: 44.08%, G3: 0.00%\n",
      "EarlyStopping counter: 17 out of 40\n",
      "Epoch 19, Loss: 0.17961005633135876\n",
      "Validation Loss: 0.6342196982531321, Total Accuracy: 28.86%\n",
      "Accuracy per class - G1: 4.88%, G2: 43.84%, G3: 0.00%\n",
      "EarlyStopping counter: 18 out of 40\n",
      "Epoch 20, Loss: 0.17091490866908107\n",
      "Validation Loss: 0.6304326536399978, Total Accuracy: 29.17%\n",
      "Accuracy per class - G1: 4.88%, G2: 44.31%, G3: 0.00%\n",
      "EarlyStopping counter: 19 out of 40\n",
      "Epoch 21, Loss: 0.16435546113784055\n",
      "Validation Loss: 0.6318069678686914, Total Accuracy: 28.70%\n",
      "Accuracy per class - G1: 4.88%, G2: 43.60%, G3: 0.00%\n",
      "EarlyStopping counter: 20 out of 40\n",
      "Epoch 22, Loss: 0.15775942990937866\n",
      "Validation Loss: 0.630961099196048, Total Accuracy: 30.71%\n",
      "Accuracy per class - G1: 4.88%, G2: 46.68%, G3: 0.00%\n",
      "EarlyStopping counter: 21 out of 40\n",
      "Epoch 23, Loss: 0.15138941554419966\n",
      "Validation Loss: 0.6566664872779733, Total Accuracy: 28.40%\n",
      "Accuracy per class - G1: 4.88%, G2: 43.13%, G3: 0.00%\n",
      "EarlyStopping counter: 22 out of 40\n",
      "Epoch 24, Loss: 0.14814995516495533\n",
      "Validation Loss: 0.6731030728135791, Total Accuracy: 28.24%\n",
      "Accuracy per class - G1: 4.88%, G2: 42.89%, G3: 0.00%\n",
      "EarlyStopping counter: 23 out of 40\n",
      "Epoch 25, Loss: 0.14477348632841225\n",
      "Validation Loss: 0.6322758290029707, Total Accuracy: 28.86%\n",
      "Accuracy per class - G1: 4.88%, G2: 43.84%, G3: 0.00%\n",
      "EarlyStopping counter: 24 out of 40\n",
      "Epoch 26, Loss: 0.14214133857244468\n",
      "Validation Loss: 0.6510489008256367, Total Accuracy: 29.32%\n",
      "Accuracy per class - G1: 0.00%, G2: 45.02%, G3: 0.00%\n",
      "EarlyStopping counter: 25 out of 40\n",
      "Epoch 27, Loss: 0.1362218746399305\n",
      "Validation Loss: 0.6578546072400752, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 2.44%, G2: 43.60%, G3: 0.00%\n",
      "EarlyStopping counter: 26 out of 40\n",
      "Epoch 28, Loss: 0.13669167845005012\n",
      "Validation Loss: 0.6421757099174318, Total Accuracy: 29.17%\n",
      "Accuracy per class - G1: 0.00%, G2: 44.79%, G3: 0.00%\n",
      "EarlyStopping counter: 27 out of 40\n",
      "Epoch 29, Loss: 0.13331871928579836\n",
      "Validation Loss: 0.6527330311281341, Total Accuracy: 29.63%\n",
      "Accuracy per class - G1: 0.00%, G2: 45.50%, G3: 0.00%\n",
      "EarlyStopping counter: 28 out of 40\n",
      "Epoch 30, Loss: 0.13193933737565236\n",
      "Validation Loss: 0.6737223824574834, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 43.84%, G3: 0.00%\n",
      "EarlyStopping counter: 29 out of 40\n",
      "Epoch 31, Loss: 0.12749494199293204\n",
      "Validation Loss: 0.6582798391935372, Total Accuracy: 29.78%\n",
      "Accuracy per class - G1: 0.00%, G2: 45.73%, G3: 0.00%\n",
      "EarlyStopping counter: 30 out of 40\n",
      "Epoch 32, Loss: 0.12489253129944744\n",
      "Validation Loss: 0.6913049274257251, Total Accuracy: 29.01%\n",
      "Accuracy per class - G1: 4.88%, G2: 44.08%, G3: 0.00%\n",
      "EarlyStopping counter: 31 out of 40\n",
      "Epoch 33, Loss: 0.12208309329776879\n",
      "Validation Loss: 0.6862573118082115, Total Accuracy: 29.17%\n",
      "Accuracy per class - G1: 0.00%, G2: 44.79%, G3: 0.00%\n",
      "EarlyStopping counter: 32 out of 40\n",
      "Epoch 34, Loss: 0.12159601401492774\n",
      "Validation Loss: 0.6618906688832101, Total Accuracy: 29.32%\n",
      "Accuracy per class - G1: 0.00%, G2: 45.02%, G3: 0.00%\n",
      "EarlyStopping counter: 33 out of 40\n",
      "Epoch 35, Loss: 0.1190046477748687\n",
      "Validation Loss: 0.6876897709000678, Total Accuracy: 29.78%\n",
      "Accuracy per class - G1: 0.00%, G2: 45.73%, G3: 0.00%\n",
      "EarlyStopping counter: 34 out of 40\n",
      "Epoch 36, Loss: 0.1151402283863849\n",
      "Validation Loss: 0.6755910845739501, Total Accuracy: 29.94%\n",
      "Accuracy per class - G1: 0.00%, G2: 45.97%, G3: 0.00%\n",
      "EarlyStopping counter: 35 out of 40\n",
      "Epoch 37, Loss: 0.1127865473369518\n",
      "Validation Loss: 0.6736330757183688, Total Accuracy: 29.78%\n",
      "Accuracy per class - G1: 0.00%, G2: 45.73%, G3: 0.00%\n",
      "EarlyStopping counter: 36 out of 40\n",
      "Epoch 38, Loss: 0.10968899224177901\n",
      "Validation Loss: 0.6870896166988781, Total Accuracy: 29.63%\n",
      "Accuracy per class - G1: 0.00%, G2: 45.50%, G3: 0.00%\n",
      "EarlyStopping counter: 37 out of 40\n",
      "Epoch 39, Loss: 0.10745600296790342\n",
      "Validation Loss: 0.7045965985882849, Total Accuracy: 29.94%\n",
      "Accuracy per class - G1: 0.00%, G2: 45.97%, G3: 0.00%\n",
      "EarlyStopping counter: 38 out of 40\n",
      "Epoch 40, Loss: 0.10610413385263409\n",
      "Validation Loss: 0.6971899036850248, Total Accuracy: 28.70%\n",
      "Accuracy per class - G1: 0.00%, G2: 44.08%, G3: 0.00%\n",
      "EarlyStopping counter: 39 out of 40\n",
      "Epoch 41, Loss: 0.10176525480416884\n",
      "Validation Loss: 0.6970628432574726, Total Accuracy: 28.70%\n",
      "Accuracy per class - G1: 0.00%, G2: 44.08%, G3: 0.00%\n",
      "EarlyStopping counter: 40 out of 40\n",
      "Early stopping\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\u001b[34m\u001b[1mwandb\u001b[0m:                                                                                \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run history:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc █▇▆▅▆▅▅▅▅▅▅▄▄▅▃▂▂▂▂▂▂▂▂▂▂▁▂▁▁▁▁▂▁▁▁▁▁▁▁▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc ▁▂▂▄▄▄▅▅▅▆▆▆▇▆▆▇▇▇▇▇▇▇███▇▇██████▇█▇████\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc ▂▁▃▃▃▃▄▃▅▄▃▆▆▃▆▆▆▆▆▆▆█▅▅▆▇▆▇▇▆▇▆▇▇▇█▇▇█▆\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc ▁▂▃▄▄▅▅▆▆▆▇▇▇▇▇▇▇▇▇█████████████████████\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc █▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc ▁▁▁▁▁▂▂▂▃▃▄▄▅▅▅▆▆▆▆▆▆▇▇▇▇▇▇▇▇▇▇▇████████\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy ▃▁▃▃▃▄▅▃▅▄▃▆▇▃▆▆▅▆▆▆▅█▅▅▆▆▅▆▇▅▇▆▆▆▇▇▇▇▇▅\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy ▁▂▂▂▃▃▃▄▄▅▅▅▆▆▆▆▇▇▇▇▇▇▇▇▇▇▇▇████████████\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss █▇▇▆▆▆▅▅▅▄▄▄▄▃▃▃▃▃▂▂▂▂▂▂▂▂▂▂▂▂▁▁▁▁▁▁▁▁▁▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss ▁▁▁▁▂▁▂▂▂▂▃▂▃▄▄▄▄▄▅▅▅▅▆▇▅▆▆▅▆▇▆▇▇▆▇▇▇▇██\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run summary:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc 0\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc 97.15447\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc 44.07583\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc 98.85127\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc 0\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc 87.93566\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy 28.7037\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy 95.61602\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss 0.10177\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss 0.69706\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: 🚀 View run \u001b[33moptuna_run_5 microsoft/resnet-18 NOOVERSAMPLING FOCALLOS6\u001b[0m at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/l9udgupe\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: ⭐️ View project at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Synced 5 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Find logs at: \u001b[35m\u001b[1m./wandb/run-20241008_113345-l9udgupe/logs\u001b[0m\n",
      "[I 2024-10-08 11:45:01,255] Trial 5 finished with value: 0.1486810551558753 and parameters: {'learning_rate': 1.2527880391254175e-07, 'weight_decay': 4.7817982302789924e-05, 'focal_loss': 2.2447269998674124}. Best is trial 0 with value: 0.18755980861244023.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Tracking run with wandb version 0.18.3\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run data is saved locally in \u001b[35m\u001b[1m/kaggle/working/wandb/run-20241008_114501-315i7srh\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run \u001b[1m`wandb offline`\u001b[0m to turn off syncing.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Syncing run \u001b[33moptuna_run_6 microsoft/resnet-18 NOOVERSAMPLING FOCALLOS7\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: ⭐️ View project at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: 🚀 View run at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/315i7srh\u001b[0m\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Epoch 1, Loss: 0.4686333644820983\n",
      "Validation Loss: 0.35633998789957594, Total Accuracy: 45.22%\n",
      "Accuracy per class - G1: 26.83%, G2: 38.15%, G3: 65.41%\n",
      "Validation loss decreased (inf --> 7.483140).  Saving model ...\n",
      "Epoch 2, Loss: 0.45436498989541846\n",
      "Validation Loss: 0.34604974552279427, Total Accuracy: 45.52%\n",
      "Accuracy per class - G1: 26.83%, G2: 37.91%, G3: 67.03%\n",
      "Validation loss decreased (7.483140 --> 7.267045).  Saving model ...\n",
      "Epoch 3, Loss: 0.4423758373203048\n",
      "Validation Loss: 0.33811370602675844, Total Accuracy: 46.60%\n",
      "Accuracy per class - G1: 21.95%, G2: 39.10%, G3: 69.19%\n",
      "Validation loss decreased (7.267045 --> 7.100388).  Saving model ...\n",
      "Epoch 4, Loss: 0.42959864311907664\n",
      "Validation Loss: 0.33607248074951623, Total Accuracy: 45.52%\n",
      "Accuracy per class - G1: 29.27%, G2: 37.68%, G3: 67.03%\n",
      "Validation loss decreased (7.100388 --> 7.057522).  Saving model ...\n",
      "Epoch 5, Loss: 0.421991794224245\n",
      "Validation Loss: 0.34334612141052884, Total Accuracy: 43.06%\n",
      "Accuracy per class - G1: 29.27%, G2: 33.65%, G3: 67.57%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 6, Loss: 0.40964198471551916\n",
      "Validation Loss: 0.3434856395636286, Total Accuracy: 43.06%\n",
      "Accuracy per class - G1: 26.83%, G2: 34.12%, G3: 67.03%\n",
      "EarlyStopping counter: 2 out of 40\n",
      "Epoch 7, Loss: 0.39956051470285436\n",
      "Validation Loss: 0.35521616751239415, Total Accuracy: 40.28%\n",
      "Accuracy per class - G1: 26.83%, G2: 28.91%, G3: 69.19%\n",
      "EarlyStopping counter: 3 out of 40\n",
      "Epoch 8, Loss: 0.38848979394119904\n",
      "Validation Loss: 0.34541485352175577, Total Accuracy: 40.28%\n",
      "Accuracy per class - G1: 26.83%, G2: 30.09%, G3: 66.49%\n",
      "EarlyStopping counter: 4 out of 40\n",
      "Epoch 9, Loss: 0.3818350240408656\n",
      "Validation Loss: 0.36290812279496876, Total Accuracy: 36.42%\n",
      "Accuracy per class - G1: 24.39%, G2: 24.88%, G3: 65.41%\n",
      "EarlyStopping counter: 5 out of 40\n",
      "Epoch 10, Loss: 0.3713856328682727\n",
      "Validation Loss: 0.35653529564539593, Total Accuracy: 36.88%\n",
      "Accuracy per class - G1: 26.83%, G2: 25.83%, G3: 64.32%\n",
      "EarlyStopping counter: 6 out of 40\n",
      "Epoch 11, Loss: 0.36473078253757524\n",
      "Validation Loss: 0.3622665809733527, Total Accuracy: 35.96%\n",
      "Accuracy per class - G1: 26.83%, G2: 23.46%, G3: 66.49%\n",
      "EarlyStopping counter: 7 out of 40\n",
      "Epoch 12, Loss: 0.3533982472965516\n",
      "Validation Loss: 0.37376516347839717, Total Accuracy: 33.18%\n",
      "Accuracy per class - G1: 26.83%, G2: 21.09%, G3: 62.16%\n",
      "EarlyStopping counter: 8 out of 40\n",
      "Epoch 13, Loss: 0.3475565414830863\n",
      "Validation Loss: 0.36824771407104673, Total Accuracy: 33.95%\n",
      "Accuracy per class - G1: 24.39%, G2: 22.04%, G3: 63.24%\n",
      "EarlyStopping counter: 9 out of 40\n",
      "Epoch 14, Loss: 0.33887746678777486\n",
      "Validation Loss: 0.3737806770063582, Total Accuracy: 31.33%\n",
      "Accuracy per class - G1: 26.83%, G2: 18.48%, G3: 61.62%\n",
      "EarlyStopping counter: 10 out of 40\n",
      "Epoch 15, Loss: 0.33249607071819076\n",
      "Validation Loss: 0.3814596388311613, Total Accuracy: 31.17%\n",
      "Accuracy per class - G1: 24.39%, G2: 16.82%, G3: 65.41%\n",
      "EarlyStopping counter: 11 out of 40\n",
      "Epoch 16, Loss: 0.3235430927520775\n",
      "Validation Loss: 0.3861402283821787, Total Accuracy: 29.63%\n",
      "Accuracy per class - G1: 24.39%, G2: 15.17%, G3: 63.78%\n",
      "EarlyStopping counter: 12 out of 40\n",
      "Epoch 17, Loss: 0.3183369772980012\n",
      "Validation Loss: 0.3833405254852204, Total Accuracy: 29.48%\n",
      "Accuracy per class - G1: 21.95%, G2: 16.82%, G3: 60.00%\n",
      "EarlyStopping counter: 13 out of 40\n",
      "Epoch 18, Loss: 0.31309593011097736\n",
      "Validation Loss: 0.38612830603406545, Total Accuracy: 29.94%\n",
      "Accuracy per class - G1: 24.39%, G2: 16.59%, G3: 61.62%\n",
      "EarlyStopping counter: 14 out of 40\n",
      "Epoch 19, Loss: 0.3052688799349658\n",
      "Validation Loss: 0.3979360173855509, Total Accuracy: 27.16%\n",
      "Accuracy per class - G1: 21.95%, G2: 12.56%, G3: 61.62%\n",
      "EarlyStopping counter: 15 out of 40\n",
      "Epoch 20, Loss: 0.3008649724434657\n",
      "Validation Loss: 0.4068072083450499, Total Accuracy: 26.39%\n",
      "Accuracy per class - G1: 24.39%, G2: 11.37%, G3: 61.08%\n",
      "EarlyStopping counter: 16 out of 40\n",
      "Epoch 21, Loss: 0.2932428381888263\n",
      "Validation Loss: 0.41733906276169275, Total Accuracy: 25.15%\n",
      "Accuracy per class - G1: 19.51%, G2: 9.24%, G3: 62.70%\n",
      "EarlyStopping counter: 17 out of 40\n",
      "Epoch 22, Loss: 0.28965233966528653\n",
      "Validation Loss: 0.40808720106170293, Total Accuracy: 25.31%\n",
      "Accuracy per class - G1: 29.27%, G2: 10.43%, G3: 58.38%\n",
      "EarlyStopping counter: 18 out of 40\n",
      "Epoch 23, Loss: 0.28170285562434827\n",
      "Validation Loss: 0.4098293919648443, Total Accuracy: 25.62%\n",
      "Accuracy per class - G1: 24.39%, G2: 11.14%, G3: 58.92%\n",
      "EarlyStopping counter: 19 out of 40\n",
      "Epoch 24, Loss: 0.2763391217912536\n",
      "Validation Loss: 0.40548306419735863, Total Accuracy: 25.77%\n",
      "Accuracy per class - G1: 17.07%, G2: 12.09%, G3: 58.92%\n",
      "EarlyStopping counter: 20 out of 40\n",
      "Epoch 25, Loss: 0.27487853456692524\n",
      "Validation Loss: 0.42570567840621587, Total Accuracy: 24.54%\n",
      "Accuracy per class - G1: 17.07%, G2: 11.37%, G3: 56.22%\n",
      "EarlyStopping counter: 21 out of 40\n",
      "Epoch 26, Loss: 0.2700859144868621\n",
      "Validation Loss: 0.4282498693182355, Total Accuracy: 25.31%\n",
      "Accuracy per class - G1: 17.07%, G2: 10.43%, G3: 61.08%\n",
      "EarlyStopping counter: 22 out of 40\n",
      "Epoch 27, Loss: 0.2652616947889328\n",
      "Validation Loss: 0.4312612009899957, Total Accuracy: 24.07%\n",
      "Accuracy per class - G1: 21.95%, G2: 9.72%, G3: 57.30%\n",
      "EarlyStopping counter: 23 out of 40\n",
      "Epoch 28, Loss: 0.26390211284160614\n",
      "Validation Loss: 0.4281743537812006, Total Accuracy: 25.15%\n",
      "Accuracy per class - G1: 17.07%, G2: 10.90%, G3: 59.46%\n",
      "EarlyStopping counter: 24 out of 40\n",
      "Epoch 29, Loss: 0.26005999205342256\n",
      "Validation Loss: 0.4245546892994926, Total Accuracy: 24.23%\n",
      "Accuracy per class - G1: 17.07%, G2: 11.85%, G3: 54.05%\n",
      "EarlyStopping counter: 25 out of 40\n",
      "Epoch 30, Loss: 0.2588878184197897\n",
      "Validation Loss: 0.4395358079955691, Total Accuracy: 23.77%\n",
      "Accuracy per class - G1: 17.07%, G2: 10.66%, G3: 55.14%\n",
      "EarlyStopping counter: 26 out of 40\n",
      "Epoch 31, Loss: 0.25478796948151416\n",
      "Validation Loss: 0.4259450158902577, Total Accuracy: 24.85%\n",
      "Accuracy per class - G1: 14.63%, G2: 11.61%, G3: 57.30%\n",
      "EarlyStopping counter: 27 out of 40\n",
      "Epoch 32, Loss: 0.2548647099230663\n",
      "Validation Loss: 0.4409372827836445, Total Accuracy: 24.07%\n",
      "Accuracy per class - G1: 17.07%, G2: 10.66%, G3: 56.22%\n",
      "EarlyStopping counter: 28 out of 40\n",
      "Epoch 33, Loss: 0.24905301073947586\n",
      "Validation Loss: 0.4309730529785156, Total Accuracy: 24.54%\n",
      "Accuracy per class - G1: 17.07%, G2: 11.85%, G3: 55.14%\n",
      "EarlyStopping counter: 29 out of 40\n",
      "Epoch 34, Loss: 0.2482527878629156\n",
      "Validation Loss: 0.43511033271040234, Total Accuracy: 25.15%\n",
      "Accuracy per class - G1: 14.63%, G2: 11.61%, G3: 58.38%\n",
      "EarlyStopping counter: 30 out of 40\n",
      "Epoch 35, Loss: 0.24689565203994154\n",
      "Validation Loss: 0.43692138649168466, Total Accuracy: 23.77%\n",
      "Accuracy per class - G1: 17.07%, G2: 11.14%, G3: 54.05%\n",
      "EarlyStopping counter: 31 out of 40\n",
      "Epoch 36, Loss: 0.24372825170137796\n",
      "Validation Loss: 0.43754362705208005, Total Accuracy: 24.69%\n",
      "Accuracy per class - G1: 17.07%, G2: 12.56%, G3: 54.05%\n",
      "EarlyStopping counter: 32 out of 40\n",
      "Epoch 37, Loss: 0.2401443838355053\n",
      "Validation Loss: 0.4450259045476005, Total Accuracy: 24.69%\n",
      "Accuracy per class - G1: 14.63%, G2: 11.85%, G3: 56.22%\n",
      "EarlyStopping counter: 33 out of 40\n",
      "Epoch 38, Loss: 0.23883034647947335\n",
      "Validation Loss: 0.4322227324758257, Total Accuracy: 25.00%\n",
      "Accuracy per class - G1: 17.07%, G2: 13.27%, G3: 53.51%\n",
      "EarlyStopping counter: 34 out of 40\n",
      "Epoch 39, Loss: 0.23766168700643334\n",
      "Validation Loss: 0.45794345367522465, Total Accuracy: 23.30%\n",
      "Accuracy per class - G1: 17.07%, G2: 10.66%, G3: 53.51%\n",
      "EarlyStopping counter: 35 out of 40\n",
      "Epoch 40, Loss: 0.2335497297077294\n",
      "Validation Loss: 0.45793692554746357, Total Accuracy: 24.54%\n",
      "Accuracy per class - G1: 17.07%, G2: 10.43%, G3: 58.38%\n",
      "EarlyStopping counter: 36 out of 40\n",
      "Epoch 41, Loss: 0.23121318185185813\n",
      "Validation Loss: 0.4579949698277882, Total Accuracy: 23.46%\n",
      "Accuracy per class - G1: 14.63%, G2: 10.90%, G3: 54.05%\n",
      "EarlyStopping counter: 37 out of 40\n",
      "Epoch 42, Loss: 0.22769933687635216\n",
      "Validation Loss: 0.4627700660909925, Total Accuracy: 24.38%\n",
      "Accuracy per class - G1: 17.07%, G2: 10.90%, G3: 56.76%\n",
      "EarlyStopping counter: 38 out of 40\n",
      "Epoch 43, Loss: 0.22874264939721808\n",
      "Validation Loss: 0.46683988258952186, Total Accuracy: 23.30%\n",
      "Accuracy per class - G1: 12.20%, G2: 10.66%, G3: 54.59%\n",
      "EarlyStopping counter: 39 out of 40\n",
      "Epoch 44, Loss: 0.22865175536598067\n",
      "Validation Loss: 0.45669962820552645, Total Accuracy: 23.61%\n",
      "Accuracy per class - G1: 17.07%, G2: 11.14%, G3: 53.51%\n",
      "EarlyStopping counter: 40 out of 40\n",
      "Early stopping\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\u001b[34m\u001b[1mwandb\u001b[0m:                                                                                \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run history:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc ▇▇▄██▇▇▇▆▇▇▆▇▆▆▄▆▄▆▃▆▂▂▂▄▂▂▂▁▂▁▂▂▁▂▂▂▁▂▂\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc ▁▁▁▂▂▂▃▃▄▄▅▅▆▆▆▆▇▇▇▇▇▇▇▇█▇▇███▇█████████\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc ████▇▇▆▆▅▅▄▄▃▃▂▃▃▂▂▁▁▂▂▁▁▁▂▁▂▁▂▁▂▂▂▁▁▁▁▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc ▁▁▁▁▁▁▁▂▁▂▂▂▂▂▃▃▃▃▄▄▅▅▅▅▅▅▆▆▆▆▆▇▇▇▇▇█▇██\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc ▆▇█▇▇▇█▇▆▆▅▅▅▆▆▄▅▅▄▅▃▃▂▄▃▄▁▂▃▂▃▁▁▂▁▁▃▁▂▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc ▁▁▁▂▂▂▂▂▃▃▃▄▄▄▄▄▄▅▅▆▆▆▆▇▆▆▇▆▇▇▇▇▇▇█▇▇██▇\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy ████▇▇▆▆▅▅▄▄▃▃▃▃▃▂▂▂▂▂▁▂▁▂▁▁▁▁▂▁▁▁▂▁▁▁▁▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy ▁▁▁▁▂▂▂▂▂▂▃▃▃▃▄▄▄▄▄▅▅▆▆▆▆▆▆▆▆▆▇▇▇▇▇▇████\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss ██▇▇▇▆▆▆▅▅▅▄▄▄▄▄▃▃▃▃▃▂▂▂▂▂▂▂▂▂▂▂▁▁▁▁▁▁▁▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss ▂▂▁▁▁▁▂▂▂▂▃▃▃▄▄▄▄▄▅▅▅▅▆▆▆▆▆▇▆▇▆▇▇▇▆█████\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run summary:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc 17.07317\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc 74.39024\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc 11.13744\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc 49.21403\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc 53.51351\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc 72.92225\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy 23.61111\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy 58.23885\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss 0.22865\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss 0.4567\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: 🚀 View run \u001b[33moptuna_run_6 microsoft/resnet-18 NOOVERSAMPLING FOCALLOS7\u001b[0m at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/315i7srh\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: ⭐️ View project at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Synced 5 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Find logs at: \u001b[35m\u001b[1m./wandb/run-20241008_114501-315i7srh/logs\u001b[0m\n",
      "[I 2024-10-08 11:57:30,231] Trial 6 finished with value: 0.210465738327397 and parameters: {'learning_rate': 3.7924423579868084e-08, 'weight_decay': 0.0005734950415418563, 'focal_loss': 3.27075734166145}. Best is trial 6 with value: 0.210465738327397.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Tracking run with wandb version 0.18.3\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run data is saved locally in \u001b[35m\u001b[1m/kaggle/working/wandb/run-20241008_115730-iydubmls\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run \u001b[1m`wandb offline`\u001b[0m to turn off syncing.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Syncing run \u001b[33moptuna_run_7 microsoft/resnet-18 NOOVERSAMPLING FOCALLOS8\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: ⭐️ View project at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: 🚀 View run at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/iydubmls\u001b[0m\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Epoch 1, Loss: 0.897968728140176\n",
      "Validation Loss: 1.1401454579262507, Total Accuracy: 12.19%\n",
      "Accuracy per class - G1: 100.00%, G2: 4.98%, G3: 9.19%\n",
      "Validation loss decreased (inf --> 23.943055).  Saving model ...\n",
      "Epoch 2, Loss: 0.8696620471506233\n",
      "Validation Loss: 1.2405407315208798, Total Accuracy: 9.10%\n",
      "Accuracy per class - G1: 100.00%, G2: 1.18%, G3: 7.03%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 3, Loss: 0.8405861768377832\n",
      "Validation Loss: 1.246765749085517, Total Accuracy: 10.19%\n",
      "Accuracy per class - G1: 100.00%, G2: 1.42%, G3: 10.27%\n",
      "EarlyStopping counter: 2 out of 40\n",
      "Epoch 4, Loss: 0.8147930179733828\n",
      "Validation Loss: 1.2617967980248588, Total Accuracy: 9.88%\n",
      "Accuracy per class - G1: 100.00%, G2: 1.42%, G3: 9.19%\n",
      "EarlyStopping counter: 3 out of 40\n",
      "Epoch 5, Loss: 0.7849415038005415\n",
      "Validation Loss: 1.2236284563938777, Total Accuracy: 10.49%\n",
      "Accuracy per class - G1: 100.00%, G2: 2.13%, G3: 9.73%\n",
      "EarlyStopping counter: 4 out of 40\n",
      "Epoch 6, Loss: 0.7606286837393978\n",
      "Validation Loss: 1.269153932730357, Total Accuracy: 12.04%\n",
      "Accuracy per class - G1: 100.00%, G2: 2.84%, G3: 13.51%\n",
      "EarlyStopping counter: 5 out of 40\n",
      "Epoch 7, Loss: 0.736006561532078\n",
      "Validation Loss: 1.2302560941094445, Total Accuracy: 12.19%\n",
      "Accuracy per class - G1: 100.00%, G2: 3.32%, G3: 12.97%\n",
      "EarlyStopping counter: 6 out of 40\n",
      "Epoch 8, Loss: 0.7138238516916712\n",
      "Validation Loss: 1.2709968231973194, Total Accuracy: 11.57%\n",
      "Accuracy per class - G1: 100.00%, G2: 3.08%, G3: 11.35%\n",
      "EarlyStopping counter: 7 out of 40\n",
      "Epoch 9, Loss: 0.6937114309115582\n",
      "Validation Loss: 1.2444312686011905, Total Accuracy: 14.04%\n",
      "Accuracy per class - G1: 100.00%, G2: 5.69%, G3: 14.05%\n",
      "EarlyStopping counter: 8 out of 40\n",
      "Epoch 10, Loss: 0.6728857805929989\n",
      "Validation Loss: 1.278323850461415, Total Accuracy: 13.73%\n",
      "Accuracy per class - G1: 100.00%, G2: 4.98%, G3: 14.59%\n",
      "EarlyStopping counter: 9 out of 40\n",
      "Epoch 11, Loss: 0.6529122906995107\n",
      "Validation Loss: 1.277551715572675, Total Accuracy: 13.12%\n",
      "Accuracy per class - G1: 100.00%, G2: 4.98%, G3: 12.43%\n",
      "EarlyStopping counter: 10 out of 40\n",
      "Epoch 12, Loss: 0.6360726496541357\n",
      "Validation Loss: 1.3084931600661505, Total Accuracy: 13.58%\n",
      "Accuracy per class - G1: 100.00%, G2: 4.74%, G3: 14.59%\n",
      "EarlyStopping counter: 11 out of 40\n",
      "Epoch 13, Loss: 0.6134186767670046\n",
      "Validation Loss: 1.2808897991975148, Total Accuracy: 13.89%\n",
      "Accuracy per class - G1: 100.00%, G2: 5.92%, G3: 12.97%\n",
      "EarlyStopping counter: 12 out of 40\n",
      "Epoch 14, Loss: 0.5945523988051586\n",
      "Validation Loss: 1.317224003019787, Total Accuracy: 14.35%\n",
      "Accuracy per class - G1: 100.00%, G2: 6.40%, G3: 13.51%\n",
      "EarlyStopping counter: 13 out of 40\n",
      "Epoch 15, Loss: 0.5813928871269686\n",
      "Validation Loss: 1.320775480497451, Total Accuracy: 14.81%\n",
      "Accuracy per class - G1: 100.00%, G2: 6.64%, G3: 14.59%\n",
      "EarlyStopping counter: 14 out of 40\n",
      "Epoch 16, Loss: 0.5607361491904201\n",
      "Validation Loss: 1.2967064181963603, Total Accuracy: 15.12%\n",
      "Accuracy per class - G1: 100.00%, G2: 7.35%, G3: 14.05%\n",
      "EarlyStopping counter: 15 out of 40\n",
      "Epoch 17, Loss: 0.5452466639409582\n",
      "Validation Loss: 1.3064724930695124, Total Accuracy: 14.35%\n",
      "Accuracy per class - G1: 100.00%, G2: 7.35%, G3: 11.35%\n",
      "EarlyStopping counter: 16 out of 40\n",
      "Epoch 18, Loss: 0.5294530151120151\n",
      "Validation Loss: 1.318805454742341, Total Accuracy: 14.81%\n",
      "Accuracy per class - G1: 100.00%, G2: 7.35%, G3: 12.97%\n",
      "EarlyStopping counter: 17 out of 40\n",
      "Epoch 19, Loss: 0.5165944835507726\n",
      "Validation Loss: 1.304354185149783, Total Accuracy: 15.43%\n",
      "Accuracy per class - G1: 100.00%, G2: 8.29%, G3: 12.97%\n",
      "EarlyStopping counter: 18 out of 40\n",
      "Epoch 20, Loss: 0.49927608866289436\n",
      "Validation Loss: 1.3537979097593398, Total Accuracy: 15.12%\n",
      "Accuracy per class - G1: 100.00%, G2: 8.53%, G3: 11.35%\n",
      "EarlyStopping counter: 19 out of 40\n",
      "Epoch 21, Loss: 0.48096968431070625\n",
      "Validation Loss: 1.3311827693666731, Total Accuracy: 15.90%\n",
      "Accuracy per class - G1: 100.00%, G2: 8.53%, G3: 14.05%\n",
      "EarlyStopping counter: 20 out of 40\n",
      "Epoch 22, Loss: 0.4701026049723108\n",
      "Validation Loss: 1.3525847125621069, Total Accuracy: 15.74%\n",
      "Accuracy per class - G1: 100.00%, G2: 9.24%, G3: 11.89%\n",
      "EarlyStopping counter: 21 out of 40\n",
      "Epoch 23, Loss: 0.4639681272477989\n",
      "Validation Loss: 1.3487117049239932, Total Accuracy: 15.74%\n",
      "Accuracy per class - G1: 100.00%, G2: 8.77%, G3: 12.97%\n",
      "EarlyStopping counter: 22 out of 40\n",
      "Epoch 24, Loss: 0.4545813529606325\n",
      "Validation Loss: 1.3116761616298132, Total Accuracy: 16.05%\n",
      "Accuracy per class - G1: 100.00%, G2: 10.66%, G3: 9.73%\n",
      "EarlyStopping counter: 23 out of 40\n",
      "Epoch 25, Loss: 0.4484692025615508\n",
      "Validation Loss: 1.4133644629092443, Total Accuracy: 15.90%\n",
      "Accuracy per class - G1: 100.00%, G2: 9.00%, G3: 12.97%\n",
      "EarlyStopping counter: 24 out of 40\n",
      "Epoch 26, Loss: 0.44765941780733776\n",
      "Validation Loss: 1.3562556221371604, Total Accuracy: 15.43%\n",
      "Accuracy per class - G1: 100.00%, G2: 9.24%, G3: 10.81%\n",
      "EarlyStopping counter: 25 out of 40\n",
      "Epoch 27, Loss: 0.4347955369087587\n",
      "Validation Loss: 1.3440900161152793, Total Accuracy: 16.36%\n",
      "Accuracy per class - G1: 100.00%, G2: 10.43%, G3: 11.35%\n",
      "EarlyStopping counter: 26 out of 40\n",
      "Epoch 28, Loss: 0.4324940658477415\n",
      "Validation Loss: 1.323616684902282, Total Accuracy: 16.82%\n",
      "Accuracy per class - G1: 100.00%, G2: 10.90%, G3: 11.89%\n",
      "EarlyStopping counter: 27 out of 40\n",
      "Epoch 29, Loss: 0.4221723252032177\n",
      "Validation Loss: 1.374302910906928, Total Accuracy: 15.59%\n",
      "Accuracy per class - G1: 100.00%, G2: 9.95%, G3: 9.73%\n",
      "EarlyStopping counter: 28 out of 40\n",
      "Epoch 30, Loss: 0.41647694089326515\n",
      "Validation Loss: 1.3612890711852483, Total Accuracy: 17.28%\n",
      "Accuracy per class - G1: 100.00%, G2: 10.90%, G3: 13.51%\n",
      "EarlyStopping counter: 29 out of 40\n",
      "Epoch 31, Loss: 0.41199707949017905\n",
      "Validation Loss: 1.3478560163861228, Total Accuracy: 16.05%\n",
      "Accuracy per class - G1: 100.00%, G2: 11.37%, G3: 8.11%\n",
      "EarlyStopping counter: 30 out of 40\n",
      "Epoch 32, Loss: 0.4057747827595975\n",
      "Validation Loss: 1.3432756932008834, Total Accuracy: 16.98%\n",
      "Accuracy per class - G1: 100.00%, G2: 11.85%, G3: 10.27%\n",
      "EarlyStopping counter: 31 out of 40\n",
      "Epoch 33, Loss: 0.4014114945767874\n",
      "Validation Loss: 1.347147477524621, Total Accuracy: 16.82%\n",
      "Accuracy per class - G1: 100.00%, G2: 10.90%, G3: 11.89%\n",
      "EarlyStopping counter: 32 out of 40\n",
      "Epoch 34, Loss: 0.39363189975181256\n",
      "Validation Loss: 1.3702251896971749, Total Accuracy: 17.13%\n",
      "Accuracy per class - G1: 100.00%, G2: 11.61%, G3: 11.35%\n",
      "EarlyStopping counter: 33 out of 40\n",
      "Epoch 35, Loss: 0.3894280223961336\n",
      "Validation Loss: 1.3327229221661885, Total Accuracy: 18.06%\n",
      "Accuracy per class - G1: 100.00%, G2: 13.74%, G3: 9.73%\n",
      "EarlyStopping counter: 34 out of 40\n",
      "Epoch 36, Loss: 0.3827480499643877\n",
      "Validation Loss: 1.409782009465354, Total Accuracy: 16.36%\n",
      "Accuracy per class - G1: 100.00%, G2: 11.61%, G3: 8.65%\n",
      "EarlyStopping counter: 35 out of 40\n",
      "Epoch 37, Loss: 0.3793172789625375\n",
      "Validation Loss: 1.3967078512623197, Total Accuracy: 16.67%\n",
      "Accuracy per class - G1: 100.00%, G2: 11.61%, G3: 9.73%\n",
      "EarlyStopping counter: 36 out of 40\n",
      "Epoch 38, Loss: 0.36979004166212426\n",
      "Validation Loss: 1.3860745486759005, Total Accuracy: 17.44%\n",
      "Accuracy per class - G1: 100.00%, G2: 12.56%, G3: 10.27%\n",
      "EarlyStopping counter: 37 out of 40\n",
      "Epoch 39, Loss: 0.36559040934206494\n",
      "Validation Loss: 1.3930411040782928, Total Accuracy: 17.75%\n",
      "Accuracy per class - G1: 100.00%, G2: 13.74%, G3: 8.65%\n",
      "EarlyStopping counter: 38 out of 40\n",
      "Epoch 40, Loss: 0.36088905725852555\n",
      "Validation Loss: 1.3565193443071275, Total Accuracy: 18.52%\n",
      "Accuracy per class - G1: 100.00%, G2: 15.64%, G3: 7.03%\n",
      "EarlyStopping counter: 39 out of 40\n",
      "Epoch 41, Loss: 0.3562694096780685\n",
      "Validation Loss: 1.4067354911849612, Total Accuracy: 18.21%\n",
      "Accuracy per class - G1: 100.00%, G2: 13.74%, G3: 10.27%\n",
      "EarlyStopping counter: 40 out of 40\n",
      "Early stopping\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\u001b[34m\u001b[1mwandb\u001b[0m:                                                                                \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run history:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc ▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc ▁▂▂▄▂▃▄▅▆▅▆▆▆▆▆▆▆▇▆▇▆▇▆▇▇▇▇█▇▇▇▇█▇▇█▆█▇▇\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc ▃▁▁▁▂▂▂▂▄▃▃▃▄▄▄▄▄▄▅▅▅▅▅▆▅▅▆▆▆▆▇▇▆▇█▇▇▇██\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc ▁▁▁▁▁▁▁▂▂▂▂▃▃▄▄▄▅▅▅▆▆▆▆▆▇▇▇▇▇▇▇▇▇▇██████\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc ▃▁▄▃▃▇▆▅▇█▆█▆▇█▇▅▆▆▅▇▅▆▃▆▅▅▅▃▇▂▄▅▅▃▂▃▄▂▄\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc ▁▂▂▃▃▄▄▄▄▅▅▅▅▆▆▆▆▆▆▆▇▇▇▇▇▇▇▇▇▇▇▇▇▇██████\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy ▃▁▂▂▂▃▃▃▅▅▄▄▅▅▅▆▅▅▆▆▆▆▆▆▆▆▇▇▆▇▆▇▇▇█▇▇▇██\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy ▁▁▁▁▂▂▂▂▂▃▃▃▄▄▄▅▅▅▅▆▆▆▆▇▇▇▇▇▇▇▇▇▇▇██████\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss ██▇▇▇▆▆▆▅▅▅▅▄▄▄▄▃▃▃▃▃▂▂▂▂▂▂▂▂▂▂▂▂▁▁▁▁▁▁▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss ▁▄▄▄▃▄▃▄▄▅▅▅▅▆▆▅▅▆▅▆▆▆▆▅█▇▆▆▇▇▆▆▆▇▆██▇▇█\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run summary:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc 100\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc 97.96748\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc 13.74408\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc 77.50907\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc 10.27027\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc 86.19303\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy 18.20988\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy 81.85941\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss 0.35627\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss 1.40674\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: 🚀 View run \u001b[33moptuna_run_7 microsoft/resnet-18 NOOVERSAMPLING FOCALLOS8\u001b[0m at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/iydubmls\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: ⭐️ View project at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Synced 5 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Find logs at: \u001b[35m\u001b[1m./wandb/run-20241008_115730-iydubmls/logs\u001b[0m\n",
      "[I 2024-10-08 12:08:52,849] Trial 7 finished with value: 0.17436113459511673 and parameters: {'learning_rate': 9.664167696508335e-08, 'weight_decay': 4.482575797634977e-07, 'focal_loss': 1.2620958740534713}. Best is trial 6 with value: 0.210465738327397.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Tracking run with wandb version 0.18.3\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run data is saved locally in \u001b[35m\u001b[1m/kaggle/working/wandb/run-20241008_120853-56dgtnz9\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run \u001b[1m`wandb offline`\u001b[0m to turn off syncing.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Syncing run \u001b[33moptuna_run_8 microsoft/resnet-18 NOOVERSAMPLING FOCALLOS9\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: ⭐️ View project at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: 🚀 View run at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/56dgtnz9\u001b[0m\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Epoch 1, Loss: 0.3764612764479166\n",
      "Validation Loss: 0.2874890026592073, Total Accuracy: 45.52%\n",
      "Accuracy per class - G1: 97.56%, G2: 45.50%, G3: 34.05%\n",
      "Validation loss decreased (inf --> 6.037269).  Saving model ...\n",
      "Epoch 2, Loss: 0.3038289803697402\n",
      "Validation Loss: 0.2986177766606921, Total Accuracy: 44.44%\n",
      "Accuracy per class - G1: 82.93%, G2: 47.16%, G3: 29.73%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 3, Loss: 0.250622349690242\n",
      "Validation Loss: 0.3095786731157984, Total Accuracy: 43.67%\n",
      "Accuracy per class - G1: 68.29%, G2: 47.16%, G3: 30.27%\n",
      "EarlyStopping counter: 2 out of 40\n",
      "Epoch 4, Loss: 0.21343600301139326\n",
      "Validation Loss: 0.3318628030163901, Total Accuracy: 41.51%\n",
      "Accuracy per class - G1: 48.78%, G2: 46.45%, G3: 28.65%\n",
      "EarlyStopping counter: 3 out of 40\n",
      "Epoch 5, Loss: 0.18411123950079264\n",
      "Validation Loss: 0.33452667721680235, Total Accuracy: 39.66%\n",
      "Accuracy per class - G1: 34.15%, G2: 47.16%, G3: 23.78%\n",
      "EarlyStopping counter: 4 out of 40\n",
      "Epoch 6, Loss: 0.16517093095434718\n",
      "Validation Loss: 0.34913712456112816, Total Accuracy: 37.04%\n",
      "Accuracy per class - G1: 29.27%, G2: 48.82%, G3: 11.89%\n",
      "EarlyStopping counter: 5 out of 40\n",
      "Epoch 7, Loss: 0.1444260909794325\n",
      "Validation Loss: 0.36682047765879405, Total Accuracy: 36.73%\n",
      "Accuracy per class - G1: 24.39%, G2: 48.10%, G3: 13.51%\n",
      "EarlyStopping counter: 6 out of 40\n",
      "Epoch 8, Loss: 0.13223832136536218\n",
      "Validation Loss: 0.38364300238234655, Total Accuracy: 36.57%\n",
      "Accuracy per class - G1: 19.51%, G2: 47.87%, G3: 14.59%\n",
      "EarlyStopping counter: 7 out of 40\n",
      "Epoch 9, Loss: 0.12064008513487966\n",
      "Validation Loss: 0.3842159350003515, Total Accuracy: 34.10%\n",
      "Accuracy per class - G1: 14.63%, G2: 48.34%, G3: 5.95%\n",
      "EarlyStopping counter: 8 out of 40\n",
      "Epoch 10, Loss: 0.10814097460853048\n",
      "Validation Loss: 0.394977475383452, Total Accuracy: 35.65%\n",
      "Accuracy per class - G1: 14.63%, G2: 47.63%, G3: 12.97%\n",
      "EarlyStopping counter: 9 out of 40\n",
      "Epoch 11, Loss: 0.09785291978932288\n",
      "Validation Loss: 0.3894934698584534, Total Accuracy: 35.19%\n",
      "Accuracy per class - G1: 14.63%, G2: 47.63%, G3: 11.35%\n",
      "EarlyStopping counter: 10 out of 40\n",
      "Epoch 12, Loss: 0.09000123682689953\n",
      "Validation Loss: 0.4173451628358591, Total Accuracy: 34.41%\n",
      "Accuracy per class - G1: 14.63%, G2: 48.10%, G3: 7.57%\n",
      "EarlyStopping counter: 11 out of 40\n",
      "Epoch 13, Loss: 0.08194335603929427\n",
      "Validation Loss: 0.43919667495148523, Total Accuracy: 34.72%\n",
      "Accuracy per class - G1: 19.51%, G2: 47.87%, G3: 8.11%\n",
      "EarlyStopping counter: 12 out of 40\n",
      "Epoch 14, Loss: 0.07718617944832308\n",
      "Validation Loss: 0.4385697603935287, Total Accuracy: 35.34%\n",
      "Accuracy per class - G1: 19.51%, G2: 47.63%, G3: 10.81%\n",
      "EarlyStopping counter: 13 out of 40\n",
      "Epoch 15, Loss: 0.0720157211264932\n",
      "Validation Loss: 0.43510598813494045, Total Accuracy: 34.26%\n",
      "Accuracy per class - G1: 12.20%, G2: 47.87%, G3: 8.11%\n",
      "EarlyStopping counter: 14 out of 40\n",
      "Epoch 16, Loss: 0.06811224557010524\n",
      "Validation Loss: 0.44115837078009335, Total Accuracy: 33.64%\n",
      "Accuracy per class - G1: 2.44%, G2: 49.05%, G3: 5.41%\n",
      "EarlyStopping counter: 15 out of 40\n",
      "Epoch 17, Loss: 0.06013900836009577\n",
      "Validation Loss: 0.464926184288093, Total Accuracy: 33.64%\n",
      "Accuracy per class - G1: 2.44%, G2: 48.10%, G3: 7.57%\n",
      "EarlyStopping counter: 16 out of 40\n",
      "Epoch 18, Loss: 0.05859537718884916\n",
      "Validation Loss: 0.46228814870119095, Total Accuracy: 32.56%\n",
      "Accuracy per class - G1: 2.44%, G2: 49.05%, G3: 1.62%\n",
      "EarlyStopping counter: 17 out of 40\n",
      "Epoch 19, Loss: 0.052351147542337335\n",
      "Validation Loss: 0.5068860422997248, Total Accuracy: 33.49%\n",
      "Accuracy per class - G1: 4.88%, G2: 48.10%, G3: 6.49%\n",
      "EarlyStopping counter: 18 out of 40\n",
      "Epoch 20, Loss: 0.05050629009324384\n",
      "Validation Loss: 0.48557619209445657, Total Accuracy: 32.72%\n",
      "Accuracy per class - G1: 2.44%, G2: 48.58%, G3: 3.24%\n",
      "EarlyStopping counter: 19 out of 40\n",
      "Epoch 21, Loss: 0.04599108499845108\n",
      "Validation Loss: 0.5098576280510142, Total Accuracy: 33.02%\n",
      "Accuracy per class - G1: 2.44%, G2: 48.34%, G3: 4.86%\n",
      "EarlyStopping counter: 20 out of 40\n",
      "Epoch 22, Loss: 0.04332487489354898\n",
      "Validation Loss: 0.5421471281775406, Total Accuracy: 33.02%\n",
      "Accuracy per class - G1: 7.32%, G2: 48.58%, G3: 3.24%\n",
      "EarlyStopping counter: 21 out of 40\n",
      "Epoch 23, Loss: 0.04133843231093453\n",
      "Validation Loss: 0.49789698528391974, Total Accuracy: 33.02%\n",
      "Accuracy per class - G1: 0.00%, G2: 48.34%, G3: 5.41%\n",
      "EarlyStopping counter: 22 out of 40\n",
      "Epoch 24, Loss: 0.03909369701721582\n",
      "Validation Loss: 0.5165510849938506, Total Accuracy: 32.72%\n",
      "Accuracy per class - G1: 2.44%, G2: 48.34%, G3: 3.78%\n",
      "EarlyStopping counter: 23 out of 40\n",
      "Epoch 25, Loss: 0.038152878946927656\n",
      "Validation Loss: 0.5373471086578709, Total Accuracy: 32.72%\n",
      "Accuracy per class - G1: 2.44%, G2: 48.10%, G3: 4.32%\n",
      "EarlyStopping counter: 24 out of 40\n",
      "Epoch 26, Loss: 0.03806964599763055\n",
      "Validation Loss: 0.5351110047527722, Total Accuracy: 32.87%\n",
      "Accuracy per class - G1: 2.44%, G2: 48.10%, G3: 4.86%\n",
      "EarlyStopping counter: 25 out of 40\n",
      "Epoch 27, Loss: 0.03683731271829232\n",
      "Validation Loss: 0.5344536755056608, Total Accuracy: 32.25%\n",
      "Accuracy per class - G1: 2.44%, G2: 48.58%, G3: 1.62%\n",
      "EarlyStopping counter: 26 out of 40\n",
      "Epoch 28, Loss: 0.03509005697735821\n",
      "Validation Loss: 0.5245212808783565, Total Accuracy: 32.25%\n",
      "Accuracy per class - G1: 2.44%, G2: 48.58%, G3: 1.62%\n",
      "EarlyStopping counter: 27 out of 40\n",
      "Epoch 29, Loss: 0.03344911704939532\n",
      "Validation Loss: 0.5289665365680343, Total Accuracy: 32.25%\n",
      "Accuracy per class - G1: 2.44%, G2: 48.58%, G3: 1.62%\n",
      "EarlyStopping counter: 28 out of 40\n",
      "Epoch 30, Loss: 0.032474230840263595\n",
      "Validation Loss: 0.5351726605246464, Total Accuracy: 32.25%\n",
      "Accuracy per class - G1: 2.44%, G2: 48.58%, G3: 1.62%\n",
      "EarlyStopping counter: 29 out of 40\n",
      "Epoch 31, Loss: 0.0313399555722633\n",
      "Validation Loss: 0.552149571744459, Total Accuracy: 32.10%\n",
      "Accuracy per class - G1: 2.44%, G2: 48.58%, G3: 1.08%\n",
      "EarlyStopping counter: 30 out of 40\n",
      "Epoch 32, Loss: 0.031124786619680475\n",
      "Validation Loss: 0.5513539867741721, Total Accuracy: 32.25%\n",
      "Accuracy per class - G1: 2.44%, G2: 48.58%, G3: 1.62%\n",
      "EarlyStopping counter: 31 out of 40\n",
      "Epoch 33, Loss: 0.029521221788712294\n",
      "Validation Loss: 0.5612285350937218, Total Accuracy: 32.10%\n",
      "Accuracy per class - G1: 0.00%, G2: 48.58%, G3: 1.62%\n",
      "EarlyStopping counter: 32 out of 40\n",
      "Epoch 34, Loss: 0.028649230622293718\n",
      "Validation Loss: 0.564814607124953, Total Accuracy: 32.10%\n",
      "Accuracy per class - G1: 0.00%, G2: 48.58%, G3: 1.62%\n",
      "EarlyStopping counter: 33 out of 40\n",
      "Epoch 35, Loss: 0.026860151103282548\n",
      "Validation Loss: 0.5938440163930258, Total Accuracy: 32.25%\n",
      "Accuracy per class - G1: 2.44%, G2: 48.58%, G3: 1.62%\n",
      "EarlyStopping counter: 34 out of 40\n",
      "Epoch 36, Loss: 0.02642028291810708\n",
      "Validation Loss: 0.5721109624774683, Total Accuracy: 32.25%\n",
      "Accuracy per class - G1: 0.00%, G2: 48.58%, G3: 2.16%\n",
      "EarlyStopping counter: 35 out of 40\n",
      "Epoch 37, Loss: 0.026831006709800428\n",
      "Validation Loss: 0.6124261027822892, Total Accuracy: 32.25%\n",
      "Accuracy per class - G1: 2.44%, G2: 48.58%, G3: 1.62%\n",
      "EarlyStopping counter: 36 out of 40\n",
      "Epoch 38, Loss: 0.026714529191334564\n",
      "Validation Loss: 0.6079047355091288, Total Accuracy: 32.41%\n",
      "Accuracy per class - G1: 2.44%, G2: 48.34%, G3: 2.70%\n",
      "EarlyStopping counter: 37 out of 40\n",
      "Epoch 39, Loss: 0.02378046745995441\n",
      "Validation Loss: 0.5997983950766779, Total Accuracy: 32.25%\n",
      "Accuracy per class - G1: 2.44%, G2: 48.58%, G3: 1.62%\n",
      "EarlyStopping counter: 38 out of 40\n",
      "Epoch 40, Loss: 0.021555345034204334\n",
      "Validation Loss: 0.5978801564446518, Total Accuracy: 32.25%\n",
      "Accuracy per class - G1: 2.44%, G2: 48.58%, G3: 1.62%\n",
      "EarlyStopping counter: 39 out of 40\n",
      "Epoch 41, Loss: 0.021945130427828037\n",
      "Validation Loss: 0.5919080925661893, Total Accuracy: 32.10%\n",
      "Accuracy per class - G1: 0.00%, G2: 48.58%, G3: 1.62%\n",
      "EarlyStopping counter: 40 out of 40\n",
      "Early stopping\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\u001b[34m\u001b[1mwandb\u001b[0m:                                                                                \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run history:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc █▇▆▅▃▃▃▂▂▂▂▂▂▂▂▁▁▁▁▁▁▂▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc ▁▁▁▂▄▅▆▆▇▇▇▇▇▇█▇████████████████████████\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc ▁▄▄▃▄█▆▆▇▅▅▆▆▅▆█▆█▆▇▇▇▇▇▆▆▇▇▇▇▇▇▇▇▇▇▇▇▇▇\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc ▁▃▄▅▆▆▇▇▇▇▇▇▇▇██████████████████████████\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc █▇▇▇▆▃▄▄▂▄▃▂▂▃▂▂▂▁▂▁▂▁▂▂▂▂▁▁▁▁▁▁▁▁▁▁▁▁▁▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc ▁▂▄▅▅▆▆▆▇▇▇▇▇▇▇▇█▇██████████████████████\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy █▇▇▆▅▄▃▃▂▃▃▂▂▃▂▂▂▁▂▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy ▁▂▄▅▆▆▆▇▇▇▇▇▇▇▇█████████████████████████\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss █▇▆▅▄▄▃▃▃▃▂▂▂▂▂▂▂▂▂▂▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss ▁▁▁▂▂▂▃▃▃▃▃▄▄▄▄▄▅▅▆▅▆▆▆▆▆▆▆▆▆▆▇▇▇▇█▇████\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run summary:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc 0\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc 97.96748\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc 48.5782\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc 99.93954\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc 1.62162\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc 99.46381\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy 32.09877\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy 99.62207\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss 0.02195\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss 0.59191\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: 🚀 View run \u001b[33moptuna_run_8 microsoft/resnet-18 NOOVERSAMPLING FOCALLOS9\u001b[0m at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/56dgtnz9\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: ⭐️ View project at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Synced 5 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Find logs at: \u001b[35m\u001b[1m./wandb/run-20241008_120853-56dgtnz9/logs\u001b[0m\n",
      "[I 2024-10-08 12:20:23,960] Trial 8 finished with value: 0.16577184489756003 and parameters: {'learning_rate': 2.9351512810540796e-07, 'weight_decay': 2.0402078732401477e-05, 'focal_loss': 2.5613135250469643}. Best is trial 6 with value: 0.210465738327397.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Tracking run with wandb version 0.18.3\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run data is saved locally in \u001b[35m\u001b[1m/kaggle/working/wandb/run-20241008_122024-csatkhqe\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run \u001b[1m`wandb offline`\u001b[0m to turn off syncing.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Syncing run \u001b[33moptuna_run_9 microsoft/resnet-18 NOOVERSAMPLING FOCALLOS10\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: ⭐️ View project at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: 🚀 View run at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/csatkhqe\u001b[0m\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Epoch 1, Loss: 0.3991257383162717\n",
      "Validation Loss: 0.31073049349444254, Total Accuracy: 48.61%\n",
      "Accuracy per class - G1: 0.00%, G2: 31.75%, G3: 97.84%\n",
      "Validation loss decreased (inf --> 6.525340).  Saving model ...\n",
      "Epoch 2, Loss: 0.3410780302372323\n",
      "Validation Loss: 0.3286579208714621, Total Accuracy: 43.83%\n",
      "Accuracy per class - G1: 0.00%, G2: 26.78%, G3: 92.43%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 3, Loss: 0.30459834437772454\n",
      "Validation Loss: 0.33622064086652936, Total Accuracy: 43.67%\n",
      "Accuracy per class - G1: 0.00%, G2: 27.73%, G3: 89.73%\n",
      "EarlyStopping counter: 2 out of 40\n",
      "Epoch 4, Loss: 0.26996635672557784\n",
      "Validation Loss: 0.34535997609297436, Total Accuracy: 40.74%\n",
      "Accuracy per class - G1: 0.00%, G2: 24.88%, G3: 85.95%\n",
      "EarlyStopping counter: 3 out of 40\n",
      "Epoch 5, Loss: 0.24347453950399375\n",
      "Validation Loss: 0.36302157030219123, Total Accuracy: 39.04%\n",
      "Accuracy per class - G1: 0.00%, G2: 24.88%, G3: 80.00%\n",
      "EarlyStopping counter: 4 out of 40\n",
      "Epoch 6, Loss: 0.22035272437405873\n",
      "Validation Loss: 0.3629538672310965, Total Accuracy: 39.04%\n",
      "Accuracy per class - G1: 0.00%, G2: 27.73%, G3: 73.51%\n",
      "EarlyStopping counter: 5 out of 40\n",
      "Epoch 7, Loss: 0.20407817342195167\n",
      "Validation Loss: 0.37282578576178776, Total Accuracy: 38.73%\n",
      "Accuracy per class - G1: 0.00%, G2: 28.20%, G3: 71.35%\n",
      "EarlyStopping counter: 6 out of 40\n",
      "Epoch 8, Loss: 0.18466727202197156\n",
      "Validation Loss: 0.40500053692431676, Total Accuracy: 36.73%\n",
      "Accuracy per class - G1: 0.00%, G2: 24.64%, G3: 72.43%\n",
      "EarlyStopping counter: 7 out of 40\n",
      "Epoch 9, Loss: 0.17424449719578386\n",
      "Validation Loss: 0.4035901909782773, Total Accuracy: 33.64%\n",
      "Accuracy per class - G1: 0.00%, G2: 27.96%, G3: 54.05%\n",
      "EarlyStopping counter: 8 out of 40\n",
      "Epoch 10, Loss: 0.160312986517527\n",
      "Validation Loss: 0.4126051657256626, Total Accuracy: 34.72%\n",
      "Accuracy per class - G1: 0.00%, G2: 30.09%, G3: 52.97%\n",
      "EarlyStopping counter: 9 out of 40\n",
      "Epoch 11, Loss: 0.14995766170771727\n",
      "Validation Loss: 0.4106869903348741, Total Accuracy: 35.49%\n",
      "Accuracy per class - G1: 0.00%, G2: 31.04%, G3: 53.51%\n",
      "EarlyStopping counter: 10 out of 40\n",
      "Epoch 12, Loss: 0.14000177509095296\n",
      "Validation Loss: 0.4397096655198506, Total Accuracy: 35.34%\n",
      "Accuracy per class - G1: 0.00%, G2: 30.57%, G3: 54.05%\n",
      "EarlyStopping counter: 11 out of 40\n",
      "Epoch 13, Loss: 0.12972623549671058\n",
      "Validation Loss: 0.4352662715883482, Total Accuracy: 34.41%\n",
      "Accuracy per class - G1: 0.00%, G2: 32.70%, G3: 45.95%\n",
      "EarlyStopping counter: 12 out of 40\n",
      "Epoch 14, Loss: 0.12297027585018112\n",
      "Validation Loss: 0.43848784267902374, Total Accuracy: 34.72%\n",
      "Accuracy per class - G1: 0.00%, G2: 35.78%, G3: 40.00%\n",
      "EarlyStopping counter: 13 out of 40\n",
      "Epoch 15, Loss: 0.11411159198327236\n",
      "Validation Loss: 0.45029113725537345, Total Accuracy: 34.41%\n",
      "Accuracy per class - G1: 0.00%, G2: 35.07%, G3: 40.54%\n",
      "EarlyStopping counter: 14 out of 40\n",
      "Epoch 16, Loss: 0.10842874870601907\n",
      "Validation Loss: 0.47675500952062155, Total Accuracy: 33.02%\n",
      "Accuracy per class - G1: 0.00%, G2: 34.36%, G3: 37.30%\n",
      "EarlyStopping counter: 15 out of 40\n",
      "Epoch 17, Loss: 0.10313032235366752\n",
      "Validation Loss: 0.4700342927660261, Total Accuracy: 33.18%\n",
      "Accuracy per class - G1: 0.00%, G2: 36.49%, G3: 32.97%\n",
      "EarlyStopping counter: 16 out of 40\n",
      "Epoch 18, Loss: 0.09469554537391088\n",
      "Validation Loss: 0.4729726726100558, Total Accuracy: 33.95%\n",
      "Accuracy per class - G1: 0.00%, G2: 37.44%, G3: 33.51%\n",
      "EarlyStopping counter: 17 out of 40\n",
      "Epoch 19, Loss: 0.08940051877534533\n",
      "Validation Loss: 0.49185244490702945, Total Accuracy: 33.95%\n",
      "Accuracy per class - G1: 0.00%, G2: 37.91%, G3: 32.43%\n",
      "EarlyStopping counter: 18 out of 40\n",
      "Epoch 20, Loss: 0.08711059297244232\n",
      "Validation Loss: 0.5172433115187145, Total Accuracy: 32.25%\n",
      "Accuracy per class - G1: 0.00%, G2: 36.73%, G3: 29.19%\n",
      "EarlyStopping counter: 19 out of 40\n",
      "Epoch 21, Loss: 0.08155476221119065\n",
      "Validation Loss: 0.49500972245420727, Total Accuracy: 32.41%\n",
      "Accuracy per class - G1: 0.00%, G2: 38.39%, G3: 25.95%\n",
      "EarlyStopping counter: 20 out of 40\n",
      "Epoch 22, Loss: 0.07612104408712272\n",
      "Validation Loss: 0.5639911726826713, Total Accuracy: 31.94%\n",
      "Accuracy per class - G1: 0.00%, G2: 37.44%, G3: 26.49%\n",
      "EarlyStopping counter: 21 out of 40\n",
      "Epoch 23, Loss: 0.07406837479716324\n",
      "Validation Loss: 0.5400896625859397, Total Accuracy: 32.56%\n",
      "Accuracy per class - G1: 0.00%, G2: 37.91%, G3: 27.57%\n",
      "EarlyStopping counter: 22 out of 40\n",
      "Epoch 24, Loss: 0.07157412252153258\n",
      "Validation Loss: 0.5627762487246877, Total Accuracy: 33.18%\n",
      "Accuracy per class - G1: 0.00%, G2: 36.73%, G3: 32.43%\n",
      "EarlyStopping counter: 23 out of 40\n",
      "Epoch 25, Loss: 0.06934589740023556\n",
      "Validation Loss: 0.5197057759477979, Total Accuracy: 33.64%\n",
      "Accuracy per class - G1: 0.00%, G2: 40.28%, G3: 25.95%\n",
      "EarlyStopping counter: 24 out of 40\n",
      "Epoch 26, Loss: 0.06789921408137643\n",
      "Validation Loss: 0.5683390856498763, Total Accuracy: 31.17%\n",
      "Accuracy per class - G1: 0.00%, G2: 38.15%, G3: 22.16%\n",
      "EarlyStopping counter: 25 out of 40\n",
      "Epoch 27, Loss: 0.06598968561514314\n",
      "Validation Loss: 0.5425932517363912, Total Accuracy: 33.18%\n",
      "Accuracy per class - G1: 0.00%, G2: 39.10%, G3: 27.03%\n",
      "EarlyStopping counter: 26 out of 40\n",
      "Epoch 28, Loss: 0.0651040890040886\n",
      "Validation Loss: 0.5434923807070369, Total Accuracy: 32.10%\n",
      "Accuracy per class - G1: 0.00%, G2: 40.28%, G3: 20.54%\n",
      "EarlyStopping counter: 27 out of 40\n",
      "Epoch 29, Loss: 0.06261598184166184\n",
      "Validation Loss: 0.5719637693393798, Total Accuracy: 31.64%\n",
      "Accuracy per class - G1: 0.00%, G2: 38.86%, G3: 22.16%\n",
      "EarlyStopping counter: 28 out of 40\n",
      "Epoch 30, Loss: 0.060755802946816005\n",
      "Validation Loss: 0.5522669638906207, Total Accuracy: 32.10%\n",
      "Accuracy per class - G1: 0.00%, G2: 40.76%, G3: 19.46%\n",
      "EarlyStopping counter: 29 out of 40\n",
      "Epoch 31, Loss: 0.058795861810086725\n",
      "Validation Loss: 0.5488089543013346, Total Accuracy: 32.72%\n",
      "Accuracy per class - G1: 0.00%, G2: 42.65%, G3: 17.30%\n",
      "EarlyStopping counter: 30 out of 40\n",
      "Epoch 32, Loss: 0.05729506999613291\n",
      "Validation Loss: 0.5989749374843779, Total Accuracy: 31.94%\n",
      "Accuracy per class - G1: 0.00%, G2: 39.81%, G3: 21.08%\n",
      "EarlyStopping counter: 31 out of 40\n",
      "Epoch 33, Loss: 0.05735504223280642\n",
      "Validation Loss: 0.5863681545569783, Total Accuracy: 31.94%\n",
      "Accuracy per class - G1: 0.00%, G2: 40.76%, G3: 18.92%\n",
      "EarlyStopping counter: 32 out of 40\n",
      "Epoch 34, Loss: 0.053115691653037644\n",
      "Validation Loss: 0.5762163975409099, Total Accuracy: 31.17%\n",
      "Accuracy per class - G1: 0.00%, G2: 38.39%, G3: 21.62%\n",
      "EarlyStopping counter: 33 out of 40\n",
      "Epoch 35, Loss: 0.05415959548519318\n",
      "Validation Loss: 0.6005943385618073, Total Accuracy: 31.64%\n",
      "Accuracy per class - G1: 0.00%, G2: 42.18%, G3: 14.59%\n",
      "EarlyStopping counter: 34 out of 40\n",
      "Epoch 36, Loss: 0.05337912661124425\n",
      "Validation Loss: 0.5831731767171905, Total Accuracy: 32.10%\n",
      "Accuracy per class - G1: 0.00%, G2: 43.84%, G3: 12.43%\n",
      "EarlyStopping counter: 35 out of 40\n",
      "Epoch 37, Loss: 0.05067091278103461\n",
      "Validation Loss: 0.5952491040031115, Total Accuracy: 31.64%\n",
      "Accuracy per class - G1: 0.00%, G2: 43.36%, G3: 11.89%\n",
      "EarlyStopping counter: 36 out of 40\n",
      "Epoch 38, Loss: 0.048724628827837575\n",
      "Validation Loss: 0.5955319567805245, Total Accuracy: 31.79%\n",
      "Accuracy per class - G1: 0.00%, G2: 42.18%, G3: 15.14%\n",
      "EarlyStopping counter: 37 out of 40\n",
      "Epoch 39, Loss: 0.047098696074751485\n",
      "Validation Loss: 0.6368357908158075, Total Accuracy: 31.94%\n",
      "Accuracy per class - G1: 0.00%, G2: 41.47%, G3: 17.30%\n",
      "EarlyStopping counter: 38 out of 40\n",
      "Epoch 40, Loss: 0.045440651229526625\n",
      "Validation Loss: 0.6192969974307787, Total Accuracy: 32.10%\n",
      "Accuracy per class - G1: 0.00%, G2: 42.42%, G3: 15.68%\n",
      "EarlyStopping counter: 39 out of 40\n",
      "Epoch 41, Loss: 0.0447064628487969\n",
      "Validation Loss: 0.6215830104691642, Total Accuracy: 31.48%\n",
      "Accuracy per class - G1: 0.00%, G2: 43.13%, G3: 11.89%\n",
      "EarlyStopping counter: 40 out of 40\n",
      "Early stopping\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\u001b[34m\u001b[1mwandb\u001b[0m:                                                                                \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run history:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc ▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc ▁▁▁▁▁▂▂▃▄▄▅▆▆▆▆▇▇▇▇▇████████████████████\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc ▄▂▂▁▁▂▂▁▂▃▃▃▄▅▅▅▅▆▆▅▆▆▆▅▇▆▆▇▆▇█▇▇▆▇██▇▇█\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc ▁▁▂▂▃▃▄▄▅▅▅▆▆▆▆▆▇▇▇▇▇▇▇▇▇███████████████\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc ██▇▇▇▆▆▆▄▄▄▄▄▃▃▃▃▃▃▂▂▂▂▃▂▂▂▂▂▂▁▂▂▂▁▁▁▁▁▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc ▁▂▃▄▄▅▅▅▅▆▆▆▇▇▇▇▇▇▇▇▇▇▇█████████████████\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy █▆▆▅▄▄▄▃▂▂▃▃▂▂▂▂▂▂▂▁▁▁▂▂▂▁▂▁▁▁▂▁▁▁▁▁▁▁▁▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy ▁▂▂▂▃▃▄▄▅▅▅▆▆▆▆▇▇▇▇▇▇▇▇█████████████████\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss █▇▆▅▅▄▄▄▄▃▃▃▃▃▂▂▂▂▂▂▂▂▂▂▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss ▁▁▂▂▂▂▂▃▃▃▃▄▄▄▄▅▄▄▅▅▅▆▆▆▅▇▆▆▇▆▆▇▇▇▇▇▇▇██\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run summary:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc 0\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc 95.12195\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc 43.12796\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc 98.0653\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc 11.89189\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc 96.1126\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy 31.48148\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy 97.24112\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss 0.04471\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss 0.62158\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: 🚀 View run \u001b[33moptuna_run_9 microsoft/resnet-18 NOOVERSAMPLING FOCALLOS10\u001b[0m at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/csatkhqe\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: ⭐️ View project at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Synced 5 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Find logs at: \u001b[35m\u001b[1m./wandb/run-20241008_122024-csatkhqe/logs\u001b[0m\n",
      "[I 2024-10-08 12:32:16,550] Trial 9 finished with value: 0.19150850059095018 and parameters: {'learning_rate': 1.6733300241520537e-07, 'weight_decay': 1.1864327134300666e-07, 'focal_loss': 3.2786417589867143}. Best is trial 6 with value: 0.210465738327397.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Tracking run with wandb version 0.18.3\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run data is saved locally in \u001b[35m\u001b[1m/kaggle/working/wandb/run-20241008_123216-eta01sza\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run \u001b[1m`wandb offline`\u001b[0m to turn off syncing.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Syncing run \u001b[33moptuna_run_10 microsoft/resnet-18 NOOVERSAMPLING FOCALLOS11\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: ⭐️ View project at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: 🚀 View run at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/eta01sza\u001b[0m\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Epoch 1, Loss: 0.9004840664116733\n",
      "Validation Loss: 1.1532342235247295, Total Accuracy: 30.40%\n",
      "Accuracy per class - G1: 65.85%, G2: 15.64%, G3: 56.22%\n",
      "Validation loss decreased (inf --> 24.217919).  Saving model ...\n",
      "Epoch 2, Loss: 0.8993103080485241\n",
      "Validation Loss: 1.1437598381723677, Total Accuracy: 31.02%\n",
      "Accuracy per class - G1: 65.85%, G2: 16.35%, G3: 56.76%\n",
      "Validation loss decreased (24.217919 --> 24.018957).  Saving model ...\n",
      "Epoch 3, Loss: 0.8927321620734341\n",
      "Validation Loss: 1.1394632756710052, Total Accuracy: 30.56%\n",
      "Accuracy per class - G1: 60.98%, G2: 16.59%, G3: 55.68%\n",
      "Validation loss decreased (24.018957 --> 23.928729).  Saving model ...\n",
      "Epoch 4, Loss: 0.8906518206538925\n",
      "Validation Loss: 1.1342416476635706, Total Accuracy: 31.17%\n",
      "Accuracy per class - G1: 63.41%, G2: 17.30%, G3: 55.68%\n",
      "Validation loss decreased (23.928729 --> 23.819075).  Saving model ...\n",
      "Epoch 5, Loss: 0.8859287744545075\n",
      "Validation Loss: 1.17257882583709, Total Accuracy: 29.48%\n",
      "Accuracy per class - G1: 63.41%, G2: 14.93%, G3: 55.14%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 6, Loss: 0.8842314072402127\n",
      "Validation Loss: 1.173060187271663, Total Accuracy: 30.09%\n",
      "Accuracy per class - G1: 65.85%, G2: 15.88%, G3: 54.59%\n",
      "EarlyStopping counter: 2 out of 40\n",
      "Epoch 7, Loss: 0.8799756032874785\n",
      "Validation Loss: 1.1697460668427604, Total Accuracy: 29.17%\n",
      "Accuracy per class - G1: 65.85%, G2: 15.17%, G3: 52.97%\n",
      "EarlyStopping counter: 3 out of 40\n",
      "Epoch 8, Loss: 0.876512469297432\n",
      "Validation Loss: 1.1396939286163874, Total Accuracy: 32.56%\n",
      "Accuracy per class - G1: 51.22%, G2: 18.48%, G3: 60.54%\n",
      "EarlyStopping counter: 4 out of 40\n",
      "Epoch 9, Loss: 0.8723287862467478\n",
      "Validation Loss: 1.1723268713269914, Total Accuracy: 29.63%\n",
      "Accuracy per class - G1: 60.98%, G2: 14.93%, G3: 56.22%\n",
      "EarlyStopping counter: 5 out of 40\n",
      "Epoch 10, Loss: 0.8735888672162251\n",
      "Validation Loss: 1.151909968682698, Total Accuracy: 31.79%\n",
      "Accuracy per class - G1: 60.98%, G2: 16.82%, G3: 59.46%\n",
      "EarlyStopping counter: 6 out of 40\n",
      "Epoch 11, Loss: 0.8679373228406332\n",
      "Validation Loss: 1.1423727898370653, Total Accuracy: 30.40%\n",
      "Accuracy per class - G1: 58.54%, G2: 17.77%, G3: 52.97%\n",
      "EarlyStopping counter: 7 out of 40\n",
      "Epoch 12, Loss: 0.8650465945163405\n",
      "Validation Loss: 1.1673299840518407, Total Accuracy: 31.17%\n",
      "Accuracy per class - G1: 51.22%, G2: 16.11%, G3: 61.08%\n",
      "EarlyStopping counter: 8 out of 40\n",
      "Epoch 13, Loss: 0.8615910590413105\n",
      "Validation Loss: 1.171926308245886, Total Accuracy: 31.02%\n",
      "Accuracy per class - G1: 58.54%, G2: 16.35%, G3: 58.38%\n",
      "EarlyStopping counter: 9 out of 40\n",
      "Epoch 14, Loss: 0.8586830152086464\n",
      "Validation Loss: 1.1601846019426982, Total Accuracy: 31.02%\n",
      "Accuracy per class - G1: 51.22%, G2: 17.77%, G3: 56.76%\n",
      "EarlyStopping counter: 10 out of 40\n",
      "Epoch 15, Loss: 0.8564101464777107\n",
      "Validation Loss: 1.1764434746333532, Total Accuracy: 29.78%\n",
      "Accuracy per class - G1: 60.98%, G2: 16.59%, G3: 52.97%\n",
      "EarlyStopping counter: 11 out of 40\n",
      "Epoch 16, Loss: 0.8541731741054949\n",
      "Validation Loss: 1.1510742278326125, Total Accuracy: 30.40%\n",
      "Accuracy per class - G1: 43.90%, G2: 18.72%, G3: 54.05%\n",
      "EarlyStopping counter: 12 out of 40\n",
      "Epoch 17, Loss: 0.8484176404504891\n",
      "Validation Loss: 1.1964451500347681, Total Accuracy: 30.56%\n",
      "Accuracy per class - G1: 53.66%, G2: 15.40%, G3: 60.00%\n",
      "EarlyStopping counter: 13 out of 40\n",
      "Epoch 18, Loss: 0.8448261589889067\n",
      "Validation Loss: 1.1898640394210815, Total Accuracy: 29.01%\n",
      "Accuracy per class - G1: 68.29%, G2: 16.82%, G3: 48.11%\n",
      "EarlyStopping counter: 14 out of 40\n",
      "Epoch 19, Loss: 0.8427690784615206\n",
      "Validation Loss: 1.1948443906647819, Total Accuracy: 30.25%\n",
      "Accuracy per class - G1: 51.22%, G2: 15.88%, G3: 58.38%\n",
      "EarlyStopping counter: 15 out of 40\n",
      "Epoch 20, Loss: 0.8400776774050241\n",
      "Validation Loss: 1.177656346843356, Total Accuracy: 30.86%\n",
      "Accuracy per class - G1: 51.22%, G2: 17.54%, G3: 56.76%\n",
      "EarlyStopping counter: 16 out of 40\n",
      "Epoch 21, Loss: 0.8386312629803118\n",
      "Validation Loss: 1.1966230046181452, Total Accuracy: 29.94%\n",
      "Accuracy per class - G1: 51.22%, G2: 16.82%, G3: 55.14%\n",
      "EarlyStopping counter: 17 out of 40\n",
      "Epoch 22, Loss: 0.8353830927825836\n",
      "Validation Loss: 1.1794218562898182, Total Accuracy: 30.56%\n",
      "Accuracy per class - G1: 56.10%, G2: 18.96%, G3: 51.35%\n",
      "EarlyStopping counter: 18 out of 40\n",
      "Epoch 23, Loss: 0.8325035607958414\n",
      "Validation Loss: 1.1901760881855374, Total Accuracy: 30.25%\n",
      "Accuracy per class - G1: 51.22%, G2: 17.77%, G3: 54.05%\n",
      "EarlyStopping counter: 19 out of 40\n",
      "Epoch 24, Loss: 0.830083447048463\n",
      "Validation Loss: 1.1916162371635437, Total Accuracy: 31.02%\n",
      "Accuracy per class - G1: 43.90%, G2: 17.54%, G3: 58.92%\n",
      "EarlyStopping counter: 20 out of 40\n",
      "Epoch 25, Loss: 0.8253016249243036\n",
      "Validation Loss: 1.1899404468990507, Total Accuracy: 29.94%\n",
      "Accuracy per class - G1: 53.66%, G2: 18.48%, G3: 50.81%\n",
      "EarlyStopping counter: 21 out of 40\n",
      "Epoch 26, Loss: 0.8211493147424904\n",
      "Validation Loss: 1.1753150423367817, Total Accuracy: 29.63%\n",
      "Accuracy per class - G1: 43.90%, G2: 17.54%, G3: 54.05%\n",
      "EarlyStopping counter: 22 out of 40\n",
      "Epoch 27, Loss: 0.8209686509097915\n",
      "Validation Loss: 1.1878217912855602, Total Accuracy: 30.71%\n",
      "Accuracy per class - G1: 48.78%, G2: 17.54%, G3: 56.76%\n",
      "EarlyStopping counter: 23 out of 40\n",
      "Epoch 28, Loss: 0.8173465621040528\n",
      "Validation Loss: 1.1951273395901634, Total Accuracy: 31.94%\n",
      "Accuracy per class - G1: 53.66%, G2: 18.01%, G3: 58.92%\n",
      "EarlyStopping counter: 24 out of 40\n",
      "Epoch 29, Loss: 0.8171063539493515\n",
      "Validation Loss: 1.1980673926217216, Total Accuracy: 30.71%\n",
      "Accuracy per class - G1: 41.46%, G2: 17.54%, G3: 58.38%\n",
      "EarlyStopping counter: 25 out of 40\n",
      "Epoch 30, Loss: 0.8155005962015635\n",
      "Validation Loss: 1.1800885455948966, Total Accuracy: 31.17%\n",
      "Accuracy per class - G1: 41.46%, G2: 18.96%, G3: 56.76%\n",
      "EarlyStopping counter: 26 out of 40\n",
      "Epoch 31, Loss: 0.8114057104271578\n",
      "Validation Loss: 1.1947179890814281, Total Accuracy: 29.78%\n",
      "Accuracy per class - G1: 48.78%, G2: 18.25%, G3: 51.89%\n",
      "EarlyStopping counter: 27 out of 40\n",
      "Epoch 32, Loss: 0.8061099806463862\n",
      "Validation Loss: 1.2036009033521016, Total Accuracy: 31.02%\n",
      "Accuracy per class - G1: 46.34%, G2: 17.30%, G3: 58.92%\n",
      "EarlyStopping counter: 28 out of 40\n",
      "Epoch 33, Loss: 0.8032513749168579\n",
      "Validation Loss: 1.1780351897080739, Total Accuracy: 30.09%\n",
      "Accuracy per class - G1: 41.46%, G2: 19.67%, G3: 51.35%\n",
      "EarlyStopping counter: 29 out of 40\n",
      "Epoch 34, Loss: 0.8026998545750078\n",
      "Validation Loss: 1.2206414455459231, Total Accuracy: 30.25%\n",
      "Accuracy per class - G1: 48.78%, G2: 17.06%, G3: 56.22%\n",
      "EarlyStopping counter: 30 out of 40\n",
      "Epoch 35, Loss: 0.8026958933795791\n",
      "Validation Loss: 1.1632722062723977, Total Accuracy: 30.56%\n",
      "Accuracy per class - G1: 36.59%, G2: 22.27%, G3: 48.11%\n",
      "EarlyStopping counter: 31 out of 40\n",
      "Epoch 36, Loss: 0.7960500365280243\n",
      "Validation Loss: 1.2236257564453852, Total Accuracy: 30.40%\n",
      "Accuracy per class - G1: 58.54%, G2: 18.01%, G3: 52.43%\n",
      "EarlyStopping counter: 32 out of 40\n",
      "Epoch 37, Loss: 0.792102038860321\n",
      "Validation Loss: 1.1811058918635051, Total Accuracy: 30.40%\n",
      "Accuracy per class - G1: 36.59%, G2: 21.33%, G3: 49.73%\n",
      "EarlyStopping counter: 33 out of 40\n",
      "Epoch 38, Loss: 0.7908584999750896\n",
      "Validation Loss: 1.2100510540462674, Total Accuracy: 29.63%\n",
      "Accuracy per class - G1: 36.59%, G2: 18.25%, G3: 54.05%\n",
      "EarlyStopping counter: 34 out of 40\n",
      "Epoch 39, Loss: 0.7889679655971298\n",
      "Validation Loss: 1.2164829657191323, Total Accuracy: 29.94%\n",
      "Accuracy per class - G1: 48.78%, G2: 18.96%, G3: 50.81%\n",
      "EarlyStopping counter: 35 out of 40\n",
      "Epoch 40, Loss: 0.7835650508662304\n",
      "Validation Loss: 1.2182390207336062, Total Accuracy: 29.32%\n",
      "Accuracy per class - G1: 46.34%, G2: 19.19%, G3: 48.65%\n",
      "EarlyStopping counter: 36 out of 40\n",
      "Epoch 41, Loss: 0.7842041878815157\n",
      "Validation Loss: 1.2043721548148565, Total Accuracy: 29.94%\n",
      "Accuracy per class - G1: 36.59%, G2: 19.67%, G3: 51.89%\n",
      "EarlyStopping counter: 37 out of 40\n",
      "Epoch 42, Loss: 0.7778649308595312\n",
      "Validation Loss: 1.2125638113135384, Total Accuracy: 30.25%\n",
      "Accuracy per class - G1: 41.46%, G2: 18.48%, G3: 54.59%\n",
      "EarlyStopping counter: 38 out of 40\n",
      "Epoch 43, Loss: 0.7766902611916324\n",
      "Validation Loss: 1.215125438712892, Total Accuracy: 30.71%\n",
      "Accuracy per class - G1: 51.22%, G2: 19.67%, G3: 51.35%\n",
      "EarlyStopping counter: 39 out of 40\n",
      "Epoch 44, Loss: 0.7748412138008209\n",
      "Validation Loss: 1.1973739238012404, Total Accuracy: 30.86%\n",
      "Accuracy per class - G1: 36.59%, G2: 20.85%, G3: 52.43%\n",
      "EarlyStopping counter: 40 out of 40\n",
      "Early stopping\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\u001b[34m\u001b[1mwandb\u001b[0m:                                                                                \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run history:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc ▇▇▆▇▇▇▇▄▆▆▄▆▄▆▃▅█▄▄▄▄▃▅▃▄▅▂▂▄▃▄▁▆▁▁▄▃▁▂▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc ▂▁▃▂▂▄▃▃▄▄▅▄▄▅▅▅▅▅▆▆▆▆▇▆▇▇▇▇▇▇▇█▇▇██████\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc ▂▂▃▃▁▂▁▄▁▃▂▂▄▃▅▁▃▂▃▃▄▃▄▃▃▄▃▅▄▃▃█▄▇▄▅▅▆▄▇\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc ▁▁▁▁▂▁▂▂▂▂▂▃▃▃▃▃▄▄▄▄▄▄▅▅▅▅▆▆▅▆▆▆▆▇▇▇████\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc ▅▆▅▅▅▄▄█▅▇█▇▆▄▄▇▁▇▆▅▄▇▂▄▆▇▇▆▃▇▅▁▃▂▄▂▁▃▄▃\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc ▂▁▂▂▂▃▄▃▃▃▄▃▃▄▅▅▅▅▆▅▅▅▆▆▆▆▆▆▆▆▆▇▇▇▇█▇██▇\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy ▄▅▄▅▂▃▁█▂▆▅▅▅▃▄▄▁▃▅▃▃▅▃▂▄▇▄▅▃▅▃▄▄▄▂▃▂▃▃▅\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy ▂▁▂▂▂▂▃▂▃▃▃▃▃▄▄▄▄▅▅▅▅▅▅▆▆▆▆▆▆▆▆▇▇▇▇█████\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss ███▇▇▇▇▇▆▇▆▆▆▆▅▅▅▅▅▅▄▄▄▄▄▃▃▃▃▃▃▃▂▂▂▂▁▂▁▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss ▂▂▁▁▄▄▄▁▄▂▄▄▃▄▂▆▅▆▄▆▅▅▅▄▅▆▆▅▆▆█▃█▅▇▇█▆▇▆\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run summary:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc 36.58537\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc 91.46341\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc 20.85308\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc 35.9734\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc 52.43243\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc 65.14745\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy 30.8642\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy 49.35752\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss 0.77484\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss 1.19737\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: 🚀 View run \u001b[33moptuna_run_10 microsoft/resnet-18 NOOVERSAMPLING FOCALLOS11\u001b[0m at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/eta01sza\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: ⭐️ View project at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Synced 5 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Find logs at: \u001b[35m\u001b[1m./wandb/run-20241008_123216-eta01sza/logs\u001b[0m\n",
      "[I 2024-10-08 12:45:34,462] Trial 10 finished with value: 0.2812981148209461 and parameters: {'learning_rate': 1.1517105876669186e-08, 'weight_decay': 0.0008536866358920481, 'focal_loss': 0.665541498223253}. Best is trial 10 with value: 0.2812981148209461.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Tracking run with wandb version 0.18.3\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run data is saved locally in \u001b[35m\u001b[1m/kaggle/working/wandb/run-20241008_124534-i783avog\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run \u001b[1m`wandb offline`\u001b[0m to turn off syncing.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Syncing run \u001b[33moptuna_run_11 microsoft/resnet-18 NOOVERSAMPLING FOCALLOS12\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: ⭐️ View project at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: 🚀 View run at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/i783avog\u001b[0m\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Epoch 1, Loss: 0.6956173339522028\n",
      "Validation Loss: 0.800033335174833, Total Accuracy: 44.75%\n",
      "Accuracy per class - G1: 0.00%, G2: 58.06%, G3: 24.32%\n",
      "Validation loss decreased (inf --> 16.800700).  Saving model ...\n",
      "Epoch 2, Loss: 0.6933743300208126\n",
      "Validation Loss: 0.8101467915943691, Total Accuracy: 40.12%\n",
      "Accuracy per class - G1: 0.00%, G2: 56.40%, G3: 11.89%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 3, Loss: 0.6901090561625469\n",
      "Validation Loss: 0.8096718944254375, Total Accuracy: 41.05%\n",
      "Accuracy per class - G1: 0.00%, G2: 55.92%, G3: 16.22%\n",
      "EarlyStopping counter: 2 out of 40\n",
      "Epoch 4, Loss: 0.6878933978368\n",
      "Validation Loss: 0.8400867496218, Total Accuracy: 37.96%\n",
      "Accuracy per class - G1: 0.00%, G2: 51.42%, G3: 15.68%\n",
      "EarlyStopping counter: 3 out of 40\n",
      "Epoch 5, Loss: 0.6837402553443449\n",
      "Validation Loss: 0.8014080056122371, Total Accuracy: 41.82%\n",
      "Accuracy per class - G1: 0.00%, G2: 57.35%, G3: 15.68%\n",
      "EarlyStopping counter: 4 out of 40\n",
      "Epoch 6, Loss: 0.682080187711371\n",
      "Validation Loss: 0.7876152892907461, Total Accuracy: 44.14%\n",
      "Accuracy per class - G1: 0.00%, G2: 59.95%, G3: 17.84%\n",
      "Validation loss decreased (16.800700 --> 16.539921).  Saving model ...\n",
      "Epoch 7, Loss: 0.6792071325233183\n",
      "Validation Loss: 0.8234308915478843, Total Accuracy: 39.04%\n",
      "Accuracy per class - G1: 0.00%, G2: 53.08%, G3: 15.68%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 8, Loss: 0.6745737274009062\n",
      "Validation Loss: 0.8138902967884427, Total Accuracy: 41.20%\n",
      "Accuracy per class - G1: 0.00%, G2: 54.98%, G3: 18.92%\n",
      "EarlyStopping counter: 2 out of 40\n",
      "Epoch 9, Loss: 0.6726522093795868\n",
      "Validation Loss: 0.833152121021634, Total Accuracy: 39.66%\n",
      "Accuracy per class - G1: 0.00%, G2: 53.08%, G3: 17.84%\n",
      "EarlyStopping counter: 3 out of 40\n",
      "Epoch 10, Loss: 0.6693662713809185\n",
      "Validation Loss: 0.7839399590378716, Total Accuracy: 45.22%\n",
      "Accuracy per class - G1: 0.00%, G2: 62.56%, G3: 15.68%\n",
      "Validation loss decreased (16.539921 --> 16.462739).  Saving model ...\n",
      "Epoch 11, Loss: 0.6621202998850719\n",
      "Validation Loss: 0.829864963179543, Total Accuracy: 39.20%\n",
      "Accuracy per class - G1: 0.00%, G2: 54.03%, G3: 14.05%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 12, Loss: 0.6636229473424246\n",
      "Validation Loss: 0.8244249877475557, Total Accuracy: 40.28%\n",
      "Accuracy per class - G1: 0.00%, G2: 54.74%, G3: 16.22%\n",
      "EarlyStopping counter: 2 out of 40\n",
      "Epoch 13, Loss: 0.6584922893937811\n",
      "Validation Loss: 0.8278184377011799, Total Accuracy: 39.66%\n",
      "Accuracy per class - G1: 0.00%, G2: 54.27%, G3: 15.14%\n",
      "EarlyStopping counter: 3 out of 40\n",
      "Epoch 14, Loss: 0.6567162210682789\n",
      "Validation Loss: 0.7901203376906258, Total Accuracy: 44.60%\n",
      "Accuracy per class - G1: 0.00%, G2: 60.43%, G3: 18.38%\n",
      "EarlyStopping counter: 4 out of 40\n",
      "Epoch 15, Loss: 0.6549647479172213\n",
      "Validation Loss: 0.8133574397790999, Total Accuracy: 42.28%\n",
      "Accuracy per class - G1: 0.00%, G2: 57.82%, G3: 16.22%\n",
      "EarlyStopping counter: 5 out of 40\n",
      "Epoch 16, Loss: 0.6514795393828886\n",
      "Validation Loss: 0.7705699914977664, Total Accuracy: 46.30%\n",
      "Accuracy per class - G1: 0.00%, G2: 64.22%, G3: 15.68%\n",
      "Validation loss decreased (16.462739 --> 16.181970).  Saving model ...\n",
      "Epoch 17, Loss: 0.6496525909527239\n",
      "Validation Loss: 0.853183673960822, Total Accuracy: 37.50%\n",
      "Accuracy per class - G1: 0.00%, G2: 50.71%, G3: 15.68%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 18, Loss: 0.6442514198372163\n",
      "Validation Loss: 0.7955226742085957, Total Accuracy: 43.52%\n",
      "Accuracy per class - G1: 0.00%, G2: 59.95%, G3: 15.68%\n",
      "EarlyStopping counter: 2 out of 40\n",
      "Epoch 19, Loss: 0.6452508532857321\n",
      "Validation Loss: 0.8264774424689156, Total Accuracy: 41.20%\n",
      "Accuracy per class - G1: 0.00%, G2: 54.98%, G3: 18.92%\n",
      "EarlyStopping counter: 3 out of 40\n",
      "Epoch 20, Loss: 0.6421682468379837\n",
      "Validation Loss: 0.842100107953662, Total Accuracy: 39.04%\n",
      "Accuracy per class - G1: 0.00%, G2: 53.08%, G3: 15.68%\n",
      "EarlyStopping counter: 4 out of 40\n",
      "Epoch 21, Loss: 0.6381316357348339\n",
      "Validation Loss: 0.8295217369283948, Total Accuracy: 39.66%\n",
      "Accuracy per class - G1: 0.00%, G2: 53.55%, G3: 16.76%\n",
      "EarlyStopping counter: 5 out of 40\n",
      "Epoch 22, Loss: 0.6360514135245817\n",
      "Validation Loss: 0.8087937548047021, Total Accuracy: 43.06%\n",
      "Accuracy per class - G1: 0.00%, G2: 56.64%, G3: 21.62%\n",
      "EarlyStopping counter: 6 out of 40\n",
      "Epoch 23, Loss: 0.6353480708168213\n",
      "Validation Loss: 0.806801913749604, Total Accuracy: 43.06%\n",
      "Accuracy per class - G1: 0.00%, G2: 57.82%, G3: 18.92%\n",
      "EarlyStopping counter: 7 out of 40\n",
      "Epoch 24, Loss: 0.6331736488514635\n",
      "Validation Loss: 0.8148285746574402, Total Accuracy: 42.28%\n",
      "Accuracy per class - G1: 0.00%, G2: 55.45%, G3: 21.62%\n",
      "EarlyStopping counter: 8 out of 40\n",
      "Epoch 25, Loss: 0.6272441328289997\n",
      "Validation Loss: 0.8429975552218301, Total Accuracy: 39.20%\n",
      "Accuracy per class - G1: 0.00%, G2: 52.61%, G3: 17.30%\n",
      "EarlyStopping counter: 9 out of 40\n",
      "Epoch 26, Loss: 0.6243622978049589\n",
      "Validation Loss: 0.8242744789237068, Total Accuracy: 40.90%\n",
      "Accuracy per class - G1: 0.00%, G2: 54.50%, G3: 18.92%\n",
      "EarlyStopping counter: 10 out of 40\n",
      "Epoch 27, Loss: 0.6211844517523983\n",
      "Validation Loss: 0.8255958315872011, Total Accuracy: 40.43%\n",
      "Accuracy per class - G1: 0.00%, G2: 55.21%, G3: 15.68%\n",
      "EarlyStopping counter: 11 out of 40\n",
      "Epoch 28, Loss: 0.6166200767080467\n",
      "Validation Loss: 0.8243042627970377, Total Accuracy: 40.28%\n",
      "Accuracy per class - G1: 0.00%, G2: 55.45%, G3: 14.59%\n",
      "EarlyStopping counter: 12 out of 40\n",
      "Epoch 29, Loss: 0.6173367058656302\n",
      "Validation Loss: 0.8408976991971334, Total Accuracy: 38.89%\n",
      "Accuracy per class - G1: 0.00%, G2: 52.13%, G3: 17.30%\n",
      "EarlyStopping counter: 13 out of 40\n",
      "Epoch 30, Loss: 0.6114127729312483\n",
      "Validation Loss: 0.8370126812230974, Total Accuracy: 40.59%\n",
      "Accuracy per class - G1: 0.00%, G2: 53.79%, G3: 19.46%\n",
      "EarlyStopping counter: 14 out of 40\n",
      "Epoch 31, Loss: 0.6132756787610342\n",
      "Validation Loss: 0.8089311222235361, Total Accuracy: 41.82%\n",
      "Accuracy per class - G1: 0.00%, G2: 58.29%, G3: 13.51%\n",
      "EarlyStopping counter: 15 out of 40\n",
      "Epoch 32, Loss: 0.6074493534593697\n",
      "Validation Loss: 0.8433771658511389, Total Accuracy: 39.35%\n",
      "Accuracy per class - G1: 0.00%, G2: 53.32%, G3: 16.22%\n",
      "EarlyStopping counter: 16 out of 40\n",
      "Epoch 33, Loss: 0.6064652412770742\n",
      "Validation Loss: 0.8489005480493818, Total Accuracy: 39.35%\n",
      "Accuracy per class - G1: 0.00%, G2: 52.61%, G3: 17.84%\n",
      "EarlyStopping counter: 17 out of 40\n",
      "Epoch 34, Loss: 0.6035733919545828\n",
      "Validation Loss: 0.8484894292695182, Total Accuracy: 38.58%\n",
      "Accuracy per class - G1: 0.00%, G2: 52.37%, G3: 15.68%\n",
      "EarlyStopping counter: 18 out of 40\n",
      "Epoch 35, Loss: 0.601479247391942\n",
      "Validation Loss: 0.8052677568935213, Total Accuracy: 43.06%\n",
      "Accuracy per class - G1: 0.00%, G2: 58.29%, G3: 17.84%\n",
      "EarlyStopping counter: 19 out of 40\n",
      "Epoch 36, Loss: 0.5995615695614412\n",
      "Validation Loss: 0.8316946100620997, Total Accuracy: 40.74%\n",
      "Accuracy per class - G1: 0.00%, G2: 55.21%, G3: 16.76%\n",
      "EarlyStopping counter: 20 out of 40\n",
      "Epoch 37, Loss: 0.5956501242626144\n",
      "Validation Loss: 0.824464731273197, Total Accuracy: 40.12%\n",
      "Accuracy per class - G1: 0.00%, G2: 55.92%, G3: 12.97%\n",
      "EarlyStopping counter: 21 out of 40\n",
      "Epoch 38, Loss: 0.5919203679245638\n",
      "Validation Loss: 0.8521935258592878, Total Accuracy: 38.89%\n",
      "Accuracy per class - G1: 0.00%, G2: 52.61%, G3: 16.22%\n",
      "EarlyStopping counter: 22 out of 40\n",
      "Epoch 39, Loss: 0.5921282545629755\n",
      "Validation Loss: 0.8579713929267156, Total Accuracy: 39.66%\n",
      "Accuracy per class - G1: 0.00%, G2: 51.66%, G3: 21.08%\n",
      "EarlyStopping counter: 23 out of 40\n",
      "Epoch 40, Loss: 0.5884422807090254\n",
      "Validation Loss: 0.8339332200232006, Total Accuracy: 40.59%\n",
      "Accuracy per class - G1: 0.00%, G2: 53.79%, G3: 19.46%\n",
      "EarlyStopping counter: 24 out of 40\n",
      "Epoch 41, Loss: 0.5853069349225745\n",
      "Validation Loss: 0.8480830987294515, Total Accuracy: 39.51%\n",
      "Accuracy per class - G1: 0.00%, G2: 53.55%, G3: 16.22%\n",
      "EarlyStopping counter: 25 out of 40\n",
      "Epoch 42, Loss: 0.582733160041901\n",
      "Validation Loss: 0.8159508378732772, Total Accuracy: 42.59%\n",
      "Accuracy per class - G1: 0.00%, G2: 56.87%, G3: 19.46%\n",
      "EarlyStopping counter: 26 out of 40\n",
      "Epoch 43, Loss: 0.5814496598329889\n",
      "Validation Loss: 0.8558289465450105, Total Accuracy: 37.96%\n",
      "Accuracy per class - G1: 0.00%, G2: 51.42%, G3: 15.68%\n",
      "EarlyStopping counter: 27 out of 40\n",
      "Epoch 44, Loss: 0.5819436207593206\n",
      "Validation Loss: 0.8456742408729735, Total Accuracy: 39.66%\n",
      "Accuracy per class - G1: 0.00%, G2: 53.32%, G3: 17.30%\n",
      "EarlyStopping counter: 28 out of 40\n",
      "Epoch 45, Loss: 0.5780219812709165\n",
      "Validation Loss: 0.8571394114267259, Total Accuracy: 38.89%\n",
      "Accuracy per class - G1: 0.00%, G2: 53.08%, G3: 15.14%\n",
      "EarlyStopping counter: 29 out of 40\n",
      "Epoch 46, Loss: 0.5734625218144382\n",
      "Validation Loss: 0.8747358208610898, Total Accuracy: 37.96%\n",
      "Accuracy per class - G1: 0.00%, G2: 50.95%, G3: 16.76%\n",
      "EarlyStopping counter: 30 out of 40\n",
      "Epoch 47, Loss: 0.569332617952163\n",
      "Validation Loss: 0.836358463480359, Total Accuracy: 39.97%\n",
      "Accuracy per class - G1: 0.00%, G2: 55.45%, G3: 13.51%\n",
      "EarlyStopping counter: 31 out of 40\n",
      "Epoch 48, Loss: 0.5688199095697288\n",
      "Validation Loss: 0.8706192941892714, Total Accuracy: 38.43%\n",
      "Accuracy per class - G1: 0.00%, G2: 50.95%, G3: 18.38%\n",
      "EarlyStopping counter: 32 out of 40\n",
      "Epoch 49, Loss: 0.5691734125097114\n",
      "Validation Loss: 0.8871881848289853, Total Accuracy: 37.50%\n",
      "Accuracy per class - G1: 0.00%, G2: 49.53%, G3: 18.38%\n",
      "EarlyStopping counter: 33 out of 40\n",
      "Epoch 50, Loss: 0.5646650712174105\n",
      "Validation Loss: 0.8667175273100535, Total Accuracy: 37.65%\n",
      "Accuracy per class - G1: 0.00%, G2: 51.42%, G3: 14.59%\n",
      "EarlyStopping counter: 34 out of 40\n",
      "Epoch 51, Loss: 0.5616405986877809\n",
      "Validation Loss: 0.8064911918980735, Total Accuracy: 41.98%\n",
      "Accuracy per class - G1: 0.00%, G2: 58.77%, G3: 12.97%\n",
      "EarlyStopping counter: 35 out of 40\n",
      "Epoch 52, Loss: 0.5571043875562139\n",
      "Validation Loss: 0.8447785916782561, Total Accuracy: 39.66%\n",
      "Accuracy per class - G1: 0.00%, G2: 53.79%, G3: 16.22%\n",
      "EarlyStopping counter: 36 out of 40\n",
      "Epoch 53, Loss: 0.5582178256597864\n",
      "Validation Loss: 0.8436566804136548, Total Accuracy: 39.35%\n",
      "Accuracy per class - G1: 0.00%, G2: 54.03%, G3: 14.59%\n",
      "EarlyStopping counter: 37 out of 40\n",
      "Epoch 54, Loss: 0.5529645893229059\n",
      "Validation Loss: 0.849474332162312, Total Accuracy: 38.43%\n",
      "Accuracy per class - G1: 0.00%, G2: 54.27%, G3: 10.81%\n",
      "EarlyStopping counter: 38 out of 40\n",
      "Epoch 55, Loss: 0.5522545956703554\n",
      "Validation Loss: 0.8539024137315296, Total Accuracy: 39.20%\n",
      "Accuracy per class - G1: 0.00%, G2: 52.37%, G3: 17.84%\n",
      "EarlyStopping counter: 39 out of 40\n",
      "Epoch 56, Loss: 0.5515792222626238\n",
      "Validation Loss: 0.8747783161344982, Total Accuracy: 37.81%\n",
      "Accuracy per class - G1: 0.00%, G2: 50.71%, G3: 16.76%\n",
      "EarlyStopping counter: 40 out of 40\n",
      "Early stopping\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\u001b[34m\u001b[1mwandb\u001b[0m:                                                                                \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run history:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc ▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc ▁▁▁▂▁▂▂▂▂▂▃▃▄▃▄▄▄▄▄▄▅▅▅▅▅▅▆▆▆▆▆▆▇▇▇▇▆▇█▇\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc ▅▄▄▂▅▃▄▃▇▃▆▅█▂▆▃▃▄▅▄▄▂▅▃▂▄▄▂▃▅▃▃▂▄▁▅▃▃▃▂\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc ▂▁▂▂▃▃▃▃▃▄▄▄▄▄▅▅▅▅▅▅▆▅▆▆▆▆▆▇▆▇▇▇▇▇██▇███\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc █▁▃▃▃▄▃▂▃▃▃▃▃▅▃▆▅▄▅▃▄▅▂▃▄▄▄▂▃▆▃▅▃▃▄▅▂▃▃▄\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc ▁▁▁▂▂▃▃▃▃▃▃▃▄▄▄▄▄▄▄▄▅▅▆▆▅▆▆▆▆▆▇▇▇▇▇▇█▇██\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy ▇▃▄▄▆▃▇▂▃▃█▁▆▄▂▅▅▅▃▃▃▄▂▂▅▃▃▃▃▅▃▂▃▂▁▅▃▂▂▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy ▁▁▁▂▂▂▂▃▃▃▄▄▄▄▄▄▄▅▅▅▅▆▅▆▆▆▆▆▆▆▇▇▇▇▇▇████\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss ████▇▇▇▆▆▆▆▆▆▆▅▅▅▅▅▄▄▄▄▄▄▃▃▃▃▃▃▂▂▂▂▂▁▁▁▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss ▃▅▂▄▃▁▄▄▁▃▆▂▄▅▄▃▅▄▄▄▅▃▅▅▅▄▆▆▄▅▆▅▆▅█▃▅▅▅▇\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run summary:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc 0\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc 53.25203\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc 50.7109\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc 83.61548\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc 16.75676\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc 67.69437\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy 37.80864\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy 76.30385\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss 0.55158\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss 0.87478\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: 🚀 View run \u001b[33moptuna_run_11 microsoft/resnet-18 NOOVERSAMPLING FOCALLOS12\u001b[0m at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/i783avog\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: ⭐️ View project at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Synced 5 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Find logs at: \u001b[35m\u001b[1m./wandb/run-20241008_124534-i783avog/logs\u001b[0m\n",
      "[I 2024-10-08 13:02:27,603] Trial 11 finished with value: 0.24647614939429888 and parameters: {'learning_rate': 1.285688529734834e-08, 'weight_decay': 0.0007464085010189541, 'focal_loss': 0.6393824190683057}. Best is trial 10 with value: 0.2812981148209461.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Tracking run with wandb version 0.18.3\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run data is saved locally in \u001b[35m\u001b[1m/kaggle/working/wandb/run-20241008_130227-yw8wgvbm\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run \u001b[1m`wandb offline`\u001b[0m to turn off syncing.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Syncing run \u001b[33moptuna_run_12 microsoft/resnet-18 NOOVERSAMPLING FOCALLOS13\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: ⭐️ View project at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: 🚀 View run at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/yw8wgvbm\u001b[0m\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Epoch 1, Loss: 0.7540467065500925\n",
      "Validation Loss: 0.6992216152804238, Total Accuracy: 57.41%\n",
      "Accuracy per class - G1: 0.00%, G2: 88.15%, G3: 0.00%\n",
      "Validation loss decreased (inf --> 14.683654).  Saving model ...\n",
      "Epoch 2, Loss: 0.753034150744059\n",
      "Validation Loss: 0.6930195887883505, Total Accuracy: 55.86%\n",
      "Accuracy per class - G1: 0.00%, G2: 83.18%, G3: 5.95%\n",
      "Validation loss decreased (14.683654 --> 14.553411).  Saving model ...\n",
      "Epoch 3, Loss: 0.7510547350688153\n",
      "Validation Loss: 0.7000513736690793, Total Accuracy: 55.56%\n",
      "Accuracy per class - G1: 0.00%, G2: 82.46%, G3: 6.49%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 4, Loss: 0.7471979052187449\n",
      "Validation Loss: 0.702483492238181, Total Accuracy: 54.78%\n",
      "Accuracy per class - G1: 0.00%, G2: 80.57%, G3: 8.11%\n",
      "EarlyStopping counter: 2 out of 40\n",
      "Epoch 5, Loss: 0.7409369608005846\n",
      "Validation Loss: 0.69489215527262, Total Accuracy: 56.02%\n",
      "Accuracy per class - G1: 0.00%, G2: 82.23%, G3: 8.65%\n",
      "EarlyStopping counter: 3 out of 40\n",
      "Epoch 6, Loss: 0.7394753428826849\n",
      "Validation Loss: 0.7028567698739824, Total Accuracy: 55.86%\n",
      "Accuracy per class - G1: 0.00%, G2: 82.70%, G3: 7.03%\n",
      "EarlyStopping counter: 4 out of 40\n",
      "Epoch 7, Loss: 0.7361496313508734\n",
      "Validation Loss: 0.7051393645150321, Total Accuracy: 56.33%\n",
      "Accuracy per class - G1: 0.00%, G2: 84.36%, G3: 4.86%\n",
      "EarlyStopping counter: 5 out of 40\n",
      "Epoch 8, Loss: 0.7309113288500223\n",
      "Validation Loss: 0.694156459399632, Total Accuracy: 57.10%\n",
      "Accuracy per class - G1: 0.00%, G2: 85.31%, G3: 5.41%\n",
      "EarlyStopping counter: 6 out of 40\n",
      "Epoch 9, Loss: 0.728647679449564\n",
      "Validation Loss: 0.7054639657338461, Total Accuracy: 56.17%\n",
      "Accuracy per class - G1: 0.00%, G2: 83.41%, G3: 6.49%\n",
      "EarlyStopping counter: 7 out of 40\n",
      "Epoch 10, Loss: 0.7277384687619037\n",
      "Validation Loss: 0.6955737521251043, Total Accuracy: 55.09%\n",
      "Accuracy per class - G1: 0.00%, G2: 81.75%, G3: 6.49%\n",
      "EarlyStopping counter: 8 out of 40\n",
      "Epoch 11, Loss: 0.7248613611761346\n",
      "Validation Loss: 0.7048432159991491, Total Accuracy: 55.86%\n",
      "Accuracy per class - G1: 0.00%, G2: 84.12%, G3: 3.78%\n",
      "EarlyStopping counter: 9 out of 40\n",
      "Epoch 12, Loss: 0.7211088071386498\n",
      "Validation Loss: 0.7094371701989856, Total Accuracy: 54.94%\n",
      "Accuracy per class - G1: 0.00%, G2: 81.04%, G3: 7.57%\n",
      "EarlyStopping counter: 10 out of 40\n",
      "Epoch 13, Loss: 0.7144293648650847\n",
      "Validation Loss: 0.699507169780277, Total Accuracy: 56.48%\n",
      "Accuracy per class - G1: 0.00%, G2: 83.65%, G3: 7.03%\n",
      "EarlyStopping counter: 11 out of 40\n",
      "Epoch 14, Loss: 0.7177635531827627\n",
      "Validation Loss: 0.7038593263853163, Total Accuracy: 55.71%\n",
      "Accuracy per class - G1: 0.00%, G2: 82.23%, G3: 7.57%\n",
      "EarlyStopping counter: 12 out of 40\n",
      "Epoch 15, Loss: 0.7147817468068686\n",
      "Validation Loss: 0.7056425426687513, Total Accuracy: 54.48%\n",
      "Accuracy per class - G1: 0.00%, G2: 80.57%, G3: 7.03%\n",
      "EarlyStopping counter: 13 out of 40\n",
      "Epoch 16, Loss: 0.7120511187128273\n",
      "Validation Loss: 0.703983329591297, Total Accuracy: 55.71%\n",
      "Accuracy per class - G1: 0.00%, G2: 82.23%, G3: 7.57%\n",
      "EarlyStopping counter: 14 out of 40\n",
      "Epoch 17, Loss: 0.7074119631784508\n",
      "Validation Loss: 0.7034616839318049, Total Accuracy: 56.79%\n",
      "Accuracy per class - G1: 0.00%, G2: 83.41%, G3: 8.65%\n",
      "EarlyStopping counter: 15 out of 40\n",
      "Epoch 18, Loss: 0.7057525429380945\n",
      "Validation Loss: 0.7028548767169317, Total Accuracy: 56.17%\n",
      "Accuracy per class - G1: 0.00%, G2: 81.99%, G3: 9.73%\n",
      "EarlyStopping counter: 16 out of 40\n",
      "Epoch 19, Loss: 0.7000681370137686\n",
      "Validation Loss: 0.7153565798486982, Total Accuracy: 53.40%\n",
      "Accuracy per class - G1: 0.00%, G2: 79.38%, G3: 5.95%\n",
      "EarlyStopping counter: 17 out of 40\n",
      "Epoch 20, Loss: 0.6987332112817879\n",
      "Validation Loss: 0.7034275148596082, Total Accuracy: 55.09%\n",
      "Accuracy per class - G1: 0.00%, G2: 80.57%, G3: 9.19%\n",
      "EarlyStopping counter: 18 out of 40\n",
      "Epoch 21, Loss: 0.6954711560743401\n",
      "Validation Loss: 0.7080238269908088, Total Accuracy: 55.86%\n",
      "Accuracy per class - G1: 0.00%, G2: 82.70%, G3: 7.03%\n",
      "EarlyStopping counter: 19 out of 40\n",
      "Epoch 22, Loss: 0.6957516648683203\n",
      "Validation Loss: 0.7026012355373019, Total Accuracy: 54.63%\n",
      "Accuracy per class - G1: 0.00%, G2: 79.62%, G3: 9.73%\n",
      "EarlyStopping counter: 20 out of 40\n",
      "Epoch 23, Loss: 0.6868183727724007\n",
      "Validation Loss: 0.7052464996065412, Total Accuracy: 55.56%\n",
      "Accuracy per class - G1: 0.00%, G2: 82.46%, G3: 6.49%\n",
      "EarlyStopping counter: 21 out of 40\n",
      "Epoch 24, Loss: 0.6867905086781605\n",
      "Validation Loss: 0.7063699073734737, Total Accuracy: 55.56%\n",
      "Accuracy per class - G1: 0.00%, G2: 82.94%, G3: 5.41%\n",
      "EarlyStopping counter: 22 out of 40\n",
      "Epoch 25, Loss: 0.6864638946142542\n",
      "Validation Loss: 0.7066050342151097, Total Accuracy: 55.25%\n",
      "Accuracy per class - G1: 0.00%, G2: 81.28%, G3: 8.11%\n",
      "EarlyStopping counter: 23 out of 40\n",
      "Epoch 26, Loss: 0.6825453021440161\n",
      "Validation Loss: 0.7071912856329055, Total Accuracy: 55.56%\n",
      "Accuracy per class - G1: 0.00%, G2: 82.23%, G3: 7.03%\n",
      "EarlyStopping counter: 24 out of 40\n",
      "Epoch 27, Loss: 0.6801060064729437\n",
      "Validation Loss: 0.7023275714545023, Total Accuracy: 55.09%\n",
      "Accuracy per class - G1: 0.00%, G2: 81.52%, G3: 7.03%\n",
      "EarlyStopping counter: 25 out of 40\n",
      "Epoch 28, Loss: 0.6743650084518524\n",
      "Validation Loss: 0.7083523138647988, Total Accuracy: 55.25%\n",
      "Accuracy per class - G1: 0.00%, G2: 81.52%, G3: 7.57%\n",
      "EarlyStopping counter: 26 out of 40\n",
      "Epoch 29, Loss: 0.672143900250814\n",
      "Validation Loss: 0.7063926422879809, Total Accuracy: 55.40%\n",
      "Accuracy per class - G1: 0.00%, G2: 82.23%, G3: 6.49%\n",
      "EarlyStopping counter: 27 out of 40\n",
      "Epoch 30, Loss: 0.6712330213512283\n",
      "Validation Loss: 0.7123125713495981, Total Accuracy: 54.48%\n",
      "Accuracy per class - G1: 0.00%, G2: 80.57%, G3: 7.03%\n",
      "EarlyStopping counter: 28 out of 40\n",
      "Epoch 31, Loss: 0.6688562890133226\n",
      "Validation Loss: 0.7129968674409957, Total Accuracy: 53.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 78.91%, G3: 7.57%\n",
      "EarlyStopping counter: 29 out of 40\n",
      "Epoch 32, Loss: 0.6640700827161949\n",
      "Validation Loss: 0.7121682748908088, Total Accuracy: 54.78%\n",
      "Accuracy per class - G1: 0.00%, G2: 80.81%, G3: 7.57%\n",
      "EarlyStopping counter: 30 out of 40\n",
      "Epoch 33, Loss: 0.6666076599833477\n",
      "Validation Loss: 0.7162224451700846, Total Accuracy: 52.93%\n",
      "Accuracy per class - G1: 0.00%, G2: 78.91%, G3: 5.41%\n",
      "EarlyStopping counter: 31 out of 40\n",
      "Epoch 34, Loss: 0.6615287385073053\n",
      "Validation Loss: 0.7082856950305757, Total Accuracy: 54.78%\n",
      "Accuracy per class - G1: 0.00%, G2: 80.57%, G3: 8.11%\n",
      "EarlyStopping counter: 32 out of 40\n",
      "Epoch 35, Loss: 0.6597698043627911\n",
      "Validation Loss: 0.7086991000743139, Total Accuracy: 55.40%\n",
      "Accuracy per class - G1: 0.00%, G2: 80.81%, G3: 9.73%\n",
      "EarlyStopping counter: 33 out of 40\n",
      "Epoch 36, Loss: 0.6556415665580566\n",
      "Validation Loss: 0.713833654210681, Total Accuracy: 53.09%\n",
      "Accuracy per class - G1: 0.00%, G2: 77.96%, G3: 8.11%\n",
      "EarlyStopping counter: 34 out of 40\n",
      "Epoch 37, Loss: 0.6515073589531772\n",
      "Validation Loss: 0.7186669629244578, Total Accuracy: 53.40%\n",
      "Accuracy per class - G1: 0.00%, G2: 77.96%, G3: 9.19%\n",
      "EarlyStopping counter: 35 out of 40\n",
      "Epoch 38, Loss: 0.6491570049021618\n",
      "Validation Loss: 0.7129983618145898, Total Accuracy: 54.32%\n",
      "Accuracy per class - G1: 0.00%, G2: 79.86%, G3: 8.11%\n",
      "EarlyStopping counter: 36 out of 40\n",
      "Epoch 39, Loss: 0.6512781029724213\n",
      "Validation Loss: 0.7121968425455547, Total Accuracy: 54.48%\n",
      "Accuracy per class - G1: 0.00%, G2: 80.09%, G3: 8.11%\n",
      "EarlyStopping counter: 37 out of 40\n",
      "Epoch 40, Loss: 0.6459815573979573\n",
      "Validation Loss: 0.7154601429189954, Total Accuracy: 53.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 78.67%, G3: 8.11%\n",
      "EarlyStopping counter: 38 out of 40\n",
      "Epoch 41, Loss: 0.6422770533217005\n",
      "Validation Loss: 0.7214668549242473, Total Accuracy: 52.62%\n",
      "Accuracy per class - G1: 0.00%, G2: 77.49%, G3: 7.57%\n",
      "EarlyStopping counter: 39 out of 40\n",
      "Epoch 42, Loss: 0.6393573352371353\n",
      "Validation Loss: 0.7126132065341586, Total Accuracy: 54.63%\n",
      "Accuracy per class - G1: 0.00%, G2: 80.57%, G3: 7.57%\n",
      "EarlyStopping counter: 40 out of 40\n",
      "Early stopping\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\u001b[34m\u001b[1mwandb\u001b[0m:                                                                                \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run history:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc ▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc ▁▁▁▁▁▁▁▁▅▁▁▅▁▁▁▁▁▁▁▁█▁▁▁▅▅▁▅▁▁▅▁▅█▅▅▅██▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc █▅▄▃▄▄▅▆▅▄▅▃▅▄▃▄▅▄▂▃▂▄▄▃▄▃▃▄▃▂▃▂▃▃▁▁▂▂▁▃\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc ▁▁▁▂▁▂▂▂▃▄▃▄▄▃▄▄▄▄▅▅▄▆▆▆▆▅▇▆▆▇▇▇▇▇▆▇█▇██\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc ▁▅▆▇▇▆▅▅▆▆▄▆▆▆▆▆▇█▅██▆▅▇▆▆▆▆▆▆▆▅▇█▇█▇▇▇▆\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc ▁▁▂▂▁▂▁▂▃▃▃▃▃▃▃▄▃▄▅▅▄▅▅▆▅▅▆▆▅▆▇▅▇▇▇▇██▆█\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy █▆▅▄▆▆▆█▆▄▆▄▇▅▃▅▇▆▂▄▄▅▅▅▅▄▅▅▃▂▄▁▄▅▁▂▃▃▂▄\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy ▁▁▁▂▁▂▂▂▃▃▃▃▃▃▄▄▄▄▅▅▄▆▆▆▆▅▆▆▆▇▇▆▇▇▇▇█▇▇█\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss ████▇▇▇▇▆▆▆▆▆▆▆▅▅▅▅▅▄▄▄▄▄▃▃▃▃▃▃▃▂▂▂▂▂▂▁▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss ▃▁▃▄▂▄▄▁▄▂▄▅▃▄▄▄▄▄▇▄▄▄▅▅▅▄▅▅▆▆▆▇▅▅▇█▆▆▇▆\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run summary:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc 0\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc 0\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc 80.56872\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc 93.40992\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc 7.56757\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc 21.31367\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy 54.62963\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy 64.39909\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss 0.63936\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss 0.71261\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: 🚀 View run \u001b[33moptuna_run_12 microsoft/resnet-18 NOOVERSAMPLING FOCALLOS13\u001b[0m at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/yw8wgvbm\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: ⭐️ View project at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Synced 5 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Find logs at: \u001b[35m\u001b[1m./wandb/run-20241008_130227-yw8wgvbm/logs\u001b[0m\n",
      "[I 2024-10-08 13:15:20,414] Trial 12 finished with value: 0.2659320262775216 and parameters: {'learning_rate': 1.0669847176317663e-08, 'weight_decay': 0.0007813275734969627, 'focal_loss': 0.5050181799668267}. Best is trial 10 with value: 0.2812981148209461.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Tracking run with wandb version 0.18.3\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run data is saved locally in \u001b[35m\u001b[1m/kaggle/working/wandb/run-20241008_131520-apz1n4iz\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run \u001b[1m`wandb offline`\u001b[0m to turn off syncing.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Syncing run \u001b[33moptuna_run_13 microsoft/resnet-18 NOOVERSAMPLING FOCALLOS14\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: ⭐️ View project at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: 🚀 View run at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/apz1n4iz\u001b[0m\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Epoch 1, Loss: 0.7680886739707855\n",
      "Validation Loss: 0.8292468757856459, Total Accuracy: 31.48%\n",
      "Accuracy per class - G1: 0.00%, G2: 31.75%, G3: 37.84%\n",
      "Validation loss decreased (inf --> 17.414184).  Saving model ...\n",
      "Epoch 2, Loss: 0.7639284227267805\n",
      "Validation Loss: 0.8224877516428629, Total Accuracy: 32.72%\n",
      "Accuracy per class - G1: 0.00%, G2: 28.67%, G3: 49.19%\n",
      "Validation loss decreased (17.414184 --> 17.272243).  Saving model ...\n",
      "Epoch 3, Loss: 0.7625871192978089\n",
      "Validation Loss: 0.8217577338218689, Total Accuracy: 33.33%\n",
      "Accuracy per class - G1: 0.00%, G2: 30.33%, G3: 47.57%\n",
      "Validation loss decreased (17.272243 --> 17.256912).  Saving model ...\n",
      "Epoch 4, Loss: 0.7587843221354197\n",
      "Validation Loss: 0.824891726175944, Total Accuracy: 33.49%\n",
      "Accuracy per class - G1: 0.00%, G2: 29.62%, G3: 49.73%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 5, Loss: 0.7562485315713537\n",
      "Validation Loss: 0.8265811290059771, Total Accuracy: 32.56%\n",
      "Accuracy per class - G1: 0.00%, G2: 28.44%, G3: 49.19%\n",
      "EarlyStopping counter: 2 out of 40\n",
      "Epoch 6, Loss: 0.75263447287571\n",
      "Validation Loss: 0.8370225926240286, Total Accuracy: 31.33%\n",
      "Accuracy per class - G1: 0.00%, G2: 25.83%, G3: 50.81%\n",
      "EarlyStopping counter: 3 out of 40\n",
      "Epoch 7, Loss: 0.749067393412073\n",
      "Validation Loss: 0.8273227782476515, Total Accuracy: 32.56%\n",
      "Accuracy per class - G1: 0.00%, G2: 29.62%, G3: 46.49%\n",
      "EarlyStopping counter: 4 out of 40\n",
      "Epoch 8, Loss: 0.7463334418204893\n",
      "Validation Loss: 0.8289051992552621, Total Accuracy: 32.41%\n",
      "Accuracy per class - G1: 0.00%, G2: 28.91%, G3: 47.57%\n",
      "EarlyStopping counter: 5 out of 40\n",
      "Epoch 9, Loss: 0.7443532814462501\n",
      "Validation Loss: 0.8301101852030981, Total Accuracy: 31.94%\n",
      "Accuracy per class - G1: 0.00%, G2: 27.96%, G3: 48.11%\n",
      "EarlyStopping counter: 6 out of 40\n",
      "Epoch 10, Loss: 0.7401132698518684\n",
      "Validation Loss: 0.8391274000917163, Total Accuracy: 31.64%\n",
      "Accuracy per class - G1: 0.00%, G2: 28.44%, G3: 45.95%\n",
      "EarlyStopping counter: 7 out of 40\n",
      "Epoch 11, Loss: 0.7396741990583489\n",
      "Validation Loss: 0.8357042514142536, Total Accuracy: 32.10%\n",
      "Accuracy per class - G1: 0.00%, G2: 28.91%, G3: 46.49%\n",
      "EarlyStopping counter: 8 out of 40\n",
      "Epoch 12, Loss: 0.738095083150519\n",
      "Validation Loss: 0.83817458152771, Total Accuracy: 30.71%\n",
      "Accuracy per class - G1: 0.00%, G2: 26.54%, G3: 47.03%\n",
      "EarlyStopping counter: 9 out of 40\n",
      "Epoch 13, Loss: 0.7328724207648312\n",
      "Validation Loss: 0.8336252825600761, Total Accuracy: 30.71%\n",
      "Accuracy per class - G1: 0.00%, G2: 26.07%, G3: 48.11%\n",
      "EarlyStopping counter: 10 out of 40\n",
      "Epoch 14, Loss: 0.7280336402984987\n",
      "Validation Loss: 0.8376556138197581, Total Accuracy: 31.64%\n",
      "Accuracy per class - G1: 0.00%, G2: 28.91%, G3: 44.86%\n",
      "EarlyStopping counter: 11 out of 40\n",
      "Epoch 15, Loss: 0.725554059786969\n",
      "Validation Loss: 0.8382064146654946, Total Accuracy: 32.72%\n",
      "Accuracy per class - G1: 0.00%, G2: 29.15%, G3: 48.11%\n",
      "EarlyStopping counter: 12 out of 40\n",
      "Epoch 16, Loss: 0.7257563708776451\n",
      "Validation Loss: 0.844705309186663, Total Accuracy: 31.94%\n",
      "Accuracy per class - G1: 0.00%, G2: 28.91%, G3: 45.95%\n",
      "EarlyStopping counter: 13 out of 40\n",
      "Epoch 17, Loss: 0.7177334054406866\n",
      "Validation Loss: 0.8392671204748607, Total Accuracy: 31.79%\n",
      "Accuracy per class - G1: 0.00%, G2: 28.91%, G3: 45.41%\n",
      "EarlyStopping counter: 14 out of 40\n",
      "Epoch 18, Loss: 0.7173055597098477\n",
      "Validation Loss: 0.8424920099122184, Total Accuracy: 31.79%\n",
      "Accuracy per class - G1: 0.00%, G2: 27.01%, G3: 49.73%\n",
      "EarlyStopping counter: 15 out of 40\n",
      "Epoch 19, Loss: 0.7151563009583807\n",
      "Validation Loss: 0.8368408438705263, Total Accuracy: 30.56%\n",
      "Accuracy per class - G1: 0.00%, G2: 27.49%, G3: 44.32%\n",
      "EarlyStopping counter: 16 out of 40\n",
      "Epoch 20, Loss: 0.713825664606439\n",
      "Validation Loss: 0.8438257347969782, Total Accuracy: 31.17%\n",
      "Accuracy per class - G1: 0.00%, G2: 29.15%, G3: 42.70%\n",
      "EarlyStopping counter: 17 out of 40\n",
      "Epoch 21, Loss: 0.710541256220944\n",
      "Validation Loss: 0.8539365331331888, Total Accuracy: 29.78%\n",
      "Accuracy per class - G1: 0.00%, G2: 24.41%, G3: 48.65%\n",
      "EarlyStopping counter: 18 out of 40\n",
      "Epoch 22, Loss: 0.7057378665510431\n",
      "Validation Loss: 0.8499720465569269, Total Accuracy: 30.25%\n",
      "Accuracy per class - G1: 0.00%, G2: 27.01%, G3: 44.32%\n",
      "EarlyStopping counter: 19 out of 40\n",
      "Epoch 23, Loss: 0.7026573117957058\n",
      "Validation Loss: 0.8483689980847495, Total Accuracy: 32.10%\n",
      "Accuracy per class - G1: 0.00%, G2: 28.20%, G3: 48.11%\n",
      "EarlyStopping counter: 20 out of 40\n",
      "Epoch 24, Loss: 0.6988139949649214\n",
      "Validation Loss: 0.839492909965061, Total Accuracy: 31.64%\n",
      "Accuracy per class - G1: 0.00%, G2: 29.15%, G3: 44.32%\n",
      "EarlyStopping counter: 21 out of 40\n",
      "Epoch 25, Loss: 0.6979914232190833\n",
      "Validation Loss: 0.8459811324164981, Total Accuracy: 31.33%\n",
      "Accuracy per class - G1: 0.00%, G2: 28.67%, G3: 44.32%\n",
      "EarlyStopping counter: 22 out of 40\n",
      "Epoch 26, Loss: 0.6956907582570271\n",
      "Validation Loss: 0.8423012026718685, Total Accuracy: 31.33%\n",
      "Accuracy per class - G1: 0.00%, G2: 27.49%, G3: 47.03%\n",
      "EarlyStopping counter: 23 out of 40\n",
      "Epoch 27, Loss: 0.6887949188071562\n",
      "Validation Loss: 0.8466137335413978, Total Accuracy: 31.02%\n",
      "Accuracy per class - G1: 0.00%, G2: 26.78%, G3: 47.57%\n",
      "EarlyStopping counter: 24 out of 40\n",
      "Epoch 28, Loss: 0.6918587727719042\n",
      "Validation Loss: 0.8541228090013776, Total Accuracy: 31.02%\n",
      "Accuracy per class - G1: 0.00%, G2: 27.73%, G3: 45.41%\n",
      "EarlyStopping counter: 25 out of 40\n",
      "Epoch 29, Loss: 0.6840454181992864\n",
      "Validation Loss: 0.8583320038659232, Total Accuracy: 30.40%\n",
      "Accuracy per class - G1: 0.00%, G2: 25.59%, G3: 48.11%\n",
      "EarlyStopping counter: 26 out of 40\n",
      "Epoch 30, Loss: 0.6849025933139296\n",
      "Validation Loss: 0.8568325638771057, Total Accuracy: 30.71%\n",
      "Accuracy per class - G1: 0.00%, G2: 27.49%, G3: 44.86%\n",
      "EarlyStopping counter: 27 out of 40\n",
      "Epoch 31, Loss: 0.6844204211809549\n",
      "Validation Loss: 0.8520676891009012, Total Accuracy: 30.56%\n",
      "Accuracy per class - G1: 0.00%, G2: 26.54%, G3: 46.49%\n",
      "EarlyStopping counter: 28 out of 40\n",
      "Epoch 32, Loss: 0.6791861409164337\n",
      "Validation Loss: 0.8576097247146425, Total Accuracy: 30.56%\n",
      "Accuracy per class - G1: 0.00%, G2: 25.83%, G3: 48.11%\n",
      "EarlyStopping counter: 29 out of 40\n",
      "Epoch 33, Loss: 0.6762380197823766\n",
      "Validation Loss: 0.8412984339963823, Total Accuracy: 32.87%\n",
      "Accuracy per class - G1: 0.00%, G2: 31.75%, G3: 42.70%\n",
      "EarlyStopping counter: 30 out of 40\n",
      "Epoch 34, Loss: 0.6730501917471369\n",
      "Validation Loss: 0.842350518419629, Total Accuracy: 31.79%\n",
      "Accuracy per class - G1: 0.00%, G2: 32.23%, G3: 37.84%\n",
      "EarlyStopping counter: 31 out of 40\n",
      "Epoch 35, Loss: 0.6689358396702502\n",
      "Validation Loss: 0.8511969234262194, Total Accuracy: 30.40%\n",
      "Accuracy per class - G1: 0.00%, G2: 26.30%, G3: 46.49%\n",
      "EarlyStopping counter: 32 out of 40\n",
      "Epoch 36, Loss: 0.6672966728009373\n",
      "Validation Loss: 0.8547919066179366, Total Accuracy: 30.86%\n",
      "Accuracy per class - G1: 0.00%, G2: 29.62%, G3: 40.54%\n",
      "EarlyStopping counter: 33 out of 40\n",
      "Epoch 37, Loss: 0.6653816922601447\n",
      "Validation Loss: 0.8520434271721613, Total Accuracy: 31.02%\n",
      "Accuracy per class - G1: 0.00%, G2: 29.38%, G3: 41.62%\n",
      "EarlyStopping counter: 34 out of 40\n",
      "Epoch 38, Loss: 0.6650332628962505\n",
      "Validation Loss: 0.8514930719421023, Total Accuracy: 31.02%\n",
      "Accuracy per class - G1: 0.00%, G2: 30.33%, G3: 39.46%\n",
      "EarlyStopping counter: 35 out of 40\n",
      "Epoch 39, Loss: 0.6604433792183199\n",
      "Validation Loss: 0.8630903207120442, Total Accuracy: 31.17%\n",
      "Accuracy per class - G1: 0.00%, G2: 28.20%, G3: 44.86%\n",
      "EarlyStopping counter: 36 out of 40\n",
      "Epoch 40, Loss: 0.6600415742540934\n",
      "Validation Loss: 0.8637512666838509, Total Accuracy: 29.94%\n",
      "Accuracy per class - G1: 0.00%, G2: 30.33%, G3: 35.68%\n",
      "EarlyStopping counter: 37 out of 40\n",
      "Epoch 41, Loss: 0.654279052852148\n",
      "Validation Loss: 0.8647710056531996, Total Accuracy: 29.78%\n",
      "Accuracy per class - G1: 0.00%, G2: 28.67%, G3: 38.92%\n",
      "EarlyStopping counter: 38 out of 40\n",
      "Epoch 42, Loss: 0.6532267432614981\n",
      "Validation Loss: 0.8660732663813091, Total Accuracy: 30.71%\n",
      "Accuracy per class - G1: 0.00%, G2: 27.01%, G3: 45.95%\n",
      "EarlyStopping counter: 39 out of 40\n",
      "Epoch 43, Loss: 0.6520765667938324\n",
      "Validation Loss: 0.8590442339579264, Total Accuracy: 30.86%\n",
      "Accuracy per class - G1: 0.00%, G2: 27.25%, G3: 45.95%\n",
      "EarlyStopping counter: 40 out of 40\n",
      "Early stopping\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\u001b[34m\u001b[1mwandb\u001b[0m:                                                                                \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run history:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc ▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc ▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc █▅▆▆▅▂▆▅▄▅▅▃▂▅▅▅▃▄▅▁▃▄▅▅▄▃▂▄▃▂██▃▆▅▆▄▆▅▄\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc ▁▁▁▁▂▂▂▂▂▂▂▃▃▃▂▃▄▄▄▄▄▄▅▅▅▆▆▆▆▆▆▆▇▇▇▇▇███\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc ▂▇▆▇▇█▆▆▇▆▆▆▇▇▆▆▇▅▄▇▅▇▅▅▆▆▇▅▆▇▄▂▆▃▄▃▅▁▃▆\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc ▁▁▂▂▁▂▂▃▃▃▃▃▃▃▃▅▄▄▄▅▄▅▅▅▅▆▆▆▇▆▆▇▇▇▇▆▇▇▇█\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy ▄▇██▆▄▆▆▅▅▅▃▃▇▅▅▅▂▄▁▂▅▅▄▄▃▂▃▂▂▇▅▂▃▃▃▄▁▁▃\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy ▁▁▁▁▂▂▂▂▂▃▃▃▃▃▃▄▄▄▄▄▄▄▅▅▅▆▆▆▆▆▆▆▇▇▇▇▇█▇█\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss ███▇▇▇▇▇▇▆▆▆▆▅▅▅▅▅▅▅▄▄▄▄▄▃▃▃▃▃▂▂▂▂▂▂▂▁▁▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss ▂▁▁▂▂▃▂▂▂▄▃▄▃▄▅▄▄▃▅▆▆▅▄▅▄▅▇▇▆▇▄▄▆▆▆▆███▇\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run summary:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc 0\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc 0\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc 27.25118\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc 57.92019\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc 45.94595\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc 75.46917\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy 30.8642\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy 57.48299\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss 0.65208\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss 0.85904\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: 🚀 View run \u001b[33moptuna_run_13 microsoft/resnet-18 NOOVERSAMPLING FOCALLOS14\u001b[0m at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/apz1n4iz\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: ⭐️ View project at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Synced 5 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Find logs at: \u001b[35m\u001b[1m./wandb/run-20241008_131520-apz1n4iz/logs\u001b[0m\n",
      "[I 2024-10-08 13:28:18,637] Trial 13 finished with value: 0.21145234665187015 and parameters: {'learning_rate': 1.0781956760058566e-08, 'weight_decay': 1.5238270399884212e-08, 'focal_loss': 0.5602901936687703}. Best is trial 10 with value: 0.2812981148209461.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Tracking run with wandb version 0.18.3\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run data is saved locally in \u001b[35m\u001b[1m/kaggle/working/wandb/run-20241008_132819-sb3vhnx1\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run \u001b[1m`wandb offline`\u001b[0m to turn off syncing.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Syncing run \u001b[33moptuna_run_14 microsoft/resnet-18 NOOVERSAMPLING FOCALLOS15\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: ⭐️ View project at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: 🚀 View run at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/sb3vhnx1\u001b[0m\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Epoch 1, Loss: 0.7529013085078045\n",
      "Validation Loss: 0.6651018588315873, Total Accuracy: 38.89%\n",
      "Accuracy per class - G1: 51.22%, G2: 49.53%, G3: 11.89%\n",
      "Validation loss decreased (inf --> 13.967139).  Saving model ...\n",
      "Epoch 2, Loss: 0.7464151289089617\n",
      "Validation Loss: 0.6541847260225386, Total Accuracy: 40.90%\n",
      "Accuracy per class - G1: 60.98%, G2: 50.95%, G3: 13.51%\n",
      "Validation loss decreased (13.967139 --> 13.737879).  Saving model ...\n",
      "Epoch 3, Loss: 0.7340928251484791\n",
      "Validation Loss: 0.6352754008202326, Total Accuracy: 42.13%\n",
      "Accuracy per class - G1: 58.54%, G2: 52.37%, G3: 15.14%\n",
      "Validation loss decreased (13.737879 --> 13.340783).  Saving model ...\n",
      "Epoch 4, Loss: 0.7278979018510107\n",
      "Validation Loss: 0.6552557391779763, Total Accuracy: 41.98%\n",
      "Accuracy per class - G1: 68.29%, G2: 50.71%, G3: 16.22%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 5, Loss: 0.7204116798308958\n",
      "Validation Loss: 0.6368124130226317, Total Accuracy: 41.51%\n",
      "Accuracy per class - G1: 46.34%, G2: 53.08%, G3: 14.05%\n",
      "EarlyStopping counter: 2 out of 40\n",
      "Epoch 6, Loss: 0.7107629840632519\n",
      "Validation Loss: 0.63559281258356, Total Accuracy: 42.75%\n",
      "Accuracy per class - G1: 63.41%, G2: 52.13%, G3: 16.76%\n",
      "EarlyStopping counter: 3 out of 40\n",
      "Epoch 7, Loss: 0.7052430862403778\n",
      "Validation Loss: 0.6260844171047211, Total Accuracy: 43.21%\n",
      "Accuracy per class - G1: 46.34%, G2: 55.45%, G3: 14.59%\n",
      "Validation loss decreased (13.340783 --> 13.147773).  Saving model ...\n",
      "Epoch 8, Loss: 0.7008009667856148\n",
      "Validation Loss: 0.649014698607581, Total Accuracy: 41.51%\n",
      "Accuracy per class - G1: 46.34%, G2: 52.37%, G3: 15.68%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 9, Loss: 0.6934803415493793\n",
      "Validation Loss: 0.6438326282160622, Total Accuracy: 41.20%\n",
      "Accuracy per class - G1: 48.78%, G2: 52.13%, G3: 14.59%\n",
      "EarlyStopping counter: 2 out of 40\n",
      "Epoch 10, Loss: 0.6884410280779184\n",
      "Validation Loss: 0.647115965684255, Total Accuracy: 41.20%\n",
      "Accuracy per class - G1: 60.98%, G2: 49.29%, G3: 18.38%\n",
      "EarlyStopping counter: 3 out of 40\n",
      "Epoch 11, Loss: 0.6802859277610319\n",
      "Validation Loss: 0.6322413824853443, Total Accuracy: 41.98%\n",
      "Accuracy per class - G1: 53.66%, G2: 51.66%, G3: 17.30%\n",
      "EarlyStopping counter: 4 out of 40\n",
      "Epoch 12, Loss: 0.6766220302466887\n",
      "Validation Loss: 0.6446167244797661, Total Accuracy: 41.67%\n",
      "Accuracy per class - G1: 48.78%, G2: 53.55%, G3: 12.97%\n",
      "EarlyStopping counter: 5 out of 40\n",
      "Epoch 13, Loss: 0.6697378582265003\n",
      "Validation Loss: 0.6491512471721286, Total Accuracy: 39.66%\n",
      "Accuracy per class - G1: 46.34%, G2: 47.87%, G3: 19.46%\n",
      "EarlyStopping counter: 6 out of 40\n",
      "Epoch 14, Loss: 0.6633725669010576\n",
      "Validation Loss: 0.6324240324043092, Total Accuracy: 40.43%\n",
      "Accuracy per class - G1: 39.02%, G2: 49.76%, G3: 19.46%\n",
      "EarlyStopping counter: 7 out of 40\n",
      "Epoch 15, Loss: 0.6583018999501883\n",
      "Validation Loss: 0.625667983577365, Total Accuracy: 41.98%\n",
      "Accuracy per class - G1: 39.02%, G2: 52.84%, G3: 17.84%\n",
      "Validation loss decreased (13.147773 --> 13.139028).  Saving model ...\n",
      "Epoch 16, Loss: 0.6486480494579637\n",
      "Validation Loss: 0.6356731681596666, Total Accuracy: 40.59%\n",
      "Accuracy per class - G1: 41.46%, G2: 50.24%, G3: 18.38%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 17, Loss: 0.6458473672349769\n",
      "Validation Loss: 0.6389177441596985, Total Accuracy: 40.59%\n",
      "Accuracy per class - G1: 43.90%, G2: 50.00%, G3: 18.38%\n",
      "EarlyStopping counter: 2 out of 40\n",
      "Epoch 18, Loss: 0.6381595594337187\n",
      "Validation Loss: 0.633479661884762, Total Accuracy: 39.81%\n",
      "Accuracy per class - G1: 39.02%, G2: 49.05%, G3: 18.92%\n",
      "EarlyStopping counter: 3 out of 40\n",
      "Epoch 19, Loss: 0.6352481755865625\n",
      "Validation Loss: 0.6478237396194821, Total Accuracy: 39.66%\n",
      "Accuracy per class - G1: 43.90%, G2: 48.10%, G3: 19.46%\n",
      "EarlyStopping counter: 4 out of 40\n",
      "Epoch 20, Loss: 0.6281094838337726\n",
      "Validation Loss: 0.6286654202711015, Total Accuracy: 40.43%\n",
      "Accuracy per class - G1: 39.02%, G2: 50.00%, G3: 18.92%\n",
      "EarlyStopping counter: 5 out of 40\n",
      "Epoch 21, Loss: 0.6206096209675432\n",
      "Validation Loss: 0.6409628958929152, Total Accuracy: 38.89%\n",
      "Accuracy per class - G1: 39.02%, G2: 47.16%, G3: 20.00%\n",
      "EarlyStopping counter: 6 out of 40\n",
      "Epoch 22, Loss: 0.615080912070102\n",
      "Validation Loss: 0.643886848574593, Total Accuracy: 38.73%\n",
      "Accuracy per class - G1: 39.02%, G2: 45.73%, G3: 22.70%\n",
      "EarlyStopping counter: 7 out of 40\n",
      "Epoch 23, Loss: 0.6100678864013718\n",
      "Validation Loss: 0.647117623261043, Total Accuracy: 38.58%\n",
      "Accuracy per class - G1: 41.46%, G2: 46.92%, G3: 18.92%\n",
      "EarlyStopping counter: 8 out of 40\n",
      "Epoch 24, Loss: 0.6045121823448733\n",
      "Validation Loss: 0.640837577127275, Total Accuracy: 39.04%\n",
      "Accuracy per class - G1: 39.02%, G2: 48.58%, G3: 17.30%\n",
      "EarlyStopping counter: 9 out of 40\n",
      "Epoch 25, Loss: 0.6006669947899967\n",
      "Validation Loss: 0.6419573454629808, Total Accuracy: 39.35%\n",
      "Accuracy per class - G1: 39.02%, G2: 48.10%, G3: 19.46%\n",
      "EarlyStopping counter: 10 out of 40\n",
      "Epoch 26, Loss: 0.5959676701620401\n",
      "Validation Loss: 0.6186798725809369, Total Accuracy: 42.90%\n",
      "Accuracy per class - G1: 41.46%, G2: 53.55%, G3: 18.92%\n",
      "Validation loss decreased (13.139028 --> 12.992277).  Saving model ...\n",
      "Epoch 27, Loss: 0.5891808975173767\n",
      "Validation Loss: 0.6235133267584301, Total Accuracy: 41.51%\n",
      "Accuracy per class - G1: 39.02%, G2: 51.90%, G3: 18.38%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 28, Loss: 0.5815208841519184\n",
      "Validation Loss: 0.643481847785768, Total Accuracy: 40.12%\n",
      "Accuracy per class - G1: 39.02%, G2: 49.76%, G3: 18.38%\n",
      "EarlyStopping counter: 2 out of 40\n",
      "Epoch 29, Loss: 0.5775112710803388\n",
      "Validation Loss: 0.6378098186992464, Total Accuracy: 40.12%\n",
      "Accuracy per class - G1: 39.02%, G2: 48.82%, G3: 20.54%\n",
      "EarlyStopping counter: 3 out of 40\n",
      "Epoch 30, Loss: 0.5749287300081138\n",
      "Validation Loss: 0.6235192659355345, Total Accuracy: 41.67%\n",
      "Accuracy per class - G1: 29.27%, G2: 52.37%, G3: 20.00%\n",
      "EarlyStopping counter: 4 out of 40\n",
      "Epoch 31, Loss: 0.5723078322697834\n",
      "Validation Loss: 0.6443430355616978, Total Accuracy: 38.73%\n",
      "Accuracy per class - G1: 34.15%, G2: 47.63%, G3: 19.46%\n",
      "EarlyStopping counter: 5 out of 40\n",
      "Epoch 32, Loss: 0.5651335274598684\n",
      "Validation Loss: 0.6516986673786527, Total Accuracy: 38.58%\n",
      "Accuracy per class - G1: 39.02%, G2: 46.45%, G3: 20.54%\n",
      "EarlyStopping counter: 6 out of 40\n",
      "Epoch 33, Loss: 0.5598271765622748\n",
      "Validation Loss: 0.6517154063497271, Total Accuracy: 39.20%\n",
      "Accuracy per class - G1: 39.02%, G2: 45.97%, G3: 23.78%\n",
      "EarlyStopping counter: 7 out of 40\n",
      "Epoch 34, Loss: 0.5574162649102958\n",
      "Validation Loss: 0.6626998044195629, Total Accuracy: 36.27%\n",
      "Accuracy per class - G1: 41.46%, G2: 42.65%, G3: 20.54%\n",
      "EarlyStopping counter: 8 out of 40\n",
      "Epoch 35, Loss: 0.5499184853341206\n",
      "Validation Loss: 0.6606426678952717, Total Accuracy: 37.19%\n",
      "Accuracy per class - G1: 31.71%, G2: 44.55%, G3: 21.62%\n",
      "EarlyStopping counter: 9 out of 40\n",
      "Epoch 36, Loss: 0.5478186417056854\n",
      "Validation Loss: 0.6547218064467112, Total Accuracy: 39.20%\n",
      "Accuracy per class - G1: 31.71%, G2: 49.05%, G3: 18.38%\n",
      "EarlyStopping counter: 10 out of 40\n",
      "Epoch 37, Loss: 0.54205457704613\n",
      "Validation Loss: 0.6356892230964842, Total Accuracy: 41.05%\n",
      "Accuracy per class - G1: 26.83%, G2: 51.90%, G3: 19.46%\n",
      "EarlyStopping counter: 11 out of 40\n",
      "Epoch 38, Loss: 0.5373999892947185\n",
      "Validation Loss: 0.6678525649365925, Total Accuracy: 35.80%\n",
      "Accuracy per class - G1: 41.46%, G2: 40.28%, G3: 24.32%\n",
      "EarlyStopping counter: 12 out of 40\n",
      "Epoch 39, Loss: 0.5311470311808298\n",
      "Validation Loss: 0.6420708653472719, Total Accuracy: 40.12%\n",
      "Accuracy per class - G1: 34.15%, G2: 48.82%, G3: 21.62%\n",
      "EarlyStopping counter: 13 out of 40\n",
      "Epoch 40, Loss: 0.528004125658288\n",
      "Validation Loss: 0.6622819474765232, Total Accuracy: 35.96%\n",
      "Accuracy per class - G1: 26.83%, G2: 42.18%, G3: 23.78%\n",
      "EarlyStopping counter: 14 out of 40\n",
      "Epoch 41, Loss: 0.5267503315425781\n",
      "Validation Loss: 0.650201576096671, Total Accuracy: 38.58%\n",
      "Accuracy per class - G1: 26.83%, G2: 45.50%, G3: 25.41%\n",
      "EarlyStopping counter: 15 out of 40\n",
      "Epoch 42, Loss: 0.5193915399442236\n",
      "Validation Loss: 0.6558946356886909, Total Accuracy: 36.73%\n",
      "Accuracy per class - G1: 21.95%, G2: 44.31%, G3: 22.70%\n",
      "EarlyStopping counter: 16 out of 40\n",
      "Epoch 43, Loss: 0.513986739408539\n",
      "Validation Loss: 0.6373553432169414, Total Accuracy: 38.73%\n",
      "Accuracy per class - G1: 17.07%, G2: 49.29%, G3: 19.46%\n",
      "EarlyStopping counter: 17 out of 40\n",
      "Epoch 44, Loss: 0.5103785611060728\n",
      "Validation Loss: 0.6512643907751355, Total Accuracy: 37.96%\n",
      "Accuracy per class - G1: 17.07%, G2: 48.82%, G3: 17.84%\n",
      "EarlyStopping counter: 18 out of 40\n",
      "Epoch 45, Loss: 0.5072177461830967\n",
      "Validation Loss: 0.649301909265064, Total Accuracy: 38.27%\n",
      "Accuracy per class - G1: 24.39%, G2: 47.39%, G3: 20.54%\n",
      "EarlyStopping counter: 19 out of 40\n",
      "Epoch 46, Loss: 0.5037007856081768\n",
      "Validation Loss: 0.6727665166060129, Total Accuracy: 34.41%\n",
      "Accuracy per class - G1: 24.39%, G2: 41.71%, G3: 20.00%\n",
      "EarlyStopping counter: 20 out of 40\n",
      "Epoch 47, Loss: 0.49841676957635994\n",
      "Validation Loss: 0.6475618325528645, Total Accuracy: 39.51%\n",
      "Accuracy per class - G1: 21.95%, G2: 50.00%, G3: 19.46%\n",
      "EarlyStopping counter: 21 out of 40\n",
      "Epoch 48, Loss: 0.49830191142587776\n",
      "Validation Loss: 0.661760341553461, Total Accuracy: 36.73%\n",
      "Accuracy per class - G1: 26.83%, G2: 45.26%, G3: 19.46%\n",
      "EarlyStopping counter: 22 out of 40\n",
      "Epoch 49, Loss: 0.49204919819372245\n",
      "Validation Loss: 0.6469708397274926, Total Accuracy: 38.58%\n",
      "Accuracy per class - G1: 24.39%, G2: 48.10%, G3: 20.00%\n",
      "EarlyStopping counter: 23 out of 40\n",
      "Epoch 50, Loss: 0.4893551752509841\n",
      "Validation Loss: 0.6695912522929055, Total Accuracy: 36.88%\n",
      "Accuracy per class - G1: 26.83%, G2: 43.84%, G3: 23.24%\n",
      "EarlyStopping counter: 24 out of 40\n",
      "Epoch 51, Loss: 0.4828767923705549\n",
      "Validation Loss: 0.6648846736976078, Total Accuracy: 37.35%\n",
      "Accuracy per class - G1: 24.39%, G2: 46.21%, G3: 20.00%\n",
      "EarlyStopping counter: 25 out of 40\n",
      "Epoch 52, Loss: 0.48214203586061316\n",
      "Validation Loss: 0.6848726002942949, Total Accuracy: 34.10%\n",
      "Accuracy per class - G1: 26.83%, G2: 40.76%, G3: 20.54%\n",
      "EarlyStopping counter: 26 out of 40\n",
      "Epoch 53, Loss: 0.4769780818956444\n",
      "Validation Loss: 0.6597671707471212, Total Accuracy: 37.19%\n",
      "Accuracy per class - G1: 17.07%, G2: 44.79%, G3: 24.32%\n",
      "EarlyStopping counter: 27 out of 40\n",
      "Epoch 54, Loss: 0.4737558594669204\n",
      "Validation Loss: 0.6768245810554141, Total Accuracy: 35.03%\n",
      "Accuracy per class - G1: 17.07%, G2: 43.13%, G3: 20.54%\n",
      "EarlyStopping counter: 28 out of 40\n",
      "Epoch 55, Loss: 0.4686952872448657\n",
      "Validation Loss: 0.680423542147591, Total Accuracy: 34.72%\n",
      "Accuracy per class - G1: 24.39%, G2: 40.76%, G3: 23.24%\n",
      "EarlyStopping counter: 29 out of 40\n",
      "Epoch 56, Loss: 0.4652666822973504\n",
      "Validation Loss: 0.669671851964224, Total Accuracy: 35.49%\n",
      "Accuracy per class - G1: 19.51%, G2: 42.18%, G3: 23.78%\n",
      "EarlyStopping counter: 30 out of 40\n",
      "Epoch 57, Loss: 0.45857365052384064\n",
      "Validation Loss: 0.674329624289558, Total Accuracy: 35.19%\n",
      "Accuracy per class - G1: 17.07%, G2: 43.60%, G3: 20.00%\n",
      "EarlyStopping counter: 31 out of 40\n",
      "Epoch 58, Loss: 0.4601483858493437\n",
      "Validation Loss: 0.675956149895986, Total Accuracy: 34.88%\n",
      "Accuracy per class - G1: 17.07%, G2: 43.13%, G3: 20.00%\n",
      "EarlyStopping counter: 32 out of 40\n",
      "Epoch 59, Loss: 0.4556590096060052\n",
      "Validation Loss: 0.6846493482589722, Total Accuracy: 33.49%\n",
      "Accuracy per class - G1: 19.51%, G2: 40.52%, G3: 20.54%\n",
      "EarlyStopping counter: 33 out of 40\n",
      "Epoch 60, Loss: 0.45152553844164656\n",
      "Validation Loss: 0.7046427187465486, Total Accuracy: 31.48%\n",
      "Accuracy per class - G1: 17.07%, G2: 36.26%, G3: 23.78%\n",
      "EarlyStopping counter: 34 out of 40\n",
      "Epoch 61, Loss: 0.44878235567046937\n",
      "Validation Loss: 0.6948490525994983, Total Accuracy: 33.02%\n",
      "Accuracy per class - G1: 17.07%, G2: 39.81%, G3: 21.08%\n",
      "EarlyStopping counter: 35 out of 40\n",
      "Epoch 62, Loss: 0.44597612159797945\n",
      "Validation Loss: 0.6775306789647966, Total Accuracy: 34.10%\n",
      "Accuracy per class - G1: 17.07%, G2: 40.52%, G3: 23.24%\n",
      "EarlyStopping counter: 36 out of 40\n",
      "Epoch 63, Loss: 0.44292970989123887\n",
      "Validation Loss: 0.7134128851549966, Total Accuracy: 30.25%\n",
      "Accuracy per class - G1: 17.07%, G2: 35.07%, G3: 22.16%\n",
      "EarlyStopping counter: 37 out of 40\n",
      "Epoch 64, Loss: 0.43857313064207515\n",
      "Validation Loss: 0.6791403889656067, Total Accuracy: 33.80%\n",
      "Accuracy per class - G1: 17.07%, G2: 41.00%, G3: 21.08%\n",
      "EarlyStopping counter: 38 out of 40\n",
      "Epoch 65, Loss: 0.4339156068233122\n",
      "Validation Loss: 0.6816313777651105, Total Accuracy: 34.57%\n",
      "Accuracy per class - G1: 17.07%, G2: 42.65%, G3: 20.00%\n",
      "EarlyStopping counter: 39 out of 40\n",
      "Epoch 66, Loss: 0.43005229658391103\n",
      "Validation Loss: 0.6698010861873627, Total Accuracy: 36.57%\n",
      "Accuracy per class - G1: 17.07%, G2: 45.73%, G3: 20.00%\n",
      "EarlyStopping counter: 40 out of 40\n",
      "Early stopping\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\u001b[34m\u001b[1mwandb\u001b[0m:                                                                                \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run history:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc ▆█▅▅▅▅▄▄▅▅▄▄▄▄▄▃▃▄▄▃▄▂▂▂▁▂▂▂▂▂▂▁▂▁▁▁▁▁▁▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc ▁▂▁▂▂▃▄▃▄▄▄▄▅▅▅▆▅▆▅▆▆▆▇▇▇▇▇▇▇▇▇▇▇▇▇████▇\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc ▆█▇█▇▇▇█▆▇▆▇▆▆█▆█▆▅▅▇▆▄▅▅▆▆▄▅▃▄▄▄▄▃▃▃▁▃▅\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc ▁▁▁▁▂▂▂▂▂▂▃▃▃▃▃▄▄▄▄▄▄▅▅▅▅▅▆▆▆▆▆▇▇▇▇▇▇▇██\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc ▁▂▃▃▃▃▅▂▅▅▅▅▆▇▄▅▅▆▆▅█▆▆█▆▅▆▅▆▇█▆▇█▆▆█▇▇▆\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc ▁▁▁▁▁▂▂▂▂▂▃▂▃▃▃▃▄▄▄▄▄▅▅▅▅▆▅▆▆▆▆▇▇▇▇█▇███\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy ▅▇██▇▇▆▆▆▆▅▅▆█▆▅▄▄▆▇▆▄▅▄▅▅▃▆▄▄▄▃▃▃▃▂▁▂▃▄\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy ▁▁▁▁▁▂▂▂▂▂▂▂▂▂▃▃▃▃▃▄▄▄▄▅▅▆▆▆▆▆▇▇▇▇▇▇▇▇██\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss ███▇▇▇▇▆▆▆▆▅▅▅▅▅▅▄▄▄▄▄▃▃▃▃▃▃▂▂▂▂▂▂▂▂▂▁▁▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss ▄▂▂▁▃▃▄▂▁▂▃▂▃▃▃▃▁▃▁▄▅▄▂▅▃▂▄▄▃▅▆▅▇▅▇▆▇█▆▆\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run summary:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc 17.07317\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc 87.39837\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc 45.7346\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc 72.00726\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc 20\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc 71.84987\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy 36.57407\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy 73.3938\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss 0.43005\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss 0.6698\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: 🚀 View run \u001b[33moptuna_run_14 microsoft/resnet-18 NOOVERSAMPLING FOCALLOS15\u001b[0m at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/sb3vhnx1\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: ⭐️ View project at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Synced 5 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Find logs at: \u001b[35m\u001b[1m./wandb/run-20241008_132819-sb3vhnx1/logs\u001b[0m\n",
      "[I 2024-10-08 13:48:12,943] Trial 14 finished with value: 0.2673255519033561 and parameters: {'learning_rate': 1.978416506239139e-08, 'weight_decay': 0.00028905740684436083, 'focal_loss': 1.374005147833434}. Best is trial 10 with value: 0.2812981148209461.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Tracking run with wandb version 0.18.3\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run data is saved locally in \u001b[35m\u001b[1m/kaggle/working/wandb/run-20241008_134813-az6vkdig\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run \u001b[1m`wandb offline`\u001b[0m to turn off syncing.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Syncing run \u001b[33moptuna_run_15 microsoft/resnet-18 NOOVERSAMPLING FOCALLOS16\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: ⭐️ View project at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: 🚀 View run at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/az6vkdig\u001b[0m\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Epoch 1, Loss: 1.07107790406928\n",
      "Validation Loss: 1.050426184421494, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "Validation loss decreased (inf --> 22.058950).  Saving model ...\n",
      "Epoch 2, Loss: 1.0614911533263793\n",
      "Validation Loss: 0.9803218238410496, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "Validation loss decreased (22.058950 --> 20.586758).  Saving model ...\n",
      "Epoch 3, Loss: 1.0542002162301396\n",
      "Validation Loss: 0.9813807826666605, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 4, Loss: 1.0419563859342091\n",
      "Validation Loss: 0.9875008868319648, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 2 out of 40\n",
      "Epoch 5, Loss: 1.0347652320402214\n",
      "Validation Loss: 1.0079830721730278, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 3 out of 40\n",
      "Epoch 6, Loss: 1.031095636178212\n",
      "Validation Loss: 0.9995766516242709, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 4 out of 40\n",
      "Epoch 7, Loss: 1.0210876766457615\n",
      "Validation Loss: 1.0147752712170284, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 5 out of 40\n",
      "Epoch 8, Loss: 1.0138698342334793\n",
      "Validation Loss: 1.0061947405338287, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 6 out of 40\n",
      "Epoch 9, Loss: 1.0083637711513473\n",
      "Validation Loss: 1.0037863545474552, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 7 out of 40\n",
      "Epoch 10, Loss: 0.9969669989792698\n",
      "Validation Loss: 1.0227588347735859, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 8 out of 40\n",
      "Epoch 11, Loss: 0.9941514278032694\n",
      "Validation Loss: 0.9861846977756137, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 9 out of 40\n",
      "Epoch 12, Loss: 0.9858299838491233\n",
      "Validation Loss: 1.0089643015747978, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 10 out of 40\n",
      "Epoch 13, Loss: 0.980771406587348\n",
      "Validation Loss: 1.0283324863939058, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 11 out of 40\n",
      "Epoch 14, Loss: 0.974450461117618\n",
      "Validation Loss: 1.0000487963358562, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 12 out of 40\n",
      "Epoch 15, Loss: 0.9646632951426218\n",
      "Validation Loss: 0.995788166920344, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 13 out of 40\n",
      "Epoch 16, Loss: 0.9574617923024189\n",
      "Validation Loss: 1.0098692139699346, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 14 out of 40\n",
      "Epoch 17, Loss: 0.9538800199347807\n",
      "Validation Loss: 1.0041922635975338, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 15 out of 40\n",
      "Epoch 18, Loss: 0.9426674677664975\n",
      "Validation Loss: 1.027985305303619, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 16 out of 40\n",
      "Epoch 19, Loss: 0.94022542022797\n",
      "Validation Loss: 1.0332838814883005, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 17 out of 40\n",
      "Epoch 20, Loss: 0.9299470121601978\n",
      "Validation Loss: 1.0203946140550433, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 18 out of 40\n",
      "Epoch 21, Loss: 0.9273172818034529\n",
      "Validation Loss: 1.029017217102505, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 19 out of 40\n",
      "Epoch 22, Loss: 0.9175857441971101\n",
      "Validation Loss: 1.0129168743178958, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 20 out of 40\n",
      "Epoch 23, Loss: 0.9090471763208688\n",
      "Validation Loss: 1.0371098213252568, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 21 out of 40\n",
      "Epoch 24, Loss: 0.9083339787391295\n",
      "Validation Loss: 1.0381397008895874, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 22 out of 40\n",
      "Epoch 25, Loss: 0.9043881720807179\n",
      "Validation Loss: 1.0280296600290708, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 23 out of 40\n",
      "Epoch 26, Loss: 0.9000010188803615\n",
      "Validation Loss: 1.0089755597568693, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 24 out of 40\n",
      "Epoch 27, Loss: 0.8979949829090073\n",
      "Validation Loss: 1.0390627714140075, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 25 out of 40\n",
      "Epoch 28, Loss: 0.8972838944699391\n",
      "Validation Loss: 1.001322875775042, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 26 out of 40\n",
      "Epoch 29, Loss: 0.893419127148318\n",
      "Validation Loss: 1.045083273024786, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 27 out of 40\n",
      "Epoch 30, Loss: 0.8871024854211922\n",
      "Validation Loss: 1.0224765546265102, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 28 out of 40\n",
      "Epoch 31, Loss: 0.8850758765117231\n",
      "Validation Loss: 1.0525507614726113, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 29 out of 40\n",
      "Epoch 32, Loss: 0.8809706626168217\n",
      "Validation Loss: 1.0376282596871966, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 30 out of 40\n",
      "Epoch 33, Loss: 0.8785580073494509\n",
      "Validation Loss: 1.0532553589769773, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 31 out of 40\n",
      "Epoch 34, Loss: 0.8803546618984406\n",
      "Validation Loss: 1.0574065893888474, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 32 out of 40\n",
      "Epoch 35, Loss: 0.8735890395670052\n",
      "Validation Loss: 1.0538068002178556, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 33 out of 40\n",
      "Epoch 36, Loss: 0.8673812833177038\n",
      "Validation Loss: 1.0453704184009915, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 34 out of 40\n",
      "Epoch 37, Loss: 0.8645283055592732\n",
      "Validation Loss: 1.0239897625786918, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 35 out of 40\n",
      "Epoch 38, Loss: 0.862978596285165\n",
      "Validation Loss: 1.036371981104215, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 36 out of 40\n",
      "Epoch 39, Loss: 0.8593146312667663\n",
      "Validation Loss: 1.0537179566565014, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 37 out of 40\n",
      "Epoch 40, Loss: 0.8558795847088457\n",
      "Validation Loss: 1.049342196612131, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 38 out of 40\n",
      "Epoch 41, Loss: 0.8572040735239006\n",
      "Validation Loss: 1.0622675269842148, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 39 out of 40\n",
      "Epoch 42, Loss: 0.8542864602732371\n",
      "Validation Loss: 1.050508134421848, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 40 out of 40\n",
      "Early stopping\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\u001b[34m\u001b[1mwandb\u001b[0m:                                                                                \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run history:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc ▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc ▁▁▁▁▁▁▁▁▁▁▁▁▁▂▁▁▁▁▁▂▃▄▂▃▃▃▄▄▃▂▅▅▅▃▇▄▅▇█▅\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc ▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc ▂▂▂▂▂▂▂▁▂▁▃▃▃▂▃▂▃▄▃▇▃▂▂▄▂▃▃▃▃▄█▆█▄▇▄▃▃▆█\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc ▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc ▃▃▄▄▃▆▃▄▄▂▃▁▄▂█▃▇▆█▃▇▆▆█▆▃▃▆▇▆█▇▆▅▆▆▆█▆▅\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy ▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy ▁▂▂▂▂▂▁▂▂▁▂▁▂▂▄▂▃▃▃▃▅▅▃▅▄▄▄▅▅▄▇▆▇▄█▅▆▇█▆\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss ██▇▇▇▇▆▆▆▆▆▅▅▅▅▄▄▄▄▃▃▃▃▃▂▂▂▂▂▂▂▂▂▂▁▁▁▁▁▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss ▇▁▁▂▄▃▄▃▃▅▂▄▅▃▂▄▃▅▆▅▄▆▆▅▄▆▃▇▅█▆███▇▅▆█▇▇\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run summary:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc 0\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc 4.87805\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc 0\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc 0.36276\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc 100\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc 98.79357\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy 28.54938\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy 28.53364\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss 0.85429\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss 1.05051\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: 🚀 View run \u001b[33moptuna_run_15 microsoft/resnet-18 NOOVERSAMPLING FOCALLOS16\u001b[0m at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/az6vkdig\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: ⭐️ View project at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Synced 5 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Find logs at: \u001b[35m\u001b[1m./wandb/run-20241008_134813-az6vkdig/logs\u001b[0m\n",
      "[I 2024-10-08 14:00:46,129] Trial 15 finished with value: 0.1482371794871795 and parameters: {'learning_rate': 2.1644902042336422e-08, 'weight_decay': 0.00013851415229026564, 'focal_loss': 1.4401114782589497}. Best is trial 10 with value: 0.2812981148209461.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Tracking run with wandb version 0.18.3\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run data is saved locally in \u001b[35m\u001b[1m/kaggle/working/wandb/run-20241008_140046-81kvngfd\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run \u001b[1m`wandb offline`\u001b[0m to turn off syncing.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Syncing run \u001b[33moptuna_run_16 microsoft/resnet-18 NOOVERSAMPLING FOCALLOS17\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: ⭐️ View project at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: 🚀 View run at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/81kvngfd\u001b[0m\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Epoch 1, Loss: 1.1675451067556817\n",
      "Validation Loss: 1.0930242385892641, Total Accuracy: 30.56%\n",
      "Accuracy per class - G1: 0.00%, G2: 3.08%, G3: 100.00%\n",
      "Validation loss decreased (inf --> 22.953509).  Saving model ...\n",
      "Epoch 2, Loss: 1.1577202706451875\n",
      "Validation Loss: 1.098536267167046, Total Accuracy: 29.78%\n",
      "Accuracy per class - G1: 0.00%, G2: 1.90%, G3: 100.00%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 3, Loss: 1.152266771678465\n",
      "Validation Loss: 1.1213547392260461, Total Accuracy: 29.17%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.95%, G3: 100.00%\n",
      "EarlyStopping counter: 2 out of 40\n",
      "Epoch 4, Loss: 1.1442155206059834\n",
      "Validation Loss: 1.071714273166089, Total Accuracy: 30.09%\n",
      "Accuracy per class - G1: 0.00%, G2: 2.37%, G3: 100.00%\n",
      "Validation loss decreased (22.953509 --> 22.506000).  Saving model ...\n",
      "Epoch 5, Loss: 1.1365255419030247\n",
      "Validation Loss: 1.1088447521130245, Total Accuracy: 29.17%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.95%, G3: 100.00%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 6, Loss: 1.1280152883874364\n",
      "Validation Loss: 1.0879274422214145, Total Accuracy: 29.63%\n",
      "Accuracy per class - G1: 0.00%, G2: 1.66%, G3: 100.00%\n",
      "EarlyStopping counter: 2 out of 40\n",
      "Epoch 7, Loss: 1.1254741793655487\n",
      "Validation Loss: 1.1207076105333509, Total Accuracy: 29.17%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.95%, G3: 100.00%\n",
      "EarlyStopping counter: 3 out of 40\n",
      "Epoch 8, Loss: 1.1137492900871369\n",
      "Validation Loss: 1.0985413541396458, Total Accuracy: 29.48%\n",
      "Accuracy per class - G1: 0.00%, G2: 1.42%, G3: 100.00%\n",
      "EarlyStopping counter: 4 out of 40\n",
      "Epoch 9, Loss: 1.10737800813583\n",
      "Validation Loss: 1.1043296828866005, Total Accuracy: 29.17%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.95%, G3: 100.00%\n",
      "EarlyStopping counter: 5 out of 40\n",
      "Epoch 10, Loss: 1.0986269992518138\n",
      "Validation Loss: 1.1184571399575187, Total Accuracy: 29.17%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.95%, G3: 100.00%\n",
      "EarlyStopping counter: 6 out of 40\n",
      "Epoch 11, Loss: 1.0918131815381797\n",
      "Validation Loss: 1.097094095888592, Total Accuracy: 29.17%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.95%, G3: 100.00%\n",
      "EarlyStopping counter: 7 out of 40\n",
      "Epoch 12, Loss: 1.0903237928827125\n",
      "Validation Loss: 1.1246828522000993, Total Accuracy: 28.86%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.47%, G3: 100.00%\n",
      "EarlyStopping counter: 8 out of 40\n",
      "Epoch 13, Loss: 1.079349492687777\n",
      "Validation Loss: 1.1170321021761214, Total Accuracy: 28.86%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.47%, G3: 100.00%\n",
      "EarlyStopping counter: 9 out of 40\n",
      "Epoch 14, Loss: 1.0729843952569618\n",
      "Validation Loss: 1.1257043438298362, Total Accuracy: 28.86%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.47%, G3: 100.00%\n",
      "EarlyStopping counter: 10 out of 40\n",
      "Epoch 15, Loss: 1.065912629466459\n",
      "Validation Loss: 1.1508481140647615, Total Accuracy: 28.70%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.24%, G3: 100.00%\n",
      "EarlyStopping counter: 11 out of 40\n",
      "Epoch 16, Loss: 1.0600588479674007\n",
      "Validation Loss: 1.1591247554336275, Total Accuracy: 28.70%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.24%, G3: 100.00%\n",
      "EarlyStopping counter: 12 out of 40\n",
      "Epoch 17, Loss: 1.0546294989356075\n",
      "Validation Loss: 1.1207322073834283, Total Accuracy: 28.86%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.47%, G3: 100.00%\n",
      "EarlyStopping counter: 13 out of 40\n",
      "Epoch 18, Loss: 1.0472246501819198\n",
      "Validation Loss: 1.139541479803267, Total Accuracy: 28.70%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.24%, G3: 100.00%\n",
      "EarlyStopping counter: 14 out of 40\n",
      "Epoch 19, Loss: 1.0382007597440697\n",
      "Validation Loss: 1.1354321738084157, Total Accuracy: 28.86%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.47%, G3: 100.00%\n",
      "EarlyStopping counter: 15 out of 40\n",
      "Epoch 20, Loss: 1.0329225214130908\n",
      "Validation Loss: 1.1430582836979912, Total Accuracy: 28.70%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.24%, G3: 100.00%\n",
      "EarlyStopping counter: 16 out of 40\n",
      "Epoch 21, Loss: 1.0283013215984207\n",
      "Validation Loss: 1.134673848748207, Total Accuracy: 28.70%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.24%, G3: 100.00%\n",
      "EarlyStopping counter: 17 out of 40\n",
      "Epoch 22, Loss: 1.018262433718486\n",
      "Validation Loss: 1.1321750439348675, Total Accuracy: 28.70%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.24%, G3: 100.00%\n",
      "EarlyStopping counter: 18 out of 40\n",
      "Epoch 23, Loss: 1.0107448036412159\n",
      "Validation Loss: 1.1519614784490495, Total Accuracy: 28.70%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.24%, G3: 100.00%\n",
      "EarlyStopping counter: 19 out of 40\n",
      "Epoch 24, Loss: 1.0039545893669128\n",
      "Validation Loss: 1.1573695625577654, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 20 out of 40\n",
      "Epoch 25, Loss: 0.9980564756565783\n",
      "Validation Loss: 1.1692572101241065, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 21 out of 40\n",
      "Epoch 26, Loss: 0.997706278260932\n",
      "Validation Loss: 1.1742919435103734, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 22 out of 40\n",
      "Epoch 27, Loss: 0.9928889461310513\n",
      "Validation Loss: 1.1342544009288151, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 23 out of 40\n",
      "Epoch 28, Loss: 0.9886605940669416\n",
      "Validation Loss: 1.160810574179604, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 24 out of 40\n",
      "Epoch 29, Loss: 0.9862483028905937\n",
      "Validation Loss: 1.1741534840492975, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 25 out of 40\n",
      "Epoch 30, Loss: 0.9825996311314135\n",
      "Validation Loss: 1.149538632659685, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 26 out of 40\n",
      "Epoch 31, Loss: 0.9804424916405275\n",
      "Validation Loss: 1.153649437285605, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 27 out of 40\n",
      "Epoch 32, Loss: 0.976471013333424\n",
      "Validation Loss: 1.1659117475861596, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 28 out of 40\n",
      "Epoch 33, Loss: 0.9725279111460031\n",
      "Validation Loss: 1.1821845450571604, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 29 out of 40\n",
      "Epoch 34, Loss: 0.9707707374928946\n",
      "Validation Loss: 1.1815436368896848, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 30 out of 40\n",
      "Epoch 35, Loss: 0.9642362278628062\n",
      "Validation Loss: 1.1861577658426194, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 31 out of 40\n",
      "Epoch 36, Loss: 0.9654561740806303\n",
      "Validation Loss: 1.1795140100376946, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 32 out of 40\n",
      "Epoch 37, Loss: 0.9609188164573118\n",
      "Validation Loss: 1.1741615179039182, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 33 out of 40\n",
      "Epoch 38, Loss: 0.958207839224712\n",
      "Validation Loss: 1.1779575184697197, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 34 out of 40\n",
      "Epoch 39, Loss: 0.9545444623533502\n",
      "Validation Loss: 1.1543952553045183, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 35 out of 40\n",
      "Epoch 40, Loss: 0.9494151329419699\n",
      "Validation Loss: 1.161418799843107, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 36 out of 40\n",
      "Epoch 41, Loss: 0.9485546149403216\n",
      "Validation Loss: 1.1891824383111227, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 37 out of 40\n",
      "Epoch 42, Loss: 0.946553943386997\n",
      "Validation Loss: 1.1784576865888776, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 38 out of 40\n",
      "Epoch 43, Loss: 0.9429828510226974\n",
      "Validation Loss: 1.1652477092686153, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 39 out of 40\n",
      "Epoch 44, Loss: 0.9392631886953331\n",
      "Validation Loss: 1.1861356397469838, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 40 out of 40\n",
      "Early stopping\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\u001b[34m\u001b[1mwandb\u001b[0m:                                                                                \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run history:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc ▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc ▂▂▁▂▃▂▂▂▂▂▂▂▃▃▃▃▃▅▃▄▃▄▅▃▅▄▅▅▅▆▆▅▆▅▆▇█▆▇▇\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc █▅▃▆▃▅▃▄▃▃▂▂▂▂▂▂▂▂▂▂▂▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc ▄█▂▅▄▅▃▃▃▂▃▂▂▃▄▁▂▄▂▃▃▃▄▄▄▃▂▂▂▄▆▂▃▆▃▅▄▄▇▆\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc ▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc ▁▁▂▂▁▂▄▃▃▄▃▄▄▄▅▅▅▆▅▅▆▆▇▇▇▇▇▇▇▇▇▇▇█▇█▇▇▇█\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy █▅▃▆▃▅▃▄▃▃▂▂▂▂▂▂▂▂▂▂▂▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy ▁▁▁▂▂▂▃▂▂▃▃▃▃▄▄▄▄▅▄▅▅▅▆▆▆▆▆▆▆▇▇▆▆▇▇▇▇▇▇█\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss ███▇▇▇▇▆▆▆▆▅▅▅▅▅▄▄▄▄▃▃▃▃▃▃▂▂▂▂▂▂▂▂▂▁▁▁▁▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss ▂▃▄▁▃▂▄▃▃▄▄▄▄▆▆▄▅▅▅▅▆▆▇▇▅▆▇▆▆▇██▇▇▇▆▆█▇█\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run summary:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc 0\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc 20.3252\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc 0\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc 0.72551\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc 100\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc 91.9571\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy 28.54938\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy 28.26909\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss 0.93926\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss 1.18614\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: 🚀 View run \u001b[33moptuna_run_16 microsoft/resnet-18 NOOVERSAMPLING FOCALLOS17\u001b[0m at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/81kvngfd\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: ⭐️ View project at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Synced 5 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Find logs at: \u001b[35m\u001b[1m./wandb/run-20241008_140046-81kvngfd/logs\u001b[0m\n",
      "[I 2024-10-08 14:14:08,939] Trial 16 finished with value: 0.14805922368947577 and parameters: {'learning_rate': 2.0797197341699574e-08, 'weight_decay': 0.0001637845241634295, 'focal_loss': 1.1569353433462832}. Best is trial 10 with value: 0.2812981148209461.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Tracking run with wandb version 0.18.3\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run data is saved locally in \u001b[35m\u001b[1m/kaggle/working/wandb/run-20241008_141409-b8jp31o0\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run \u001b[1m`wandb offline`\u001b[0m to turn off syncing.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Syncing run \u001b[33moptuna_run_17 microsoft/resnet-18 NOOVERSAMPLING FOCALLOS18\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: ⭐️ View project at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: 🚀 View run at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/b8jp31o0\u001b[0m\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Epoch 1, Loss: 0.5738745899085539\n",
      "Validation Loss: 0.4066464574564071, Total Accuracy: 52.93%\n",
      "Accuracy per class - G1: 7.32%, G2: 43.84%, G3: 83.78%\n",
      "Validation loss decreased (inf --> 8.539576).  Saving model ...\n",
      "Epoch 2, Loss: 0.5662433734859329\n",
      "Validation Loss: 0.4246891268662044, Total Accuracy: 51.23%\n",
      "Accuracy per class - G1: 9.76%, G2: 41.71%, G3: 82.16%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 3, Loss: 0.5612872566085264\n",
      "Validation Loss: 0.4202543380005019, Total Accuracy: 52.16%\n",
      "Accuracy per class - G1: 9.76%, G2: 43.13%, G3: 82.16%\n",
      "EarlyStopping counter: 2 out of 40\n",
      "Epoch 4, Loss: 0.5536836195422943\n",
      "Validation Loss: 0.4319611174010095, Total Accuracy: 49.07%\n",
      "Accuracy per class - G1: 12.20%, G2: 38.86%, G3: 80.54%\n",
      "EarlyStopping counter: 3 out of 40\n",
      "Epoch 5, Loss: 0.5480112882263689\n",
      "Validation Loss: 0.42213788060914903, Total Accuracy: 50.00%\n",
      "Accuracy per class - G1: 14.63%, G2: 40.76%, G3: 78.92%\n",
      "EarlyStopping counter: 4 out of 40\n",
      "Epoch 6, Loss: 0.5426173910319086\n",
      "Validation Loss: 0.415565244498707, Total Accuracy: 50.31%\n",
      "Accuracy per class - G1: 7.32%, G2: 40.52%, G3: 82.16%\n",
      "EarlyStopping counter: 5 out of 40\n",
      "Epoch 7, Loss: 0.5371231382869812\n",
      "Validation Loss: 0.4311365251030241, Total Accuracy: 47.69%\n",
      "Accuracy per class - G1: 17.07%, G2: 36.97%, G3: 78.92%\n",
      "EarlyStopping counter: 6 out of 40\n",
      "Epoch 8, Loss: 0.5303440571549427\n",
      "Validation Loss: 0.4327576185266177, Total Accuracy: 48.15%\n",
      "Accuracy per class - G1: 12.20%, G2: 36.97%, G3: 81.62%\n",
      "EarlyStopping counter: 7 out of 40\n",
      "Epoch 9, Loss: 0.521705549165427\n",
      "Validation Loss: 0.43642459384032656, Total Accuracy: 47.22%\n",
      "Accuracy per class - G1: 9.76%, G2: 35.78%, G3: 81.62%\n",
      "EarlyStopping counter: 8 out of 40\n",
      "Epoch 10, Loss: 0.5178012966391552\n",
      "Validation Loss: 0.4357583082857586, Total Accuracy: 47.99%\n",
      "Accuracy per class - G1: 12.20%, G2: 37.20%, G3: 80.54%\n",
      "EarlyStopping counter: 9 out of 40\n",
      "Epoch 11, Loss: 0.5113677235252886\n",
      "Validation Loss: 0.4248254292068027, Total Accuracy: 47.38%\n",
      "Accuracy per class - G1: 17.07%, G2: 37.68%, G3: 76.22%\n",
      "EarlyStopping counter: 10 out of 40\n",
      "Epoch 12, Loss: 0.5057866045509476\n",
      "Validation Loss: 0.44434172482717604, Total Accuracy: 45.37%\n",
      "Accuracy per class - G1: 12.20%, G2: 34.12%, G3: 78.38%\n",
      "EarlyStopping counter: 11 out of 40\n",
      "Epoch 13, Loss: 0.49980223609740476\n",
      "Validation Loss: 0.4296691524130957, Total Accuracy: 47.38%\n",
      "Accuracy per class - G1: 12.20%, G2: 36.26%, G3: 80.54%\n",
      "EarlyStopping counter: 12 out of 40\n",
      "Epoch 14, Loss: 0.4961625395050968\n",
      "Validation Loss: 0.4451339982804798, Total Accuracy: 43.67%\n",
      "Accuracy per class - G1: 17.07%, G2: 31.99%, G3: 76.22%\n",
      "EarlyStopping counter: 13 out of 40\n",
      "Epoch 15, Loss: 0.49138287499726535\n",
      "Validation Loss: 0.44023950965631575, Total Accuracy: 44.29%\n",
      "Accuracy per class - G1: 12.20%, G2: 32.94%, G3: 77.30%\n",
      "EarlyStopping counter: 14 out of 40\n",
      "Epoch 16, Loss: 0.48538368832634154\n",
      "Validation Loss: 0.43098122165316627, Total Accuracy: 44.75%\n",
      "Accuracy per class - G1: 14.63%, G2: 32.70%, G3: 78.92%\n",
      "EarlyStopping counter: 15 out of 40\n",
      "Epoch 17, Loss: 0.481889930475189\n",
      "Validation Loss: 0.4466357316289629, Total Accuracy: 43.67%\n",
      "Accuracy per class - G1: 12.20%, G2: 31.04%, G3: 79.46%\n",
      "EarlyStopping counter: 16 out of 40\n",
      "Epoch 18, Loss: 0.47509196292923156\n",
      "Validation Loss: 0.43860999601227896, Total Accuracy: 42.59%\n",
      "Accuracy per class - G1: 19.51%, G2: 30.81%, G3: 74.59%\n",
      "EarlyStopping counter: 17 out of 40\n",
      "Epoch 19, Loss: 0.4746273630354778\n",
      "Validation Loss: 0.44101571540037793, Total Accuracy: 42.90%\n",
      "Accuracy per class - G1: 19.51%, G2: 30.57%, G3: 76.22%\n",
      "EarlyStopping counter: 18 out of 40\n",
      "Epoch 20, Loss: 0.46749560373375215\n",
      "Validation Loss: 0.4509512654372624, Total Accuracy: 41.20%\n",
      "Accuracy per class - G1: 17.07%, G2: 28.20%, G3: 76.22%\n",
      "EarlyStopping counter: 19 out of 40\n",
      "Epoch 21, Loss: 0.462517643190292\n",
      "Validation Loss: 0.4428732380980537, Total Accuracy: 42.75%\n",
      "Accuracy per class - G1: 12.20%, G2: 29.38%, G3: 80.00%\n",
      "EarlyStopping counter: 20 out of 40\n",
      "Epoch 22, Loss: 0.45804412357778435\n",
      "Validation Loss: 0.4498031983772914, Total Accuracy: 41.67%\n",
      "Accuracy per class - G1: 17.07%, G2: 29.15%, G3: 75.68%\n",
      "EarlyStopping counter: 21 out of 40\n",
      "Epoch 23, Loss: 0.4523943666234074\n",
      "Validation Loss: 0.4522909124692281, Total Accuracy: 41.36%\n",
      "Accuracy per class - G1: 17.07%, G2: 27.96%, G3: 77.30%\n",
      "EarlyStopping counter: 22 out of 40\n",
      "Epoch 24, Loss: 0.4529347943972392\n",
      "Validation Loss: 0.4580909176951363, Total Accuracy: 40.28%\n",
      "Accuracy per class - G1: 14.63%, G2: 26.30%, G3: 77.84%\n",
      "EarlyStopping counter: 23 out of 40\n",
      "Epoch 25, Loss: 0.45082927181060056\n",
      "Validation Loss: 0.4467447385901496, Total Accuracy: 41.20%\n",
      "Accuracy per class - G1: 17.07%, G2: 28.67%, G3: 75.14%\n",
      "EarlyStopping counter: 24 out of 40\n",
      "Epoch 26, Loss: 0.4464226544621479\n",
      "Validation Loss: 0.45091767112414044, Total Accuracy: 41.05%\n",
      "Accuracy per class - G1: 17.07%, G2: 27.73%, G3: 76.76%\n",
      "EarlyStopping counter: 25 out of 40\n",
      "Epoch 27, Loss: 0.4426718752786338\n",
      "Validation Loss: 0.45065423917202724, Total Accuracy: 41.20%\n",
      "Accuracy per class - G1: 19.51%, G2: 27.49%, G3: 77.30%\n",
      "EarlyStopping counter: 26 out of 40\n",
      "Epoch 28, Loss: 0.4446899517472968\n",
      "Validation Loss: 0.4568474115360351, Total Accuracy: 40.74%\n",
      "Accuracy per class - G1: 19.51%, G2: 26.78%, G3: 77.30%\n",
      "EarlyStopping counter: 27 out of 40\n",
      "Epoch 29, Loss: 0.4421156389885638\n",
      "Validation Loss: 0.4610173950592677, Total Accuracy: 38.73%\n",
      "Accuracy per class - G1: 19.51%, G2: 24.64%, G3: 75.14%\n",
      "EarlyStopping counter: 28 out of 40\n",
      "Epoch 30, Loss: 0.4403677306261407\n",
      "Validation Loss: 0.4731288786445345, Total Accuracy: 38.12%\n",
      "Accuracy per class - G1: 17.07%, G2: 23.93%, G3: 75.14%\n",
      "EarlyStopping counter: 29 out of 40\n",
      "Epoch 31, Loss: 0.4364622343017394\n",
      "Validation Loss: 0.4561816830010641, Total Accuracy: 39.81%\n",
      "Accuracy per class - G1: 19.51%, G2: 26.07%, G3: 75.68%\n",
      "EarlyStopping counter: 30 out of 40\n",
      "Epoch 32, Loss: 0.4340957169791302\n",
      "Validation Loss: 0.4648094049521855, Total Accuracy: 38.43%\n",
      "Accuracy per class - G1: 17.07%, G2: 23.93%, G3: 76.22%\n",
      "EarlyStopping counter: 31 out of 40\n",
      "Epoch 33, Loss: 0.43333069279969455\n",
      "Validation Loss: 0.4579668988784154, Total Accuracy: 39.04%\n",
      "Accuracy per class - G1: 19.51%, G2: 25.36%, G3: 74.59%\n",
      "EarlyStopping counter: 32 out of 40\n",
      "Epoch 34, Loss: 0.4306152042854263\n",
      "Validation Loss: 0.4648191900480361, Total Accuracy: 39.66%\n",
      "Accuracy per class - G1: 19.51%, G2: 25.83%, G3: 75.68%\n",
      "EarlyStopping counter: 33 out of 40\n",
      "Epoch 35, Loss: 0.42824499039764863\n",
      "Validation Loss: 0.4576282671519688, Total Accuracy: 38.89%\n",
      "Accuracy per class - G1: 17.07%, G2: 25.59%, G3: 74.05%\n",
      "EarlyStopping counter: 34 out of 40\n",
      "Epoch 36, Loss: 0.4268497637955539\n",
      "Validation Loss: 0.4596668503114155, Total Accuracy: 40.28%\n",
      "Accuracy per class - G1: 17.07%, G2: 26.07%, G3: 77.84%\n",
      "EarlyStopping counter: 35 out of 40\n",
      "Epoch 37, Loss: 0.4251700201666499\n",
      "Validation Loss: 0.46354542885507855, Total Accuracy: 39.04%\n",
      "Accuracy per class - G1: 12.20%, G2: 25.36%, G3: 76.22%\n",
      "EarlyStopping counter: 36 out of 40\n",
      "Epoch 38, Loss: 0.4211507683776947\n",
      "Validation Loss: 0.4607856145926884, Total Accuracy: 38.89%\n",
      "Accuracy per class - G1: 17.07%, G2: 24.41%, G3: 76.76%\n",
      "EarlyStopping counter: 37 out of 40\n",
      "Epoch 39, Loss: 0.419339450367962\n",
      "Validation Loss: 0.4526051850545974, Total Accuracy: 39.66%\n",
      "Accuracy per class - G1: 17.07%, G2: 26.30%, G3: 75.14%\n",
      "EarlyStopping counter: 38 out of 40\n",
      "Epoch 40, Loss: 0.41971438225493374\n",
      "Validation Loss: 0.481964803877331, Total Accuracy: 36.57%\n",
      "Accuracy per class - G1: 17.07%, G2: 21.33%, G3: 75.68%\n",
      "EarlyStopping counter: 39 out of 40\n",
      "Epoch 41, Loss: 0.4140602131205869\n",
      "Validation Loss: 0.4659895598888397, Total Accuracy: 37.81%\n",
      "Accuracy per class - G1: 17.07%, G2: 22.75%, G3: 76.76%\n",
      "EarlyStopping counter: 40 out of 40\n",
      "Early stopping\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\u001b[34m\u001b[1mwandb\u001b[0m:                                                                                \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run history:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc ▁▂▂▄▅▁▇▄▂▄▇▄▄▇▄▅▄██▇▄▇▇▅▇▇███▇█▇██▇▇▄▇▇▇\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc ▁▁▁▁▁▂▂▁▂▂▂▃▄▃▄▄▄▅▄▅▅▅▆▅▅▆▆▆▆▆▇▇▇▇▇▇▇███\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc █▇█▆▇▇▆▆▅▆▆▅▅▄▄▄▄▄▄▃▃▃▃▂▃▃▃▂▂▁▂▁▂▂▂▂▂▂▂▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc ▁▁▁▁▂▁▂▂▂▂▂▃▃▃▃▃▄▄▄▅▅▅▅▆▅▆▆▆▆▆▆▇▆▆▇▇▇█▇█\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc █▇▇▆▅▇▅▆▆▆▃▄▆▃▃▅▅▁▃▃▅▂▃▄▂▃▃▃▂▂▂▃▁▂▁▄▃▃▂▃\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc ▁▁▂▂▂▃▂▃▂▃▃▃▄▄▄▄▅▅▅▅▆▆▆▆▆▇▅▅▆▇▇▆▇▇▇▇▇▇██\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy █▇█▆▇▇▆▆▅▆▅▄▅▄▄▄▄▃▃▃▃▃▃▂▃▂▃▂▁▁▂▁▂▂▁▂▂▁▂▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy ▁▁▁▁▂▂▂▂▂▂▂▃▃▃▃▄▄▄▄▅▅▅▆▆▅▆▆▆▆▆▇▇▇▇▇▇▇█▇█\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss ██▇▇▇▇▆▆▆▆▅▅▅▅▄▄▄▄▄▃▃▃▃▃▃▂▂▂▂▂▂▂▂▂▂▂▁▁▁▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss ▁▃▂▄▃▂▄▄▄▄▃▅▃▅▅▄▅▄▅▆▅▆▆▆▅▆▆▆▇█▆▇▆▇▆▇▇▇▆▇\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run summary:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc 17.07317\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc 56.50407\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc 22.74882\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc 47.52116\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc 76.75676\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc 59.51743\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy 37.80864\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy 51.73847\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss 0.41406\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss 0.46599\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: 🚀 View run \u001b[33moptuna_run_17 microsoft/resnet-18 NOOVERSAMPLING FOCALLOS18\u001b[0m at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/b8jp31o0\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: ⭐️ View project at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Synced 5 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Find logs at: \u001b[35m\u001b[1m./wandb/run-20241008_141409-b8jp31o0/logs\u001b[0m\n",
      "[I 2024-10-08 14:26:34,948] Trial 17 finished with value: 0.33465094473811785 and parameters: {'learning_rate': 2.0794131179599615e-08, 'weight_decay': 3.977510983924452e-06, 'focal_loss': 2.093232505195767}. Best is trial 17 with value: 0.33465094473811785.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Tracking run with wandb version 0.18.3\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run data is saved locally in \u001b[35m\u001b[1m/kaggle/working/wandb/run-20241008_142635-dd3neewo\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run \u001b[1m`wandb offline`\u001b[0m to turn off syncing.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Syncing run \u001b[33moptuna_run_18 microsoft/resnet-18 NOOVERSAMPLING FOCALLOS19\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: ⭐️ View project at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: 🚀 View run at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/dd3neewo\u001b[0m\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Epoch 1, Loss: 1.697952168533601\n",
      "Validation Loss: 1.782981541894731, Total Accuracy: 6.33%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 0.00%\n",
      "Validation loss decreased (inf --> 37.442612).  Saving model ...\n",
      "Epoch 2, Loss: 1.6727266211107552\n",
      "Validation Loss: 1.8003468327224255, Total Accuracy: 6.33%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 0.00%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 3, Loss: 1.652877797563392\n",
      "Validation Loss: 1.7992516468678201, Total Accuracy: 6.33%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 0.00%\n",
      "EarlyStopping counter: 2 out of 40\n",
      "Epoch 4, Loss: 1.6257017534899425\n",
      "Validation Loss: 1.819059972606954, Total Accuracy: 6.33%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 0.00%\n",
      "EarlyStopping counter: 3 out of 40\n",
      "Epoch 5, Loss: 1.5987426157457283\n",
      "Validation Loss: 1.8156841721917902, Total Accuracy: 6.33%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 0.00%\n",
      "EarlyStopping counter: 4 out of 40\n",
      "Epoch 6, Loss: 1.5752039013138737\n",
      "Validation Loss: 1.8373073699573677, Total Accuracy: 6.33%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 0.00%\n",
      "EarlyStopping counter: 5 out of 40\n",
      "Epoch 7, Loss: 1.5535345939268548\n",
      "Validation Loss: 1.8324870374940692, Total Accuracy: 6.33%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 0.00%\n",
      "EarlyStopping counter: 6 out of 40\n",
      "Epoch 8, Loss: 1.5289600671055805\n",
      "Validation Loss: 1.8732485870520275, Total Accuracy: 6.33%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 0.00%\n",
      "EarlyStopping counter: 7 out of 40\n",
      "Epoch 9, Loss: 1.5030912146510849\n",
      "Validation Loss: 1.8522501804289364, Total Accuracy: 6.33%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 0.00%\n",
      "EarlyStopping counter: 8 out of 40\n",
      "Epoch 10, Loss: 1.4821144730211742\n",
      "Validation Loss: 1.868365987248364, Total Accuracy: 6.33%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 0.00%\n",
      "EarlyStopping counter: 9 out of 40\n",
      "Epoch 11, Loss: 1.461642606430743\n",
      "Validation Loss: 1.8994713954272724, Total Accuracy: 6.33%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 0.00%\n",
      "EarlyStopping counter: 10 out of 40\n",
      "Epoch 12, Loss: 1.437098577798131\n",
      "Validation Loss: 1.9000846342671485, Total Accuracy: 6.33%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 0.00%\n",
      "EarlyStopping counter: 11 out of 40\n",
      "Epoch 13, Loss: 1.415618669555848\n",
      "Validation Loss: 1.9064836324680419, Total Accuracy: 6.33%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 0.00%\n",
      "EarlyStopping counter: 12 out of 40\n",
      "Epoch 14, Loss: 1.3891894436744323\n",
      "Validation Loss: 1.9250134893116497, Total Accuracy: 6.33%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 0.00%\n",
      "EarlyStopping counter: 13 out of 40\n",
      "Epoch 15, Loss: 1.3686997330332378\n",
      "Validation Loss: 1.9677539017228853, Total Accuracy: 6.33%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 0.00%\n",
      "EarlyStopping counter: 14 out of 40\n",
      "Epoch 16, Loss: 1.3467570320669426\n",
      "Validation Loss: 1.9426247239822434, Total Accuracy: 6.33%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 0.00%\n",
      "EarlyStopping counter: 15 out of 40\n",
      "Epoch 17, Loss: 1.3242803891021084\n",
      "Validation Loss: 1.9744040877336548, Total Accuracy: 6.33%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 0.00%\n",
      "EarlyStopping counter: 16 out of 40\n",
      "Epoch 18, Loss: 1.3037108355257885\n",
      "Validation Loss: 1.9516990227358681, Total Accuracy: 6.33%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 0.00%\n",
      "EarlyStopping counter: 17 out of 40\n",
      "Epoch 19, Loss: 1.2833245604871266\n",
      "Validation Loss: 1.9474160635755176, Total Accuracy: 6.33%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 0.00%\n",
      "EarlyStopping counter: 18 out of 40\n",
      "Epoch 20, Loss: 1.2616737513657075\n",
      "Validation Loss: 1.9901167296227955, Total Accuracy: 6.33%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 0.00%\n",
      "EarlyStopping counter: 19 out of 40\n",
      "Epoch 21, Loss: 1.2417445024812077\n",
      "Validation Loss: 2.0033878144763766, Total Accuracy: 6.33%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 0.00%\n",
      "EarlyStopping counter: 20 out of 40\n",
      "Epoch 22, Loss: 1.2199336161096412\n",
      "Validation Loss: 2.0402326253908023, Total Accuracy: 6.33%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 0.00%\n",
      "EarlyStopping counter: 21 out of 40\n",
      "Epoch 23, Loss: 1.20455913945853\n",
      "Validation Loss: 2.053312083794957, Total Accuracy: 6.33%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 0.00%\n",
      "EarlyStopping counter: 22 out of 40\n",
      "Epoch 24, Loss: 1.1911177146865661\n",
      "Validation Loss: 2.002588313959894, Total Accuracy: 6.33%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 0.00%\n",
      "EarlyStopping counter: 23 out of 40\n",
      "Epoch 25, Loss: 1.184803057865924\n",
      "Validation Loss: 2.0286722644453956, Total Accuracy: 6.33%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 0.00%\n",
      "EarlyStopping counter: 24 out of 40\n",
      "Epoch 26, Loss: 1.171168177960867\n",
      "Validation Loss: 1.9983624539205007, Total Accuracy: 6.33%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 0.00%\n",
      "EarlyStopping counter: 25 out of 40\n",
      "Epoch 27, Loss: 1.1647876824241086\n",
      "Validation Loss: 2.062685883470944, Total Accuracy: 6.33%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 0.00%\n",
      "EarlyStopping counter: 26 out of 40\n",
      "Epoch 28, Loss: 1.1524459367775055\n",
      "Validation Loss: 2.0507792993670417, Total Accuracy: 6.33%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 0.00%\n",
      "EarlyStopping counter: 27 out of 40\n",
      "Epoch 29, Loss: 1.1434618299265942\n",
      "Validation Loss: 2.030456026395162, Total Accuracy: 6.33%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 0.00%\n",
      "EarlyStopping counter: 28 out of 40\n",
      "Epoch 30, Loss: 1.1335994888500995\n",
      "Validation Loss: 2.1370683631726672, Total Accuracy: 6.33%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 0.00%\n",
      "EarlyStopping counter: 29 out of 40\n",
      "Epoch 31, Loss: 1.121134151177234\n",
      "Validation Loss: 2.041316346043632, Total Accuracy: 6.33%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 0.00%\n",
      "EarlyStopping counter: 30 out of 40\n",
      "Epoch 32, Loss: 1.1114199290792626\n",
      "Validation Loss: 2.0218335567485717, Total Accuracy: 6.33%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 0.00%\n",
      "EarlyStopping counter: 31 out of 40\n",
      "Epoch 33, Loss: 1.1071190331355636\n",
      "Validation Loss: 2.111783180208433, Total Accuracy: 6.33%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 0.00%\n",
      "EarlyStopping counter: 32 out of 40\n",
      "Epoch 34, Loss: 1.0859836347131844\n",
      "Validation Loss: 2.083091896559511, Total Accuracy: 6.33%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 0.00%\n",
      "EarlyStopping counter: 33 out of 40\n",
      "Epoch 35, Loss: 1.0767863816525562\n",
      "Validation Loss: 2.0693744853848504, Total Accuracy: 6.33%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 0.00%\n",
      "EarlyStopping counter: 34 out of 40\n",
      "Epoch 36, Loss: 1.0760981986321598\n",
      "Validation Loss: 2.1344840122120723, Total Accuracy: 6.33%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 0.00%\n",
      "EarlyStopping counter: 35 out of 40\n",
      "Epoch 37, Loss: 1.0665458886020154\n",
      "Validation Loss: 2.1387847442002523, Total Accuracy: 6.33%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 0.00%\n",
      "EarlyStopping counter: 36 out of 40\n",
      "Epoch 38, Loss: 1.0555455253784916\n",
      "Validation Loss: 2.063755746398653, Total Accuracy: 6.33%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 0.00%\n",
      "EarlyStopping counter: 37 out of 40\n",
      "Epoch 39, Loss: 1.0413737376052212\n",
      "Validation Loss: 2.0538263498317626, Total Accuracy: 6.33%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 0.00%\n",
      "EarlyStopping counter: 38 out of 40\n",
      "Epoch 40, Loss: 1.0360404949590385\n",
      "Validation Loss: 2.1416597345045636, Total Accuracy: 6.33%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 0.00%\n",
      "EarlyStopping counter: 39 out of 40\n",
      "Epoch 41, Loss: 1.0250732288303146\n",
      "Validation Loss: 2.1801680546431315, Total Accuracy: 6.33%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 0.00%\n",
      "EarlyStopping counter: 40 out of 40\n",
      "Early stopping\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\u001b[34m\u001b[1mwandb\u001b[0m:                                                                                \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run history:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc ▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc █▁██████████████████████████████████████\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc ▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc ▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc ▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc ▂▂▂▂▂▁▁▂▁▁▂▂▂▂▂▂▂▂▃▄▃▃▄▄▅▄▄▅▆▇▆▆▆▇▇▇█▆▇█\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy ▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy ▂▂▂▂▂▁▁▂▁▁▂▂▂▂▂▂▂▂▃▄▃▃▄▄▅▄▄▅▆▇▆▆▆▇▇▇█▆▇█\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss ███▇▇▇▆▆▆▆▆▅▅▅▅▄▄▄▄▃▃▃▃▃▃▃▂▂▂▂▂▂▂▂▂▂▁▁▁▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss ▁▁▁▂▂▂▂▃▂▃▃▃▃▄▄▄▄▄▄▅▅▆▆▅▅▅▆▆▅▇▆▅▇▆▆▇▇▆▆█\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run summary:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc 100\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc 100\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc 0\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc 0\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc 0\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc 13.94102\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy 6.32716\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy 13.22751\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss 1.02507\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss 2.18017\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: 🚀 View run \u001b[33moptuna_run_18 microsoft/resnet-18 NOOVERSAMPLING FOCALLOS19\u001b[0m at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/dd3neewo\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: ⭐️ View project at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Synced 5 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Find logs at: \u001b[35m\u001b[1m./wandb/run-20241008_142635-dd3neewo/logs\u001b[0m\n",
      "[I 2024-10-08 14:38:58,824] Trial 18 finished with value: 0.03978651140223192 and parameters: {'learning_rate': 6.477720191258763e-08, 'weight_decay': 3.99606137854846e-06, 'focal_loss': 2.0682873931342685}. Best is trial 17 with value: 0.33465094473811785.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Tracking run with wandb version 0.18.3\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run data is saved locally in \u001b[35m\u001b[1m/kaggle/working/wandb/run-20241008_143859-tyo63s8x\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run \u001b[1m`wandb offline`\u001b[0m to turn off syncing.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Syncing run \u001b[33moptuna_run_19 microsoft/resnet-18 NOOVERSAMPLING FOCALLOS20\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: ⭐️ View project at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: 🚀 View run at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/tyo63s8x\u001b[0m\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Epoch 1, Loss: 0.3247140301279275\n",
      "Validation Loss: 0.322772517090752, Total Accuracy: 18.36%\n",
      "Accuracy per class - G1: 85.37%, G2: 18.48%, G3: 3.24%\n",
      "Validation loss decreased (inf --> 6.778223).  Saving model ...\n",
      "Epoch 2, Loss: 0.317318107887923\n",
      "Validation Loss: 0.3057577574536914, Total Accuracy: 18.21%\n",
      "Accuracy per class - G1: 82.93%, G2: 18.01%, G3: 4.32%\n",
      "Validation loss decreased (6.778223 --> 6.420913).  Saving model ...\n",
      "Epoch 3, Loss: 0.31038975500198734\n",
      "Validation Loss: 0.3012439594382331, Total Accuracy: 19.29%\n",
      "Accuracy per class - G1: 63.41%, G2: 21.80%, G3: 3.78%\n",
      "Validation loss decreased (6.420913 --> 6.326123).  Saving model ...\n",
      "Epoch 4, Loss: 0.3036983576883753\n",
      "Validation Loss: 0.31996206584430875, Total Accuracy: 16.67%\n",
      "Accuracy per class - G1: 80.49%, G2: 16.11%, G3: 3.78%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 5, Loss: 0.29949399703238383\n",
      "Validation Loss: 0.3219441469936144, Total Accuracy: 16.67%\n",
      "Accuracy per class - G1: 65.85%, G2: 17.54%, G3: 3.78%\n",
      "EarlyStopping counter: 2 out of 40\n",
      "Epoch 6, Loss: 0.29276484987103796\n",
      "Validation Loss: 0.3340274468064308, Total Accuracy: 16.67%\n",
      "Accuracy per class - G1: 73.17%, G2: 17.54%, G3: 2.16%\n",
      "EarlyStopping counter: 3 out of 40\n",
      "Epoch 7, Loss: 0.28907026081200105\n",
      "Validation Loss: 0.3242715221075785, Total Accuracy: 17.59%\n",
      "Accuracy per class - G1: 68.29%, G2: 18.48%, G3: 4.32%\n",
      "EarlyStopping counter: 4 out of 40\n",
      "Epoch 8, Loss: 0.2841620213655104\n",
      "Validation Loss: 0.33076661896137965, Total Accuracy: 16.51%\n",
      "Accuracy per class - G1: 53.66%, G2: 18.96%, G3: 2.70%\n",
      "EarlyStopping counter: 5 out of 40\n",
      "Epoch 9, Loss: 0.27865175651498586\n",
      "Validation Loss: 0.3232367042274702, Total Accuracy: 17.13%\n",
      "Accuracy per class - G1: 56.10%, G2: 19.67%, G3: 2.70%\n",
      "EarlyStopping counter: 6 out of 40\n",
      "Epoch 10, Loss: 0.27511240649654206\n",
      "Validation Loss: 0.32632061324658845, Total Accuracy: 16.51%\n",
      "Accuracy per class - G1: 51.22%, G2: 19.91%, G3: 1.08%\n",
      "EarlyStopping counter: 7 out of 40\n",
      "Epoch 11, Loss: 0.27157744334404726\n",
      "Validation Loss: 0.3288592667806716, Total Accuracy: 16.82%\n",
      "Accuracy per class - G1: 48.78%, G2: 20.14%, G3: 2.16%\n",
      "EarlyStopping counter: 8 out of 40\n",
      "Epoch 12, Loss: 0.26533647743334254\n",
      "Validation Loss: 0.3319220943819909, Total Accuracy: 16.82%\n",
      "Accuracy per class - G1: 48.78%, G2: 20.62%, G3: 1.08%\n",
      "EarlyStopping counter: 9 out of 40\n",
      "Epoch 13, Loss: 0.2618099804743227\n",
      "Validation Loss: 0.3359010407612437, Total Accuracy: 16.98%\n",
      "Accuracy per class - G1: 51.22%, G2: 20.14%, G3: 2.16%\n",
      "EarlyStopping counter: 10 out of 40\n",
      "Epoch 14, Loss: 0.25693557797426203\n",
      "Validation Loss: 0.3308096205194791, Total Accuracy: 17.44%\n",
      "Accuracy per class - G1: 53.66%, G2: 21.09%, G3: 1.08%\n",
      "EarlyStopping counter: 11 out of 40\n",
      "Epoch 15, Loss: 0.251541612378086\n",
      "Validation Loss: 0.33634480745309875, Total Accuracy: 17.44%\n",
      "Accuracy per class - G1: 46.34%, G2: 21.33%, G3: 2.16%\n",
      "EarlyStopping counter: 12 out of 40\n",
      "Epoch 16, Loss: 0.249357085271054\n",
      "Validation Loss: 0.34896770403498695, Total Accuracy: 17.44%\n",
      "Accuracy per class - G1: 48.78%, G2: 20.85%, G3: 2.70%\n",
      "EarlyStopping counter: 13 out of 40\n",
      "Epoch 17, Loss: 0.2442338807755206\n",
      "Validation Loss: 0.3633640137101923, Total Accuracy: 17.13%\n",
      "Accuracy per class - G1: 51.22%, G2: 20.38%, G3: 2.16%\n",
      "EarlyStopping counter: 14 out of 40\n",
      "Epoch 18, Loss: 0.24043399257114134\n",
      "Validation Loss: 0.34576005346718286, Total Accuracy: 17.13%\n",
      "Accuracy per class - G1: 43.90%, G2: 21.56%, G3: 1.08%\n",
      "EarlyStopping counter: 15 out of 40\n",
      "Epoch 19, Loss: 0.23650733444346003\n",
      "Validation Loss: 0.3522289203745978, Total Accuracy: 16.67%\n",
      "Accuracy per class - G1: 41.46%, G2: 20.62%, G3: 2.16%\n",
      "EarlyStopping counter: 16 out of 40\n",
      "Epoch 20, Loss: 0.23253569904580174\n",
      "Validation Loss: 0.36155529213803156, Total Accuracy: 17.13%\n",
      "Accuracy per class - G1: 43.90%, G2: 21.56%, G3: 1.08%\n",
      "EarlyStopping counter: 17 out of 40\n",
      "Epoch 21, Loss: 0.22969718941723008\n",
      "Validation Loss: 0.3535957552847408, Total Accuracy: 17.59%\n",
      "Accuracy per class - G1: 39.02%, G2: 22.75%, G3: 1.08%\n",
      "EarlyStopping counter: 18 out of 40\n",
      "Epoch 22, Loss: 0.22468870429389448\n",
      "Validation Loss: 0.35737021622203646, Total Accuracy: 16.98%\n",
      "Accuracy per class - G1: 43.90%, G2: 20.85%, G3: 2.16%\n",
      "EarlyStopping counter: 19 out of 40\n",
      "Epoch 23, Loss: 0.22205017848187183\n",
      "Validation Loss: 0.3517725854402497, Total Accuracy: 17.90%\n",
      "Accuracy per class - G1: 43.90%, G2: 22.75%, G3: 1.08%\n",
      "EarlyStopping counter: 20 out of 40\n",
      "Epoch 24, Loss: 0.21792694423572126\n",
      "Validation Loss: 0.36243890545197893, Total Accuracy: 16.67%\n",
      "Accuracy per class - G1: 39.02%, G2: 21.33%, G3: 1.08%\n",
      "EarlyStopping counter: 21 out of 40\n",
      "Epoch 25, Loss: 0.21650667829685902\n",
      "Validation Loss: 0.35307094969210173, Total Accuracy: 18.52%\n",
      "Accuracy per class - G1: 36.59%, G2: 24.41%, G3: 1.08%\n",
      "EarlyStopping counter: 22 out of 40\n",
      "Epoch 26, Loss: 0.21698288350220185\n",
      "Validation Loss: 0.3598401692828962, Total Accuracy: 18.21%\n",
      "Accuracy per class - G1: 39.02%, G2: 23.46%, G3: 1.62%\n",
      "EarlyStopping counter: 23 out of 40\n",
      "Epoch 27, Loss: 0.21452459028686385\n",
      "Validation Loss: 0.3782203169096084, Total Accuracy: 18.36%\n",
      "Accuracy per class - G1: 43.90%, G2: 23.22%, G3: 1.62%\n",
      "EarlyStopping counter: 24 out of 40\n",
      "Epoch 28, Loss: 0.20959786083324847\n",
      "Validation Loss: 0.3640851795318581, Total Accuracy: 18.52%\n",
      "Accuracy per class - G1: 39.02%, G2: 24.17%, G3: 1.08%\n",
      "EarlyStopping counter: 25 out of 40\n",
      "Epoch 29, Loss: 0.20814982397728657\n",
      "Validation Loss: 0.3717442999283473, Total Accuracy: 16.82%\n",
      "Accuracy per class - G1: 43.90%, G2: 21.09%, G3: 1.08%\n",
      "EarlyStopping counter: 26 out of 40\n",
      "Epoch 30, Loss: 0.206184366381312\n",
      "Validation Loss: 0.3671454260391848, Total Accuracy: 17.75%\n",
      "Accuracy per class - G1: 39.02%, G2: 22.99%, G3: 1.08%\n",
      "EarlyStopping counter: 27 out of 40\n",
      "Epoch 31, Loss: 0.20675956969519696\n",
      "Validation Loss: 0.3740816953636351, Total Accuracy: 17.28%\n",
      "Accuracy per class - G1: 39.02%, G2: 22.04%, G3: 1.62%\n",
      "EarlyStopping counter: 28 out of 40\n",
      "Epoch 32, Loss: 0.20468992443687944\n",
      "Validation Loss: 0.3768249068941389, Total Accuracy: 17.44%\n",
      "Accuracy per class - G1: 43.90%, G2: 22.04%, G3: 1.08%\n",
      "EarlyStopping counter: 29 out of 40\n",
      "Epoch 33, Loss: 0.20432952154113584\n",
      "Validation Loss: 0.38393344588222955, Total Accuracy: 18.06%\n",
      "Accuracy per class - G1: 43.90%, G2: 22.99%, G3: 1.08%\n",
      "EarlyStopping counter: 30 out of 40\n",
      "Epoch 34, Loss: 0.2005382431558816\n",
      "Validation Loss: 0.37879817755449385, Total Accuracy: 17.90%\n",
      "Accuracy per class - G1: 43.90%, G2: 22.75%, G3: 1.08%\n",
      "EarlyStopping counter: 31 out of 40\n",
      "Epoch 35, Loss: 0.19948449784732727\n",
      "Validation Loss: 0.37433566534448237, Total Accuracy: 17.59%\n",
      "Accuracy per class - G1: 39.02%, G2: 22.75%, G3: 1.08%\n",
      "EarlyStopping counter: 32 out of 40\n",
      "Epoch 36, Loss: 0.19855218569198288\n",
      "Validation Loss: 0.36625393391365096, Total Accuracy: 18.98%\n",
      "Accuracy per class - G1: 39.02%, G2: 24.88%, G3: 1.08%\n",
      "EarlyStopping counter: 33 out of 40\n",
      "Epoch 37, Loss: 0.1946146258388657\n",
      "Validation Loss: 0.3609612773926485, Total Accuracy: 18.98%\n",
      "Accuracy per class - G1: 36.59%, G2: 25.12%, G3: 1.08%\n",
      "EarlyStopping counter: 34 out of 40\n",
      "Epoch 38, Loss: 0.19456943133509302\n",
      "Validation Loss: 0.3674490762253602, Total Accuracy: 18.52%\n",
      "Accuracy per class - G1: 36.59%, G2: 24.41%, G3: 1.08%\n",
      "EarlyStopping counter: 35 out of 40\n",
      "Epoch 39, Loss: 0.19363112828458648\n",
      "Validation Loss: 0.3659550627427442, Total Accuracy: 18.36%\n",
      "Accuracy per class - G1: 36.59%, G2: 24.17%, G3: 1.08%\n",
      "EarlyStopping counter: 36 out of 40\n",
      "Epoch 40, Loss: 0.19252241681139154\n",
      "Validation Loss: 0.37314096306051525, Total Accuracy: 18.36%\n",
      "Accuracy per class - G1: 36.59%, G2: 24.17%, G3: 1.08%\n",
      "EarlyStopping counter: 37 out of 40\n",
      "Epoch 41, Loss: 0.1908675658415599\n",
      "Validation Loss: 0.3626736409607388, Total Accuracy: 19.29%\n",
      "Accuracy per class - G1: 41.46%, G2: 25.12%, G3: 1.08%\n",
      "EarlyStopping counter: 38 out of 40\n",
      "Epoch 42, Loss: 0.18952618252082043\n",
      "Validation Loss: 0.36357477076706435, Total Accuracy: 19.29%\n",
      "Accuracy per class - G1: 36.59%, G2: 25.59%, G3: 1.08%\n",
      "EarlyStopping counter: 39 out of 40\n",
      "Epoch 43, Loss: 0.18980952468981227\n",
      "Validation Loss: 0.37911590853972094, Total Accuracy: 18.36%\n",
      "Accuracy per class - G1: 36.59%, G2: 24.17%, G3: 1.08%\n",
      "EarlyStopping counter: 40 out of 40\n",
      "Early stopping\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\u001b[34m\u001b[1mwandb\u001b[0m:                                                                                \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run history:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc ██▅▇▅▆▆▃▄▃▃▃▃▂▃▃▂▂▂▁▂▂▁▁▁▂▂▁▁▂▂▂▁▁▁▁▁▁▂▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc ▁▁▂▁▂▂▂▃▂▂▃▃▃▃▃▃▄▅▄▅▆▅▆▆▇▅▆▇▇▆▇▇▇▇██▇█▇█\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc ▃▂▅▁▂▂▃▃▄▄▄▅▄▅▅▄▅▅▅▆▅▆▅▇▇▇▅▆▆▆▆▆▆██▇▇▇█▇\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc ▁▁▁▂▂▂▂▃▃▃▄▄▄▅▅▅▅▅▆▆▆▆▆▆▇▆▇▇▇█▇▇▇███████\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc ▆█▇▇▇▃█▅▅▁▃▁▃▃▅▃▁▃▁▁▃▁▁▁▂▂▁▁▂▁▁▁▁▁▁▁▁▁▁▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc ▁▁▁▁▁▁▂▁▁▂▂▂▂▂▃▃▃▃▃▄▄▄▅▄▅▅▅▅▆▆▅▇▆▇▇▇▇███\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy ▆▅█▁▁▁▄▁▃▁▂▂▂▃▃▃▃▁▃▄▂▄▁▆▅▆▂▄▃▃▅▄▄▇▇▆▆▆█▆\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy ▁▁▁▂▂▂▂▃▃▃▃▃▃▄▄▄▅▅▅▅▆▅▆▆▆▆▆▇▇▇▇▇▇▇██████\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss ██▇▇▇▆▆▆▆▅▅▅▅▄▄▄▄▃▃▃▃▃▂▂▂▂▂▂▂▂▂▂▂▁▁▁▁▁▁▁\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss ▃▁▁▃▃▄▃▃▃▃▃▄▄▄▅▆▅▅▆▅▆▅▆▅▆█▇▇▇▇██▇▇▆▇▆▇▆█\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run summary:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc 36.58537\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc 72.76423\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc 24.17062\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc 67.53325\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc 1.08108\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc 19.1689\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy 18.3642\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy 54.38398\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss 0.18981\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss 0.37912\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: 🚀 View run \u001b[33moptuna_run_19 microsoft/resnet-18 NOOVERSAMPLING FOCALLOS20\u001b[0m at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/tyo63s8x\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: ⭐️ View project at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Synced 5 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Find logs at: \u001b[35m\u001b[1m./wandb/run-20241008_143859-tyo63s8x/logs\u001b[0m\n",
      "[I 2024-10-08 14:52:01,742] Trial 19 finished with value: 0.13106790645252187 and parameters: {'learning_rate': 2.6515709489232066e-08, 'weight_decay': 1.1358538740594945e-06, 'focal_loss': 3.9155482348203794}. Best is trial 17 with value: 0.33465094473811785.\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Best hyperparameters:  {'learning_rate': 2.0794131179599615e-08, 'weight_decay': 3.977510983924452e-06, 'focal_loss': 2.093232505195767}\n"
     ]
    }
   ],
   "source": [
    "import optuna\n",
    "from optuna.trial import TrialState\n",
    "from torch.utils.data import DataLoader, Subset\n",
    "from collections import Counter \n",
    "from sklearn.metrics import f1_score\n",
    "from sklearn.model_selection import train_test_split\n",
    "#from optuna.integration.wandb import WeightsAndBiasesCallback\n",
    "\n",
    "# Define the objective function for Optuna\n",
    "def objective(trial):\n",
    "    # Suggest hyperparameters to be tuned by Optuna\n",
    "    config = {\n",
    "        \"learning_rate\": trial.suggest_float(\"learning_rate\", 1e-8, 1e-6, log=True),\n",
    "        \"weight_decay\": trial.suggest_float(\"weight_decay\", 1e-8, 1e-3, log=True),\n",
    "        \"reduce_lr_factor\": 0.5,\n",
    "        \"patience\": 20,\n",
    "        \"early_stop_patience\": 40,\n",
    "        \"focal_loss\": trial.suggest_float(\"focal_loss\", 0.5, 5.0),  # Focal loss gamma can vary from 0 (CrossEntropy) to 5\n",
    "        \"epochs\": 600,  # Fixing the number of epochs to avoid very long runs\n",
    "        \"class_weights\": None,\n",
    "        \"run_name\": f\"optuna_run_{trial.number} microsoft/resnet-18 NOOVERSAMPLING FOCALLOSS\",\n",
    "        \"architecture\": \"microsoft/resnet-18\"\n",
    "    }\n",
    "\n",
    "    # Use k-fold cross-validation\n",
    "    k_folds = 5 #In order to obtain a split of 20-80\n",
    "    batch_size = 32\n",
    "\n",
    "    # Initialize the k-fold cross-validation\n",
    "    #I'm forced to use this crossvalidation function because there's no other functions able to perform stratified and grouped train-test split\n",
    "    gkf = StratifiedGroupKFold(n_splits=k_folds)  \n",
    "    patient_ids = [info.split(\"/\")[0].split(\"_\")[0] for info in train_dataset.items]\n",
    "    labels = [train_dataset.labels[patient_id] for patient_id in patient_ids]\n",
    "    indices = list(range(len(patient_ids)))\n",
    "    \n",
    "    #train_indices, test_indices = train_test_split(\n",
    "    #    range(len(labels)),          # Indices of the dataset\n",
    "    #    test_size=0.2,                # Split ratio (e.g., 20% for testing)\n",
    "    #    stratify=labels,              # Use the labels for stratification\n",
    "    #    random_state=42               # For reproducibility\n",
    "    #)\n",
    "\n",
    "    train_indices, test_indices = next(gkf.split(indices, labels, groups=patient_ids))\n",
    "    val_scores = []\n",
    "\n",
    "    \n",
    "    train_subset = Subset(train_dataset, train_indices)\n",
    "    val_subset = Subset(train_dataset, test_indices)\n",
    "    train_loader = DataLoader(dataset=train_subset, batch_size=batch_size, shuffle=True)\n",
    "    val_loader = DataLoader(dataset=val_subset, batch_size=batch_size, shuffle=False)\n",
    "\n",
    "    # Prepare the model for each fold\n",
    "    model = ResNetForImageClassification.from_pretrained(config[\"architecture\"])\n",
    "    model.classifier[-1] = nn.Linear(model.classifier[-1].in_features, UnimodalCTDataset.num_classes)\n",
    "    device = torch.device(\"cuda\" if torch.cuda.is_available() else \"cpu\")\n",
    "    model.to(device)\n",
    "\n",
    "    run_name = list(config[\"run_name\"])\n",
    "    run_name[-1] = str(trial.number + 1)\n",
    "    config[\"run_name\"] = ''.join(run_name)\n",
    "\n",
    "    # Train the model for the current fold\n",
    "    train(model, train_loader, val_loader, config, run_name=config[\"run_name\"])\n",
    "\n",
    "    # After training, evaluate on the validation set\n",
    "    f1 = evaluate(model, val_loader, device)\n",
    "    \n",
    "    return f1\n",
    "\n",
    "# Define the evaluation function\n",
    "def evaluate(model, val_loader, device):\n",
    "    model.eval()\n",
    "    val_labels = []\n",
    "    val_predictions = []\n",
    "    \n",
    "    with torch.no_grad():\n",
    "        for batch in val_loader:\n",
    "            frames = batch['frame'].float().to(device)\n",
    "            labels = batch['label'].long().to(device)\n",
    "            outputs = model(frames)\n",
    "            \n",
    "            _, predicted = torch.max(outputs.logits, 1)\n",
    "            val_labels.extend(labels.cpu().tolist())\n",
    "            val_predictions.extend(predicted.cpu().tolist())\n",
    "\n",
    "    # Calculate macro-averaged F1-score across all classes\n",
    "    f1 = f1_score(val_labels, val_predictions, average='macro')\n",
    "    return f1\n",
    "\n",
    "\n",
    "# Create an Optuna study and optimize\n",
    "study = optuna.create_study(direction=\"maximize\")  # Maximizing f1-score\n",
    "study.optimize(objective, n_trials=20)  \n",
    "\n",
    "# Print the best hyperparameters found by Optuna\n",
    "print(\"Best hyperparameters: \", study.best_params)\n"
   ]
  }
 ],
 "metadata": {
  "kaggle": {
   "accelerator": "gpu",
   "dataSources": [
    {
     "datasetId": 5758221,
     "sourceId": 9516694,
     "sourceType": "datasetVersion"
    },
    {
     "datasetId": 5664308,
     "sourceId": 9547833,
     "sourceType": "datasetVersion"
    }
   ],
   "isGpuEnabled": true,
   "isInternetEnabled": true,
   "language": "python",
   "sourceType": "notebook"
  },
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.14"
  },
  "papermill": {
   "default_parameters": {},
   "duration": 16595.730035,
   "end_time": "2024-10-08T14:52:03.552625",
   "environment_variables": {},
   "exception": null,
   "input_path": "__notebook__.ipynb",
   "output_path": "__notebook__.ipynb",
   "parameters": {},
   "start_time": "2024-10-08T10:15:27.822590",
   "version": "2.6.0"
  },
  "widgets": {
   "application/vnd.jupyter.widget-state+json": {
    "state": {
     "07c114d710e34a36993f462e688983ec": {
      "model_module": "@jupyter-widgets/controls",
      "model_module_version": "1.5.0",
      "model_name": "DescriptionStyleModel",
      "state": {
       "_model_module": "@jupyter-widgets/controls",
       "_model_module_version": "1.5.0",
       "_model_name": "DescriptionStyleModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/base",
       "_view_module_version": "1.2.0",
       "_view_name": "StyleView",
       "description_width": ""
      }
     },
     "0bc6bed6805543e489e9e243509b327a": {
      "model_module": "@jupyter-widgets/controls",
      "model_module_version": "1.5.0",
      "model_name": "HTMLModel",
      "state": {
       "_dom_classes": [],
       "_model_module": "@jupyter-widgets/controls",
       "_model_module_version": "1.5.0",
       "_model_name": "HTMLModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/controls",
       "_view_module_version": "1.5.0",
       "_view_name": "HTMLView",
       "description": "",
       "description_tooltip": null,
       "layout": "IPY_MODEL_f00c248a4caf427c895e3a6a95bb81ff",
       "placeholder": "​",
       "style": "IPY_MODEL_07c114d710e34a36993f462e688983ec",
       "value": " 46.8M/46.8M [00:00&lt;00:00, 180MB/s]"
      }
     },
     "223811f718a94ba7826af2c202f81e3e": {
      "model_module": "@jupyter-widgets/base",
      "model_module_version": "1.2.0",
      "model_name": "LayoutModel",
      "state": {
       "_model_module": "@jupyter-widgets/base",
       "_model_module_version": "1.2.0",
       "_model_name": "LayoutModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/base",
       "_view_module_version": "1.2.0",
       "_view_name": "LayoutView",
       "align_content": null,
       "align_items": null,
       "align_self": null,
       "border": null,
       "bottom": null,
       "display": null,
       "flex": null,
       "flex_flow": null,
       "grid_area": null,
       "grid_auto_columns": null,
       "grid_auto_flow": null,
       "grid_auto_rows": null,
       "grid_column": null,
       "grid_gap": null,
       "grid_row": null,
       "grid_template_areas": null,
       "grid_template_columns": null,
       "grid_template_rows": null,
       "height": null,
       "justify_content": null,
       "justify_items": null,
       "left": null,
       "margin": null,
       "max_height": null,
       "max_width": null,
       "min_height": null,
       "min_width": null,
       "object_fit": null,
       "object_position": null,
       "order": null,
       "overflow": null,
       "overflow_x": null,
       "overflow_y": null,
       "padding": null,
       "right": null,
       "top": null,
       "visibility": null,
       "width": null
      }
     },
     "26b60f8f898c4ccab37f1ebfcf972b49": {
      "model_module": "@jupyter-widgets/controls",
      "model_module_version": "1.5.0",
      "model_name": "ProgressStyleModel",
      "state": {
       "_model_module": "@jupyter-widgets/controls",
       "_model_module_version": "1.5.0",
       "_model_name": "ProgressStyleModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/base",
       "_view_module_version": "1.2.0",
       "_view_name": "StyleView",
       "bar_color": null,
       "description_width": ""
      }
     },
     "39b5cdd0c0064bc38bd7a68cc08f0470": {
      "model_module": "@jupyter-widgets/base",
      "model_module_version": "1.2.0",
      "model_name": "LayoutModel",
      "state": {
       "_model_module": "@jupyter-widgets/base",
       "_model_module_version": "1.2.0",
       "_model_name": "LayoutModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/base",
       "_view_module_version": "1.2.0",
       "_view_name": "LayoutView",
       "align_content": null,
       "align_items": null,
       "align_self": null,
       "border": null,
       "bottom": null,
       "display": null,
       "flex": null,
       "flex_flow": null,
       "grid_area": null,
       "grid_auto_columns": null,
       "grid_auto_flow": null,
       "grid_auto_rows": null,
       "grid_column": null,
       "grid_gap": null,
       "grid_row": null,
       "grid_template_areas": null,
       "grid_template_columns": null,
       "grid_template_rows": null,
       "height": null,
       "justify_content": null,
       "justify_items": null,
       "left": null,
       "margin": null,
       "max_height": null,
       "max_width": null,
       "min_height": null,
       "min_width": null,
       "object_fit": null,
       "object_position": null,
       "order": null,
       "overflow": null,
       "overflow_x": null,
       "overflow_y": null,
       "padding": null,
       "right": null,
       "top": null,
       "visibility": null,
       "width": null
      }
     },
     "5e4f01651a4f4a22ac61f7471bdd2ed1": {
      "model_module": "@jupyter-widgets/base",
      "model_module_version": "1.2.0",
      "model_name": "LayoutModel",
      "state": {
       "_model_module": "@jupyter-widgets/base",
       "_model_module_version": "1.2.0",
       "_model_name": "LayoutModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/base",
       "_view_module_version": "1.2.0",
       "_view_name": "LayoutView",
       "align_content": null,
       "align_items": null,
       "align_self": null,
       "border": null,
       "bottom": null,
       "display": null,
       "flex": null,
       "flex_flow": null,
       "grid_area": null,
       "grid_auto_columns": null,
       "grid_auto_flow": null,
       "grid_auto_rows": null,
       "grid_column": null,
       "grid_gap": null,
       "grid_row": null,
       "grid_template_areas": null,
       "grid_template_columns": null,
       "grid_template_rows": null,
       "height": null,
       "justify_content": null,
       "justify_items": null,
       "left": null,
       "margin": null,
       "max_height": null,
       "max_width": null,
       "min_height": null,
       "min_width": null,
       "object_fit": null,
       "object_position": null,
       "order": null,
       "overflow": null,
       "overflow_x": null,
       "overflow_y": null,
       "padding": null,
       "right": null,
       "top": null,
       "visibility": null,
       "width": null
      }
     },
     "5ecff89fd39b4477b3a90519dddf834d": {
      "model_module": "@jupyter-widgets/controls",
      "model_module_version": "1.5.0",
      "model_name": "FloatProgressModel",
      "state": {
       "_dom_classes": [],
       "_model_module": "@jupyter-widgets/controls",
       "_model_module_version": "1.5.0",
       "_model_name": "FloatProgressModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/controls",
       "_view_module_version": "1.5.0",
       "_view_name": "ProgressView",
       "bar_style": "success",
       "description": "",
       "description_tooltip": null,
       "layout": "IPY_MODEL_223811f718a94ba7826af2c202f81e3e",
       "max": 69548.0,
       "min": 0.0,
       "orientation": "horizontal",
       "style": "IPY_MODEL_67baf884ffc94846b2f39b38d81c9315",
       "value": 69548.0
      }
     },
     "62add141a7624469904c70acaf66ce71": {
      "model_module": "@jupyter-widgets/controls",
      "model_module_version": "1.5.0",
      "model_name": "HTMLModel",
      "state": {
       "_dom_classes": [],
       "_model_module": "@jupyter-widgets/controls",
       "_model_module_version": "1.5.0",
       "_model_name": "HTMLModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/controls",
       "_view_module_version": "1.5.0",
       "_view_name": "HTMLView",
       "description": "",
       "description_tooltip": null,
       "layout": "IPY_MODEL_5e4f01651a4f4a22ac61f7471bdd2ed1",
       "placeholder": "​",
       "style": "IPY_MODEL_d3bc174cb5374a1e86415b80adee2470",
       "value": " 69.5k/69.5k [00:00&lt;00:00, 833kB/s]"
      }
     },
     "64303c2dfbe64b07afddb246daf768e1": {
      "model_module": "@jupyter-widgets/controls",
      "model_module_version": "1.5.0",
      "model_name": "HTMLModel",
      "state": {
       "_dom_classes": [],
       "_model_module": "@jupyter-widgets/controls",
       "_model_module_version": "1.5.0",
       "_model_name": "HTMLModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/controls",
       "_view_module_version": "1.5.0",
       "_view_name": "HTMLView",
       "description": "",
       "description_tooltip": null,
       "layout": "IPY_MODEL_6ec68a5b7f1f4e348fe5d293d252c543",
       "placeholder": "​",
       "style": "IPY_MODEL_9873e0866ddb4e21a4040e6eb3af6962",
       "value": "model.safetensors: 100%"
      }
     },
     "67baf884ffc94846b2f39b38d81c9315": {
      "model_module": "@jupyter-widgets/controls",
      "model_module_version": "1.5.0",
      "model_name": "ProgressStyleModel",
      "state": {
       "_model_module": "@jupyter-widgets/controls",
       "_model_module_version": "1.5.0",
       "_model_name": "ProgressStyleModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/base",
       "_view_module_version": "1.2.0",
       "_view_name": "StyleView",
       "bar_color": null,
       "description_width": ""
      }
     },
     "6ec68a5b7f1f4e348fe5d293d252c543": {
      "model_module": "@jupyter-widgets/base",
      "model_module_version": "1.2.0",
      "model_name": "LayoutModel",
      "state": {
       "_model_module": "@jupyter-widgets/base",
       "_model_module_version": "1.2.0",
       "_model_name": "LayoutModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/base",
       "_view_module_version": "1.2.0",
       "_view_name": "LayoutView",
       "align_content": null,
       "align_items": null,
       "align_self": null,
       "border": null,
       "bottom": null,
       "display": null,
       "flex": null,
       "flex_flow": null,
       "grid_area": null,
       "grid_auto_columns": null,
       "grid_auto_flow": null,
       "grid_auto_rows": null,
       "grid_column": null,
       "grid_gap": null,
       "grid_row": null,
       "grid_template_areas": null,
       "grid_template_columns": null,
       "grid_template_rows": null,
       "height": null,
       "justify_content": null,
       "justify_items": null,
       "left": null,
       "margin": null,
       "max_height": null,
       "max_width": null,
       "min_height": null,
       "min_width": null,
       "object_fit": null,
       "object_position": null,
       "order": null,
       "overflow": null,
       "overflow_x": null,
       "overflow_y": null,
       "padding": null,
       "right": null,
       "top": null,
       "visibility": null,
       "width": null
      }
     },
     "6edb33ade896407783e84ea0e2a7e9b1": {
      "model_module": "@jupyter-widgets/base",
      "model_module_version": "1.2.0",
      "model_name": "LayoutModel",
      "state": {
       "_model_module": "@jupyter-widgets/base",
       "_model_module_version": "1.2.0",
       "_model_name": "LayoutModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/base",
       "_view_module_version": "1.2.0",
       "_view_name": "LayoutView",
       "align_content": null,
       "align_items": null,
       "align_self": null,
       "border": null,
       "bottom": null,
       "display": null,
       "flex": null,
       "flex_flow": null,
       "grid_area": null,
       "grid_auto_columns": null,
       "grid_auto_flow": null,
       "grid_auto_rows": null,
       "grid_column": null,
       "grid_gap": null,
       "grid_row": null,
       "grid_template_areas": null,
       "grid_template_columns": null,
       "grid_template_rows": null,
       "height": null,
       "justify_content": null,
       "justify_items": null,
       "left": null,
       "margin": null,
       "max_height": null,
       "max_width": null,
       "min_height": null,
       "min_width": null,
       "object_fit": null,
       "object_position": null,
       "order": null,
       "overflow": null,
       "overflow_x": null,
       "overflow_y": null,
       "padding": null,
       "right": null,
       "top": null,
       "visibility": null,
       "width": null
      }
     },
     "70fa1aacaf37432689afeba2cbd8cb13": {
      "model_module": "@jupyter-widgets/controls",
      "model_module_version": "1.5.0",
      "model_name": "HBoxModel",
      "state": {
       "_dom_classes": [],
       "_model_module": "@jupyter-widgets/controls",
       "_model_module_version": "1.5.0",
       "_model_name": "HBoxModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/controls",
       "_view_module_version": "1.5.0",
       "_view_name": "HBoxView",
       "box_style": "",
       "children": [
        "IPY_MODEL_b13a56bb4ce544f8aad4ffb8ed4a4466",
        "IPY_MODEL_5ecff89fd39b4477b3a90519dddf834d",
        "IPY_MODEL_62add141a7624469904c70acaf66ce71"
       ],
       "layout": "IPY_MODEL_79057f56a1b84eda8817200056f8b224"
      }
     },
     "79057f56a1b84eda8817200056f8b224": {
      "model_module": "@jupyter-widgets/base",
      "model_module_version": "1.2.0",
      "model_name": "LayoutModel",
      "state": {
       "_model_module": "@jupyter-widgets/base",
       "_model_module_version": "1.2.0",
       "_model_name": "LayoutModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/base",
       "_view_module_version": "1.2.0",
       "_view_name": "LayoutView",
       "align_content": null,
       "align_items": null,
       "align_self": null,
       "border": null,
       "bottom": null,
       "display": null,
       "flex": null,
       "flex_flow": null,
       "grid_area": null,
       "grid_auto_columns": null,
       "grid_auto_flow": null,
       "grid_auto_rows": null,
       "grid_column": null,
       "grid_gap": null,
       "grid_row": null,
       "grid_template_areas": null,
       "grid_template_columns": null,
       "grid_template_rows": null,
       "height": null,
       "justify_content": null,
       "justify_items": null,
       "left": null,
       "margin": null,
       "max_height": null,
       "max_width": null,
       "min_height": null,
       "min_width": null,
       "object_fit": null,
       "object_position": null,
       "order": null,
       "overflow": null,
       "overflow_x": null,
       "overflow_y": null,
       "padding": null,
       "right": null,
       "top": null,
       "visibility": null,
       "width": null
      }
     },
     "9514d517e5b447259281cf7529d84387": {
      "model_module": "@jupyter-widgets/base",
      "model_module_version": "1.2.0",
      "model_name": "LayoutModel",
      "state": {
       "_model_module": "@jupyter-widgets/base",
       "_model_module_version": "1.2.0",
       "_model_name": "LayoutModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/base",
       "_view_module_version": "1.2.0",
       "_view_name": "LayoutView",
       "align_content": null,
       "align_items": null,
       "align_self": null,
       "border": null,
       "bottom": null,
       "display": null,
       "flex": null,
       "flex_flow": null,
       "grid_area": null,
       "grid_auto_columns": null,
       "grid_auto_flow": null,
       "grid_auto_rows": null,
       "grid_column": null,
       "grid_gap": null,
       "grid_row": null,
       "grid_template_areas": null,
       "grid_template_columns": null,
       "grid_template_rows": null,
       "height": null,
       "justify_content": null,
       "justify_items": null,
       "left": null,
       "margin": null,
       "max_height": null,
       "max_width": null,
       "min_height": null,
       "min_width": null,
       "object_fit": null,
       "object_position": null,
       "order": null,
       "overflow": null,
       "overflow_x": null,
       "overflow_y": null,
       "padding": null,
       "right": null,
       "top": null,
       "visibility": null,
       "width": null
      }
     },
     "9873e0866ddb4e21a4040e6eb3af6962": {
      "model_module": "@jupyter-widgets/controls",
      "model_module_version": "1.5.0",
      "model_name": "DescriptionStyleModel",
      "state": {
       "_model_module": "@jupyter-widgets/controls",
       "_model_module_version": "1.5.0",
       "_model_name": "DescriptionStyleModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/base",
       "_view_module_version": "1.2.0",
       "_view_name": "StyleView",
       "description_width": ""
      }
     },
     "9edcf7b6ef714171b8b9e28d0059f0b2": {
      "model_module": "@jupyter-widgets/controls",
      "model_module_version": "1.5.0",
      "model_name": "HBoxModel",
      "state": {
       "_dom_classes": [],
       "_model_module": "@jupyter-widgets/controls",
       "_model_module_version": "1.5.0",
       "_model_name": "HBoxModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/controls",
       "_view_module_version": "1.5.0",
       "_view_name": "HBoxView",
       "box_style": "",
       "children": [
        "IPY_MODEL_64303c2dfbe64b07afddb246daf768e1",
        "IPY_MODEL_b8d0b5bfc8e74f88afe1d116d0d5e5e6",
        "IPY_MODEL_0bc6bed6805543e489e9e243509b327a"
       ],
       "layout": "IPY_MODEL_6edb33ade896407783e84ea0e2a7e9b1"
      }
     },
     "b13a56bb4ce544f8aad4ffb8ed4a4466": {
      "model_module": "@jupyter-widgets/controls",
      "model_module_version": "1.5.0",
      "model_name": "HTMLModel",
      "state": {
       "_dom_classes": [],
       "_model_module": "@jupyter-widgets/controls",
       "_model_module_version": "1.5.0",
       "_model_name": "HTMLModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/controls",
       "_view_module_version": "1.5.0",
       "_view_name": "HTMLView",
       "description": "",
       "description_tooltip": null,
       "layout": "IPY_MODEL_9514d517e5b447259281cf7529d84387",
       "placeholder": "​",
       "style": "IPY_MODEL_cdb52014aed24a539c6929fda69be45f",
       "value": "config.json: 100%"
      }
     },
     "b8d0b5bfc8e74f88afe1d116d0d5e5e6": {
      "model_module": "@jupyter-widgets/controls",
      "model_module_version": "1.5.0",
      "model_name": "FloatProgressModel",
      "state": {
       "_dom_classes": [],
       "_model_module": "@jupyter-widgets/controls",
       "_model_module_version": "1.5.0",
       "_model_name": "FloatProgressModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/controls",
       "_view_module_version": "1.5.0",
       "_view_name": "ProgressView",
       "bar_style": "success",
       "description": "",
       "description_tooltip": null,
       "layout": "IPY_MODEL_39b5cdd0c0064bc38bd7a68cc08f0470",
       "max": 46812324.0,
       "min": 0.0,
       "orientation": "horizontal",
       "style": "IPY_MODEL_26b60f8f898c4ccab37f1ebfcf972b49",
       "value": 46812324.0
      }
     },
     "cdb52014aed24a539c6929fda69be45f": {
      "model_module": "@jupyter-widgets/controls",
      "model_module_version": "1.5.0",
      "model_name": "DescriptionStyleModel",
      "state": {
       "_model_module": "@jupyter-widgets/controls",
       "_model_module_version": "1.5.0",
       "_model_name": "DescriptionStyleModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/base",
       "_view_module_version": "1.2.0",
       "_view_name": "StyleView",
       "description_width": ""
      }
     },
     "d3bc174cb5374a1e86415b80adee2470": {
      "model_module": "@jupyter-widgets/controls",
      "model_module_version": "1.5.0",
      "model_name": "DescriptionStyleModel",
      "state": {
       "_model_module": "@jupyter-widgets/controls",
       "_model_module_version": "1.5.0",
       "_model_name": "DescriptionStyleModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/base",
       "_view_module_version": "1.2.0",
       "_view_name": "StyleView",
       "description_width": ""
      }
     },
     "f00c248a4caf427c895e3a6a95bb81ff": {
      "model_module": "@jupyter-widgets/base",
      "model_module_version": "1.2.0",
      "model_name": "LayoutModel",
      "state": {
       "_model_module": "@jupyter-widgets/base",
       "_model_module_version": "1.2.0",
       "_model_name": "LayoutModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/base",
       "_view_module_version": "1.2.0",
       "_view_name": "LayoutView",
       "align_content": null,
       "align_items": null,
       "align_self": null,
       "border": null,
       "bottom": null,
       "display": null,
       "flex": null,
       "flex_flow": null,
       "grid_area": null,
       "grid_auto_columns": null,
       "grid_auto_flow": null,
       "grid_auto_rows": null,
       "grid_column": null,
       "grid_gap": null,
       "grid_row": null,
       "grid_template_areas": null,
       "grid_template_columns": null,
       "grid_template_rows": null,
       "height": null,
       "justify_content": null,
       "justify_items": null,
       "left": null,
       "margin": null,
       "max_height": null,
       "max_width": null,
       "min_height": null,
       "min_width": null,
       "object_fit": null,
       "object_position": null,
       "order": null,
       "overflow": null,
       "overflow_x": null,
       "overflow_y": null,
       "padding": null,
       "right": null,
       "top": null,
       "visibility": null,
       "width": null
      }
     }
    },
    "version_major": 2,
    "version_minor": 0
   }
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
