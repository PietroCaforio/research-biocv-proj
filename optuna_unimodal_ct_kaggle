{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "1028c19e",
   "metadata": {
    "papermill": {
     "duration": 0.014326,
     "end_time": "2024-10-09T17:29:59.384884",
     "exception": false,
     "start_time": "2024-10-09T17:29:59.370558",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "<a href=\"https://www.kaggle.com/code/pietrocaforio/unimodal-ct-training-kaggle?scriptVersionId=199214851\" target=\"_blank\"><img align=\"left\" alt=\"Kaggle\" title=\"Open in Kaggle\" src=\"https://kaggle.com/static/images/open-in-kaggle.svg\"></a>"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "6e960931",
   "metadata": {
    "papermill": {
     "duration": 0.013244,
     "end_time": "2024-10-09T17:29:59.413164",
     "exception": false,
     "start_time": "2024-10-09T17:29:59.399920",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "# Train unimodal CT"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "c93e3b67",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-09T17:29:59.441306Z",
     "iopub.status.busy": "2024-10-09T17:29:59.440963Z",
     "iopub.status.idle": "2024-10-09T17:30:02.473065Z",
     "shell.execute_reply": "2024-10-09T17:30:02.472147Z"
    },
    "papermill": {
     "duration": 3.048687,
     "end_time": "2024-10-09T17:30:02.475123",
     "exception": false,
     "start_time": "2024-10-09T17:29:59.426436",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Cloning into 'research-biocv-proj'...\r\n",
      "remote: Enumerating objects: 459, done.\u001b[K\r\n",
      "remote: Counting objects: 100% (4/4), done.\u001b[K\r\n",
      "remote: Compressing objects: 100% (4/4), done.\u001b[K\r\n",
      "remote: Total 459 (delta 0), reused 1 (delta 0), pack-reused 455 (from 1)\u001b[K\r\n",
      "Receiving objects: 100% (459/459), 3.90 MiB | 20.19 MiB/s, done.\r\n",
      "Resolving deltas: 100% (280/280), done.\r\n",
      "Branch 'dev' set up to track remote branch 'dev' from 'origin'.\r\n",
      "Switched to a new branch 'dev'\r\n"
     ]
    }
   ],
   "source": [
    "!git clone https://github.com/PietroCaforio/research-biocv-proj\n",
    "!cd research-biocv-proj && git switch dev"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "c9c40bfc",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-09T17:30:02.505749Z",
     "iopub.status.busy": "2024-10-09T17:30:02.505412Z",
     "iopub.status.idle": "2024-10-09T17:30:03.809381Z",
     "shell.execute_reply": "2024-10-09T17:30:03.808446Z"
    },
    "papermill": {
     "duration": 1.322018,
     "end_time": "2024-10-09T17:30:03.811783",
     "exception": false,
     "start_time": "2024-10-09T17:30:02.489765",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Already up to date.\r\n"
     ]
    }
   ],
   "source": [
    "!cd research-biocv-proj && git pull"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "1f20ee37",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-09T17:30:03.843629Z",
     "iopub.status.busy": "2024-10-09T17:30:03.843309Z",
     "iopub.status.idle": "2024-10-09T17:30:16.556112Z",
     "shell.execute_reply": "2024-10-09T17:30:16.555105Z"
    },
    "papermill": {
     "duration": 12.730804,
     "end_time": "2024-10-09T17:30:16.558446",
     "exception": false,
     "start_time": "2024-10-09T17:30:03.827642",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Requirement already satisfied: wandb in /opt/conda/lib/python3.10/site-packages (0.18.3)\r\n",
      "Requirement already satisfied: click!=8.0.0,>=7.1 in /opt/conda/lib/python3.10/site-packages (from wandb) (8.1.7)\r\n",
      "Requirement already satisfied: docker-pycreds>=0.4.0 in /opt/conda/lib/python3.10/site-packages (from wandb) (0.4.0)\r\n",
      "Requirement already satisfied: gitpython!=3.1.29,>=1.0.0 in /opt/conda/lib/python3.10/site-packages (from wandb) (3.1.43)\r\n",
      "Requirement already satisfied: platformdirs in /opt/conda/lib/python3.10/site-packages (from wandb) (3.11.0)\r\n",
      "Requirement already satisfied: protobuf!=4.21.0,!=5.28.0,<6,>=3.19.0 in /opt/conda/lib/python3.10/site-packages (from wandb) (3.20.3)\r\n",
      "Requirement already satisfied: psutil>=5.0.0 in /opt/conda/lib/python3.10/site-packages (from wandb) (5.9.3)\r\n",
      "Requirement already satisfied: pyyaml in /opt/conda/lib/python3.10/site-packages (from wandb) (6.0.2)\r\n",
      "Requirement already satisfied: requests<3,>=2.0.0 in /opt/conda/lib/python3.10/site-packages (from wandb) (2.32.3)\r\n",
      "Requirement already satisfied: sentry-sdk>=1.0.0 in /opt/conda/lib/python3.10/site-packages (from wandb) (2.15.0)\r\n",
      "Requirement already satisfied: setproctitle in /opt/conda/lib/python3.10/site-packages (from wandb) (1.3.3)\r\n",
      "Requirement already satisfied: setuptools in /opt/conda/lib/python3.10/site-packages (from wandb) (70.0.0)\r\n",
      "Requirement already satisfied: six>=1.4.0 in /opt/conda/lib/python3.10/site-packages (from docker-pycreds>=0.4.0->wandb) (1.16.0)\r\n",
      "Requirement already satisfied: gitdb<5,>=4.0.1 in /opt/conda/lib/python3.10/site-packages (from gitpython!=3.1.29,>=1.0.0->wandb) (4.0.11)\r\n",
      "Requirement already satisfied: charset-normalizer<4,>=2 in /opt/conda/lib/python3.10/site-packages (from requests<3,>=2.0.0->wandb) (3.3.2)\r\n",
      "Requirement already satisfied: idna<4,>=2.5 in /opt/conda/lib/python3.10/site-packages (from requests<3,>=2.0.0->wandb) (3.7)\r\n",
      "Requirement already satisfied: urllib3<3,>=1.21.1 in /opt/conda/lib/python3.10/site-packages (from requests<3,>=2.0.0->wandb) (1.26.18)\r\n",
      "Requirement already satisfied: certifi>=2017.4.17 in /opt/conda/lib/python3.10/site-packages (from requests<3,>=2.0.0->wandb) (2024.8.30)\r\n",
      "Requirement already satisfied: smmap<6,>=3.0.1 in /opt/conda/lib/python3.10/site-packages (from gitdb<5,>=4.0.1->gitpython!=3.1.29,>=1.0.0->wandb) (5.0.1)\r\n"
     ]
    }
   ],
   "source": [
    "!pip install wandb"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "88e36ad8",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-09T17:30:16.590326Z",
     "iopub.status.busy": "2024-10-09T17:30:16.589997Z",
     "iopub.status.idle": "2024-10-09T17:30:16.796439Z",
     "shell.execute_reply": "2024-10-09T17:30:16.795634Z"
    },
    "papermill": {
     "duration": 0.224776,
     "end_time": "2024-10-09T17:30:16.798566",
     "exception": false,
     "start_time": "2024-10-09T17:30:16.573790",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "from kaggle_secrets import UserSecretsClient\n",
    "user_secrets = UserSecretsClient()\n",
    "secret_value_0 = user_secrets.get_secret(\"wandb_api_key\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "3b100e05",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-09T17:30:16.830330Z",
     "iopub.status.busy": "2024-10-09T17:30:16.829579Z",
     "iopub.status.idle": "2024-10-09T17:30:18.642328Z",
     "shell.execute_reply": "2024-10-09T17:30:18.641307Z"
    },
    "papermill": {
     "duration": 1.830705,
     "end_time": "2024-10-09T17:30:18.644518",
     "exception": false,
     "start_time": "2024-10-09T17:30:16.813813",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\u001b[34m\u001b[1mwandb\u001b[0m: Using wandb-core as the SDK backend. Please refer to https://wandb.me/wandb-core for more information.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: W&B API key is configured. Use \u001b[1m`wandb login --relogin`\u001b[0m to force relogin\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \u001b[33mWARNING\u001b[0m If you're specifying your api key in code, ensure this code is not shared publicly.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \u001b[33mWARNING\u001b[0m Consider setting the WANDB_API_KEY environment variable, or running `wandb login` from the command line.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Appending key for api.wandb.ai to your netrc file: /root/.netrc\n"
     ]
    },
    {
     "data": {
      "text/plain": [
       "True"
      ]
     },
     "execution_count": 5,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "import wandb\n",
    "wandb.login(key=secret_value_0)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "dd4b2e48",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-09T17:30:18.677647Z",
     "iopub.status.busy": "2024-10-09T17:30:18.676946Z",
     "iopub.status.idle": "2024-10-09T17:30:24.436726Z",
     "shell.execute_reply": "2024-10-09T17:30:24.435924Z"
    },
    "papermill": {
     "duration": 5.778648,
     "end_time": "2024-10-09T17:30:24.438917",
     "exception": false,
     "start_time": "2024-10-09T17:30:18.660269",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "import sys\n",
    "from pathlib import Path\n",
    "\n",
    "# Add the 'data' directory to sys.path\n",
    "sys.path.append(str(Path('research-biocv-proj').resolve()))\n",
    "from data.unimodal import *\n",
    "from pathlib import Path\n",
    "\n",
    "import numpy as np\n",
    "import torch\n",
    "from torch.utils.data import DataLoader\n",
    "\n",
    "from sklearn.utils.class_weight import compute_class_weight"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "0d43dab7",
   "metadata": {
    "papermill": {
     "duration": 0.015136,
     "end_time": "2024-10-09T17:30:24.469705",
     "exception": false,
     "start_time": "2024-10-09T17:30:24.454569",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "### Train ResNet model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "b7e339c7",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-09T17:30:24.501842Z",
     "iopub.status.busy": "2024-10-09T17:30:24.500950Z",
     "iopub.status.idle": "2024-10-09T17:30:36.256556Z",
     "shell.execute_reply": "2024-10-09T17:30:36.255554Z"
    },
    "papermill": {
     "duration": 11.773991,
     "end_time": "2024-10-09T17:30:36.258890",
     "exception": false,
     "start_time": "2024-10-09T17:30:24.484899",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Collecting focal_loss_torch\r\n",
      "  Downloading focal_loss_torch-0.1.2-py3-none-any.whl.metadata (2.2 kB)\r\n",
      "Requirement already satisfied: torch in /opt/conda/lib/python3.10/site-packages (from focal_loss_torch) (2.4.0)\r\n",
      "Requirement already satisfied: numpy in /opt/conda/lib/python3.10/site-packages (from focal_loss_torch) (1.26.4)\r\n",
      "Requirement already satisfied: filelock in /opt/conda/lib/python3.10/site-packages (from torch->focal_loss_torch) (3.15.1)\r\n",
      "Requirement already satisfied: typing-extensions>=4.8.0 in /opt/conda/lib/python3.10/site-packages (from torch->focal_loss_torch) (4.12.2)\r\n",
      "Requirement already satisfied: sympy in /opt/conda/lib/python3.10/site-packages (from torch->focal_loss_torch) (1.13.3)\r\n",
      "Requirement already satisfied: networkx in /opt/conda/lib/python3.10/site-packages (from torch->focal_loss_torch) (3.3)\r\n",
      "Requirement already satisfied: jinja2 in /opt/conda/lib/python3.10/site-packages (from torch->focal_loss_torch) (3.1.4)\r\n",
      "Requirement already satisfied: fsspec in /opt/conda/lib/python3.10/site-packages (from torch->focal_loss_torch) (2024.6.1)\r\n",
      "Requirement already satisfied: MarkupSafe>=2.0 in /opt/conda/lib/python3.10/site-packages (from jinja2->torch->focal_loss_torch) (2.1.5)\r\n",
      "Requirement already satisfied: mpmath<1.4,>=1.1.0 in /opt/conda/lib/python3.10/site-packages (from sympy->torch->focal_loss_torch) (1.3.0)\r\n",
      "Downloading focal_loss_torch-0.1.2-py3-none-any.whl (4.5 kB)\r\n",
      "Installing collected packages: focal_loss_torch\r\n",
      "Successfully installed focal_loss_torch-0.1.2\r\n"
     ]
    }
   ],
   "source": [
    "#https://github.com/mathiaszinnen/focal_loss_torch/tree/main\n",
    "!pip install focal_loss_torch"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "28a4e9be",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-09T17:30:36.292826Z",
     "iopub.status.busy": "2024-10-09T17:30:36.292457Z",
     "iopub.status.idle": "2024-10-09T17:30:36.303999Z",
     "shell.execute_reply": "2024-10-09T17:30:36.303128Z"
    },
    "papermill": {
     "duration": 0.030692,
     "end_time": "2024-10-09T17:30:36.305882",
     "exception": false,
     "start_time": "2024-10-09T17:30:36.275190",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "class EarlyStopping:\n",
    "    \"\"\"Early stops the training if validation loss doesn't improve after a given patience.\"\"\"\n",
    "    def __init__(self, patience=7, verbose=False, delta=0, path='checkpoint.pt', trace_func=print):\n",
    "        \"\"\"\n",
    "        Args:\n",
    "            patience (int): How long to wait after last time validation loss improved.\n",
    "                            Default: 7\n",
    "            verbose (bool): If True, prints a message for each validation loss improvement. \n",
    "                            Default: False\n",
    "            delta (float): Minimum change in the monitored quantity to qualify as an improvement.\n",
    "                            Default: 0\n",
    "            path (str): Path for the checkpoint to be saved to.\n",
    "                            Default: 'checkpoint.pt'\n",
    "            trace_func (function): trace print function.\n",
    "                            Default: print            \n",
    "        \"\"\"\n",
    "        self.patience = patience\n",
    "        self.verbose = verbose\n",
    "        self.counter = 0\n",
    "        self.best_score = None\n",
    "        self.early_stop = False\n",
    "        self.val_loss_min = np.Inf\n",
    "        self.delta = delta\n",
    "        self.path = path\n",
    "        self.trace_func = trace_func\n",
    "    def __call__(self, val_loss, model):\n",
    "\n",
    "        score = -val_loss\n",
    "\n",
    "        if self.best_score is None:\n",
    "            self.best_score = score\n",
    "            self.save_checkpoint(val_loss, model)\n",
    "        elif score < self.best_score + self.delta:\n",
    "            self.counter += 1\n",
    "            self.trace_func(f'EarlyStopping counter: {self.counter} out of {self.patience}')\n",
    "            if self.counter >= self.patience:\n",
    "                self.early_stop = True\n",
    "        else:\n",
    "            self.best_score = score\n",
    "            self.save_checkpoint(val_loss, model)\n",
    "            self.counter = 0\n",
    "\n",
    "    def save_checkpoint(self, val_loss, model):\n",
    "        '''Saves model when validation loss decrease.'''\n",
    "        if self.verbose:\n",
    "            self.trace_func(f'Validation loss decreased ({self.val_loss_min:.6f} --> {val_loss:.6f}).  Saving model ...')\n",
    "        torch.save(model.state_dict(), self.path)\n",
    "        self.val_loss_min = val_loss"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "8b672b5f",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-09T17:30:36.339006Z",
     "iopub.status.busy": "2024-10-09T17:30:36.338699Z",
     "iopub.status.idle": "2024-10-09T17:30:36.367501Z",
     "shell.execute_reply": "2024-10-09T17:30:36.366785Z"
    },
    "papermill": {
     "duration": 0.047782,
     "end_time": "2024-10-09T17:30:36.369362",
     "exception": false,
     "start_time": "2024-10-09T17:30:36.321580",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "from focal_loss.focal_loss import FocalLoss\n",
    "\n",
    "def train(model, train_loader,val_loader, config, run_name=None):\n",
    "    \n",
    "    wandb.init(\n",
    "        # set the wandb project where this run will be logged\n",
    "        project=\"optuna_unimodal_ct_training\",\n",
    "        name = run_name,\n",
    "        # track hyperparameters and run metadata\n",
    "        config=config\n",
    "    )\n",
    "    device = torch.device(\"cuda\" if torch.cuda.is_available() else \"cpu\")\n",
    "    if config[\"class_weights\"] is not None: \n",
    "        config[\"class_weights\"] = torch.tensor(config[\"class_weights\"], dtype=torch.float).to(device) \n",
    "    optimizer = optim.Adam(model.parameters(), lr=config[\"learning_rate\"], weight_decay=config[\"weight_decay\"])\n",
    "    if config[\"focal_loss\"] is not None:\n",
    "        \n",
    "        criterion = FocalLoss(gamma = config[\"focal_loss\"])\n",
    "    else:\n",
    "        criterion = nn.CrossEntropyLoss(weight = config[\"class_weights\"])\n",
    "    scheduler = optim.lr_scheduler.ReduceLROnPlateau(optimizer, 'min',factor = config[\"reduce_lr_factor\"], patience = config[\"patience\"])\n",
    "    \n",
    "    # initialize the early_stopping object\n",
    "    early_stopping = EarlyStopping(patience=config[\"early_stop_patience\"], verbose=True)\n",
    "    \n",
    "    # Training loop\n",
    "    num_epochs = config[\"epochs\"]\n",
    "    for epoch in range(num_epochs):\n",
    "        model.train()\n",
    "        running_loss = 0.0\n",
    "        train_correct = 0\n",
    "        total = 0\n",
    "        correct_per_class = [0, 0, 0]  # For G1, G2, G3\n",
    "        total_per_class = [0, 0, 0]  # For G1, G2, G3\n",
    "        for batch in train_loader:\n",
    "            frames = batch['frame'].float().to(device)\n",
    "            labels = batch['label'].long().to(device)\n",
    "            \n",
    "            optimizer.zero_grad()\n",
    "            outputs = model(frames)\n",
    "            if config[\"focal_loss\"]:\n",
    "                softmax = torch.nn.Softmax(dim=-1)\n",
    "                loss = criterion(softmax(outputs.logits), labels)\n",
    "            else:\n",
    "                loss = criterion(outputs.logits, labels)\n",
    "\n",
    "            \n",
    "            _, predicted = torch.max(outputs.logits, 1)\n",
    "            train_correct += (predicted == labels).sum().item()\n",
    "            loss.backward()\n",
    "            optimizer.step()\n",
    "            total += labels.size(0)\n",
    "            running_loss += loss.item()\n",
    "            \n",
    "            # Calculate accuracy per class\n",
    "            for i in range(3):  # We have 3 classes: G1 (0), G2 (1), G3 (2)\n",
    "                correct_per_class[i] += ((predicted == i) & (labels == i)).sum().item()\n",
    "                total_per_class[i] += (labels == i).sum().item()\n",
    "\n",
    "        train_accuracy = 100 * train_correct / total\n",
    "        class_accuracy = [(100 * correct_per_class[i] / total_per_class[i]) if total_per_class[i] > 0 else 0 for i in range(3)]\n",
    "        print(f\"Epoch {epoch+1}, Loss: {running_loss/len(train_loader)}\")\n",
    "        wandb.log({\"Train Accuracy\": train_accuracy, \"Train loss\": running_loss/len(train_loader), \"G1_TrainAcc\":class_accuracy[0], \"G2_TrainAcc\":class_accuracy[1], \"G3_TrainAcc\":class_accuracy[2]})\n",
    "\n",
    "        # Validation loop\n",
    "        model.eval()\n",
    "        val_loss = 0.0\n",
    "        correct = 0\n",
    "        total = 0\n",
    "        # Initialize counters for each class (G1, G2, G3)\n",
    "        correct_per_class = [0, 0, 0]  # For G1, G2, G3\n",
    "        total_per_class = [0, 0, 0]  # For G1, G2, G3\n",
    "        val_labels = []\n",
    "        val_predictions = []\n",
    "\n",
    "\n",
    "        with torch.no_grad():\n",
    "            for batch in val_loader:\n",
    "                frames = batch['frame'].float().to(device)\n",
    "                labels = batch['label'].long().to(device)\n",
    "\n",
    "                outputs = model(frames)\n",
    "                \n",
    "                if config[\"focal_loss\"]:\n",
    "                    softmax = torch.nn.Softmax(dim=-1)\n",
    "                    loss = criterion(softmax(outputs.logits), labels)\n",
    "                else:\n",
    "                    loss = criterion(outputs.logits, labels)\n",
    "\n",
    "                val_loss += loss.item()\n",
    "                _, predicted = torch.max(outputs.logits, 1)\n",
    "                total += labels.size(0)\n",
    "                correct += (predicted == labels).sum().item()\n",
    "\n",
    "                # Calculate accuracy per class\n",
    "                for i in range(3):  # We have 3 classes: G1 (0), G2 (1), G3 (2)\n",
    "                    correct_per_class[i] += ((predicted == i) & (labels == i)).sum().item()\n",
    "                    total_per_class[i] += (labels == i).sum().item()\n",
    "                \n",
    "                val_labels.extend(labels.cpu().tolist())\n",
    "                val_predictions.extend(predicted.cpu().tolist())\n",
    "        \n",
    "        scheduler.step(val_loss)\n",
    "        \n",
    "        # Compute total accuracy and per-class accuracy\n",
    "       \n",
    "        total_accuracy = 100 * correct / total\n",
    "        class_accuracy = [(100 * correct_per_class[i] / total_per_class[i]) if total_per_class[i] > 0 else 0 for i in range(3)]\n",
    "        print(f\"Validation Loss: {val_loss/len(val_loader)}, Total Accuracy: {total_accuracy:.2f}%\")\n",
    "        print(f\"Accuracy per class - G1: {class_accuracy[0]:.2f}%, G2: {class_accuracy[1]:.2f}%, G3: {class_accuracy[2]:.2f}%\")\n",
    "        # log metrics to wandb\n",
    "        wandb.log({\n",
    "            \"Total Accuracy\": total_accuracy, \n",
    "            \"Validation Loss\": val_loss/len(val_loader), \n",
    "            \"G1_Acc\":class_accuracy[0], \n",
    "            \"G2_Acc\":class_accuracy[1], \n",
    "            \"G3_Acc\":class_accuracy[2]\n",
    "        })\n",
    "        \n",
    "        \n",
    "        early_stopping(val_loss, model)\n",
    "        \n",
    "        if early_stopping.early_stop:\n",
    "            print(\"Early stopping\")\n",
    "            break\n",
    "    wandb.finish()\n",
    "    return "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "80c22bb9",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-09T17:30:36.402158Z",
     "iopub.status.busy": "2024-10-09T17:30:36.401606Z",
     "iopub.status.idle": "2024-10-09T17:30:37.894002Z",
     "shell.execute_reply": "2024-10-09T17:30:37.893229Z"
    },
    "papermill": {
     "duration": 1.511475,
     "end_time": "2024-10-09T17:30:37.896403",
     "exception": false,
     "start_time": "2024-10-09T17:30:36.384928",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "import torch.nn as nn\n",
    "import torch.optim as optim\n",
    "from transformers import ResNetForImageClassification\n",
    "from sklearn.model_selection import StratifiedGroupKFold #For crossvalidation"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "189c8c2e",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-09T17:30:37.929760Z",
     "iopub.status.busy": "2024-10-09T17:30:37.929095Z",
     "iopub.status.idle": "2024-10-09T17:30:37.934941Z",
     "shell.execute_reply": "2024-10-09T17:30:37.934146Z"
    },
    "papermill": {
     "duration": 0.024657,
     "end_time": "2024-10-09T17:30:37.937031",
     "exception": false,
     "start_time": "2024-10-09T17:30:37.912374",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "transform = transforms.Compose([\n",
    "        transforms.ToTensor(),    \n",
    "        # Apply a random subset of the following transformations\n",
    "        transforms.RandomApply([\n",
    "            transforms.RandomRotation(degrees=10),       # Random rotation\n",
    "            transforms.ColorJitter(brightness=0.2, contrast=0.2),  # Adjust brightness/contrast\n",
    "            transforms.GaussianBlur(kernel_size=(5,5),sigma=(0.1,0.5))\n",
    "        ], p=0.5),  # Only apply the above transformations with a probability of 0.5\n",
    "    ])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "28b72c34",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-09T17:30:37.970971Z",
     "iopub.status.busy": "2024-10-09T17:30:37.970290Z",
     "iopub.status.idle": "2024-10-09T17:30:52.812535Z",
     "shell.execute_reply": "2024-10-09T17:30:52.811601Z"
    },
    "papermill": {
     "duration": 14.861302,
     "end_time": "2024-10-09T17:30:52.815140",
     "exception": false,
     "start_time": "2024-10-09T17:30:37.953838",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "train_dataset = UnimodalCTDataset(split='all',dataset_path = \"/kaggle/input/preprocessed57patientscptacpda/processed/\", transform = transform )"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "id": "f7ba5312",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-09T17:30:52.848600Z",
     "iopub.status.busy": "2024-10-09T17:30:52.848267Z",
     "iopub.status.idle": "2024-10-09T17:30:52.852010Z",
     "shell.execute_reply": "2024-10-09T17:30:52.851151Z"
    },
    "papermill": {
     "duration": 0.022394,
     "end_time": "2024-10-09T17:30:52.853964",
     "exception": false,
     "start_time": "2024-10-09T17:30:52.831570",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "#print(f\"Training set stats:{train_dataset.stats()}\")\n",
    "#print(f\"Validation set stats:{val_dataset.stats()}\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 14,
   "id": "fa31a95a",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-09T17:30:52.887147Z",
     "iopub.status.busy": "2024-10-09T17:30:52.886814Z",
     "iopub.status.idle": "2024-10-09T17:30:52.892548Z",
     "shell.execute_reply": "2024-10-09T17:30:52.891699Z"
    },
    "papermill": {
     "duration": 0.024503,
     "end_time": "2024-10-09T17:30:52.894485",
     "exception": false,
     "start_time": "2024-10-09T17:30:52.869982",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "'\\nlabels = []\\nfor sample in train_dataset:\\n    labels.append(sample[\"label\"])\\nlabels = np.array(labels)\\nclass_weights = compute_class_weight(\"balanced\", classes=np.unique(labels), y=labels)\\n'"
      ]
     },
     "execution_count": 14,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "\"\"\"\n",
    "labels = []\n",
    "for sample in train_dataset:\n",
    "    labels.append(sample[\"label\"])\n",
    "labels = np.array(labels)\n",
    "class_weights = compute_class_weight(\"balanced\", classes=np.unique(labels), y=labels)\n",
    "\"\"\""
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 15,
   "id": "01c13ddb",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-09T17:30:52.926998Z",
     "iopub.status.busy": "2024-10-09T17:30:52.926706Z",
     "iopub.status.idle": "2024-10-09T17:30:52.930341Z",
     "shell.execute_reply": "2024-10-09T17:30:52.929514Z"
    },
    "papermill": {
     "duration": 0.022137,
     "end_time": "2024-10-09T17:30:52.932172",
     "exception": false,
     "start_time": "2024-10-09T17:30:52.910035",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "#print(class_weights)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 16,
   "id": "7dc94acc",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-09T17:30:52.964749Z",
     "iopub.status.busy": "2024-10-09T17:30:52.964478Z",
     "iopub.status.idle": "2024-10-09T17:30:52.968147Z",
     "shell.execute_reply": "2024-10-09T17:30:52.967333Z"
    },
    "papermill": {
     "duration": 0.02176,
     "end_time": "2024-10-09T17:30:52.969920",
     "exception": false,
     "start_time": "2024-10-09T17:30:52.948160",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "#train_dataset = UnimodalCTDataset(split='train',dataset_path = \"/kaggle/input/oversampling57patientscptacpda/processed_oversampling/\" )\n",
    "#val_dataset = UnimodalCTDataset(split='val',dataset_path = \"/kaggle/input/oversampling57patientscptacpda/processed_oversampling/\")\n",
    "\n",
    "#train_loader = DataLoader(train_dataset, batch_size=32, shuffle=True)\n",
    "#val_loader = DataLoader(val_dataset, batch_size=32, shuffle=False)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 17,
   "id": "b231d1ce",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-09T17:30:53.003842Z",
     "iopub.status.busy": "2024-10-09T17:30:53.003561Z",
     "iopub.status.idle": "2024-10-09T17:30:53.007138Z",
     "shell.execute_reply": "2024-10-09T17:30:53.006298Z"
    },
    "papermill": {
     "duration": 0.023308,
     "end_time": "2024-10-09T17:30:53.008962",
     "exception": false,
     "start_time": "2024-10-09T17:30:52.985654",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "#print(f\"Training set stats:{train_dataset.stats()}\")\n",
    "#print(f\"Validation set stats:{val_dataset.stats()}\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 18,
   "id": "9327a1f7",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-09T17:30:53.041983Z",
     "iopub.status.busy": "2024-10-09T17:30:53.041693Z",
     "iopub.status.idle": "2024-10-09T17:30:53.045840Z",
     "shell.execute_reply": "2024-10-09T17:30:53.044799Z"
    },
    "papermill": {
     "duration": 0.022458,
     "end_time": "2024-10-09T17:30:53.047756",
     "exception": false,
     "start_time": "2024-10-09T17:30:53.025298",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "#total = train_dataset.stats()[\"length\"]\n",
    "#most_frequent = max(train_dataset.stats()[\"class_frequency\"].values())\n",
    "#freq_dict = train_dataset.stats()[\"class_frequency\"]\n",
    "#target_volume_depth= {}\n",
    "#for index in freq_dict.keys():\n",
    "#    target_volume_depth[index] = int((total/3 ) * most_frequent / freq_dict[index])\n",
    "#print(target_volume_depth)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "7e1f6992",
   "metadata": {
    "papermill": {
     "duration": 0.015597,
     "end_time": "2024-10-09T17:30:53.079372",
     "exception": false,
     "start_time": "2024-10-09T17:30:53.063775",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "### Resnet-50"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 19,
   "id": "6781b266",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-09T17:30:53.112670Z",
     "iopub.status.busy": "2024-10-09T17:30:53.111956Z",
     "iopub.status.idle": "2024-10-09T17:30:53.115849Z",
     "shell.execute_reply": "2024-10-09T17:30:53.114968Z"
    },
    "papermill": {
     "duration": 0.022578,
     "end_time": "2024-10-09T17:30:53.117803",
     "exception": false,
     "start_time": "2024-10-09T17:30:53.095225",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "#model = ResNetForImageClassification.from_pretrained('microsoft/resnet-50')\n",
    "#model.classifier[-1] = nn.Linear(model.classifier[-1].in_features, UnimodalCTDataset.num_classes) #Adjusting the final layer to the unimodal number of classes"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 20,
   "id": "474faa09",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-09T17:30:53.150703Z",
     "iopub.status.busy": "2024-10-09T17:30:53.150404Z",
     "iopub.status.idle": "2024-10-09T17:30:53.153994Z",
     "shell.execute_reply": "2024-10-09T17:30:53.153127Z"
    },
    "papermill": {
     "duration": 0.022443,
     "end_time": "2024-10-09T17:30:53.156050",
     "exception": false,
     "start_time": "2024-10-09T17:30:53.133607",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "#device = torch.device(\"cuda\" if torch.cuda.is_available() else \"cpu\")\n",
    "#model.to(device)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 21,
   "id": "4d050c03",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-09T17:30:53.190007Z",
     "iopub.status.busy": "2024-10-09T17:30:53.189669Z",
     "iopub.status.idle": "2024-10-09T17:30:53.195325Z",
     "shell.execute_reply": "2024-10-09T17:30:53.194464Z"
    },
    "papermill": {
     "duration": 0.02493,
     "end_time": "2024-10-09T17:30:53.197624",
     "exception": false,
     "start_time": "2024-10-09T17:30:53.172694",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "'\\nconfig={\\n    \"learning_rate\": 1e-4,\\n    \"architecture\": \"microsoft/resnet-50 new1\",\\n    \"epochs\": 100,\\n    \"weight_decay\": 1e-4,\\n    \"reduce_lr_factor\": 0.2,\\n    \"patience\": 10,\\n    \"class_weights\": class_weights\\n    }\\ntrain(model, config, run_name = config[\"architecture\"])\\n'"
      ]
     },
     "execution_count": 21,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "\"\"\"\n",
    "config={\n",
    "    \"learning_rate\": 1e-4,\n",
    "    \"architecture\": \"microsoft/resnet-50 new1\",\n",
    "    \"epochs\": 100,\n",
    "    \"weight_decay\": 1e-4,\n",
    "    \"reduce_lr_factor\": 0.2,\n",
    "    \"patience\": 10,\n",
    "    \"class_weights\": class_weights\n",
    "    }\n",
    "train(model, config, run_name = config[\"architecture\"])\n",
    "\"\"\""
   ]
  },
  {
   "cell_type": "markdown",
   "id": "fa147a66",
   "metadata": {
    "papermill": {
     "duration": 0.015524,
     "end_time": "2024-10-09T17:30:53.228920",
     "exception": false,
     "start_time": "2024-10-09T17:30:53.213396",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "### Resnet-18"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 22,
   "id": "eb7557eb",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-09T17:30:53.261781Z",
     "iopub.status.busy": "2024-10-09T17:30:53.261479Z",
     "iopub.status.idle": "2024-10-09T17:30:53.267115Z",
     "shell.execute_reply": "2024-10-09T17:30:53.266214Z"
    },
    "papermill": {
     "duration": 0.024262,
     "end_time": "2024-10-09T17:30:53.269048",
     "exception": false,
     "start_time": "2024-10-09T17:30:53.244786",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "'\\nconfig={\\n    \"learning_rate\": 1e-7,\\n    \"architecture\": \"microsoft/resnet-18\",\\n    \"run_name\": \"microsoft/resnet-18 NOOVERSAMPLING FOCALLOSS\",\\n    \"epochs\": 800,\\n    \"weight_decay\": 1e-6,\\n    \"reduce_lr_factor\": 0.25,\\n    \"patience\": 20,\\n    \"early_stop_patience\": 40,\\n    \"class_weights\": None,\\n    \"focal_loss\": 2\\n    }\\n\\n'"
      ]
     },
     "execution_count": 22,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "\"\"\"\n",
    "config={\n",
    "    \"learning_rate\": 1e-7,\n",
    "    \"architecture\": \"microsoft/resnet-18\",\n",
    "    \"run_name\": \"microsoft/resnet-18 NOOVERSAMPLING FOCALLOSS\",\n",
    "    \"epochs\": 800,\n",
    "    \"weight_decay\": 1e-6,\n",
    "    \"reduce_lr_factor\": 0.25,\n",
    "    \"patience\": 20,\n",
    "    \"early_stop_patience\": 40,\n",
    "    \"class_weights\": None,\n",
    "    \"focal_loss\": 2\n",
    "    }\n",
    "\n",
    "\"\"\"\n",
    "\n",
    "\n"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "caa6eac7",
   "metadata": {
    "papermill": {
     "duration": 0.015794,
     "end_time": "2024-10-09T17:30:53.300696",
     "exception": false,
     "start_time": "2024-10-09T17:30:53.284902",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "### Resnet-34"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 23,
   "id": "75f2ae89",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-09T17:30:53.334777Z",
     "iopub.status.busy": "2024-10-09T17:30:53.334414Z",
     "iopub.status.idle": "2024-10-09T17:30:54.492024Z",
     "shell.execute_reply": "2024-10-09T17:30:54.491274Z"
    },
    "papermill": {
     "duration": 1.177077,
     "end_time": "2024-10-09T17:30:54.494024",
     "exception": false,
     "start_time": "2024-10-09T17:30:53.316947",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "068b0fec6cac401881602b731ed57f62",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "config.json:   0%|          | 0.00/69.5k [00:00<?, ?B/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "7bc0cbafe7294c5c8793f51d7a0e79ba",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "model.safetensors:   0%|          | 0.00/46.8M [00:00<?, ?B/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "model = ResNetForImageClassification.from_pretrained('microsoft/resnet-18')\n",
    "model.classifier[-1] = nn.Linear(model.classifier[-1].in_features, UnimodalCTDataset.num_classes) #Adjusting the final layer to the unimodal number of classes"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 24,
   "id": "53a6ffa4",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-09T17:30:54.529093Z",
     "iopub.status.busy": "2024-10-09T17:30:54.528760Z",
     "iopub.status.idle": "2024-10-09T17:30:54.534546Z",
     "shell.execute_reply": "2024-10-09T17:30:54.533668Z"
    },
    "papermill": {
     "duration": 0.026195,
     "end_time": "2024-10-09T17:30:54.537236",
     "exception": false,
     "start_time": "2024-10-09T17:30:54.511041",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "resnet.embedder.embedder.convolution.weight\n",
      "resnet.embedder.embedder.normalization.weight\n",
      "resnet.embedder.embedder.normalization.bias\n",
      "resnet.encoder.stages.0.layers.0.layer.0.convolution.weight\n",
      "resnet.encoder.stages.0.layers.0.layer.0.normalization.weight\n",
      "resnet.encoder.stages.0.layers.0.layer.0.normalization.bias\n",
      "resnet.encoder.stages.0.layers.0.layer.1.convolution.weight\n",
      "resnet.encoder.stages.0.layers.0.layer.1.normalization.weight\n",
      "resnet.encoder.stages.0.layers.0.layer.1.normalization.bias\n",
      "resnet.encoder.stages.0.layers.1.layer.0.convolution.weight\n",
      "resnet.encoder.stages.0.layers.1.layer.0.normalization.weight\n",
      "resnet.encoder.stages.0.layers.1.layer.0.normalization.bias\n",
      "resnet.encoder.stages.0.layers.1.layer.1.convolution.weight\n",
      "resnet.encoder.stages.0.layers.1.layer.1.normalization.weight\n",
      "resnet.encoder.stages.0.layers.1.layer.1.normalization.bias\n",
      "resnet.encoder.stages.1.layers.0.shortcut.convolution.weight\n",
      "resnet.encoder.stages.1.layers.0.shortcut.normalization.weight\n",
      "resnet.encoder.stages.1.layers.0.shortcut.normalization.bias\n",
      "resnet.encoder.stages.1.layers.0.layer.0.convolution.weight\n",
      "resnet.encoder.stages.1.layers.0.layer.0.normalization.weight\n",
      "resnet.encoder.stages.1.layers.0.layer.0.normalization.bias\n",
      "resnet.encoder.stages.1.layers.0.layer.1.convolution.weight\n",
      "resnet.encoder.stages.1.layers.0.layer.1.normalization.weight\n",
      "resnet.encoder.stages.1.layers.0.layer.1.normalization.bias\n",
      "resnet.encoder.stages.1.layers.1.layer.0.convolution.weight\n",
      "resnet.encoder.stages.1.layers.1.layer.0.normalization.weight\n",
      "resnet.encoder.stages.1.layers.1.layer.0.normalization.bias\n",
      "resnet.encoder.stages.1.layers.1.layer.1.convolution.weight\n",
      "resnet.encoder.stages.1.layers.1.layer.1.normalization.weight\n",
      "resnet.encoder.stages.1.layers.1.layer.1.normalization.bias\n",
      "resnet.encoder.stages.2.layers.0.shortcut.convolution.weight\n",
      "resnet.encoder.stages.2.layers.0.shortcut.normalization.weight\n",
      "resnet.encoder.stages.2.layers.0.shortcut.normalization.bias\n",
      "resnet.encoder.stages.2.layers.0.layer.0.convolution.weight\n",
      "resnet.encoder.stages.2.layers.0.layer.0.normalization.weight\n",
      "resnet.encoder.stages.2.layers.0.layer.0.normalization.bias\n",
      "resnet.encoder.stages.2.layers.0.layer.1.convolution.weight\n",
      "resnet.encoder.stages.2.layers.0.layer.1.normalization.weight\n",
      "resnet.encoder.stages.2.layers.0.layer.1.normalization.bias\n",
      "resnet.encoder.stages.2.layers.1.layer.0.convolution.weight\n",
      "resnet.encoder.stages.2.layers.1.layer.0.normalization.weight\n",
      "resnet.encoder.stages.2.layers.1.layer.0.normalization.bias\n",
      "resnet.encoder.stages.2.layers.1.layer.1.convolution.weight\n",
      "resnet.encoder.stages.2.layers.1.layer.1.normalization.weight\n",
      "resnet.encoder.stages.2.layers.1.layer.1.normalization.bias\n",
      "resnet.encoder.stages.3.layers.0.shortcut.convolution.weight\n",
      "resnet.encoder.stages.3.layers.0.shortcut.normalization.weight\n",
      "resnet.encoder.stages.3.layers.0.shortcut.normalization.bias\n",
      "resnet.encoder.stages.3.layers.0.layer.0.convolution.weight\n",
      "resnet.encoder.stages.3.layers.0.layer.0.normalization.weight\n",
      "resnet.encoder.stages.3.layers.0.layer.0.normalization.bias\n",
      "resnet.encoder.stages.3.layers.0.layer.1.convolution.weight\n",
      "resnet.encoder.stages.3.layers.0.layer.1.normalization.weight\n",
      "resnet.encoder.stages.3.layers.0.layer.1.normalization.bias\n",
      "resnet.encoder.stages.3.layers.1.layer.0.convolution.weight\n",
      "resnet.encoder.stages.3.layers.1.layer.0.normalization.weight\n",
      "resnet.encoder.stages.3.layers.1.layer.0.normalization.bias\n",
      "resnet.encoder.stages.3.layers.1.layer.1.convolution.weight\n",
      "resnet.encoder.stages.3.layers.1.layer.1.normalization.weight\n",
      "resnet.encoder.stages.3.layers.1.layer.1.normalization.bias\n",
      "classifier.1.weight\n",
      "classifier.1.bias\n"
     ]
    }
   ],
   "source": [
    "for name, param in model.named_parameters():\n",
    "    print(name)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 25,
   "id": "5ef59569",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-09T17:30:54.571633Z",
     "iopub.status.busy": "2024-10-09T17:30:54.571329Z",
     "iopub.status.idle": "2024-10-09T17:30:54.576274Z",
     "shell.execute_reply": "2024-10-09T17:30:54.575412Z"
    },
    "papermill": {
     "duration": 0.024377,
     "end_time": "2024-10-09T17:30:54.578166",
     "exception": false,
     "start_time": "2024-10-09T17:30:54.553789",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "for name, param in model.named_parameters():\n",
    "    if \"resnet.encoder.stages.3\" in name:\n",
    "        param.requires_grad = True\n",
    "    else:\n",
    "        param.requires_grad = False"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 26,
   "id": "710214b9",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-09T17:30:54.613038Z",
     "iopub.status.busy": "2024-10-09T17:30:54.612756Z",
     "iopub.status.idle": "2024-10-09T17:30:54.616617Z",
     "shell.execute_reply": "2024-10-09T17:30:54.615697Z"
    },
    "papermill": {
     "duration": 0.023676,
     "end_time": "2024-10-09T17:30:54.618569",
     "exception": false,
     "start_time": "2024-10-09T17:30:54.594893",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "#device = torch.device(\"cuda\" if torch.cuda.is_available() else \"cpu\")\n",
    "#model.to(device)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 27,
   "id": "7b4c2855",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-09T17:30:54.652861Z",
     "iopub.status.busy": "2024-10-09T17:30:54.652574Z",
     "iopub.status.idle": "2024-10-09T17:30:54.658401Z",
     "shell.execute_reply": "2024-10-09T17:30:54.657574Z"
    },
    "papermill": {
     "duration": 0.025455,
     "end_time": "2024-10-09T17:30:54.660439",
     "exception": false,
     "start_time": "2024-10-09T17:30:54.634984",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "'\\nconfig={\\n    \"learning_rate\": 5e-8,\\n    \"architecture\": \"microsoft/resnet-34\",\\n    \"run_name\": \"microsoft/resnet-34 NOOVERSAMPLING FOCALLOSS fold: \",\\n    \"epochs\": 2,\\n    \"weight_decay\": 1e-6,\\n    \"reduce_lr_factor\": 0.25,\\n    \"patience\": 20,\\n    \"early_stop_patience\": 40,\\n    \"class_weights\": None,\\n    \"focal_loss\": 5\\n    }\\n\\n'"
      ]
     },
     "execution_count": 27,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "\"\"\"\n",
    "config={\n",
    "    \"learning_rate\": 5e-8,\n",
    "    \"architecture\": \"microsoft/resnet-34\",\n",
    "    \"run_name\": \"microsoft/resnet-34 NOOVERSAMPLING FOCALLOSS fold: \",\n",
    "    \"epochs\": 2,\n",
    "    \"weight_decay\": 1e-6,\n",
    "    \"reduce_lr_factor\": 0.25,\n",
    "    \"patience\": 20,\n",
    "    \"early_stop_patience\": 40,\n",
    "    \"class_weights\": None,\n",
    "    \"focal_loss\": 5\n",
    "    }\n",
    "\n",
    "\"\"\"\n",
    "\n",
    "\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 28,
   "id": "9a163b66",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-09T17:30:54.695070Z",
     "iopub.status.busy": "2024-10-09T17:30:54.694549Z",
     "iopub.status.idle": "2024-10-09T17:30:54.700436Z",
     "shell.execute_reply": "2024-10-09T17:30:54.699582Z"
    },
    "papermill": {
     "duration": 0.025099,
     "end_time": "2024-10-09T17:30:54.702290",
     "exception": false,
     "start_time": "2024-10-09T17:30:54.677191",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "{'length': 3294, 'class_frequency': {'G1': 287, 'G2': 2076, 'G3': 931}}"
      ]
     },
     "execution_count": 28,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "train_dataset.stats()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 29,
   "id": "23e5bf57",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-09T17:30:54.737912Z",
     "iopub.status.busy": "2024-10-09T17:30:54.737623Z",
     "iopub.status.idle": "2024-10-09T17:30:54.741174Z",
     "shell.execute_reply": "2024-10-09T17:30:54.740438Z"
    },
    "papermill": {
     "duration": 0.023449,
     "end_time": "2024-10-09T17:30:54.743138",
     "exception": false,
     "start_time": "2024-10-09T17:30:54.719689",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "#!pip install optuna-integration"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 30,
   "id": "97c0e97d",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-09T17:30:54.778316Z",
     "iopub.status.busy": "2024-10-09T17:30:54.777959Z",
     "iopub.status.idle": "2024-10-10T00:29:23.445449Z",
     "shell.execute_reply": "2024-10-10T00:29:23.444420Z"
    },
    "papermill": {
     "duration": 25108.687563,
     "end_time": "2024-10-10T00:29:23.447600",
     "exception": false,
     "start_time": "2024-10-09T17:30:54.760037",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "[I 2024-10-09 17:30:54,905] A new study created in memory with name: no-name-0567e708-6a8c-40e3-85cb-311c85b2994a\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Currently logged in as: \u001b[33mpietro-caforio\u001b[0m (\u001b[33mpietro-caforio-politecnico-di-milano\u001b[0m). Use \u001b[1m`wandb login --relogin`\u001b[0m to force relogin\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Tracking run with wandb version 0.18.3\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run data is saved locally in \u001b[35m\u001b[1m/kaggle/working/wandb/run-20241009_173055-k2m8afnt\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run \u001b[1m`wandb offline`\u001b[0m to turn off syncing.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Syncing run \u001b[33m1optuna_run_0 microsoft/resnet-18 Frozen Layers Nooversampling Focallo1\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View project at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View run at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/k2m8afnt\u001b[0m\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Epoch 1, Loss: 1.007131708673684\n",
      "Validation Loss: 0.9235431064097654, Total Accuracy: 29.01%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.71%, G3: 100.00%\n",
      "Validation loss decreased (inf --> 19.394405).  Saving model ...\n",
      "Epoch 2, Loss: 0.9935685439282153\n",
      "Validation Loss: 0.9766109076639017, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 3, Loss: 0.9826564199953194\n",
      "Validation Loss: 0.9779768779519058, Total Accuracy: 28.70%\n",
      "Accuracy per class - G1: 2.44%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 2 out of 40\n",
      "Epoch 4, Loss: 0.9635864050991564\n",
      "Validation Loss: 1.0074430908120813, Total Accuracy: 28.40%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 99.46%\n",
      "EarlyStopping counter: 3 out of 40\n",
      "Epoch 5, Loss: 0.9487275840288185\n",
      "Validation Loss: 0.9706166537389869, Total Accuracy: 29.01%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.71%, G3: 100.00%\n",
      "EarlyStopping counter: 4 out of 40\n",
      "Epoch 6, Loss: 0.9406322750700525\n",
      "Validation Loss: 1.0074292983682382, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 5 out of 40\n",
      "Epoch 7, Loss: 0.9161188882517527\n",
      "Validation Loss: 0.9819919293125471, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 6 out of 40\n",
      "Epoch 8, Loss: 0.9123877444899225\n",
      "Validation Loss: 1.0294803606257552, Total Accuracy: 28.70%\n",
      "Accuracy per class - G1: 2.44%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 7 out of 40\n",
      "Epoch 9, Loss: 0.8984428231256554\n",
      "Validation Loss: 1.023520007197346, Total Accuracy: 29.01%\n",
      "Accuracy per class - G1: 2.44%, G2: 0.47%, G3: 100.00%\n",
      "EarlyStopping counter: 8 out of 40\n",
      "Epoch 10, Loss: 0.8854931557034872\n",
      "Validation Loss: 1.0249988571518944, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 9 out of 40\n",
      "Epoch 11, Loss: 0.8699566032513079\n",
      "Validation Loss: 1.041033034523328, Total Accuracy: 28.70%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.24%, G3: 100.00%\n",
      "EarlyStopping counter: 10 out of 40\n",
      "Epoch 12, Loss: 0.8669845785003111\n",
      "Validation Loss: 1.0815887758064837, Total Accuracy: 28.70%\n",
      "Accuracy per class - G1: 2.44%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 11 out of 40\n",
      "Epoch 13, Loss: 0.8521394456725523\n",
      "Validation Loss: 1.041669127487001, Total Accuracy: 28.70%\n",
      "Accuracy per class - G1: 2.44%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 12 out of 40\n",
      "Epoch 14, Loss: 0.8484844551028976\n",
      "Validation Loss: 1.0906976046306747, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 13 out of 40\n",
      "Epoch 15, Loss: 0.8344219966107104\n",
      "Validation Loss: 1.0718573008974392, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 14 out of 40\n",
      "Epoch 16, Loss: 0.8165545779538442\n",
      "Validation Loss: 1.113562525915248, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 15 out of 40\n",
      "Epoch 17, Loss: 0.7999997871467867\n",
      "Validation Loss: 1.1493663855251812, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 16 out of 40\n",
      "Epoch 18, Loss: 0.7993664321411087\n",
      "Validation Loss: 1.1528988943568297, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 17 out of 40\n",
      "Epoch 19, Loss: 0.7896553098437298\n",
      "Validation Loss: 1.1162841786586104, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 18 out of 40\n",
      "Epoch 20, Loss: 0.7704676562044994\n",
      "Validation Loss: 1.1651520654559135, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 19 out of 40\n",
      "Epoch 21, Loss: 0.7674934630652508\n",
      "Validation Loss: 1.120410960522436, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 20 out of 40\n",
      "Epoch 22, Loss: 0.7480342495872314\n",
      "Validation Loss: 1.1560409271291323, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 21 out of 40\n",
      "Epoch 23, Loss: 0.7540221612855612\n",
      "Validation Loss: 1.1474594681390695, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 22 out of 40\n",
      "Epoch 24, Loss: 0.7407746447856167\n",
      "Validation Loss: 1.1893498934805393, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 23 out of 40\n",
      "Epoch 25, Loss: 0.7409082378249571\n",
      "Validation Loss: 1.1853570554937636, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 24 out of 40\n",
      "Epoch 26, Loss: 0.7376230736094785\n",
      "Validation Loss: 1.134943734677065, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 25 out of 40\n",
      "Epoch 27, Loss: 0.7370204544929136\n",
      "Validation Loss: 1.182506294122764, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 26 out of 40\n",
      "Epoch 28, Loss: 0.7340991410864405\n",
      "Validation Loss: 1.2182515412569046, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 27 out of 40\n",
      "Epoch 29, Loss: 0.7376961485449091\n",
      "Validation Loss: 1.153030408457631, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 28 out of 40\n",
      "Epoch 30, Loss: 0.7281355814761427\n",
      "Validation Loss: 1.1939733124205045, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 29 out of 40\n",
      "Epoch 31, Loss: 0.732638524598386\n",
      "Validation Loss: 1.1864784320905095, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 30 out of 40\n",
      "Epoch 32, Loss: 0.7363255558961845\n",
      "Validation Loss: 1.2594631617622716, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 31 out of 40\n",
      "Epoch 33, Loss: 0.7236442113497171\n",
      "Validation Loss: 1.2091897720737117, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 32 out of 40\n",
      "Epoch 34, Loss: 0.716758117618331\n",
      "Validation Loss: 1.247593673744372, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 33 out of 40\n",
      "Epoch 35, Loss: 0.7198402928300651\n",
      "Validation Loss: 1.1941993641001838, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 34 out of 40\n",
      "Epoch 36, Loss: 0.7143194495913494\n",
      "Validation Loss: 1.2395170646763982, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 35 out of 40\n",
      "Epoch 37, Loss: 0.7107390833188252\n",
      "Validation Loss: 1.2472423025894732, Total Accuracy: 28.40%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 99.46%\n",
      "EarlyStopping counter: 36 out of 40\n",
      "Epoch 38, Loss: 0.7191625603710312\n",
      "Validation Loss: 1.2413843664385023, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 37 out of 40\n",
      "Epoch 39, Loss: 0.7105993890618704\n",
      "Validation Loss: 1.2244747508139837, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 38 out of 40\n",
      "Epoch 40, Loss: 0.7130082242460136\n",
      "Validation Loss: 1.260218934821231, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 39 out of 40\n",
      "Epoch 41, Loss: 0.7021709019879261\n",
      "Validation Loss: 1.223715627122493, Total Accuracy: 28.70%\n",
      "Accuracy per class - G1: 2.44%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 40 out of 40\n",
      "Early stopping\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\u001b[34m\u001b[1mwandb\u001b[0m:                                                                                \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run history:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run summary:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc 2.43902\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc 22.76423\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc 0\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc 0.90689\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc 100\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc 99.32976\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy 28.7037\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy 30.68783\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss 0.70217\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss 1.22372\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View run \u001b[33m1optuna_run_0 microsoft/resnet-18 Frozen Layers Nooversampling Focallo1\u001b[0m at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/k2m8afnt\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View project at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Synced 5 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Find logs at: \u001b[35m\u001b[1m./wandb/run-20241009_173055-k2m8afnt/logs\u001b[0m\n",
      "[I 2024-10-09 17:49:11,530] Trial 0 finished with value: 0.16405465139642353 and parameters: {'weight_decay': 5.973397900308422e-07, 'focal_loss': 1.9697661833403952}. Best is trial 0 with value: 0.16405465139642353.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Tracking run with wandb version 0.18.3\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run data is saved locally in \u001b[35m\u001b[1m/kaggle/working/wandb/run-20241009_174911-9ec44cpl\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run \u001b[1m`wandb offline`\u001b[0m to turn off syncing.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Syncing run \u001b[33m1optuna_run_1 microsoft/resnet-18 Frozen Layers Nooversampling Focallo2\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View project at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View run at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/9ec44cpl\u001b[0m\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Epoch 1, Loss: 1.0195670285856868\n",
      "Validation Loss: 0.9917078174295879, Total Accuracy: 8.33%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.24%, G3: 6.49%\n",
      "Validation loss decreased (inf --> 20.825864).  Saving model ...\n",
      "Epoch 2, Loss: 1.002742496599634\n",
      "Validation Loss: 1.087685489583583, Total Accuracy: 6.94%\n",
      "Accuracy per class - G1: 97.56%, G2: 0.00%, G3: 2.70%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 3, Loss: 0.990485495831593\n",
      "Validation Loss: 1.0500238509405226, Total Accuracy: 7.25%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 3.24%\n",
      "EarlyStopping counter: 2 out of 40\n",
      "Epoch 4, Loss: 0.9785310317234821\n",
      "Validation Loss: 1.0671960228965396, Total Accuracy: 6.79%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 1.62%\n",
      "EarlyStopping counter: 3 out of 40\n",
      "Epoch 5, Loss: 0.9686953217150217\n",
      "Validation Loss: 1.0878482390017736, Total Accuracy: 6.94%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.24%, G3: 1.62%\n",
      "EarlyStopping counter: 4 out of 40\n",
      "Epoch 6, Loss: 0.9525000316550932\n",
      "Validation Loss: 1.1151517622527622, Total Accuracy: 7.25%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 3.24%\n",
      "EarlyStopping counter: 5 out of 40\n",
      "Epoch 7, Loss: 0.943371143685766\n",
      "Validation Loss: 1.0847018314968973, Total Accuracy: 7.25%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 3.24%\n",
      "EarlyStopping counter: 6 out of 40\n",
      "Epoch 8, Loss: 0.9315220569989767\n",
      "Validation Loss: 1.124177729799634, Total Accuracy: 6.94%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 2.16%\n",
      "EarlyStopping counter: 7 out of 40\n",
      "Epoch 9, Loss: 0.9169597467744207\n",
      "Validation Loss: 1.1151357882079624, Total Accuracy: 6.64%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.24%, G3: 0.54%\n",
      "EarlyStopping counter: 8 out of 40\n",
      "Epoch 10, Loss: 0.903391360518444\n",
      "Validation Loss: 1.1371144141469682, Total Accuracy: 6.94%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 2.16%\n",
      "EarlyStopping counter: 9 out of 40\n",
      "Epoch 11, Loss: 0.8986252977187374\n",
      "Validation Loss: 1.1662680911166328, Total Accuracy: 7.10%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 2.70%\n",
      "EarlyStopping counter: 10 out of 40\n",
      "Epoch 12, Loss: 0.8866776809634933\n",
      "Validation Loss: 1.1655498831754638, Total Accuracy: 7.87%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.47%, G3: 4.32%\n",
      "EarlyStopping counter: 11 out of 40\n",
      "Epoch 13, Loss: 0.8755045640899475\n",
      "Validation Loss: 1.1654172472300983, Total Accuracy: 6.94%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.24%, G3: 1.62%\n",
      "EarlyStopping counter: 12 out of 40\n",
      "Epoch 14, Loss: 0.8713209219725735\n",
      "Validation Loss: 1.1572781269039427, Total Accuracy: 6.94%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 2.16%\n",
      "EarlyStopping counter: 13 out of 40\n",
      "Epoch 15, Loss: 0.8554026721471764\n",
      "Validation Loss: 1.1883352916865122, Total Accuracy: 7.10%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 2.70%\n",
      "EarlyStopping counter: 14 out of 40\n",
      "Epoch 16, Loss: 0.8541746189795345\n",
      "Validation Loss: 1.1649072943698793, Total Accuracy: 7.10%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.47%, G3: 1.62%\n",
      "EarlyStopping counter: 15 out of 40\n",
      "Epoch 17, Loss: 0.8449095379875367\n",
      "Validation Loss: 1.1801283561757632, Total Accuracy: 7.25%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 3.24%\n",
      "EarlyStopping counter: 16 out of 40\n",
      "Epoch 18, Loss: 0.8164351309638426\n",
      "Validation Loss: 1.181692969586168, Total Accuracy: 7.41%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 3.78%\n",
      "EarlyStopping counter: 17 out of 40\n",
      "Epoch 19, Loss: 0.8217302539262427\n",
      "Validation Loss: 1.2083875526274954, Total Accuracy: 6.94%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 2.16%\n",
      "EarlyStopping counter: 18 out of 40\n",
      "Epoch 20, Loss: 0.8050116903810616\n",
      "Validation Loss: 1.2186474062147594, Total Accuracy: 7.41%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 3.78%\n",
      "EarlyStopping counter: 19 out of 40\n",
      "Epoch 21, Loss: 0.8010315097958208\n",
      "Validation Loss: 1.2135381897290547, Total Accuracy: 7.72%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 4.86%\n",
      "EarlyStopping counter: 20 out of 40\n",
      "Epoch 22, Loss: 0.7860244756721588\n",
      "Validation Loss: 1.207004410525163, Total Accuracy: 8.18%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.24%, G3: 5.95%\n",
      "EarlyStopping counter: 21 out of 40\n",
      "Epoch 23, Loss: 0.784398560782513\n",
      "Validation Loss: 1.227614422639211, Total Accuracy: 7.41%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 3.78%\n",
      "EarlyStopping counter: 22 out of 40\n",
      "Epoch 24, Loss: 0.781681452170912\n",
      "Validation Loss: 1.253418273869015, Total Accuracy: 7.25%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 3.24%\n",
      "EarlyStopping counter: 23 out of 40\n",
      "Epoch 25, Loss: 0.7749980056142233\n",
      "Validation Loss: 1.2461979864608674, Total Accuracy: 7.25%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 3.24%\n",
      "EarlyStopping counter: 24 out of 40\n",
      "Epoch 26, Loss: 0.769088077976043\n",
      "Validation Loss: 1.2560143449476786, Total Accuracy: 7.25%\n",
      "Accuracy per class - G1: 97.56%, G2: 0.00%, G3: 3.78%\n",
      "EarlyStopping counter: 25 out of 40\n",
      "Epoch 27, Loss: 0.7727361303496073\n",
      "Validation Loss: 1.2579749726823397, Total Accuracy: 6.94%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 2.16%\n",
      "EarlyStopping counter: 26 out of 40\n",
      "Epoch 28, Loss: 0.7726417528577598\n",
      "Validation Loss: 1.2475575237047105, Total Accuracy: 7.72%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 4.86%\n",
      "EarlyStopping counter: 27 out of 40\n",
      "Epoch 29, Loss: 0.774569020213851\n",
      "Validation Loss: 1.2499093420448757, Total Accuracy: 7.41%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 3.78%\n",
      "EarlyStopping counter: 28 out of 40\n",
      "Epoch 30, Loss: 0.7733783973268715\n",
      "Validation Loss: 1.2435864557822545, Total Accuracy: 7.87%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 5.41%\n",
      "EarlyStopping counter: 29 out of 40\n",
      "Epoch 31, Loss: 0.766511298087706\n",
      "Validation Loss: 1.2722890980186916, Total Accuracy: 7.72%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 4.86%\n",
      "EarlyStopping counter: 30 out of 40\n",
      "Epoch 32, Loss: 0.7610300764980087\n",
      "Validation Loss: 1.2352468896479833, Total Accuracy: 7.56%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.24%, G3: 3.78%\n",
      "EarlyStopping counter: 31 out of 40\n",
      "Epoch 33, Loss: 0.7558347116033715\n",
      "Validation Loss: 1.2192591645178341, Total Accuracy: 7.41%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 3.78%\n",
      "EarlyStopping counter: 32 out of 40\n",
      "Epoch 34, Loss: 0.7604245299316315\n",
      "Validation Loss: 1.2562743904335159, Total Accuracy: 8.64%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 8.11%\n",
      "EarlyStopping counter: 33 out of 40\n",
      "Epoch 35, Loss: 0.7573104206337986\n",
      "Validation Loss: 1.2577302548147382, Total Accuracy: 8.02%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 5.95%\n",
      "EarlyStopping counter: 34 out of 40\n",
      "Epoch 36, Loss: 0.7563687218240944\n",
      "Validation Loss: 1.2782436673130309, Total Accuracy: 7.10%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 2.70%\n",
      "EarlyStopping counter: 35 out of 40\n",
      "Epoch 37, Loss: 0.749852252293782\n",
      "Validation Loss: 1.2347382732800074, Total Accuracy: 7.72%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 4.86%\n",
      "EarlyStopping counter: 36 out of 40\n",
      "Epoch 38, Loss: 0.7460567954793034\n",
      "Validation Loss: 1.2917778002364295, Total Accuracy: 7.41%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 3.78%\n",
      "EarlyStopping counter: 37 out of 40\n",
      "Epoch 39, Loss: 0.7443887386695448\n",
      "Validation Loss: 1.242489727480071, Total Accuracy: 8.02%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.24%, G3: 5.41%\n",
      "EarlyStopping counter: 38 out of 40\n",
      "Epoch 40, Loss: 0.7441543850554041\n",
      "Validation Loss: 1.3269286567256564, Total Accuracy: 8.33%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 7.03%\n",
      "EarlyStopping counter: 39 out of 40\n",
      "Epoch 41, Loss: 0.7430478025631733\n",
      "Validation Loss: 1.25446532028062, Total Accuracy: 7.87%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.00%, G3: 5.41%\n",
      "EarlyStopping counter: 40 out of 40\n",
      "Early stopping\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\u001b[34m\u001b[1mwandb\u001b[0m:                                                                                \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run history:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run summary:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc 100\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc 99.18699\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc 0\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc 1.08827\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc 5.40541\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc 7.10456\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy 7.87037\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy 11.90476\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss 0.74305\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss 1.25447\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View run \u001b[33m1optuna_run_1 microsoft/resnet-18 Frozen Layers Nooversampling Focallo2\u001b[0m at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/9ec44cpl\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View project at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Synced 5 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Find logs at: \u001b[35m\u001b[1m./wandb/run-20241009_174911-9ec44cpl/logs\u001b[0m\n",
      "[I 2024-10-09 18:07:35,481] Trial 1 finished with value: 0.07718544412885685 and parameters: {'weight_decay': 1.7247131058001213e-06, 'focal_loss': 2.3604692287373816}. Best is trial 0 with value: 0.16405465139642353.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Tracking run with wandb version 0.18.3\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run data is saved locally in \u001b[35m\u001b[1m/kaggle/working/wandb/run-20241009_180735-yyf85uh0\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run \u001b[1m`wandb offline`\u001b[0m to turn off syncing.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Syncing run \u001b[33m1optuna_run_2 microsoft/resnet-18 Frozen Layers Nooversampling Focallo3\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View project at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View run at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/yyf85uh0\u001b[0m\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Epoch 1, Loss: 1.0688651182565345\n",
      "Validation Loss: 1.1150715691702706, Total Accuracy: 24.85%\n",
      "Accuracy per class - G1: 2.44%, G2: 0.00%, G3: 86.49%\n",
      "Validation loss decreased (inf --> 23.416503).  Saving model ...\n",
      "Epoch 2, Loss: 1.060173058366201\n",
      "Validation Loss: 1.0564471022004174, Total Accuracy: 25.62%\n",
      "Accuracy per class - G1: 4.88%, G2: 0.00%, G3: 88.65%\n",
      "Validation loss decreased (23.416503 --> 22.185389).  Saving model ...\n",
      "Epoch 3, Loss: 1.0531622257577367\n",
      "Validation Loss: 1.0899460109926404, Total Accuracy: 22.99%\n",
      "Accuracy per class - G1: 4.88%, G2: 0.00%, G3: 79.46%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 4, Loss: 1.0329928426857453\n",
      "Validation Loss: 1.083135723358109, Total Accuracy: 22.22%\n",
      "Accuracy per class - G1: 7.32%, G2: 0.00%, G3: 76.22%\n",
      "EarlyStopping counter: 2 out of 40\n",
      "Epoch 5, Loss: 1.021226964801191\n",
      "Validation Loss: 1.071716158872559, Total Accuracy: 24.54%\n",
      "Accuracy per class - G1: 9.76%, G2: 0.00%, G3: 83.78%\n",
      "EarlyStopping counter: 3 out of 40\n",
      "Epoch 6, Loss: 1.009176173842097\n",
      "Validation Loss: 1.0999737949598403, Total Accuracy: 23.77%\n",
      "Accuracy per class - G1: 4.88%, G2: 0.00%, G3: 82.16%\n",
      "EarlyStopping counter: 4 out of 40\n",
      "Epoch 7, Loss: 1.0007665509200958\n",
      "Validation Loss: 1.0976591897862298, Total Accuracy: 25.15%\n",
      "Accuracy per class - G1: 14.63%, G2: 0.00%, G3: 84.86%\n",
      "EarlyStopping counter: 5 out of 40\n",
      "Epoch 8, Loss: 0.9761672831443419\n",
      "Validation Loss: 1.1355476187808173, Total Accuracy: 24.69%\n",
      "Accuracy per class - G1: 7.32%, G2: 0.00%, G3: 84.86%\n",
      "EarlyStopping counter: 6 out of 40\n",
      "Epoch 9, Loss: 0.9808779222419463\n",
      "Validation Loss: 1.1354200669697352, Total Accuracy: 22.84%\n",
      "Accuracy per class - G1: 4.88%, G2: 0.00%, G3: 78.92%\n",
      "EarlyStopping counter: 7 out of 40\n",
      "Epoch 10, Loss: 0.9686280718768936\n",
      "Validation Loss: 1.1333764968883424, Total Accuracy: 24.38%\n",
      "Accuracy per class - G1: 7.32%, G2: 0.00%, G3: 83.78%\n",
      "EarlyStopping counter: 8 out of 40\n",
      "Epoch 11, Loss: 0.9523670242493412\n",
      "Validation Loss: 1.1684419768197196, Total Accuracy: 23.46%\n",
      "Accuracy per class - G1: 4.88%, G2: 0.00%, G3: 81.08%\n",
      "EarlyStopping counter: 9 out of 40\n",
      "Epoch 12, Loss: 0.9381506543561636\n",
      "Validation Loss: 1.1882269425051553, Total Accuracy: 24.23%\n",
      "Accuracy per class - G1: 7.32%, G2: 0.00%, G3: 83.24%\n",
      "EarlyStopping counter: 10 out of 40\n",
      "Epoch 13, Loss: 0.9373000027185463\n",
      "Validation Loss: 1.204370691662743, Total Accuracy: 23.61%\n",
      "Accuracy per class - G1: 2.44%, G2: 0.00%, G3: 82.16%\n",
      "EarlyStopping counter: 11 out of 40\n",
      "Epoch 14, Loss: 0.920506606619042\n",
      "Validation Loss: 1.2208849858670008, Total Accuracy: 23.30%\n",
      "Accuracy per class - G1: 4.88%, G2: 0.00%, G3: 80.54%\n",
      "EarlyStopping counter: 12 out of 40\n",
      "Epoch 15, Loss: 0.9070032368223351\n",
      "Validation Loss: 1.2177004565795262, Total Accuracy: 22.99%\n",
      "Accuracy per class - G1: 9.76%, G2: 0.00%, G3: 78.38%\n",
      "EarlyStopping counter: 13 out of 40\n",
      "Epoch 16, Loss: 0.9033841102956289\n",
      "Validation Loss: 1.2537383110750289, Total Accuracy: 23.92%\n",
      "Accuracy per class - G1: 7.32%, G2: 0.00%, G3: 82.16%\n",
      "EarlyStopping counter: 14 out of 40\n",
      "Epoch 17, Loss: 0.8978643661522003\n",
      "Validation Loss: 1.2626488776434035, Total Accuracy: 24.54%\n",
      "Accuracy per class - G1: 7.32%, G2: 0.00%, G3: 84.32%\n",
      "EarlyStopping counter: 15 out of 40\n",
      "Epoch 18, Loss: 0.8817567092826567\n",
      "Validation Loss: 1.2595659324101038, Total Accuracy: 22.07%\n",
      "Accuracy per class - G1: 7.32%, G2: 0.00%, G3: 75.68%\n",
      "EarlyStopping counter: 16 out of 40\n",
      "Epoch 19, Loss: 0.868550950504211\n",
      "Validation Loss: 1.2748443328198933, Total Accuracy: 24.07%\n",
      "Accuracy per class - G1: 2.44%, G2: 0.00%, G3: 83.78%\n",
      "EarlyStopping counter: 17 out of 40\n",
      "Epoch 20, Loss: 0.8621161472366516\n",
      "Validation Loss: 1.30209542739959, Total Accuracy: 23.30%\n",
      "Accuracy per class - G1: 4.88%, G2: 0.00%, G3: 80.54%\n",
      "EarlyStopping counter: 18 out of 40\n",
      "Epoch 21, Loss: 0.8510592005339014\n",
      "Validation Loss: 1.2697623946837016, Total Accuracy: 24.69%\n",
      "Accuracy per class - G1: 4.88%, G2: 0.24%, G3: 84.86%\n",
      "EarlyStopping counter: 19 out of 40\n",
      "Epoch 22, Loss: 0.8422491981322506\n",
      "Validation Loss: 1.2999142309029896, Total Accuracy: 25.15%\n",
      "Accuracy per class - G1: 14.63%, G2: 0.47%, G3: 83.78%\n",
      "EarlyStopping counter: 20 out of 40\n",
      "Epoch 23, Loss: 0.8338665071740208\n",
      "Validation Loss: 1.350528502038547, Total Accuracy: 23.77%\n",
      "Accuracy per class - G1: 4.88%, G2: 0.00%, G3: 82.16%\n",
      "EarlyStopping counter: 21 out of 40\n",
      "Epoch 24, Loss: 0.832381471812007\n",
      "Validation Loss: 1.2827769148917425, Total Accuracy: 25.15%\n",
      "Accuracy per class - G1: 7.32%, G2: 0.00%, G3: 86.49%\n",
      "EarlyStopping counter: 22 out of 40\n",
      "Epoch 25, Loss: 0.8316583331808987\n",
      "Validation Loss: 1.3239208161830902, Total Accuracy: 22.84%\n",
      "Accuracy per class - G1: 2.44%, G2: 0.00%, G3: 79.46%\n",
      "EarlyStopping counter: 23 out of 40\n",
      "Epoch 26, Loss: 0.8283205305237368\n",
      "Validation Loss: 1.3214168562775566, Total Accuracy: 23.77%\n",
      "Accuracy per class - G1: 2.44%, G2: 0.00%, G3: 82.70%\n",
      "EarlyStopping counter: 24 out of 40\n",
      "Epoch 27, Loss: 0.8244680862828909\n",
      "Validation Loss: 1.3416243096192677, Total Accuracy: 23.15%\n",
      "Accuracy per class - G1: 2.44%, G2: 0.00%, G3: 80.54%\n",
      "EarlyStopping counter: 25 out of 40\n",
      "Epoch 28, Loss: 0.8254425791372736\n",
      "Validation Loss: 1.3793263477938515, Total Accuracy: 23.46%\n",
      "Accuracy per class - G1: 2.44%, G2: 0.00%, G3: 81.62%\n",
      "EarlyStopping counter: 26 out of 40\n",
      "Epoch 29, Loss: 0.8215406012822346\n",
      "Validation Loss: 1.3097172720091683, Total Accuracy: 22.07%\n",
      "Accuracy per class - G1: 2.44%, G2: 0.24%, G3: 76.22%\n",
      "EarlyStopping counter: 27 out of 40\n",
      "Epoch 30, Loss: 0.8159433373485703\n",
      "Validation Loss: 1.3490284652937026, Total Accuracy: 24.69%\n",
      "Accuracy per class - G1: 4.88%, G2: 0.24%, G3: 84.86%\n",
      "EarlyStopping counter: 28 out of 40\n",
      "Epoch 31, Loss: 0.8076947862843433\n",
      "Validation Loss: 1.356309704837345, Total Accuracy: 23.46%\n",
      "Accuracy per class - G1: 4.88%, G2: 0.00%, G3: 81.08%\n",
      "EarlyStopping counter: 29 out of 40\n",
      "Epoch 32, Loss: 0.8069171122757786\n",
      "Validation Loss: 1.3304001163868677, Total Accuracy: 23.30%\n",
      "Accuracy per class - G1: 7.32%, G2: 0.00%, G3: 80.00%\n",
      "EarlyStopping counter: 30 out of 40\n",
      "Epoch 33, Loss: 0.8102813564151167\n",
      "Validation Loss: 1.3664767472516923, Total Accuracy: 23.15%\n",
      "Accuracy per class - G1: 7.32%, G2: 0.00%, G3: 79.46%\n",
      "EarlyStopping counter: 31 out of 40\n",
      "Epoch 34, Loss: 0.805554891207132\n",
      "Validation Loss: 1.3769034005346752, Total Accuracy: 21.60%\n",
      "Accuracy per class - G1: 4.88%, G2: 0.00%, G3: 74.59%\n",
      "EarlyStopping counter: 32 out of 40\n",
      "Epoch 35, Loss: 0.8123154338583889\n",
      "Validation Loss: 1.365602670680909, Total Accuracy: 24.69%\n",
      "Accuracy per class - G1: 9.76%, G2: 0.00%, G3: 84.32%\n",
      "EarlyStopping counter: 33 out of 40\n",
      "Epoch 36, Loss: 0.8073948255504471\n",
      "Validation Loss: 1.351558187178203, Total Accuracy: 24.85%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.47%, G3: 85.95%\n",
      "EarlyStopping counter: 34 out of 40\n",
      "Epoch 37, Loss: 0.7952004211494722\n",
      "Validation Loss: 1.3403164460545494, Total Accuracy: 23.15%\n",
      "Accuracy per class - G1: 4.88%, G2: 0.00%, G3: 80.00%\n",
      "EarlyStopping counter: 35 out of 40\n",
      "Epoch 38, Loss: 0.798405417476792\n",
      "Validation Loss: 1.3835410560880388, Total Accuracy: 23.15%\n",
      "Accuracy per class - G1: 4.88%, G2: 0.00%, G3: 80.00%\n",
      "EarlyStopping counter: 36 out of 40\n",
      "Epoch 39, Loss: 0.7958129285329796\n",
      "Validation Loss: 1.3773796870594932, Total Accuracy: 25.00%\n",
      "Accuracy per class - G1: 9.76%, G2: 0.24%, G3: 84.86%\n",
      "EarlyStopping counter: 37 out of 40\n",
      "Epoch 40, Loss: 0.7999572847262922\n",
      "Validation Loss: 1.336176376967203, Total Accuracy: 23.61%\n",
      "Accuracy per class - G1: 4.88%, G2: 0.24%, G3: 81.08%\n",
      "EarlyStopping counter: 38 out of 40\n",
      "Epoch 41, Loss: 0.800318250455052\n",
      "Validation Loss: 1.4443841136637188, Total Accuracy: 23.61%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 82.70%\n",
      "EarlyStopping counter: 39 out of 40\n",
      "Epoch 42, Loss: 0.7926102919750903\n",
      "Validation Loss: 1.4295644064744313, Total Accuracy: 24.69%\n",
      "Accuracy per class - G1: 9.76%, G2: 0.47%, G3: 83.24%\n",
      "EarlyStopping counter: 40 out of 40\n",
      "Early stopping\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\u001b[34m\u001b[1mwandb\u001b[0m:                                                                                \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run history:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run summary:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc 9.7561\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc 64.63415\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc 0.47393\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc 4.53446\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc 83.24324\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc 90.75067\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy 24.69136\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy 34.42933\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss 0.79261\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss 1.42956\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View run \u001b[33m1optuna_run_2 microsoft/resnet-18 Frozen Layers Nooversampling Focallo3\u001b[0m at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/yyf85uh0\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View project at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Synced 5 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Find logs at: \u001b[35m\u001b[1m./wandb/run-20241009_180735-yyf85uh0/logs\u001b[0m\n",
      "[I 2024-10-09 18:26:25,855] Trial 2 finished with value: 0.1538259998458812 and parameters: {'weight_decay': 8.713925332681221e-07, 'focal_loss': 1.5833839105625234}. Best is trial 0 with value: 0.16405465139642353.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Tracking run with wandb version 0.18.3\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run data is saved locally in \u001b[35m\u001b[1m/kaggle/working/wandb/run-20241009_182626-zu60imuo\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run \u001b[1m`wandb offline`\u001b[0m to turn off syncing.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Syncing run \u001b[33m1optuna_run_3 microsoft/resnet-18 Frozen Layers Nooversampling Focallo4\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View project at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View run at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/zu60imuo\u001b[0m\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Epoch 1, Loss: 0.5459720133298851\n",
      "Validation Loss: 0.5804417729377747, Total Accuracy: 31.64%\n",
      "Accuracy per class - G1: 12.20%, G2: 30.81%, G3: 37.84%\n",
      "Validation loss decreased (inf --> 12.189277).  Saving model ...\n",
      "Epoch 2, Loss: 0.5336879782647972\n",
      "Validation Loss: 0.5670264519396282, Total Accuracy: 32.72%\n",
      "Accuracy per class - G1: 24.39%, G2: 32.70%, G3: 34.59%\n",
      "Validation loss decreased (12.189277 --> 11.907555).  Saving model ...\n",
      "Epoch 3, Loss: 0.5135106178651373\n",
      "Validation Loss: 0.5941933194796244, Total Accuracy: 27.47%\n",
      "Accuracy per class - G1: 31.71%, G2: 26.30%, G3: 29.19%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 4, Loss: 0.49715113783457193\n",
      "Validation Loss: 0.5961894733565194, Total Accuracy: 27.93%\n",
      "Accuracy per class - G1: 24.39%, G2: 26.78%, G3: 31.35%\n",
      "EarlyStopping counter: 2 out of 40\n",
      "Epoch 5, Loss: 0.48608695311718675\n",
      "Validation Loss: 0.605179427635102, Total Accuracy: 25.77%\n",
      "Accuracy per class - G1: 26.83%, G2: 26.07%, G3: 24.86%\n",
      "EarlyStopping counter: 3 out of 40\n",
      "Epoch 6, Loss: 0.47585099791905966\n",
      "Validation Loss: 0.6157544269448235, Total Accuracy: 22.07%\n",
      "Accuracy per class - G1: 19.51%, G2: 22.04%, G3: 22.70%\n",
      "EarlyStopping counter: 4 out of 40\n",
      "Epoch 7, Loss: 0.47066472955496913\n",
      "Validation Loss: 0.610580827508654, Total Accuracy: 25.15%\n",
      "Accuracy per class - G1: 17.07%, G2: 25.59%, G3: 25.95%\n",
      "EarlyStopping counter: 5 out of 40\n",
      "Epoch 8, Loss: 0.45744319242167186\n",
      "Validation Loss: 0.6149088896456218, Total Accuracy: 25.77%\n",
      "Accuracy per class - G1: 14.63%, G2: 27.01%, G3: 25.41%\n",
      "EarlyStopping counter: 6 out of 40\n",
      "Epoch 9, Loss: 0.4463448912264353\n",
      "Validation Loss: 0.624139252163115, Total Accuracy: 24.23%\n",
      "Accuracy per class - G1: 29.27%, G2: 22.99%, G3: 25.95%\n",
      "EarlyStopping counter: 7 out of 40\n",
      "Epoch 10, Loss: 0.44110723468194524\n",
      "Validation Loss: 0.6610087908449627, Total Accuracy: 18.98%\n",
      "Accuracy per class - G1: 9.76%, G2: 18.48%, G3: 22.16%\n",
      "EarlyStopping counter: 8 out of 40\n",
      "Epoch 11, Loss: 0.43590373195797566\n",
      "Validation Loss: 0.6359904607137045, Total Accuracy: 20.83%\n",
      "Accuracy per class - G1: 21.95%, G2: 20.14%, G3: 22.16%\n",
      "EarlyStopping counter: 9 out of 40\n",
      "Epoch 12, Loss: 0.4224869960761932\n",
      "Validation Loss: 0.6355359355608622, Total Accuracy: 21.30%\n",
      "Accuracy per class - G1: 21.95%, G2: 18.72%, G3: 27.03%\n",
      "EarlyStopping counter: 10 out of 40\n",
      "Epoch 13, Loss: 0.4186118191265198\n",
      "Validation Loss: 0.6763155729997725, Total Accuracy: 20.06%\n",
      "Accuracy per class - G1: 19.51%, G2: 19.91%, G3: 20.54%\n",
      "EarlyStopping counter: 11 out of 40\n",
      "Epoch 14, Loss: 0.40936264970216407\n",
      "Validation Loss: 0.6762302595944631, Total Accuracy: 18.21%\n",
      "Accuracy per class - G1: 17.07%, G2: 19.43%, G3: 15.68%\n",
      "EarlyStopping counter: 12 out of 40\n",
      "Epoch 15, Loss: 0.40878456974604044\n",
      "Validation Loss: 0.6820854729130155, Total Accuracy: 19.60%\n",
      "Accuracy per class - G1: 17.07%, G2: 20.62%, G3: 17.84%\n",
      "EarlyStopping counter: 13 out of 40\n",
      "Epoch 16, Loss: 0.40062746764665624\n",
      "Validation Loss: 0.6667308963480449, Total Accuracy: 18.98%\n",
      "Accuracy per class - G1: 19.51%, G2: 19.19%, G3: 18.38%\n",
      "EarlyStopping counter: 14 out of 40\n",
      "Epoch 17, Loss: 0.38853571716561375\n",
      "Validation Loss: 0.6918031232697623, Total Accuracy: 17.44%\n",
      "Accuracy per class - G1: 17.07%, G2: 17.30%, G3: 17.84%\n",
      "EarlyStopping counter: 15 out of 40\n",
      "Epoch 18, Loss: 0.386367469307888\n",
      "Validation Loss: 0.6903236423219953, Total Accuracy: 16.51%\n",
      "Accuracy per class - G1: 7.32%, G2: 15.88%, G3: 20.00%\n",
      "EarlyStopping counter: 16 out of 40\n",
      "Epoch 19, Loss: 0.3797987053193242\n",
      "Validation Loss: 0.6978483739353362, Total Accuracy: 19.29%\n",
      "Accuracy per class - G1: 21.95%, G2: 20.14%, G3: 16.76%\n",
      "EarlyStopping counter: 17 out of 40\n",
      "Epoch 20, Loss: 0.3739895576454071\n",
      "Validation Loss: 0.6961675406921477, Total Accuracy: 19.44%\n",
      "Accuracy per class - G1: 19.51%, G2: 19.67%, G3: 18.92%\n",
      "EarlyStopping counter: 18 out of 40\n",
      "Epoch 21, Loss: 0.3729197716856577\n",
      "Validation Loss: 0.7327042676153637, Total Accuracy: 15.90%\n",
      "Accuracy per class - G1: 9.76%, G2: 16.35%, G3: 16.22%\n",
      "EarlyStopping counter: 19 out of 40\n",
      "Epoch 22, Loss: 0.36397668396133975\n",
      "Validation Loss: 0.7204233301537377, Total Accuracy: 18.67%\n",
      "Accuracy per class - G1: 29.27%, G2: 19.43%, G3: 14.59%\n",
      "EarlyStopping counter: 20 out of 40\n",
      "Epoch 23, Loss: 0.3587897872350302\n",
      "Validation Loss: 0.7248080912090483, Total Accuracy: 20.22%\n",
      "Accuracy per class - G1: 26.83%, G2: 19.91%, G3: 19.46%\n",
      "EarlyStopping counter: 21 out of 40\n",
      "Epoch 24, Loss: 0.355467088969357\n",
      "Validation Loss: 0.7221553694634211, Total Accuracy: 18.36%\n",
      "Accuracy per class - G1: 26.83%, G2: 19.67%, G3: 13.51%\n",
      "EarlyStopping counter: 22 out of 40\n",
      "Epoch 25, Loss: 0.35045334804488953\n",
      "Validation Loss: 0.7283463094915662, Total Accuracy: 19.75%\n",
      "Accuracy per class - G1: 26.83%, G2: 18.72%, G3: 20.54%\n",
      "EarlyStopping counter: 23 out of 40\n",
      "Epoch 26, Loss: 0.3514952085104333\n",
      "Validation Loss: 0.7310836379017148, Total Accuracy: 16.82%\n",
      "Accuracy per class - G1: 24.39%, G2: 19.19%, G3: 9.73%\n",
      "EarlyStopping counter: 24 out of 40\n",
      "Epoch 27, Loss: 0.3540439020438367\n",
      "Validation Loss: 0.7457302950677418, Total Accuracy: 17.59%\n",
      "Accuracy per class - G1: 19.51%, G2: 19.67%, G3: 12.43%\n",
      "EarlyStopping counter: 25 out of 40\n",
      "Epoch 28, Loss: 0.34463026401508284\n",
      "Validation Loss: 0.7096702236504782, Total Accuracy: 18.98%\n",
      "Accuracy per class - G1: 21.95%, G2: 19.67%, G3: 16.76%\n",
      "EarlyStopping counter: 26 out of 40\n",
      "Epoch 29, Loss: 0.3528532360691622\n",
      "Validation Loss: 0.7410334973108201, Total Accuracy: 18.67%\n",
      "Accuracy per class - G1: 21.95%, G2: 20.85%, G3: 12.97%\n",
      "EarlyStopping counter: 27 out of 40\n",
      "Epoch 30, Loss: 0.34763724581304806\n",
      "Validation Loss: 0.739375631014506, Total Accuracy: 17.28%\n",
      "Accuracy per class - G1: 21.95%, G2: 17.54%, G3: 15.68%\n",
      "EarlyStopping counter: 28 out of 40\n",
      "Epoch 31, Loss: 0.3524851906730468\n",
      "Validation Loss: 0.7309207795631318, Total Accuracy: 17.90%\n",
      "Accuracy per class - G1: 19.51%, G2: 20.14%, G3: 12.43%\n",
      "EarlyStopping counter: 29 out of 40\n",
      "Epoch 32, Loss: 0.34238310930240584\n",
      "Validation Loss: 0.7414779549553281, Total Accuracy: 19.91%\n",
      "Accuracy per class - G1: 14.63%, G2: 22.27%, G3: 15.68%\n",
      "EarlyStopping counter: 30 out of 40\n",
      "Epoch 33, Loss: 0.34148619997214125\n",
      "Validation Loss: 0.7526100256613323, Total Accuracy: 17.13%\n",
      "Accuracy per class - G1: 12.20%, G2: 19.43%, G3: 12.97%\n",
      "EarlyStopping counter: 31 out of 40\n",
      "Epoch 34, Loss: 0.3409146188971508\n",
      "Validation Loss: 0.7346045062655494, Total Accuracy: 18.83%\n",
      "Accuracy per class - G1: 12.20%, G2: 20.62%, G3: 16.22%\n",
      "EarlyStopping counter: 32 out of 40\n",
      "Epoch 35, Loss: 0.33973753883177976\n",
      "Validation Loss: 0.7527203226373309, Total Accuracy: 16.36%\n",
      "Accuracy per class - G1: 31.71%, G2: 17.54%, G3: 10.27%\n",
      "EarlyStopping counter: 33 out of 40\n",
      "Epoch 36, Loss: 0.3402823845306075\n",
      "Validation Loss: 0.734335598491487, Total Accuracy: 17.75%\n",
      "Accuracy per class - G1: 21.95%, G2: 20.85%, G3: 9.73%\n",
      "EarlyStopping counter: 34 out of 40\n",
      "Epoch 37, Loss: 0.3368408848722297\n",
      "Validation Loss: 0.7530204980146318, Total Accuracy: 17.75%\n",
      "Accuracy per class - G1: 17.07%, G2: 19.43%, G3: 14.05%\n",
      "EarlyStopping counter: 35 out of 40\n",
      "Epoch 38, Loss: 0.3364375341369445\n",
      "Validation Loss: 0.7446852283818381, Total Accuracy: 17.75%\n",
      "Accuracy per class - G1: 12.20%, G2: 21.56%, G3: 10.27%\n",
      "EarlyStopping counter: 36 out of 40\n",
      "Epoch 39, Loss: 0.33657101478921364\n",
      "Validation Loss: 0.7503430119582585, Total Accuracy: 18.67%\n",
      "Accuracy per class - G1: 17.07%, G2: 19.67%, G3: 16.76%\n",
      "EarlyStopping counter: 37 out of 40\n",
      "Epoch 40, Loss: 0.3325995427657323\n",
      "Validation Loss: 0.751897197394144, Total Accuracy: 18.06%\n",
      "Accuracy per class - G1: 17.07%, G2: 21.80%, G3: 9.73%\n",
      "EarlyStopping counter: 38 out of 40\n",
      "Epoch 41, Loss: 0.33641828219574615\n",
      "Validation Loss: 0.72634200326034, Total Accuracy: 19.44%\n",
      "Accuracy per class - G1: 12.20%, G2: 23.70%, G3: 11.35%\n",
      "EarlyStopping counter: 39 out of 40\n",
      "Epoch 42, Loss: 0.33553780848721426\n",
      "Validation Loss: 0.735298637832914, Total Accuracy: 19.29%\n",
      "Accuracy per class - G1: 14.63%, G2: 22.04%, G3: 14.05%\n",
      "EarlyStopping counter: 40 out of 40\n",
      "Early stopping\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\u001b[34m\u001b[1mwandb\u001b[0m:                                                                                \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run history:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run summary:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc 14.63415\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc 84.55285\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc 22.03791\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc 73.39782\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc 14.05405\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc 57.23861\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy 19.29012\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy 69.87906\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss 0.33554\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss 0.7353\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View run \u001b[33m1optuna_run_3 microsoft/resnet-18 Frozen Layers Nooversampling Focallo4\u001b[0m at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/zu60imuo\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View project at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Synced 5 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Find logs at: \u001b[35m\u001b[1m./wandb/run-20241009_182626-zu60imuo/logs\u001b[0m\n",
      "[I 2024-10-09 18:45:30,607] Trial 3 finished with value: 0.1634923079982162 and parameters: {'weight_decay': 1.4306948595712253e-06, 'focal_loss': 1.9700230252242161}. Best is trial 0 with value: 0.16405465139642353.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Tracking run with wandb version 0.18.3\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run data is saved locally in \u001b[35m\u001b[1m/kaggle/working/wandb/run-20241009_184530-eiauzcn5\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run \u001b[1m`wandb offline`\u001b[0m to turn off syncing.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Syncing run \u001b[33m1optuna_run_4 microsoft/resnet-18 Frozen Layers Nooversampling Focallo5\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View project at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View run at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/eiauzcn5\u001b[0m\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Epoch 1, Loss: 0.6021245143499719\n",
      "Validation Loss: 0.6022674987713496, Total Accuracy: 25.46%\n",
      "Accuracy per class - G1: 2.44%, G2: 23.46%, G3: 35.14%\n",
      "Validation loss decreased (inf --> 12.647617).  Saving model ...\n",
      "Epoch 2, Loss: 0.5891739367002464\n",
      "Validation Loss: 0.6085112258082345, Total Accuracy: 21.76%\n",
      "Accuracy per class - G1: 12.20%, G2: 20.85%, G3: 25.95%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 3, Loss: 0.5774692821215435\n",
      "Validation Loss: 0.6091869118667784, Total Accuracy: 24.07%\n",
      "Accuracy per class - G1: 12.20%, G2: 23.22%, G3: 28.65%\n",
      "EarlyStopping counter: 2 out of 40\n",
      "Epoch 4, Loss: 0.566470062158194\n",
      "Validation Loss: 0.5821761531489236, Total Accuracy: 24.69%\n",
      "Accuracy per class - G1: 12.20%, G2: 25.12%, G3: 26.49%\n",
      "Validation loss decreased (12.647617 --> 12.225699).  Saving model ...\n",
      "Epoch 5, Loss: 0.554592309586973\n",
      "Validation Loss: 0.6005562231654212, Total Accuracy: 25.93%\n",
      "Accuracy per class - G1: 7.32%, G2: 25.36%, G3: 31.35%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 6, Loss: 0.5406356611883784\n",
      "Validation Loss: 0.6525811297552926, Total Accuracy: 21.76%\n",
      "Accuracy per class - G1: 19.51%, G2: 22.04%, G3: 21.62%\n",
      "EarlyStopping counter: 2 out of 40\n",
      "Epoch 7, Loss: 0.5351463994347906\n",
      "Validation Loss: 0.6316507373537336, Total Accuracy: 23.92%\n",
      "Accuracy per class - G1: 9.76%, G2: 22.75%, G3: 29.73%\n",
      "EarlyStopping counter: 3 out of 40\n",
      "Epoch 8, Loss: 0.5226457391876772\n",
      "Validation Loss: 0.6472223457835969, Total Accuracy: 23.92%\n",
      "Accuracy per class - G1: 2.44%, G2: 23.46%, G3: 29.73%\n",
      "EarlyStopping counter: 4 out of 40\n",
      "Epoch 9, Loss: 0.5174736046647451\n",
      "Validation Loss: 0.6500044819854555, Total Accuracy: 22.07%\n",
      "Accuracy per class - G1: 9.76%, G2: 21.80%, G3: 25.41%\n",
      "EarlyStopping counter: 5 out of 40\n",
      "Epoch 10, Loss: 0.503719047609582\n",
      "Validation Loss: 0.6538615709259397, Total Accuracy: 22.69%\n",
      "Accuracy per class - G1: 4.88%, G2: 19.43%, G3: 34.05%\n",
      "EarlyStopping counter: 6 out of 40\n",
      "Epoch 11, Loss: 0.4926388694579343\n",
      "Validation Loss: 0.6554016158694312, Total Accuracy: 24.23%\n",
      "Accuracy per class - G1: 12.20%, G2: 21.33%, G3: 33.51%\n",
      "EarlyStopping counter: 7 out of 40\n",
      "Epoch 12, Loss: 0.4836082566215331\n",
      "Validation Loss: 0.6618953595558802, Total Accuracy: 23.46%\n",
      "Accuracy per class - G1: 4.88%, G2: 22.27%, G3: 30.27%\n",
      "EarlyStopping counter: 8 out of 40\n",
      "Epoch 13, Loss: 0.4815764527723014\n",
      "Validation Loss: 0.6814393443720681, Total Accuracy: 21.60%\n",
      "Accuracy per class - G1: 2.44%, G2: 19.19%, G3: 31.35%\n",
      "EarlyStopping counter: 9 out of 40\n",
      "Epoch 14, Loss: 0.4762622125177498\n",
      "Validation Loss: 0.6843379466306596, Total Accuracy: 24.23%\n",
      "Accuracy per class - G1: 4.88%, G2: 22.27%, G3: 32.97%\n",
      "EarlyStopping counter: 10 out of 40\n",
      "Epoch 15, Loss: 0.46281791810529777\n",
      "Validation Loss: 0.6731471319993337, Total Accuracy: 25.31%\n",
      "Accuracy per class - G1: 9.76%, G2: 24.41%, G3: 30.81%\n",
      "EarlyStopping counter: 11 out of 40\n",
      "Epoch 16, Loss: 0.4560678077031331\n",
      "Validation Loss: 0.6873548045044854, Total Accuracy: 25.46%\n",
      "Accuracy per class - G1: 0.00%, G2: 21.56%, G3: 40.00%\n",
      "EarlyStopping counter: 12 out of 40\n",
      "Epoch 17, Loss: 0.45165191429207124\n",
      "Validation Loss: 0.6859055729139418, Total Accuracy: 24.07%\n",
      "Accuracy per class - G1: 2.44%, G2: 21.80%, G3: 34.05%\n",
      "EarlyStopping counter: 13 out of 40\n",
      "Epoch 18, Loss: 0.44308537532048053\n",
      "Validation Loss: 0.692306148154395, Total Accuracy: 26.54%\n",
      "Accuracy per class - G1: 4.88%, G2: 24.41%, G3: 36.22%\n",
      "EarlyStopping counter: 14 out of 40\n",
      "Epoch 19, Loss: 0.4331016727240689\n",
      "Validation Loss: 0.6969029449281239, Total Accuracy: 25.62%\n",
      "Accuracy per class - G1: 7.32%, G2: 23.22%, G3: 35.14%\n",
      "EarlyStopping counter: 15 out of 40\n",
      "Epoch 20, Loss: 0.4274889112236988\n",
      "Validation Loss: 0.7244049970592771, Total Accuracy: 24.07%\n",
      "Accuracy per class - G1: 7.32%, G2: 22.04%, G3: 32.43%\n",
      "EarlyStopping counter: 16 out of 40\n",
      "Epoch 21, Loss: 0.42347093949834985\n",
      "Validation Loss: 0.7281420358589717, Total Accuracy: 26.23%\n",
      "Accuracy per class - G1: 0.00%, G2: 26.07%, G3: 32.43%\n",
      "EarlyStopping counter: 17 out of 40\n",
      "Epoch 22, Loss: 0.41522723939045364\n",
      "Validation Loss: 0.7108987442084721, Total Accuracy: 25.62%\n",
      "Accuracy per class - G1: 2.44%, G2: 26.30%, G3: 29.19%\n",
      "EarlyStopping counter: 18 out of 40\n",
      "Epoch 23, Loss: 0.41563815201621457\n",
      "Validation Loss: 0.7349363380954379, Total Accuracy: 26.85%\n",
      "Accuracy per class - G1: 0.00%, G2: 28.91%, G3: 28.11%\n",
      "EarlyStopping counter: 19 out of 40\n",
      "Epoch 24, Loss: 0.40988844309944705\n",
      "Validation Loss: 0.7639516336577279, Total Accuracy: 27.93%\n",
      "Accuracy per class - G1: 2.44%, G2: 25.59%, G3: 38.92%\n",
      "EarlyStopping counter: 20 out of 40\n",
      "Epoch 25, Loss: 0.40416884135050946\n",
      "Validation Loss: 0.7283191737674531, Total Accuracy: 28.70%\n",
      "Accuracy per class - G1: 4.88%, G2: 26.07%, G3: 40.00%\n",
      "EarlyStopping counter: 21 out of 40\n",
      "Epoch 26, Loss: 0.3998673166855272\n",
      "Validation Loss: 0.7697269263721648, Total Accuracy: 25.31%\n",
      "Accuracy per class - G1: 2.44%, G2: 21.80%, G3: 38.38%\n",
      "EarlyStopping counter: 22 out of 40\n",
      "Epoch 27, Loss: 0.40249038173491697\n",
      "Validation Loss: 0.7674741872719356, Total Accuracy: 28.24%\n",
      "Accuracy per class - G1: 2.44%, G2: 24.64%, G3: 42.16%\n",
      "EarlyStopping counter: 23 out of 40\n",
      "Epoch 28, Loss: 0.3997734185442867\n",
      "Validation Loss: 0.7389084001382192, Total Accuracy: 27.01%\n",
      "Accuracy per class - G1: 4.88%, G2: 23.70%, G3: 39.46%\n",
      "EarlyStopping counter: 24 out of 40\n",
      "Epoch 29, Loss: 0.3968359623328749\n",
      "Validation Loss: 0.7608641854354313, Total Accuracy: 27.93%\n",
      "Accuracy per class - G1: 4.88%, G2: 24.64%, G3: 40.54%\n",
      "EarlyStopping counter: 25 out of 40\n",
      "Epoch 30, Loss: 0.3950666049158717\n",
      "Validation Loss: 0.7820550586496081, Total Accuracy: 29.17%\n",
      "Accuracy per class - G1: 7.32%, G2: 27.49%, G3: 37.84%\n",
      "EarlyStopping counter: 26 out of 40\n",
      "Epoch 31, Loss: 0.39765238187399254\n",
      "Validation Loss: 0.7397439593360537, Total Accuracy: 29.94%\n",
      "Accuracy per class - G1: 4.88%, G2: 26.07%, G3: 44.32%\n",
      "EarlyStopping counter: 27 out of 40\n",
      "Epoch 32, Loss: 0.38819716565580253\n",
      "Validation Loss: 0.7521711999461764, Total Accuracy: 25.77%\n",
      "Accuracy per class - G1: 2.44%, G2: 26.78%, G3: 28.65%\n",
      "EarlyStopping counter: 28 out of 40\n",
      "Epoch 33, Loss: 0.3940743796796684\n",
      "Validation Loss: 0.7786345552830469, Total Accuracy: 28.09%\n",
      "Accuracy per class - G1: 4.88%, G2: 25.83%, G3: 38.38%\n",
      "EarlyStopping counter: 29 out of 40\n",
      "Epoch 34, Loss: 0.388561845902937\n",
      "Validation Loss: 0.7822422896112714, Total Accuracy: 25.93%\n",
      "Accuracy per class - G1: 2.44%, G2: 23.22%, G3: 37.30%\n",
      "EarlyStopping counter: 30 out of 40\n",
      "Epoch 35, Loss: 0.38471616104424716\n",
      "Validation Loss: 0.8066423365048, Total Accuracy: 29.01%\n",
      "Accuracy per class - G1: 14.63%, G2: 24.88%, G3: 41.62%\n",
      "EarlyStopping counter: 31 out of 40\n",
      "Epoch 36, Loss: 0.38664700467902496\n",
      "Validation Loss: 0.756006624017443, Total Accuracy: 25.62%\n",
      "Accuracy per class - G1: 9.76%, G2: 25.12%, G3: 30.27%\n",
      "EarlyStopping counter: 32 out of 40\n",
      "Epoch 37, Loss: 0.3858678926186389\n",
      "Validation Loss: 0.7453044440065112, Total Accuracy: 29.01%\n",
      "Accuracy per class - G1: 7.32%, G2: 25.36%, G3: 42.16%\n",
      "EarlyStopping counter: 33 out of 40\n",
      "Epoch 38, Loss: 0.3776767469314207\n",
      "Validation Loss: 0.757049336319878, Total Accuracy: 25.15%\n",
      "Accuracy per class - G1: 7.32%, G2: 25.36%, G3: 28.65%\n",
      "EarlyStopping counter: 34 out of 40\n",
      "Epoch 39, Loss: 0.380903084235019\n",
      "Validation Loss: 0.754403041941779, Total Accuracy: 27.93%\n",
      "Accuracy per class - G1: 2.44%, G2: 27.01%, G3: 35.68%\n",
      "EarlyStopping counter: 35 out of 40\n",
      "Epoch 40, Loss: 0.37276340356792315\n",
      "Validation Loss: 0.7737539297058469, Total Accuracy: 26.23%\n",
      "Accuracy per class - G1: 2.44%, G2: 26.78%, G3: 30.27%\n",
      "EarlyStopping counter: 36 out of 40\n",
      "Epoch 41, Loss: 0.3808478806392256\n",
      "Validation Loss: 0.791985368444806, Total Accuracy: 25.15%\n",
      "Accuracy per class - G1: 0.00%, G2: 26.54%, G3: 27.57%\n",
      "EarlyStopping counter: 37 out of 40\n",
      "Epoch 42, Loss: 0.37494329551616346\n",
      "Validation Loss: 0.78337172241438, Total Accuracy: 26.85%\n",
      "Accuracy per class - G1: 4.88%, G2: 26.78%, G3: 31.89%\n",
      "EarlyStopping counter: 38 out of 40\n",
      "Epoch 43, Loss: 0.3723980461258486\n",
      "Validation Loss: 0.8087655178138188, Total Accuracy: 28.09%\n",
      "Accuracy per class - G1: 0.00%, G2: 25.12%, G3: 41.08%\n",
      "EarlyStopping counter: 39 out of 40\n",
      "Epoch 44, Loss: 0.36831154773034247\n",
      "Validation Loss: 0.7845065380845752, Total Accuracy: 29.32%\n",
      "Accuracy per class - G1: 17.07%, G2: 26.54%, G3: 38.38%\n",
      "EarlyStopping counter: 40 out of 40\n",
      "Early stopping\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\u001b[34m\u001b[1mwandb\u001b[0m:                                                                                \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run history:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run summary:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc 17.07317\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc 81.70732\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc 26.54028\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc 56.711\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc 38.37838\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc 76.54155\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy 29.32099\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy 64.62585\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss 0.36831\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss 0.78451\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View run \u001b[33m1optuna_run_4 microsoft/resnet-18 Frozen Layers Nooversampling Focallo5\u001b[0m at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/eiauzcn5\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View project at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Synced 5 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Find logs at: \u001b[35m\u001b[1m./wandb/run-20241009_184530-eiauzcn5/logs\u001b[0m\n",
      "[I 2024-10-09 19:05:24,945] Trial 4 finished with value: 0.22517796557233413 and parameters: {'weight_decay': 8.985648053398565e-07, 'focal_loss': 2.091092412175164}. Best is trial 4 with value: 0.22517796557233413.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Tracking run with wandb version 0.18.3\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run data is saved locally in \u001b[35m\u001b[1m/kaggle/working/wandb/run-20241009_190525-eoby7gfx\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run \u001b[1m`wandb offline`\u001b[0m to turn off syncing.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Syncing run \u001b[33m1optuna_run_5 microsoft/resnet-18 Frozen Layers Nooversampling Focallo6\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View project at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View run at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/eoby7gfx\u001b[0m\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Epoch 1, Loss: 0.6177587466067579\n",
      "Validation Loss: 0.7673439638955253, Total Accuracy: 16.98%\n",
      "Accuracy per class - G1: 78.05%, G2: 15.17%, G3: 7.57%\n",
      "Validation loss decreased (inf --> 16.114223).  Saving model ...\n",
      "Epoch 2, Loss: 0.582153834133263\n",
      "Validation Loss: 0.7542155072802589, Total Accuracy: 23.30%\n",
      "Accuracy per class - G1: 90.24%, G2: 18.01%, G3: 20.54%\n",
      "Validation loss decreased (16.114223 --> 15.838526).  Saving model ...\n",
      "Epoch 3, Loss: 0.580551088574421\n",
      "Validation Loss: 0.7890056272347769, Total Accuracy: 20.52%\n",
      "Accuracy per class - G1: 65.85%, G2: 14.69%, G3: 23.78%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 4, Loss: 0.5726769236196955\n",
      "Validation Loss: 0.8158897232441675, Total Accuracy: 19.44%\n",
      "Accuracy per class - G1: 82.93%, G2: 13.51%, G3: 18.92%\n",
      "EarlyStopping counter: 2 out of 40\n",
      "Epoch 5, Loss: 0.5512379041637283\n",
      "Validation Loss: 0.7765763331027258, Total Accuracy: 20.83%\n",
      "Accuracy per class - G1: 70.73%, G2: 16.59%, G3: 19.46%\n",
      "EarlyStopping counter: 3 out of 40\n",
      "Epoch 6, Loss: 0.5371506382901985\n",
      "Validation Loss: 0.8462135167348952, Total Accuracy: 19.91%\n",
      "Accuracy per class - G1: 75.61%, G2: 14.93%, G3: 18.92%\n",
      "EarlyStopping counter: 4 out of 40\n",
      "Epoch 7, Loss: 0.5186653216201139\n",
      "Validation Loss: 0.7794241635572343, Total Accuracy: 17.28%\n",
      "Accuracy per class - G1: 65.85%, G2: 14.45%, G3: 12.97%\n",
      "EarlyStopping counter: 5 out of 40\n",
      "Epoch 8, Loss: 0.5100228937275438\n",
      "Validation Loss: 0.7937639043444679, Total Accuracy: 20.37%\n",
      "Accuracy per class - G1: 78.05%, G2: 17.77%, G3: 13.51%\n",
      "EarlyStopping counter: 6 out of 40\n",
      "Epoch 9, Loss: 0.5025232585079699\n",
      "Validation Loss: 0.794426848491033, Total Accuracy: 22.69%\n",
      "Accuracy per class - G1: 87.80%, G2: 17.06%, G3: 21.08%\n",
      "EarlyStopping counter: 7 out of 40\n",
      "Epoch 10, Loss: 0.4969336659793394\n",
      "Validation Loss: 0.8523158331712087, Total Accuracy: 18.06%\n",
      "Accuracy per class - G1: 73.17%, G2: 12.80%, G3: 17.84%\n",
      "EarlyStopping counter: 8 out of 40\n",
      "Epoch 11, Loss: 0.4767460485538804\n",
      "Validation Loss: 0.7997368971506754, Total Accuracy: 21.91%\n",
      "Accuracy per class - G1: 75.61%, G2: 15.17%, G3: 25.41%\n",
      "EarlyStopping counter: 9 out of 40\n",
      "Epoch 12, Loss: 0.4669588470315359\n",
      "Validation Loss: 0.8710436310086932, Total Accuracy: 18.06%\n",
      "Accuracy per class - G1: 78.05%, G2: 11.37%, G3: 20.00%\n",
      "EarlyStopping counter: 10 out of 40\n",
      "Epoch 13, Loss: 0.4576028915772955\n",
      "Validation Loss: 0.8175642830984933, Total Accuracy: 20.99%\n",
      "Accuracy per class - G1: 68.29%, G2: 15.17%, G3: 23.78%\n",
      "EarlyStopping counter: 11 out of 40\n",
      "Epoch 14, Loss: 0.449282154979476\n",
      "Validation Loss: 0.8341779623712812, Total Accuracy: 18.36%\n",
      "Accuracy per class - G1: 63.41%, G2: 14.45%, G3: 17.30%\n",
      "EarlyStopping counter: 12 out of 40\n",
      "Epoch 15, Loss: 0.44319872647882946\n",
      "Validation Loss: 0.8663178597177777, Total Accuracy: 18.83%\n",
      "Accuracy per class - G1: 73.17%, G2: 12.09%, G3: 22.16%\n",
      "EarlyStopping counter: 13 out of 40\n",
      "Epoch 16, Loss: 0.43776209239500113\n",
      "Validation Loss: 0.8658336968649001, Total Accuracy: 19.60%\n",
      "Accuracy per class - G1: 63.41%, G2: 15.40%, G3: 19.46%\n",
      "EarlyStopping counter: 14 out of 40\n",
      "Epoch 17, Loss: 0.43090075074908246\n",
      "Validation Loss: 0.8607311589377267, Total Accuracy: 19.91%\n",
      "Accuracy per class - G1: 70.73%, G2: 14.45%, G3: 21.08%\n",
      "EarlyStopping counter: 15 out of 40\n",
      "Epoch 18, Loss: 0.4323233664035797\n",
      "Validation Loss: 0.8605747066792988, Total Accuracy: 20.52%\n",
      "Accuracy per class - G1: 58.54%, G2: 14.22%, G3: 26.49%\n",
      "EarlyStopping counter: 16 out of 40\n",
      "Epoch 19, Loss: 0.42145450754338\n",
      "Validation Loss: 0.8549359767209916, Total Accuracy: 19.44%\n",
      "Accuracy per class - G1: 41.46%, G2: 15.64%, G3: 23.24%\n",
      "EarlyStopping counter: 17 out of 40\n",
      "Epoch 20, Loss: 0.4129364670041096\n",
      "Validation Loss: 0.8504480464117867, Total Accuracy: 22.07%\n",
      "Accuracy per class - G1: 56.10%, G2: 18.01%, G3: 23.78%\n",
      "EarlyStopping counter: 18 out of 40\n",
      "Epoch 21, Loss: 0.4035716649279537\n",
      "Validation Loss: 0.8881469439892542, Total Accuracy: 19.44%\n",
      "Accuracy per class - G1: 46.34%, G2: 17.06%, G3: 18.92%\n",
      "EarlyStopping counter: 19 out of 40\n",
      "Epoch 22, Loss: 0.4009097735565829\n",
      "Validation Loss: 0.8747254553295317, Total Accuracy: 22.07%\n",
      "Accuracy per class - G1: 60.98%, G2: 17.77%, G3: 23.24%\n",
      "EarlyStopping counter: 20 out of 40\n",
      "Epoch 23, Loss: 0.3968351702374148\n",
      "Validation Loss: 0.9090672646250043, Total Accuracy: 22.84%\n",
      "Accuracy per class - G1: 58.54%, G2: 17.30%, G3: 27.57%\n",
      "EarlyStopping counter: 21 out of 40\n",
      "Epoch 24, Loss: 0.389609694480896\n",
      "Validation Loss: 0.9255293423221225, Total Accuracy: 19.29%\n",
      "Accuracy per class - G1: 58.54%, G2: 14.69%, G3: 21.08%\n",
      "EarlyStopping counter: 22 out of 40\n",
      "Epoch 25, Loss: 0.38571310940995274\n",
      "Validation Loss: 0.8660651544729868, Total Accuracy: 22.38%\n",
      "Accuracy per class - G1: 60.98%, G2: 17.77%, G3: 24.32%\n",
      "EarlyStopping counter: 23 out of 40\n",
      "Epoch 26, Loss: 0.3857929300831025\n",
      "Validation Loss: 0.8794822778020587, Total Accuracy: 24.07%\n",
      "Accuracy per class - G1: 65.85%, G2: 18.96%, G3: 26.49%\n",
      "EarlyStopping counter: 24 out of 40\n",
      "Epoch 27, Loss: 0.3859038159071681\n",
      "Validation Loss: 0.9316609572796595, Total Accuracy: 20.68%\n",
      "Accuracy per class - G1: 56.10%, G2: 15.17%, G3: 25.41%\n",
      "EarlyStopping counter: 25 out of 40\n",
      "Epoch 28, Loss: 0.3838210335697036\n",
      "Validation Loss: 0.8943613313493275, Total Accuracy: 20.52%\n",
      "Accuracy per class - G1: 53.66%, G2: 17.30%, G3: 20.54%\n",
      "EarlyStopping counter: 26 out of 40\n",
      "Epoch 29, Loss: 0.38385201146803705\n",
      "Validation Loss: 0.8975920762334552, Total Accuracy: 22.22%\n",
      "Accuracy per class - G1: 58.54%, G2: 20.14%, G3: 18.92%\n",
      "EarlyStopping counter: 27 out of 40\n",
      "Epoch 30, Loss: 0.3815222565668175\n",
      "Validation Loss: 0.9149952871458871, Total Accuracy: 23.30%\n",
      "Accuracy per class - G1: 56.10%, G2: 17.54%, G3: 29.19%\n",
      "EarlyStopping counter: 28 out of 40\n",
      "Epoch 31, Loss: 0.3817766398550516\n",
      "Validation Loss: 0.9093846863224393, Total Accuracy: 21.91%\n",
      "Accuracy per class - G1: 53.66%, G2: 18.96%, G3: 21.62%\n",
      "EarlyStopping counter: 29 out of 40\n",
      "Epoch 32, Loss: 0.37629184485918066\n",
      "Validation Loss: 0.9110543543384189, Total Accuracy: 22.84%\n",
      "Accuracy per class - G1: 65.85%, G2: 20.38%, G3: 18.92%\n",
      "EarlyStopping counter: 30 out of 40\n",
      "Epoch 33, Loss: 0.38066309439130575\n",
      "Validation Loss: 0.8858318172750019, Total Accuracy: 23.30%\n",
      "Accuracy per class - G1: 53.66%, G2: 19.19%, G3: 25.95%\n",
      "EarlyStopping counter: 31 out of 40\n",
      "Epoch 34, Loss: 0.377483302211187\n",
      "Validation Loss: 0.9544481493177868, Total Accuracy: 20.83%\n",
      "Accuracy per class - G1: 63.41%, G2: 18.25%, G3: 17.30%\n",
      "EarlyStopping counter: 32 out of 40\n",
      "Epoch 35, Loss: 0.37404305676379834\n",
      "Validation Loss: 0.9257394117968423, Total Accuracy: 20.22%\n",
      "Accuracy per class - G1: 65.85%, G2: 15.64%, G3: 20.54%\n",
      "EarlyStopping counter: 33 out of 40\n",
      "Epoch 36, Loss: 0.3752067229115819\n",
      "Validation Loss: 0.909618881486711, Total Accuracy: 22.99%\n",
      "Accuracy per class - G1: 53.66%, G2: 18.96%, G3: 25.41%\n",
      "EarlyStopping counter: 34 out of 40\n",
      "Epoch 37, Loss: 0.3722872278058385\n",
      "Validation Loss: 0.889988682099751, Total Accuracy: 21.91%\n",
      "Accuracy per class - G1: 63.41%, G2: 16.11%, G3: 25.95%\n",
      "EarlyStopping counter: 35 out of 40\n",
      "Epoch 38, Loss: 0.3741169273853302\n",
      "Validation Loss: 0.9129924802553087, Total Accuracy: 20.52%\n",
      "Accuracy per class - G1: 46.34%, G2: 19.19%, G3: 17.84%\n",
      "EarlyStopping counter: 36 out of 40\n",
      "Epoch 39, Loss: 0.37370944166757974\n",
      "Validation Loss: 0.9012849458626339, Total Accuracy: 23.15%\n",
      "Accuracy per class - G1: 65.85%, G2: 15.17%, G3: 31.89%\n",
      "EarlyStopping counter: 37 out of 40\n",
      "Epoch 40, Loss: 0.37060672008847617\n",
      "Validation Loss: 0.9159380821954637, Total Accuracy: 22.53%\n",
      "Accuracy per class - G1: 58.54%, G2: 17.30%, G3: 26.49%\n",
      "EarlyStopping counter: 38 out of 40\n",
      "Epoch 41, Loss: 0.3702057923179075\n",
      "Validation Loss: 0.9155475568203699, Total Accuracy: 24.07%\n",
      "Accuracy per class - G1: 60.98%, G2: 19.43%, G3: 26.49%\n",
      "EarlyStopping counter: 39 out of 40\n",
      "Epoch 42, Loss: 0.3682611548756979\n",
      "Validation Loss: 0.896146392538434, Total Accuracy: 22.99%\n",
      "Accuracy per class - G1: 46.34%, G2: 19.91%, G3: 24.86%\n",
      "EarlyStopping counter: 40 out of 40\n",
      "Early stopping\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\u001b[34m\u001b[1mwandb\u001b[0m:                                                                                \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run history:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run summary:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc 46.34146\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc 91.05691\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc 19.90521\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc 56.711\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc 24.86486\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc 64.34316\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy 22.99383\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy 62.05593\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss 0.36826\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss 0.89615\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View run \u001b[33m1optuna_run_5 microsoft/resnet-18 Frozen Layers Nooversampling Focallo6\u001b[0m at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/eoby7gfx\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View project at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Synced 5 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Find logs at: \u001b[35m\u001b[1m./wandb/run-20241009_190525-eoby7gfx/logs\u001b[0m\n",
      "[I 2024-10-09 19:24:33,957] Trial 5 finished with value: 0.22747061179917194 and parameters: {'weight_decay': 9.214114555709014e-07, 'focal_loss': 2.0692282020671713}. Best is trial 5 with value: 0.22747061179917194.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Tracking run with wandb version 0.18.3\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run data is saved locally in \u001b[35m\u001b[1m/kaggle/working/wandb/run-20241009_192434-fyv8t5e9\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run \u001b[1m`wandb offline`\u001b[0m to turn off syncing.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Syncing run \u001b[33m1optuna_run_6 microsoft/resnet-18 Frozen Layers Nooversampling Focallo7\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View project at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View run at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/fyv8t5e9\u001b[0m\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Epoch 1, Loss: 0.7509788267583732\n",
      "Validation Loss: 0.8410158306360245, Total Accuracy: 26.23%\n",
      "Accuracy per class - G1: 24.39%, G2: 37.91%, G3: 0.00%\n",
      "Validation loss decreased (inf --> 17.661332).  Saving model ...\n",
      "Epoch 2, Loss: 0.7297551294407213\n",
      "Validation Loss: 0.833729699254036, Total Accuracy: 28.24%\n",
      "Accuracy per class - G1: 51.22%, G2: 38.39%, G3: 0.00%\n",
      "Validation loss decreased (17.661332 --> 17.508324).  Saving model ...\n",
      "Epoch 3, Loss: 0.7173916629279953\n",
      "Validation Loss: 0.8543056434109098, Total Accuracy: 28.70%\n",
      "Accuracy per class - G1: 51.22%, G2: 39.10%, G3: 0.00%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 4, Loss: 0.7112180490091623\n",
      "Validation Loss: 0.8308036795684269, Total Accuracy: 28.40%\n",
      "Accuracy per class - G1: 53.66%, G2: 38.39%, G3: 0.00%\n",
      "Validation loss decreased (17.508324 --> 17.446877).  Saving model ...\n",
      "Epoch 5, Loss: 0.6935766317758215\n",
      "Validation Loss: 0.8476467735710598, Total Accuracy: 27.01%\n",
      "Accuracy per class - G1: 56.10%, G2: 36.02%, G3: 0.00%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 6, Loss: 0.6886974400784596\n",
      "Validation Loss: 0.8120063514936537, Total Accuracy: 28.86%\n",
      "Accuracy per class - G1: 46.34%, G2: 39.81%, G3: 0.00%\n",
      "Validation loss decreased (17.446877 --> 17.052133).  Saving model ...\n",
      "Epoch 7, Loss: 0.6806063583816391\n",
      "Validation Loss: 0.8483928654875074, Total Accuracy: 27.47%\n",
      "Accuracy per class - G1: 58.54%, G2: 36.49%, G3: 0.00%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 8, Loss: 0.6626514397471784\n",
      "Validation Loss: 0.8164543807506561, Total Accuracy: 29.01%\n",
      "Accuracy per class - G1: 56.10%, G2: 39.10%, G3: 0.00%\n",
      "EarlyStopping counter: 2 out of 40\n",
      "Epoch 9, Loss: 0.6546182894563101\n",
      "Validation Loss: 0.8481692139591489, Total Accuracy: 27.01%\n",
      "Accuracy per class - G1: 58.54%, G2: 35.78%, G3: 0.00%\n",
      "EarlyStopping counter: 3 out of 40\n",
      "Epoch 10, Loss: 0.6409864124045315\n",
      "Validation Loss: 0.8220643294709069, Total Accuracy: 28.40%\n",
      "Accuracy per class - G1: 58.54%, G2: 37.91%, G3: 0.00%\n",
      "EarlyStopping counter: 4 out of 40\n",
      "Epoch 11, Loss: 0.6353390101926872\n",
      "Validation Loss: 0.8446214525472551, Total Accuracy: 29.63%\n",
      "Accuracy per class - G1: 60.98%, G2: 39.57%, G3: 0.00%\n",
      "EarlyStopping counter: 5 out of 40\n",
      "Epoch 12, Loss: 0.6202262543052076\n",
      "Validation Loss: 0.836750830922808, Total Accuracy: 29.17%\n",
      "Accuracy per class - G1: 53.66%, G2: 39.57%, G3: 0.00%\n",
      "EarlyStopping counter: 6 out of 40\n",
      "Epoch 13, Loss: 0.6222803488553289\n",
      "Validation Loss: 0.8334582029354005, Total Accuracy: 30.09%\n",
      "Accuracy per class - G1: 65.85%, G2: 39.81%, G3: 0.00%\n",
      "EarlyStopping counter: 7 out of 40\n",
      "Epoch 14, Loss: 0.608026864298855\n",
      "Validation Loss: 0.8002593439249766, Total Accuracy: 31.64%\n",
      "Accuracy per class - G1: 65.85%, G2: 42.18%, G3: 0.00%\n",
      "Validation loss decreased (17.052133 --> 16.805446).  Saving model ...\n",
      "Epoch 15, Loss: 0.5948643002165369\n",
      "Validation Loss: 0.8321819376377833, Total Accuracy: 30.25%\n",
      "Accuracy per class - G1: 68.29%, G2: 39.81%, G3: 0.00%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 16, Loss: 0.5895422431359808\n",
      "Validation Loss: 0.8378235704842067, Total Accuracy: 30.86%\n",
      "Accuracy per class - G1: 70.73%, G2: 40.52%, G3: 0.00%\n",
      "EarlyStopping counter: 2 out of 40\n",
      "Epoch 17, Loss: 0.5826603518911155\n",
      "Validation Loss: 0.8363891314892542, Total Accuracy: 29.94%\n",
      "Accuracy per class - G1: 63.41%, G2: 39.81%, G3: 0.00%\n",
      "EarlyStopping counter: 3 out of 40\n",
      "Epoch 18, Loss: 0.5809018163077803\n",
      "Validation Loss: 0.82003924818266, Total Accuracy: 30.25%\n",
      "Accuracy per class - G1: 63.41%, G2: 40.28%, G3: 0.00%\n",
      "EarlyStopping counter: 4 out of 40\n",
      "Epoch 19, Loss: 0.5621045993035099\n",
      "Validation Loss: 0.8591814516555696, Total Accuracy: 28.24%\n",
      "Accuracy per class - G1: 65.85%, G2: 36.97%, G3: 0.00%\n",
      "EarlyStopping counter: 5 out of 40\n",
      "Epoch 20, Loss: 0.555700797273452\n",
      "Validation Loss: 0.8451524674892426, Total Accuracy: 29.32%\n",
      "Accuracy per class - G1: 70.73%, G2: 38.15%, G3: 0.00%\n",
      "EarlyStopping counter: 6 out of 40\n",
      "Epoch 21, Loss: 0.5522578728486256\n",
      "Validation Loss: 0.8381019192082542, Total Accuracy: 28.40%\n",
      "Accuracy per class - G1: 58.54%, G2: 37.91%, G3: 0.00%\n",
      "EarlyStopping counter: 7 out of 40\n",
      "Epoch 22, Loss: 0.5481692678238972\n",
      "Validation Loss: 0.8326762304419563, Total Accuracy: 30.40%\n",
      "Accuracy per class - G1: 56.10%, G2: 41.23%, G3: 0.00%\n",
      "EarlyStopping counter: 8 out of 40\n",
      "Epoch 23, Loss: 0.5388846627200943\n",
      "Validation Loss: 0.839089511405854, Total Accuracy: 31.48%\n",
      "Accuracy per class - G1: 63.41%, G2: 42.18%, G3: 0.00%\n",
      "EarlyStopping counter: 9 out of 40\n",
      "Epoch 24, Loss: 0.5314374163926366\n",
      "Validation Loss: 0.8285764874446959, Total Accuracy: 31.94%\n",
      "Accuracy per class - G1: 70.73%, G2: 42.18%, G3: 0.00%\n",
      "EarlyStopping counter: 10 out of 40\n",
      "Epoch 25, Loss: 0.5195206331919475\n",
      "Validation Loss: 0.8171767776920682, Total Accuracy: 29.17%\n",
      "Accuracy per class - G1: 51.22%, G2: 39.81%, G3: 0.00%\n",
      "EarlyStopping counter: 11 out of 40\n",
      "Epoch 26, Loss: 0.5132559749735407\n",
      "Validation Loss: 0.8345878628038225, Total Accuracy: 30.86%\n",
      "Accuracy per class - G1: 58.54%, G2: 41.71%, G3: 0.00%\n",
      "EarlyStopping counter: 12 out of 40\n",
      "Epoch 27, Loss: 0.5095754930053848\n",
      "Validation Loss: 0.8668737603085381, Total Accuracy: 29.48%\n",
      "Accuracy per class - G1: 60.98%, G2: 39.34%, G3: 0.00%\n",
      "EarlyStopping counter: 13 out of 40\n",
      "Epoch 28, Loss: 0.5027753427086106\n",
      "Validation Loss: 0.8634207745393118, Total Accuracy: 29.32%\n",
      "Accuracy per class - G1: 48.78%, G2: 40.28%, G3: 0.00%\n",
      "EarlyStopping counter: 14 out of 40\n",
      "Epoch 29, Loss: 0.4981021457407848\n",
      "Validation Loss: 0.8445703287919363, Total Accuracy: 30.86%\n",
      "Accuracy per class - G1: 58.54%, G2: 41.71%, G3: 0.00%\n",
      "EarlyStopping counter: 15 out of 40\n",
      "Epoch 30, Loss: 0.4908911894602948\n",
      "Validation Loss: 0.8496373345454534, Total Accuracy: 30.86%\n",
      "Accuracy per class - G1: 58.54%, G2: 41.71%, G3: 0.00%\n",
      "EarlyStopping counter: 16 out of 40\n",
      "Epoch 31, Loss: 0.48842657725495026\n",
      "Validation Loss: 0.8512268733410608, Total Accuracy: 31.02%\n",
      "Accuracy per class - G1: 60.98%, G2: 41.71%, G3: 0.00%\n",
      "EarlyStopping counter: 17 out of 40\n",
      "Epoch 32, Loss: 0.4750589469829238\n",
      "Validation Loss: 0.8423865295591808, Total Accuracy: 28.40%\n",
      "Accuracy per class - G1: 65.85%, G2: 37.20%, G3: 0.00%\n",
      "EarlyStopping counter: 18 out of 40\n",
      "Epoch 33, Loss: 0.4739876446953739\n",
      "Validation Loss: 0.8348787810121264, Total Accuracy: 31.94%\n",
      "Accuracy per class - G1: 68.29%, G2: 42.42%, G3: 0.00%\n",
      "EarlyStopping counter: 19 out of 40\n",
      "Epoch 34, Loss: 0.46993775899151724\n",
      "Validation Loss: 0.863419988325664, Total Accuracy: 29.48%\n",
      "Accuracy per class - G1: 68.29%, G2: 38.63%, G3: 0.00%\n",
      "EarlyStopping counter: 20 out of 40\n",
      "Epoch 35, Loss: 0.4607109646481204\n",
      "Validation Loss: 0.8382141952003751, Total Accuracy: 31.48%\n",
      "Accuracy per class - G1: 58.54%, G2: 42.65%, G3: 0.00%\n",
      "EarlyStopping counter: 21 out of 40\n",
      "Epoch 36, Loss: 0.45785629354327556\n",
      "Validation Loss: 0.858286033074061, Total Accuracy: 29.78%\n",
      "Accuracy per class - G1: 70.73%, G2: 38.86%, G3: 0.00%\n",
      "EarlyStopping counter: 22 out of 40\n",
      "Epoch 37, Loss: 0.45290875255343427\n",
      "Validation Loss: 0.850920190413793, Total Accuracy: 32.10%\n",
      "Accuracy per class - G1: 56.10%, G2: 43.60%, G3: 0.54%\n",
      "EarlyStopping counter: 23 out of 40\n",
      "Epoch 38, Loss: 0.45731187872139806\n",
      "Validation Loss: 0.853549721695128, Total Accuracy: 30.71%\n",
      "Accuracy per class - G1: 60.98%, G2: 41.00%, G3: 0.54%\n",
      "EarlyStopping counter: 24 out of 40\n",
      "Epoch 39, Loss: 0.4514513191688492\n",
      "Validation Loss: 0.8494482551302228, Total Accuracy: 29.01%\n",
      "Accuracy per class - G1: 56.10%, G2: 38.86%, G3: 0.54%\n",
      "EarlyStopping counter: 25 out of 40\n",
      "Epoch 40, Loss: 0.4530484331659524\n",
      "Validation Loss: 0.8270114880232584, Total Accuracy: 31.64%\n",
      "Accuracy per class - G1: 68.29%, G2: 41.94%, G3: 0.00%\n",
      "EarlyStopping counter: 26 out of 40\n",
      "Epoch 41, Loss: 0.44939739194261025\n",
      "Validation Loss: 0.867015485962232, Total Accuracy: 29.17%\n",
      "Accuracy per class - G1: 53.66%, G2: 39.57%, G3: 0.00%\n",
      "EarlyStopping counter: 27 out of 40\n",
      "Epoch 42, Loss: 0.44317132521824665\n",
      "Validation Loss: 0.8438124252217156, Total Accuracy: 28.40%\n",
      "Accuracy per class - G1: 60.98%, G2: 37.44%, G3: 0.54%\n",
      "EarlyStopping counter: 28 out of 40\n",
      "Epoch 43, Loss: 0.4595642172428499\n",
      "Validation Loss: 0.8610061449663979, Total Accuracy: 29.48%\n",
      "Accuracy per class - G1: 43.90%, G2: 41.00%, G3: 0.00%\n",
      "EarlyStopping counter: 29 out of 40\n",
      "Epoch 44, Loss: 0.4475433952118977\n",
      "Validation Loss: 0.836161100438663, Total Accuracy: 31.64%\n",
      "Accuracy per class - G1: 75.61%, G2: 41.23%, G3: 0.00%\n",
      "EarlyStopping counter: 30 out of 40\n",
      "Epoch 45, Loss: 0.44203649515128995\n",
      "Validation Loss: 0.8306584365311123, Total Accuracy: 31.02%\n",
      "Accuracy per class - G1: 63.41%, G2: 41.47%, G3: 0.00%\n",
      "EarlyStopping counter: 31 out of 40\n",
      "Epoch 46, Loss: 0.4461195192423211\n",
      "Validation Loss: 0.8502890290248961, Total Accuracy: 29.48%\n",
      "Accuracy per class - G1: 58.54%, G2: 39.57%, G3: 0.00%\n",
      "EarlyStopping counter: 32 out of 40\n",
      "Epoch 47, Loss: 0.437879431319524\n",
      "Validation Loss: 0.8490939296427227, Total Accuracy: 31.79%\n",
      "Accuracy per class - G1: 73.17%, G2: 41.71%, G3: 0.00%\n",
      "EarlyStopping counter: 33 out of 40\n",
      "Epoch 48, Loss: 0.44157462234956674\n",
      "Validation Loss: 0.8561506668726603, Total Accuracy: 28.86%\n",
      "Accuracy per class - G1: 70.73%, G2: 37.44%, G3: 0.00%\n",
      "EarlyStopping counter: 34 out of 40\n",
      "Epoch 49, Loss: 0.43295455876603184\n",
      "Validation Loss: 0.8544891114745822, Total Accuracy: 30.40%\n",
      "Accuracy per class - G1: 65.85%, G2: 40.05%, G3: 0.54%\n",
      "EarlyStopping counter: 35 out of 40\n",
      "Epoch 50, Loss: 0.4380182175033064\n",
      "Validation Loss: 0.8869538051741463, Total Accuracy: 29.17%\n",
      "Accuracy per class - G1: 73.17%, G2: 37.68%, G3: 0.00%\n",
      "EarlyStopping counter: 36 out of 40\n",
      "Epoch 51, Loss: 0.4352805492389633\n",
      "Validation Loss: 0.8315760514565876, Total Accuracy: 29.94%\n",
      "Accuracy per class - G1: 63.41%, G2: 39.81%, G3: 0.00%\n",
      "EarlyStopping counter: 37 out of 40\n",
      "Epoch 52, Loss: 0.4322576630546386\n",
      "Validation Loss: 0.9106614171039491, Total Accuracy: 28.40%\n",
      "Accuracy per class - G1: 60.98%, G2: 37.68%, G3: 0.00%\n",
      "EarlyStopping counter: 38 out of 40\n",
      "Epoch 53, Loss: 0.43210553153451664\n",
      "Validation Loss: 0.8465672972656432, Total Accuracy: 32.10%\n",
      "Accuracy per class - G1: 70.73%, G2: 42.42%, G3: 0.00%\n",
      "EarlyStopping counter: 39 out of 40\n",
      "Epoch 54, Loss: 0.42720924443509206\n",
      "Validation Loss: 0.8537088958990007, Total Accuracy: 29.01%\n",
      "Accuracy per class - G1: 63.41%, G2: 38.39%, G3: 0.00%\n",
      "EarlyStopping counter: 40 out of 40\n",
      "Early stopping\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\u001b[34m\u001b[1mwandb\u001b[0m:                                                                                \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run history:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run summary:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc 63.41463\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc 96.74797\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc 38.38863\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc 69.89117\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc 0\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc 16.48794\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy 29.01235\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy 57.33182\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss 0.42721\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss 0.85371\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View run \u001b[33m1optuna_run_6 microsoft/resnet-18 Frozen Layers Nooversampling Focallo7\u001b[0m at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/fyv8t5e9\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View project at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Synced 5 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Find logs at: \u001b[35m\u001b[1m./wandb/run-20241009_192434-fyv8t5e9/logs\u001b[0m\n",
      "[I 2024-10-09 19:48:44,321] Trial 6 finished with value: 0.20883185315469857 and parameters: {'weight_decay': 7.847472916533148e-07, 'focal_loss': 1.7398610535111692}. Best is trial 5 with value: 0.22747061179917194.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Tracking run with wandb version 0.18.3\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run data is saved locally in \u001b[35m\u001b[1m/kaggle/working/wandb/run-20241009_194844-dfwnnd6r\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run \u001b[1m`wandb offline`\u001b[0m to turn off syncing.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Syncing run \u001b[33m1optuna_run_7 microsoft/resnet-18 Frozen Layers Nooversampling Focallo8\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View project at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View run at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/dfwnnd6r\u001b[0m\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Epoch 1, Loss: 0.4753889972905079\n",
      "Validation Loss: 0.4298372268676758, Total Accuracy: 44.91%\n",
      "Accuracy per class - G1: 9.76%, G2: 55.21%, G3: 29.19%\n",
      "Validation loss decreased (inf --> 9.026582).  Saving model ...\n",
      "Epoch 2, Loss: 0.4606268201247755\n",
      "Validation Loss: 0.41239218768619357, Total Accuracy: 48.30%\n",
      "Accuracy per class - G1: 19.51%, G2: 57.58%, G3: 33.51%\n",
      "Validation loss decreased (9.026582 --> 8.660236).  Saving model ...\n",
      "Epoch 3, Loss: 0.44947054838559714\n",
      "Validation Loss: 0.3933598633323397, Total Accuracy: 50.62%\n",
      "Accuracy per class - G1: 9.76%, G2: 64.45%, G3: 28.11%\n",
      "Validation loss decreased (8.660236 --> 8.260557).  Saving model ...\n",
      "Epoch 4, Loss: 0.4291140850049904\n",
      "Validation Loss: 0.3984617817969549, Total Accuracy: 51.23%\n",
      "Accuracy per class - G1: 21.95%, G2: 62.56%, G3: 31.89%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 5, Loss: 0.4254051120166319\n",
      "Validation Loss: 0.40203176013060976, Total Accuracy: 49.38%\n",
      "Accuracy per class - G1: 14.63%, G2: 62.09%, G3: 28.11%\n",
      "EarlyStopping counter: 2 out of 40\n",
      "Epoch 6, Loss: 0.4201155513165945\n",
      "Validation Loss: 0.3891722240618297, Total Accuracy: 52.93%\n",
      "Accuracy per class - G1: 21.95%, G2: 65.17%, G3: 31.89%\n",
      "Validation loss decreased (8.260557 --> 8.172617).  Saving model ...\n",
      "Epoch 7, Loss: 0.4045145360820265\n",
      "Validation Loss: 0.3906095347234181, Total Accuracy: 50.62%\n",
      "Accuracy per class - G1: 21.95%, G2: 61.85%, G3: 31.35%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 8, Loss: 0.39934073981032314\n",
      "Validation Loss: 0.39262661763599943, Total Accuracy: 51.23%\n",
      "Accuracy per class - G1: 21.95%, G2: 62.56%, G3: 31.89%\n",
      "EarlyStopping counter: 2 out of 40\n",
      "Epoch 9, Loss: 0.3891742595707078\n",
      "Validation Loss: 0.4088438997666041, Total Accuracy: 47.38%\n",
      "Accuracy per class - G1: 19.51%, G2: 57.82%, G3: 29.73%\n",
      "EarlyStopping counter: 3 out of 40\n",
      "Epoch 10, Loss: 0.37353003527744705\n",
      "Validation Loss: 0.3782975286954925, Total Accuracy: 52.01%\n",
      "Accuracy per class - G1: 21.95%, G2: 64.45%, G3: 30.27%\n",
      "Validation loss decreased (8.172617 --> 7.944248).  Saving model ...\n",
      "Epoch 11, Loss: 0.37187890008271457\n",
      "Validation Loss: 0.3867006103197734, Total Accuracy: 51.54%\n",
      "Accuracy per class - G1: 14.63%, G2: 61.61%, G3: 36.76%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 12, Loss: 0.36797454432550686\n",
      "Validation Loss: 0.39491615408942815, Total Accuracy: 50.31%\n",
      "Accuracy per class - G1: 21.95%, G2: 61.85%, G3: 30.27%\n",
      "EarlyStopping counter: 2 out of 40\n",
      "Epoch 13, Loss: 0.3531933911593564\n",
      "Validation Loss: 0.39387997275307063, Total Accuracy: 50.62%\n",
      "Accuracy per class - G1: 12.20%, G2: 63.98%, G3: 28.65%\n",
      "EarlyStopping counter: 3 out of 40\n",
      "Epoch 14, Loss: 0.3479192766798548\n",
      "Validation Loss: 0.3803617365303494, Total Accuracy: 51.54%\n",
      "Accuracy per class - G1: 14.63%, G2: 64.69%, G3: 29.73%\n",
      "EarlyStopping counter: 4 out of 40\n",
      "Epoch 15, Loss: 0.3454476731369294\n",
      "Validation Loss: 0.3979468970071702, Total Accuracy: 52.01%\n",
      "Accuracy per class - G1: 21.95%, G2: 63.03%, G3: 33.51%\n",
      "EarlyStopping counter: 5 out of 40\n",
      "Epoch 16, Loss: 0.33622912757367973\n",
      "Validation Loss: 0.3897982097807385, Total Accuracy: 49.69%\n",
      "Accuracy per class - G1: 17.07%, G2: 59.48%, G3: 34.59%\n",
      "EarlyStopping counter: 6 out of 40\n",
      "Epoch 17, Loss: 0.3315688648137702\n",
      "Validation Loss: 0.41228769577684854, Total Accuracy: 47.38%\n",
      "Accuracy per class - G1: 14.63%, G2: 56.40%, G3: 34.05%\n",
      "EarlyStopping counter: 7 out of 40\n",
      "Epoch 18, Loss: 0.32676094267741745\n",
      "Validation Loss: 0.4026227714050384, Total Accuracy: 49.69%\n",
      "Accuracy per class - G1: 19.51%, G2: 59.95%, G3: 32.97%\n",
      "EarlyStopping counter: 8 out of 40\n",
      "Epoch 19, Loss: 0.3226616583674787\n",
      "Validation Loss: 0.4144622477747145, Total Accuracy: 47.99%\n",
      "Accuracy per class - G1: 12.20%, G2: 57.35%, G3: 34.59%\n",
      "EarlyStopping counter: 9 out of 40\n",
      "Epoch 20, Loss: 0.32034276407885265\n",
      "Validation Loss: 0.40455988617170424, Total Accuracy: 50.00%\n",
      "Accuracy per class - G1: 9.76%, G2: 61.37%, G3: 32.97%\n",
      "EarlyStopping counter: 10 out of 40\n",
      "Epoch 21, Loss: 0.31318755771022244\n",
      "Validation Loss: 0.4101644555727641, Total Accuracy: 46.76%\n",
      "Accuracy per class - G1: 4.88%, G2: 56.40%, G3: 34.05%\n",
      "EarlyStopping counter: 11 out of 40\n",
      "Epoch 22, Loss: 0.3092767529817949\n",
      "Validation Loss: 0.4112520927474612, Total Accuracy: 48.61%\n",
      "Accuracy per class - G1: 14.63%, G2: 60.90%, G3: 28.11%\n",
      "EarlyStopping counter: 12 out of 40\n",
      "Epoch 23, Loss: 0.3033448507986873\n",
      "Validation Loss: 0.39566685827005477, Total Accuracy: 47.69%\n",
      "Accuracy per class - G1: 12.20%, G2: 55.69%, G3: 37.30%\n",
      "EarlyStopping counter: 13 out of 40\n",
      "Epoch 24, Loss: 0.29498039114188\n",
      "Validation Loss: 0.4376582290445055, Total Accuracy: 42.13%\n",
      "Accuracy per class - G1: 9.76%, G2: 49.29%, G3: 32.97%\n",
      "EarlyStopping counter: 14 out of 40\n",
      "Epoch 25, Loss: 0.29503409474729053\n",
      "Validation Loss: 0.43973760519708904, Total Accuracy: 42.44%\n",
      "Accuracy per class - G1: 9.76%, G2: 50.95%, G3: 30.27%\n",
      "EarlyStopping counter: 15 out of 40\n",
      "Epoch 26, Loss: 0.2873423891254218\n",
      "Validation Loss: 0.41824114393620265, Total Accuracy: 45.22%\n",
      "Accuracy per class - G1: 4.88%, G2: 55.92%, G3: 29.73%\n",
      "EarlyStopping counter: 16 out of 40\n",
      "Epoch 27, Loss: 0.28506214234484245\n",
      "Validation Loss: 0.4261100576037452, Total Accuracy: 45.06%\n",
      "Accuracy per class - G1: 14.63%, G2: 54.27%, G3: 30.81%\n",
      "EarlyStopping counter: 17 out of 40\n",
      "Epoch 28, Loss: 0.28345328264207725\n",
      "Validation Loss: 0.45615885371253606, Total Accuracy: 41.82%\n",
      "Accuracy per class - G1: 4.88%, G2: 49.76%, G3: 31.89%\n",
      "EarlyStopping counter: 18 out of 40\n",
      "Epoch 29, Loss: 0.2758620489074523\n",
      "Validation Loss: 0.43310076778843287, Total Accuracy: 45.68%\n",
      "Accuracy per class - G1: 9.76%, G2: 56.40%, G3: 29.19%\n",
      "EarlyStopping counter: 19 out of 40\n",
      "Epoch 30, Loss: 0.2733438935983612\n",
      "Validation Loss: 0.4520528107171967, Total Accuracy: 39.35%\n",
      "Accuracy per class - G1: 4.88%, G2: 47.87%, G3: 27.57%\n",
      "EarlyStopping counter: 20 out of 40\n",
      "Epoch 31, Loss: 0.2672434260687196\n",
      "Validation Loss: 0.4439788858095805, Total Accuracy: 42.75%\n",
      "Accuracy per class - G1: 19.51%, G2: 48.34%, G3: 35.14%\n",
      "EarlyStopping counter: 21 out of 40\n",
      "Epoch 32, Loss: 0.26847441925341825\n",
      "Validation Loss: 0.44071594022569205, Total Accuracy: 42.90%\n",
      "Accuracy per class - G1: 7.32%, G2: 52.84%, G3: 28.11%\n",
      "EarlyStopping counter: 22 out of 40\n",
      "Epoch 33, Loss: 0.26724551276988295\n",
      "Validation Loss: 0.45008507725738345, Total Accuracy: 41.36%\n",
      "Accuracy per class - G1: 12.20%, G2: 50.00%, G3: 28.11%\n",
      "EarlyStopping counter: 23 out of 40\n",
      "Epoch 34, Loss: 0.26124400798096714\n",
      "Validation Loss: 0.4647215413195746, Total Accuracy: 40.28%\n",
      "Accuracy per class - G1: 17.07%, G2: 47.87%, G3: 28.11%\n",
      "EarlyStopping counter: 24 out of 40\n",
      "Epoch 35, Loss: 0.26616025186446773\n",
      "Validation Loss: 0.46166700905277613, Total Accuracy: 40.74%\n",
      "Accuracy per class - G1: 7.32%, G2: 47.39%, G3: 32.97%\n",
      "EarlyStopping counter: 25 out of 40\n",
      "Epoch 36, Loss: 0.2661767083119197\n",
      "Validation Loss: 0.46102166246800197, Total Accuracy: 38.89%\n",
      "Accuracy per class - G1: 7.32%, G2: 47.16%, G3: 27.03%\n",
      "EarlyStopping counter: 26 out of 40\n",
      "Epoch 37, Loss: 0.26360025032457096\n",
      "Validation Loss: 0.4544278493239766, Total Accuracy: 40.12%\n",
      "Accuracy per class - G1: 4.88%, G2: 47.87%, G3: 30.27%\n",
      "EarlyStopping counter: 27 out of 40\n",
      "Epoch 38, Loss: 0.2596925001546561\n",
      "Validation Loss: 0.4549510209333329, Total Accuracy: 40.28%\n",
      "Accuracy per class - G1: 7.32%, G2: 47.39%, G3: 31.35%\n",
      "EarlyStopping counter: 28 out of 40\n",
      "Epoch 39, Loss: 0.263741147087281\n",
      "Validation Loss: 0.45516400855211986, Total Accuracy: 39.97%\n",
      "Accuracy per class - G1: 4.88%, G2: 50.47%, G3: 23.78%\n",
      "EarlyStopping counter: 29 out of 40\n",
      "Epoch 40, Loss: 0.2598878069814429\n",
      "Validation Loss: 0.4571883199470384, Total Accuracy: 39.97%\n",
      "Accuracy per class - G1: 19.51%, G2: 47.16%, G3: 28.11%\n",
      "EarlyStopping counter: 30 out of 40\n",
      "Epoch 41, Loss: 0.25801063337958\n",
      "Validation Loss: 0.45174484309696017, Total Accuracy: 41.51%\n",
      "Accuracy per class - G1: 7.32%, G2: 49.29%, G3: 31.35%\n",
      "EarlyStopping counter: 31 out of 40\n",
      "Epoch 42, Loss: 0.25743528626051293\n",
      "Validation Loss: 0.45014250136557077, Total Accuracy: 41.05%\n",
      "Accuracy per class - G1: 4.88%, G2: 49.05%, G3: 30.81%\n",
      "EarlyStopping counter: 32 out of 40\n",
      "Epoch 43, Loss: 0.26100914916360235\n",
      "Validation Loss: 0.4549786774885087, Total Accuracy: 40.74%\n",
      "Accuracy per class - G1: 12.20%, G2: 47.16%, G3: 32.43%\n",
      "EarlyStopping counter: 33 out of 40\n",
      "Epoch 44, Loss: 0.2532356275492404\n",
      "Validation Loss: 0.4605501507009779, Total Accuracy: 39.81%\n",
      "Accuracy per class - G1: 2.44%, G2: 48.58%, G3: 28.11%\n",
      "EarlyStopping counter: 34 out of 40\n",
      "Epoch 45, Loss: 0.25599391148032913\n",
      "Validation Loss: 0.4543051481956527, Total Accuracy: 38.58%\n",
      "Accuracy per class - G1: 14.63%, G2: 46.68%, G3: 25.41%\n",
      "EarlyStopping counter: 35 out of 40\n",
      "Epoch 46, Loss: 0.2505361856107252\n",
      "Validation Loss: 0.48010260044109254, Total Accuracy: 39.20%\n",
      "Accuracy per class - G1: 9.76%, G2: 45.02%, G3: 32.43%\n",
      "EarlyStopping counter: 36 out of 40\n",
      "Epoch 47, Loss: 0.25727654059967364\n",
      "Validation Loss: 0.47315453950847897, Total Accuracy: 38.27%\n",
      "Accuracy per class - G1: 14.63%, G2: 45.97%, G3: 25.95%\n",
      "EarlyStopping counter: 37 out of 40\n",
      "Epoch 48, Loss: 0.25216588557484637\n",
      "Validation Loss: 0.4583958770547594, Total Accuracy: 40.28%\n",
      "Accuracy per class - G1: 12.20%, G2: 49.76%, G3: 24.86%\n",
      "EarlyStopping counter: 38 out of 40\n",
      "Epoch 49, Loss: 0.2594012492392437\n",
      "Validation Loss: 0.47042928813468843, Total Accuracy: 38.43%\n",
      "Accuracy per class - G1: 14.63%, G2: 45.26%, G3: 28.11%\n",
      "EarlyStopping counter: 39 out of 40\n",
      "Epoch 50, Loss: 0.25523561634213093\n",
      "Validation Loss: 0.46222901521694093, Total Accuracy: 38.58%\n",
      "Accuracy per class - G1: 4.88%, G2: 45.26%, G3: 30.81%\n",
      "EarlyStopping counter: 40 out of 40\n",
      "Early stopping\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\u001b[34m\u001b[1mwandb\u001b[0m:                                                                                \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run history:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run summary:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc 4.87805\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc 73.57724\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc 45.26066\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc 83.49456\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc 30.81081\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc 73.0563\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy 38.58025\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy 79.62963\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss 0.25524\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss 0.46223\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View run \u001b[33m1optuna_run_7 microsoft/resnet-18 Frozen Layers Nooversampling Focallo8\u001b[0m at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/dfwnnd6r\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View project at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Synced 5 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Find logs at: \u001b[35m\u001b[1m./wandb/run-20241009_194844-dfwnnd6r/logs\u001b[0m\n",
      "[I 2024-10-09 20:11:23,869] Trial 7 finished with value: 0.29790585093823324 and parameters: {'weight_decay': 6.055988565907814e-07, 'focal_loss': 1.9351183997842618}. Best is trial 7 with value: 0.29790585093823324.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Tracking run with wandb version 0.18.3\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run data is saved locally in \u001b[35m\u001b[1m/kaggle/working/wandb/run-20241009_201124-ldinzb0q\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run \u001b[1m`wandb offline`\u001b[0m to turn off syncing.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Syncing run \u001b[33m1optuna_run_8 microsoft/resnet-18 Frozen Layers Nooversampling Focallo9\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View project at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View run at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/ldinzb0q\u001b[0m\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Epoch 1, Loss: 0.4625312703919698\n",
      "Validation Loss: 0.39051911873476847, Total Accuracy: 44.14%\n",
      "Accuracy per class - G1: 4.88%, G2: 48.34%, G3: 43.24%\n",
      "Validation loss decreased (inf --> 8.200901).  Saving model ...\n",
      "Epoch 2, Loss: 0.4425857232277652\n",
      "Validation Loss: 0.377756457953226, Total Accuracy: 46.14%\n",
      "Accuracy per class - G1: 17.07%, G2: 46.21%, G3: 52.43%\n",
      "Validation loss decreased (8.200901 --> 7.932886).  Saving model ...\n",
      "Epoch 3, Loss: 0.4248593359826559\n",
      "Validation Loss: 0.34010796887534006, Total Accuracy: 50.31%\n",
      "Accuracy per class - G1: 14.63%, G2: 53.55%, G3: 50.81%\n",
      "Validation loss decreased (7.932886 --> 7.142267).  Saving model ...\n",
      "Epoch 4, Loss: 0.40873621565749846\n",
      "Validation Loss: 0.3626450733059928, Total Accuracy: 49.69%\n",
      "Accuracy per class - G1: 9.76%, G2: 50.71%, G3: 56.22%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 5, Loss: 0.4047877127865711\n",
      "Validation Loss: 0.3628855702422914, Total Accuracy: 50.77%\n",
      "Accuracy per class - G1: 4.88%, G2: 52.61%, G3: 56.76%\n",
      "EarlyStopping counter: 2 out of 40\n",
      "Epoch 6, Loss: 0.3919820042259722\n",
      "Validation Loss: 0.37652477409158436, Total Accuracy: 49.85%\n",
      "Accuracy per class - G1: 2.44%, G2: 50.47%, G3: 58.92%\n",
      "EarlyStopping counter: 3 out of 40\n",
      "Epoch 7, Loss: 0.38281268060925494\n",
      "Validation Loss: 0.379919748930704, Total Accuracy: 47.99%\n",
      "Accuracy per class - G1: 9.76%, G2: 46.21%, G3: 60.54%\n",
      "EarlyStopping counter: 4 out of 40\n",
      "Epoch 8, Loss: 0.3712805182818907\n",
      "Validation Loss: 0.3820392446858542, Total Accuracy: 47.53%\n",
      "Accuracy per class - G1: 4.88%, G2: 46.21%, G3: 60.00%\n",
      "EarlyStopping counter: 5 out of 40\n",
      "Epoch 9, Loss: 0.36140923902212857\n",
      "Validation Loss: 0.3882340228273755, Total Accuracy: 44.91%\n",
      "Accuracy per class - G1: 7.32%, G2: 45.02%, G3: 52.97%\n",
      "EarlyStopping counter: 6 out of 40\n",
      "Epoch 10, Loss: 0.35059383906513814\n",
      "Validation Loss: 0.40489556392033893, Total Accuracy: 45.52%\n",
      "Accuracy per class - G1: 7.32%, G2: 44.55%, G3: 56.22%\n",
      "EarlyStopping counter: 7 out of 40\n",
      "Epoch 11, Loss: 0.3460927995213543\n",
      "Validation Loss: 0.38710270325342816, Total Accuracy: 46.30%\n",
      "Accuracy per class - G1: 12.20%, G2: 45.97%, G3: 54.59%\n",
      "EarlyStopping counter: 8 out of 40\n",
      "Epoch 12, Loss: 0.3358430639807\n",
      "Validation Loss: 0.38106424042156767, Total Accuracy: 47.22%\n",
      "Accuracy per class - G1: 4.88%, G2: 47.16%, G3: 56.76%\n",
      "EarlyStopping counter: 9 out of 40\n",
      "Epoch 13, Loss: 0.3336622804762369\n",
      "Validation Loss: 0.39048488225255695, Total Accuracy: 46.14%\n",
      "Accuracy per class - G1: 4.88%, G2: 42.89%, G3: 62.70%\n",
      "EarlyStopping counter: 10 out of 40\n",
      "Epoch 14, Loss: 0.323722114225468\n",
      "Validation Loss: 0.40477400379521505, Total Accuracy: 44.91%\n",
      "Accuracy per class - G1: 2.44%, G2: 42.89%, G3: 58.92%\n",
      "EarlyStopping counter: 11 out of 40\n",
      "Epoch 15, Loss: 0.3159506532801203\n",
      "Validation Loss: 0.3791063271817707, Total Accuracy: 49.54%\n",
      "Accuracy per class - G1: 2.44%, G2: 51.90%, G3: 54.59%\n",
      "EarlyStopping counter: 12 out of 40\n",
      "Epoch 16, Loss: 0.30846026952726296\n",
      "Validation Loss: 0.4036772868462971, Total Accuracy: 43.98%\n",
      "Accuracy per class - G1: 4.88%, G2: 42.65%, G3: 55.68%\n",
      "EarlyStopping counter: 13 out of 40\n",
      "Epoch 17, Loss: 0.3054205159465951\n",
      "Validation Loss: 0.42154751292296816, Total Accuracy: 46.30%\n",
      "Accuracy per class - G1: 7.32%, G2: 42.42%, G3: 63.78%\n",
      "EarlyStopping counter: 14 out of 40\n",
      "Epoch 18, Loss: 0.29844595114868805\n",
      "Validation Loss: 0.40266549516291844, Total Accuracy: 45.06%\n",
      "Accuracy per class - G1: 7.32%, G2: 41.94%, G3: 60.54%\n",
      "EarlyStopping counter: 15 out of 40\n",
      "Epoch 19, Loss: 0.2914236961718065\n",
      "Validation Loss: 0.4255313624938329, Total Accuracy: 41.98%\n",
      "Accuracy per class - G1: 7.32%, G2: 40.05%, G3: 54.05%\n",
      "EarlyStopping counter: 16 out of 40\n",
      "Epoch 20, Loss: 0.2840166050626571\n",
      "Validation Loss: 0.4474204970257623, Total Accuracy: 39.20%\n",
      "Accuracy per class - G1: 2.44%, G2: 36.49%, G3: 53.51%\n",
      "EarlyStopping counter: 17 out of 40\n",
      "Epoch 21, Loss: 0.28002763907593414\n",
      "Validation Loss: 0.41927401579561685, Total Accuracy: 41.20%\n",
      "Accuracy per class - G1: 4.88%, G2: 38.15%, G3: 56.22%\n",
      "EarlyStopping counter: 18 out of 40\n",
      "Epoch 22, Loss: 0.27672772504479054\n",
      "Validation Loss: 0.4272729655106862, Total Accuracy: 43.98%\n",
      "Accuracy per class - G1: 2.44%, G2: 41.00%, G3: 60.00%\n",
      "EarlyStopping counter: 19 out of 40\n",
      "Epoch 23, Loss: 0.2782157639782113\n",
      "Validation Loss: 0.434025186867941, Total Accuracy: 43.06%\n",
      "Accuracy per class - G1: 2.44%, G2: 39.81%, G3: 59.46%\n",
      "EarlyStopping counter: 20 out of 40\n",
      "Epoch 24, Loss: 0.2726473275078348\n",
      "Validation Loss: 0.44212989651021506, Total Accuracy: 40.59%\n",
      "Accuracy per class - G1: 7.32%, G2: 36.97%, G3: 56.22%\n",
      "EarlyStopping counter: 21 out of 40\n",
      "Epoch 25, Loss: 0.27245209572545015\n",
      "Validation Loss: 0.45248376329739887, Total Accuracy: 39.81%\n",
      "Accuracy per class - G1: 0.00%, G2: 37.91%, G3: 52.97%\n",
      "EarlyStopping counter: 22 out of 40\n",
      "Epoch 26, Loss: 0.26721431781728583\n",
      "Validation Loss: 0.42356041357630775, Total Accuracy: 43.21%\n",
      "Accuracy per class - G1: 2.44%, G2: 39.81%, G3: 60.00%\n",
      "EarlyStopping counter: 23 out of 40\n",
      "Epoch 27, Loss: 0.2673215862498226\n",
      "Validation Loss: 0.4474126192785445, Total Accuracy: 41.98%\n",
      "Accuracy per class - G1: 4.88%, G2: 35.55%, G3: 64.86%\n",
      "EarlyStopping counter: 24 out of 40\n",
      "Epoch 28, Loss: 0.2674688687884664\n",
      "Validation Loss: 0.4416959448939278, Total Accuracy: 41.82%\n",
      "Accuracy per class - G1: 7.32%, G2: 39.10%, G3: 55.68%\n",
      "EarlyStopping counter: 25 out of 40\n",
      "Epoch 29, Loss: 0.26096597816570694\n",
      "Validation Loss: 0.43912643832819803, Total Accuracy: 42.13%\n",
      "Accuracy per class - G1: 0.00%, G2: 37.91%, G3: 61.08%\n",
      "EarlyStopping counter: 26 out of 40\n",
      "Epoch 30, Loss: 0.2638365466551608\n",
      "Validation Loss: 0.4313206346262069, Total Accuracy: 42.59%\n",
      "Accuracy per class - G1: 2.44%, G2: 39.81%, G3: 57.84%\n",
      "EarlyStopping counter: 27 out of 40\n",
      "Epoch 31, Loss: 0.25913037808544664\n",
      "Validation Loss: 0.4295138447057633, Total Accuracy: 44.60%\n",
      "Accuracy per class - G1: 2.44%, G2: 41.71%, G3: 60.54%\n",
      "EarlyStopping counter: 28 out of 40\n",
      "Epoch 32, Loss: 0.26156819530998365\n",
      "Validation Loss: 0.43732901627109166, Total Accuracy: 42.28%\n",
      "Accuracy per class - G1: 4.88%, G2: 36.49%, G3: 63.78%\n",
      "EarlyStopping counter: 29 out of 40\n",
      "Epoch 33, Loss: 0.25560576136571816\n",
      "Validation Loss: 0.45842120619047255, Total Accuracy: 40.12%\n",
      "Accuracy per class - G1: 0.00%, G2: 35.07%, G3: 60.54%\n",
      "EarlyStopping counter: 30 out of 40\n",
      "Epoch 34, Loss: 0.25831156286848594\n",
      "Validation Loss: 0.4345028861647561, Total Accuracy: 42.13%\n",
      "Accuracy per class - G1: 4.88%, G2: 37.91%, G3: 60.00%\n",
      "EarlyStopping counter: 31 out of 40\n",
      "Epoch 35, Loss: 0.25577713082353754\n",
      "Validation Loss: 0.4284295290708542, Total Accuracy: 42.90%\n",
      "Accuracy per class - G1: 4.88%, G2: 36.97%, G3: 64.86%\n",
      "EarlyStopping counter: 32 out of 40\n",
      "Epoch 36, Loss: 0.2609985345099346\n",
      "Validation Loss: 0.462116335829099, Total Accuracy: 38.89%\n",
      "Accuracy per class - G1: 2.44%, G2: 35.55%, G3: 54.59%\n",
      "EarlyStopping counter: 33 out of 40\n",
      "Epoch 37, Loss: 0.25634835786130056\n",
      "Validation Loss: 0.4481076314335778, Total Accuracy: 39.66%\n",
      "Accuracy per class - G1: 2.44%, G2: 34.60%, G3: 59.46%\n",
      "EarlyStopping counter: 34 out of 40\n",
      "Epoch 38, Loss: 0.2554605587060193\n",
      "Validation Loss: 0.4321784561588651, Total Accuracy: 38.89%\n",
      "Accuracy per class - G1: 0.00%, G2: 36.02%, G3: 54.05%\n",
      "EarlyStopping counter: 35 out of 40\n",
      "Epoch 39, Loss: 0.25492111153631325\n",
      "Validation Loss: 0.4606331544263022, Total Accuracy: 39.51%\n",
      "Accuracy per class - G1: 2.44%, G2: 32.70%, G3: 63.24%\n",
      "EarlyStopping counter: 36 out of 40\n",
      "Epoch 40, Loss: 0.2532886299024145\n",
      "Validation Loss: 0.4359924928063438, Total Accuracy: 42.59%\n",
      "Accuracy per class - G1: 4.88%, G2: 38.39%, G3: 60.54%\n",
      "EarlyStopping counter: 37 out of 40\n",
      "Epoch 41, Loss: 0.25227283587656824\n",
      "Validation Loss: 0.43425455121766954, Total Accuracy: 44.14%\n",
      "Accuracy per class - G1: 2.44%, G2: 41.71%, G3: 58.92%\n",
      "EarlyStopping counter: 38 out of 40\n",
      "Epoch 42, Loss: 0.25030838473733646\n",
      "Validation Loss: 0.47550428055581595, Total Accuracy: 38.89%\n",
      "Accuracy per class - G1: 2.44%, G2: 31.99%, G3: 62.70%\n",
      "EarlyStopping counter: 39 out of 40\n",
      "Epoch 43, Loss: 0.25222950419747686\n",
      "Validation Loss: 0.4774265523467745, Total Accuracy: 39.81%\n",
      "Accuracy per class - G1: 0.00%, G2: 34.83%, G3: 60.00%\n",
      "EarlyStopping counter: 40 out of 40\n",
      "Early stopping\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\u001b[34m\u001b[1mwandb\u001b[0m:                                                                                \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run history:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run summary:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc 0\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc 41.86992\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc 34.83412\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc 64.69166\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc 60\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc 80.8311\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy 39.81481\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy 67.12018\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss 0.25223\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss 0.47743\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View run \u001b[33m1optuna_run_8 microsoft/resnet-18 Frozen Layers Nooversampling Focallo9\u001b[0m at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/ldinzb0q\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View project at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Synced 5 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Find logs at: \u001b[35m\u001b[1m./wandb/run-20241009_201124-ldinzb0q/logs\u001b[0m\n",
      "[I 2024-10-09 20:30:52,401] Trial 8 finished with value: 0.28799257055790073 and parameters: {'weight_decay': 5.277033388553906e-07, 'focal_loss': 2.2668129590190462}. Best is trial 7 with value: 0.29790585093823324.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Tracking run with wandb version 0.18.3\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run data is saved locally in \u001b[35m\u001b[1m/kaggle/working/wandb/run-20241009_203053-ae86av7k\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run \u001b[1m`wandb offline`\u001b[0m to turn off syncing.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Syncing run \u001b[33m1optuna_run_9 microsoft/resnet-18 Frozen Layers Nooversampling Focallo10\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View project at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View run at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/ae86av7k\u001b[0m\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Epoch 1, Loss: 0.5637656331780445\n",
      "Validation Loss: 0.6502294228190467, Total Accuracy: 25.46%\n",
      "Accuracy per class - G1: 2.44%, G2: 9.72%, G3: 66.49%\n",
      "Validation loss decreased (inf --> 13.654818).  Saving model ...\n",
      "Epoch 2, Loss: 0.5450615796698145\n",
      "Validation Loss: 0.6822552723543984, Total Accuracy: 27.16%\n",
      "Accuracy per class - G1: 4.88%, G2: 9.95%, G3: 71.35%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 3, Loss: 0.5328283855713993\n",
      "Validation Loss: 0.674086556548164, Total Accuracy: 27.16%\n",
      "Accuracy per class - G1: 7.32%, G2: 10.90%, G3: 68.65%\n",
      "EarlyStopping counter: 2 out of 40\n",
      "Epoch 4, Loss: 0.5232526954398098\n",
      "Validation Loss: 0.7074878918273109, Total Accuracy: 25.46%\n",
      "Accuracy per class - G1: 12.20%, G2: 7.82%, G3: 68.65%\n",
      "EarlyStopping counter: 3 out of 40\n",
      "Epoch 5, Loss: 0.5157906068376747\n",
      "Validation Loss: 0.7107716458184379, Total Accuracy: 28.09%\n",
      "Accuracy per class - G1: 7.32%, G2: 11.37%, G3: 70.81%\n",
      "EarlyStopping counter: 4 out of 40\n",
      "Epoch 6, Loss: 0.49916570409234745\n",
      "Validation Loss: 0.7018581543649945, Total Accuracy: 26.54%\n",
      "Accuracy per class - G1: 9.76%, G2: 9.24%, G3: 69.73%\n",
      "EarlyStopping counter: 5 out of 40\n",
      "Epoch 7, Loss: 0.4870571896254298\n",
      "Validation Loss: 0.722511520697957, Total Accuracy: 26.85%\n",
      "Accuracy per class - G1: 12.20%, G2: 10.90%, G3: 66.49%\n",
      "EarlyStopping counter: 6 out of 40\n",
      "Epoch 8, Loss: 0.4860268465007644\n",
      "Validation Loss: 0.7316082730179742, Total Accuracy: 26.39%\n",
      "Accuracy per class - G1: 7.32%, G2: 10.90%, G3: 65.95%\n",
      "EarlyStopping counter: 7 out of 40\n",
      "Epoch 9, Loss: 0.480623951518392\n",
      "Validation Loss: 0.7590566710347221, Total Accuracy: 26.70%\n",
      "Accuracy per class - G1: 9.76%, G2: 12.09%, G3: 63.78%\n",
      "EarlyStopping counter: 8 out of 40\n",
      "Epoch 10, Loss: 0.4662925697952868\n",
      "Validation Loss: 0.753019399586178, Total Accuracy: 26.70%\n",
      "Accuracy per class - G1: 9.76%, G2: 9.95%, G3: 68.65%\n",
      "EarlyStopping counter: 9 out of 40\n",
      "Epoch 11, Loss: 0.4612612681216504\n",
      "Validation Loss: 0.7703046060743786, Total Accuracy: 25.77%\n",
      "Accuracy per class - G1: 7.32%, G2: 11.37%, G3: 62.70%\n",
      "EarlyStopping counter: 10 out of 40\n",
      "Epoch 12, Loss: 0.4563223389257868\n",
      "Validation Loss: 0.7511719706512633, Total Accuracy: 28.24%\n",
      "Accuracy per class - G1: 4.88%, G2: 12.09%, G3: 70.27%\n",
      "EarlyStopping counter: 11 out of 40\n",
      "Epoch 13, Loss: 0.45160960935684574\n",
      "Validation Loss: 0.7973287417775109, Total Accuracy: 24.54%\n",
      "Accuracy per class - G1: 4.88%, G2: 10.43%, G3: 61.08%\n",
      "EarlyStopping counter: 12 out of 40\n",
      "Epoch 14, Loss: 0.4464506585913968\n",
      "Validation Loss: 0.7995969993727547, Total Accuracy: 24.85%\n",
      "Accuracy per class - G1: 12.20%, G2: 11.61%, G3: 57.84%\n",
      "EarlyStopping counter: 13 out of 40\n",
      "Epoch 15, Loss: 0.4384143266333155\n",
      "Validation Loss: 0.8151729433309465, Total Accuracy: 25.15%\n",
      "Accuracy per class - G1: 12.20%, G2: 12.09%, G3: 57.84%\n",
      "EarlyStopping counter: 14 out of 40\n",
      "Epoch 16, Loss: 0.4201751588338829\n",
      "Validation Loss: 0.791905837399619, Total Accuracy: 24.23%\n",
      "Accuracy per class - G1: 4.88%, G2: 10.43%, G3: 60.00%\n",
      "EarlyStopping counter: 15 out of 40\n",
      "Epoch 17, Loss: 0.4184725187629102\n",
      "Validation Loss: 0.8331604628335862, Total Accuracy: 26.39%\n",
      "Accuracy per class - G1: 7.32%, G2: 11.85%, G3: 63.78%\n",
      "EarlyStopping counter: 16 out of 40\n",
      "Epoch 18, Loss: 0.41267888912235395\n",
      "Validation Loss: 0.8425728976726532, Total Accuracy: 27.47%\n",
      "Accuracy per class - G1: 14.63%, G2: 12.56%, G3: 64.32%\n",
      "EarlyStopping counter: 17 out of 40\n",
      "Epoch 19, Loss: 0.4166701209832387\n",
      "Validation Loss: 0.8385841945807139, Total Accuracy: 24.85%\n",
      "Accuracy per class - G1: 4.88%, G2: 11.85%, G3: 58.92%\n",
      "EarlyStopping counter: 18 out of 40\n",
      "Epoch 20, Loss: 0.4083575189831745\n",
      "Validation Loss: 0.8240843330110822, Total Accuracy: 27.01%\n",
      "Accuracy per class - G1: 9.76%, G2: 14.69%, G3: 58.92%\n",
      "EarlyStopping counter: 19 out of 40\n",
      "Epoch 21, Loss: 0.39412502028855934\n",
      "Validation Loss: 0.844005252633776, Total Accuracy: 25.00%\n",
      "Accuracy per class - G1: 4.88%, G2: 13.03%, G3: 56.76%\n",
      "EarlyStopping counter: 20 out of 40\n",
      "Epoch 22, Loss: 0.39204321029674577\n",
      "Validation Loss: 0.8607982794443766, Total Accuracy: 26.85%\n",
      "Accuracy per class - G1: 9.76%, G2: 14.22%, G3: 59.46%\n",
      "EarlyStopping counter: 21 out of 40\n",
      "Epoch 23, Loss: 0.3861105093754918\n",
      "Validation Loss: 0.8407029807567596, Total Accuracy: 27.16%\n",
      "Accuracy per class - G1: 21.95%, G2: 13.74%, G3: 58.92%\n",
      "EarlyStopping counter: 22 out of 40\n",
      "Epoch 24, Loss: 0.3880285347800657\n",
      "Validation Loss: 0.861977260737192, Total Accuracy: 27.47%\n",
      "Accuracy per class - G1: 14.63%, G2: 16.35%, G3: 55.68%\n",
      "EarlyStopping counter: 23 out of 40\n",
      "Epoch 25, Loss: 0.3868015656270177\n",
      "Validation Loss: 0.8754888361408597, Total Accuracy: 25.77%\n",
      "Accuracy per class - G1: 9.76%, G2: 14.22%, G3: 55.68%\n",
      "EarlyStopping counter: 24 out of 40\n",
      "Epoch 26, Loss: 0.3868306548480528\n",
      "Validation Loss: 0.8472357037521544, Total Accuracy: 25.62%\n",
      "Accuracy per class - G1: 17.07%, G2: 15.40%, G3: 50.81%\n",
      "EarlyStopping counter: 25 out of 40\n",
      "Epoch 27, Loss: 0.3911747336387634\n",
      "Validation Loss: 0.8641981496697381, Total Accuracy: 26.85%\n",
      "Accuracy per class - G1: 9.76%, G2: 15.17%, G3: 57.30%\n",
      "EarlyStopping counter: 26 out of 40\n",
      "Epoch 28, Loss: 0.3835443376776684\n",
      "Validation Loss: 0.8574282824993134, Total Accuracy: 23.77%\n",
      "Accuracy per class - G1: 7.32%, G2: 13.98%, G3: 49.73%\n",
      "EarlyStopping counter: 27 out of 40\n",
      "Epoch 29, Loss: 0.3795659466680274\n",
      "Validation Loss: 0.8669348813238598, Total Accuracy: 26.85%\n",
      "Accuracy per class - G1: 4.88%, G2: 16.82%, G3: 54.59%\n",
      "EarlyStopping counter: 28 out of 40\n",
      "Epoch 30, Loss: 0.3774600359330694\n",
      "Validation Loss: 0.8841406930060614, Total Accuracy: 25.62%\n",
      "Accuracy per class - G1: 7.32%, G2: 13.51%, G3: 57.30%\n",
      "EarlyStopping counter: 29 out of 40\n",
      "Epoch 31, Loss: 0.3811382859586233\n",
      "Validation Loss: 0.868147550594239, Total Accuracy: 23.92%\n",
      "Accuracy per class - G1: 9.76%, G2: 13.74%, G3: 50.27%\n",
      "EarlyStopping counter: 30 out of 40\n",
      "Epoch 32, Loss: 0.37827320738011094\n",
      "Validation Loss: 0.843065029098874, Total Accuracy: 23.77%\n",
      "Accuracy per class - G1: 12.20%, G2: 14.22%, G3: 48.11%\n",
      "EarlyStopping counter: 31 out of 40\n",
      "Epoch 33, Loss: 0.3732356594269534\n",
      "Validation Loss: 0.8614990342231024, Total Accuracy: 27.16%\n",
      "Accuracy per class - G1: 17.07%, G2: 14.69%, G3: 57.84%\n",
      "EarlyStopping counter: 32 out of 40\n",
      "Epoch 34, Loss: 0.37821438154542303\n",
      "Validation Loss: 0.8784207573958805, Total Accuracy: 25.62%\n",
      "Accuracy per class - G1: 19.51%, G2: 11.61%, G3: 58.92%\n",
      "EarlyStopping counter: 33 out of 40\n",
      "Epoch 35, Loss: 0.37419307052371015\n",
      "Validation Loss: 0.8797379348959241, Total Accuracy: 24.54%\n",
      "Accuracy per class - G1: 14.63%, G2: 11.14%, G3: 57.30%\n",
      "EarlyStopping counter: 34 out of 40\n",
      "Epoch 36, Loss: 0.3733743095254324\n",
      "Validation Loss: 0.8824519515037537, Total Accuracy: 25.00%\n",
      "Accuracy per class - G1: 14.63%, G2: 13.03%, G3: 54.59%\n",
      "EarlyStopping counter: 35 out of 40\n",
      "Epoch 37, Loss: 0.3703877990504345\n",
      "Validation Loss: 0.8678764842805409, Total Accuracy: 26.23%\n",
      "Accuracy per class - G1: 4.88%, G2: 14.93%, G3: 56.76%\n",
      "EarlyStopping counter: 36 out of 40\n",
      "Epoch 38, Loss: 0.3719649986330285\n",
      "Validation Loss: 0.9055153472082955, Total Accuracy: 25.46%\n",
      "Accuracy per class - G1: 12.20%, G2: 13.51%, G3: 55.68%\n",
      "EarlyStopping counter: 37 out of 40\n",
      "Epoch 39, Loss: 0.3765159260077649\n",
      "Validation Loss: 0.8741081513109661, Total Accuracy: 27.16%\n",
      "Accuracy per class - G1: 14.63%, G2: 15.64%, G3: 56.22%\n",
      "EarlyStopping counter: 38 out of 40\n",
      "Epoch 40, Loss: 0.3703879685287016\n",
      "Validation Loss: 0.8828730639957246, Total Accuracy: 24.07%\n",
      "Accuracy per class - G1: 9.76%, G2: 13.03%, G3: 52.43%\n",
      "EarlyStopping counter: 39 out of 40\n",
      "Epoch 41, Loss: 0.3652432612985013\n",
      "Validation Loss: 0.8865792481672197, Total Accuracy: 25.46%\n",
      "Accuracy per class - G1: 4.88%, G2: 18.01%, G3: 47.03%\n",
      "EarlyStopping counter: 40 out of 40\n",
      "Early stopping\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\u001b[34m\u001b[1mwandb\u001b[0m:                                                                                \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run history:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run summary:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc 4.87805\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc 63.00813\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc 18.00948\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc 56.77146\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc 47.02703\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc 86.72922\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy 25.46296\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy 65.79743\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss 0.36524\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss 0.88658\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View run \u001b[33m1optuna_run_9 microsoft/resnet-18 Frozen Layers Nooversampling Focallo10\u001b[0m at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/ae86av7k\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View project at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Synced 5 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Find logs at: \u001b[35m\u001b[1m./wandb/run-20241009_203053-ae86av7k/logs\u001b[0m\n",
      "[I 2024-10-09 20:49:27,683] Trial 9 finished with value: 0.2259815727992062 and parameters: {'weight_decay': 2.11337070748119e-06, 'focal_loss': 1.8613597973243665}. Best is trial 7 with value: 0.29790585093823324.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Tracking run with wandb version 0.18.3\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run data is saved locally in \u001b[35m\u001b[1m/kaggle/working/wandb/run-20241009_204928-pol31xr5\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run \u001b[1m`wandb offline`\u001b[0m to turn off syncing.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Syncing run \u001b[33m1optuna_run_10 microsoft/resnet-18 Frozen Layers Nooversampling Focallo11\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View project at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View run at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/pol31xr5\u001b[0m\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Epoch 1, Loss: 0.8829442075936191\n",
      "Validation Loss: 1.015004970665489, Total Accuracy: 28.40%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 99.46%\n",
      "Validation loss decreased (inf --> 21.315104).  Saving model ...\n",
      "Epoch 2, Loss: 0.8644835518067142\n",
      "Validation Loss: 0.9831933765893891, Total Accuracy: 28.70%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.47%, G3: 99.46%\n",
      "Validation loss decreased (21.315104 --> 20.647061).  Saving model ...\n",
      "Epoch 3, Loss: 0.8579449825976269\n",
      "Validation Loss: 1.0083818357615244, Total Accuracy: 28.70%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.47%, G3: 99.46%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 4, Loss: 0.8518671120505735\n",
      "Validation Loss: 1.0360116305805387, Total Accuracy: 28.70%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.24%, G3: 100.00%\n",
      "EarlyStopping counter: 2 out of 40\n",
      "Epoch 5, Loss: 0.8397235777004656\n",
      "Validation Loss: 1.0410382055810519, Total Accuracy: 28.70%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.24%, G3: 100.00%\n",
      "EarlyStopping counter: 3 out of 40\n",
      "Epoch 6, Loss: 0.8216472763613046\n",
      "Validation Loss: 1.0324061917407172, Total Accuracy: 29.01%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.71%, G3: 100.00%\n",
      "EarlyStopping counter: 4 out of 40\n",
      "Epoch 7, Loss: 0.8098270246781498\n",
      "Validation Loss: 1.0274206101894379, Total Accuracy: 28.70%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.24%, G3: 100.00%\n",
      "EarlyStopping counter: 5 out of 40\n",
      "Epoch 8, Loss: 0.7978404343846333\n",
      "Validation Loss: 1.0562675893306732, Total Accuracy: 28.70%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.24%, G3: 100.00%\n",
      "EarlyStopping counter: 6 out of 40\n",
      "Epoch 9, Loss: 0.7911708031792238\n",
      "Validation Loss: 1.0365910221423422, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 7 out of 40\n",
      "Epoch 10, Loss: 0.7786072248435882\n",
      "Validation Loss: 1.0501067943516231, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 8 out of 40\n",
      "Epoch 11, Loss: 0.7706895226455597\n",
      "Validation Loss: 1.070589236560322, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 9 out of 40\n",
      "Epoch 12, Loss: 0.7600103860878082\n",
      "Validation Loss: 1.116368785855316, Total Accuracy: 28.70%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.24%, G3: 100.00%\n",
      "EarlyStopping counter: 10 out of 40\n",
      "Epoch 13, Loss: 0.7459768376436579\n",
      "Validation Loss: 1.0684713838355882, Total Accuracy: 28.70%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.24%, G3: 100.00%\n",
      "EarlyStopping counter: 11 out of 40\n",
      "Epoch 14, Loss: 0.7438922944557236\n",
      "Validation Loss: 1.0716209952675162, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 12 out of 40\n",
      "Epoch 15, Loss: 0.7293261332684252\n",
      "Validation Loss: 1.0738904483261562, Total Accuracy: 28.70%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.24%, G3: 100.00%\n",
      "EarlyStopping counter: 13 out of 40\n",
      "Epoch 16, Loss: 0.7202661798661014\n",
      "Validation Loss: 1.1402161898357528, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.24%, G3: 99.46%\n",
      "EarlyStopping counter: 14 out of 40\n",
      "Epoch 17, Loss: 0.7160377222371389\n",
      "Validation Loss: 1.0879736216295333, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 15 out of 40\n",
      "Epoch 18, Loss: 0.7028381896306233\n",
      "Validation Loss: 1.112730341830424, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 16 out of 40\n",
      "Epoch 19, Loss: 0.687798677438713\n",
      "Validation Loss: 1.1647090787688892, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 17 out of 40\n",
      "Epoch 20, Loss: 0.687459624675383\n",
      "Validation Loss: 1.1411939415903318, Total Accuracy: 28.70%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.24%, G3: 100.00%\n",
      "EarlyStopping counter: 18 out of 40\n",
      "Epoch 21, Loss: 0.6700715760150587\n",
      "Validation Loss: 1.1258860957764445, Total Accuracy: 28.70%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.24%, G3: 100.00%\n",
      "EarlyStopping counter: 19 out of 40\n",
      "Epoch 22, Loss: 0.6696756252323288\n",
      "Validation Loss: 1.1249628301177705, Total Accuracy: 29.48%\n",
      "Accuracy per class - G1: 0.00%, G2: 1.42%, G3: 100.00%\n",
      "EarlyStopping counter: 20 out of 40\n",
      "Epoch 23, Loss: 0.656392896390823\n",
      "Validation Loss: 1.1577791706437157, Total Accuracy: 28.86%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.47%, G3: 100.00%\n",
      "EarlyStopping counter: 21 out of 40\n",
      "Epoch 24, Loss: 0.6468445493514279\n",
      "Validation Loss: 1.2036932350269385, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 22 out of 40\n",
      "Epoch 25, Loss: 0.6532363679753729\n",
      "Validation Loss: 1.1735035979322024, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 23 out of 40\n",
      "Epoch 26, Loss: 0.6541244559977428\n",
      "Validation Loss: 1.1745942412387758, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 24 out of 40\n",
      "Epoch 27, Loss: 0.6546926110623831\n",
      "Validation Loss: 1.1913837994493188, Total Accuracy: 28.70%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.24%, G3: 100.00%\n",
      "EarlyStopping counter: 25 out of 40\n",
      "Epoch 28, Loss: 0.6425613251077124\n",
      "Validation Loss: 1.1566293722107297, Total Accuracy: 28.86%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.47%, G3: 100.00%\n",
      "EarlyStopping counter: 26 out of 40\n",
      "Epoch 29, Loss: 0.6404165262917438\n",
      "Validation Loss: 1.1836387358960652, Total Accuracy: 28.86%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.47%, G3: 100.00%\n",
      "EarlyStopping counter: 27 out of 40\n",
      "Epoch 30, Loss: 0.6376747165817812\n",
      "Validation Loss: 1.20851705152364, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 28 out of 40\n",
      "Epoch 31, Loss: 0.6372034714882633\n",
      "Validation Loss: 1.19557498359964, Total Accuracy: 28.86%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.47%, G3: 100.00%\n",
      "EarlyStopping counter: 29 out of 40\n",
      "Epoch 32, Loss: 0.6346426311745701\n",
      "Validation Loss: 1.1787585853820755, Total Accuracy: 28.70%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.24%, G3: 100.00%\n",
      "EarlyStopping counter: 30 out of 40\n",
      "Epoch 33, Loss: 0.6307674456073578\n",
      "Validation Loss: 1.1908340730837412, Total Accuracy: 28.70%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.24%, G3: 100.00%\n",
      "EarlyStopping counter: 31 out of 40\n",
      "Epoch 34, Loss: 0.6315041809196932\n",
      "Validation Loss: 1.2668478307979447, Total Accuracy: 28.70%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.24%, G3: 100.00%\n",
      "EarlyStopping counter: 32 out of 40\n",
      "Epoch 35, Loss: 0.635696269302483\n",
      "Validation Loss: 1.2203722085271562, Total Accuracy: 28.86%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.47%, G3: 100.00%\n",
      "EarlyStopping counter: 33 out of 40\n",
      "Epoch 36, Loss: 0.6259682580649134\n",
      "Validation Loss: 1.2084175181530772, Total Accuracy: 28.86%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.47%, G3: 100.00%\n",
      "EarlyStopping counter: 34 out of 40\n",
      "Epoch 37, Loss: 0.6242929352335183\n",
      "Validation Loss: 1.2245394136934054, Total Accuracy: 28.86%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.47%, G3: 100.00%\n",
      "EarlyStopping counter: 35 out of 40\n",
      "Epoch 38, Loss: 0.6256228649472616\n",
      "Validation Loss: 1.182460153741496, Total Accuracy: 29.01%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.71%, G3: 100.00%\n",
      "EarlyStopping counter: 36 out of 40\n",
      "Epoch 39, Loss: 0.6180214091955897\n",
      "Validation Loss: 1.2234290394754637, Total Accuracy: 28.55%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.00%, G3: 100.00%\n",
      "EarlyStopping counter: 37 out of 40\n",
      "Epoch 40, Loss: 0.6194974417427936\n",
      "Validation Loss: 1.2086186199670745, Total Accuracy: 29.01%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.71%, G3: 100.00%\n",
      "EarlyStopping counter: 38 out of 40\n",
      "Epoch 41, Loss: 0.6203607205885002\n",
      "Validation Loss: 1.184766716190747, Total Accuracy: 29.01%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.71%, G3: 100.00%\n",
      "EarlyStopping counter: 39 out of 40\n",
      "Epoch 42, Loss: 0.6181783475071551\n",
      "Validation Loss: 1.2580513883204687, Total Accuracy: 28.70%\n",
      "Accuracy per class - G1: 0.00%, G2: 0.24%, G3: 100.00%\n",
      "EarlyStopping counter: 40 out of 40\n",
      "Early stopping\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\u001b[34m\u001b[1mwandb\u001b[0m:                                                                                \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run history:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run summary:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc 0\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc 7.31707\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc 0.23697\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc 5.80411\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc 100\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc 100\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy 28.7037\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy 32.50189\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss 0.61818\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss 1.25805\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View run \u001b[33m1optuna_run_10 microsoft/resnet-18 Frozen Layers Nooversampling Focallo11\u001b[0m at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/pol31xr5\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View project at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Synced 5 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Find logs at: \u001b[35m\u001b[1m./wandb/run-20241009_204928-pol31xr5/logs\u001b[0m\n",
      "[I 2024-10-09 21:08:13,883] Trial 10 finished with value: 0.15191087774072234 and parameters: {'weight_decay': 4.453374402437725e-06, 'focal_loss': 1.5587328299063756}. Best is trial 7 with value: 0.29790585093823324.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Tracking run with wandb version 0.18.3\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run data is saved locally in \u001b[35m\u001b[1m/kaggle/working/wandb/run-20241009_210814-io0kxyyj\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run \u001b[1m`wandb offline`\u001b[0m to turn off syncing.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Syncing run \u001b[33m1optuna_run_11 microsoft/resnet-18 Frozen Layers Nooversampling Focallo12\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View project at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View run at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/io0kxyyj\u001b[0m\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Epoch 1, Loss: 0.8799072475318449\n",
      "Validation Loss: 0.8804256547065008, Total Accuracy: 7.25%\n",
      "Accuracy per class - G1: 80.49%, G2: 0.95%, G3: 5.41%\n",
      "Validation loss decreased (inf --> 18.488939).  Saving model ...\n",
      "Epoch 2, Loss: 0.849185620445803\n",
      "Validation Loss: 0.9006541811284565, Total Accuracy: 8.33%\n",
      "Accuracy per class - G1: 78.05%, G2: 1.42%, G3: 8.65%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 3, Loss: 0.8274143661361143\n",
      "Validation Loss: 0.9377152607554481, Total Accuracy: 6.79%\n",
      "Accuracy per class - G1: 78.05%, G2: 0.71%, G3: 4.86%\n",
      "EarlyStopping counter: 2 out of 40\n",
      "Epoch 4, Loss: 0.8199937717024103\n",
      "Validation Loss: 0.9235452399367378, Total Accuracy: 6.64%\n",
      "Accuracy per class - G1: 73.17%, G2: 0.24%, G3: 6.49%\n",
      "EarlyStopping counter: 3 out of 40\n",
      "Epoch 5, Loss: 0.8098310885659183\n",
      "Validation Loss: 0.9178157654546556, Total Accuracy: 7.56%\n",
      "Accuracy per class - G1: 78.05%, G2: 0.95%, G3: 7.03%\n",
      "EarlyStopping counter: 4 out of 40\n",
      "Epoch 6, Loss: 0.7872257527098598\n",
      "Validation Loss: 0.9200305562643778, Total Accuracy: 7.25%\n",
      "Accuracy per class - G1: 78.05%, G2: 0.24%, G3: 7.57%\n",
      "EarlyStopping counter: 5 out of 40\n",
      "Epoch 7, Loss: 0.7896711919681135\n",
      "Validation Loss: 0.917459813611848, Total Accuracy: 7.25%\n",
      "Accuracy per class - G1: 78.05%, G2: 0.95%, G3: 5.95%\n",
      "EarlyStopping counter: 6 out of 40\n",
      "Epoch 8, Loss: 0.7844670910433115\n",
      "Validation Loss: 0.9419770552998498, Total Accuracy: 7.41%\n",
      "Accuracy per class - G1: 80.49%, G2: 0.47%, G3: 7.03%\n",
      "EarlyStopping counter: 7 out of 40\n",
      "Epoch 9, Loss: 0.7676315831850811\n",
      "Validation Loss: 0.9671987940867742, Total Accuracy: 7.25%\n",
      "Accuracy per class - G1: 73.17%, G2: 0.24%, G3: 8.65%\n",
      "EarlyStopping counter: 8 out of 40\n",
      "Epoch 10, Loss: 0.7556606538324471\n",
      "Validation Loss: 0.945956887233825, Total Accuracy: 7.87%\n",
      "Accuracy per class - G1: 78.05%, G2: 1.18%, G3: 7.57%\n",
      "EarlyStopping counter: 9 out of 40\n",
      "Epoch 11, Loss: 0.7493577455899801\n",
      "Validation Loss: 0.9604393215406508, Total Accuracy: 7.72%\n",
      "Accuracy per class - G1: 82.93%, G2: 1.18%, G3: 5.95%\n",
      "EarlyStopping counter: 10 out of 40\n",
      "Epoch 12, Loss: 0.7376309087477535\n",
      "Validation Loss: 0.9474765147481646, Total Accuracy: 8.64%\n",
      "Accuracy per class - G1: 92.68%, G2: 1.18%, G3: 7.03%\n",
      "EarlyStopping counter: 11 out of 40\n",
      "Epoch 13, Loss: 0.7215226148984518\n",
      "Validation Loss: 0.9801951490697407, Total Accuracy: 7.41%\n",
      "Accuracy per class - G1: 87.80%, G2: 0.24%, G3: 5.95%\n",
      "EarlyStopping counter: 12 out of 40\n",
      "Epoch 14, Loss: 0.7114543562912079\n",
      "Validation Loss: 0.983967798096793, Total Accuracy: 7.25%\n",
      "Accuracy per class - G1: 80.49%, G2: 0.71%, G3: 5.95%\n",
      "EarlyStopping counter: 13 out of 40\n",
      "Epoch 15, Loss: 0.7048937304910406\n",
      "Validation Loss: 0.9801779949948901, Total Accuracy: 8.02%\n",
      "Accuracy per class - G1: 87.80%, G2: 0.95%, G3: 6.49%\n",
      "EarlyStopping counter: 14 out of 40\n",
      "Epoch 16, Loss: 0.6957219961177872\n",
      "Validation Loss: 1.0098262336992083, Total Accuracy: 7.56%\n",
      "Accuracy per class - G1: 87.80%, G2: 0.47%, G3: 5.95%\n",
      "EarlyStopping counter: 15 out of 40\n",
      "Epoch 17, Loss: 0.6760872343936598\n",
      "Validation Loss: 0.9814042072920572, Total Accuracy: 7.25%\n",
      "Accuracy per class - G1: 85.37%, G2: 0.47%, G3: 5.41%\n",
      "EarlyStopping counter: 16 out of 40\n",
      "Epoch 18, Loss: 0.679422211934285\n",
      "Validation Loss: 1.0223362091041746, Total Accuracy: 8.64%\n",
      "Accuracy per class - G1: 92.68%, G2: 0.71%, G3: 8.11%\n",
      "EarlyStopping counter: 17 out of 40\n",
      "Epoch 19, Loss: 0.6636987328529358\n",
      "Validation Loss: 1.0055950284004211, Total Accuracy: 8.18%\n",
      "Accuracy per class - G1: 80.49%, G2: 1.42%, G3: 7.57%\n",
      "EarlyStopping counter: 18 out of 40\n",
      "Epoch 20, Loss: 0.6462798585374672\n",
      "Validation Loss: 1.061184326807658, Total Accuracy: 8.80%\n",
      "Accuracy per class - G1: 95.12%, G2: 2.13%, G3: 4.86%\n",
      "EarlyStopping counter: 19 out of 40\n",
      "Epoch 21, Loss: 0.6419127734310656\n",
      "Validation Loss: 1.0282303804442996, Total Accuracy: 8.02%\n",
      "Accuracy per class - G1: 90.24%, G2: 0.71%, G3: 6.49%\n",
      "EarlyStopping counter: 20 out of 40\n",
      "Epoch 22, Loss: 0.629870699471738\n",
      "Validation Loss: 1.0381643353473573, Total Accuracy: 8.64%\n",
      "Accuracy per class - G1: 87.80%, G2: 1.66%, G3: 7.03%\n",
      "EarlyStopping counter: 21 out of 40\n",
      "Epoch 23, Loss: 0.6242592370653727\n",
      "Validation Loss: 1.0438120712836583, Total Accuracy: 8.64%\n",
      "Accuracy per class - G1: 87.80%, G2: 1.18%, G3: 8.11%\n",
      "EarlyStopping counter: 22 out of 40\n",
      "Epoch 24, Loss: 0.6229221540761282\n",
      "Validation Loss: 0.9941418050300508, Total Accuracy: 8.95%\n",
      "Accuracy per class - G1: 92.68%, G2: 2.13%, G3: 5.95%\n",
      "EarlyStopping counter: 23 out of 40\n",
      "Epoch 25, Loss: 0.6178498627191567\n",
      "Validation Loss: 1.0551721382708776, Total Accuracy: 8.49%\n",
      "Accuracy per class - G1: 97.56%, G2: 0.95%, G3: 5.95%\n",
      "EarlyStopping counter: 24 out of 40\n",
      "Epoch 26, Loss: 0.6324354503528181\n",
      "Validation Loss: 1.0539196381966274, Total Accuracy: 7.72%\n",
      "Accuracy per class - G1: 92.68%, G2: 0.71%, G3: 4.86%\n",
      "EarlyStopping counter: 25 out of 40\n",
      "Epoch 27, Loss: 0.6172854293541736\n",
      "Validation Loss: 1.0346694822822298, Total Accuracy: 8.64%\n",
      "Accuracy per class - G1: 90.24%, G2: 2.13%, G3: 5.41%\n",
      "EarlyStopping counter: 26 out of 40\n",
      "Epoch 28, Loss: 0.6177869421171854\n",
      "Validation Loss: 1.0703609507708323, Total Accuracy: 7.72%\n",
      "Accuracy per class - G1: 95.12%, G2: 0.71%, G3: 4.32%\n",
      "EarlyStopping counter: 27 out of 40\n",
      "Epoch 29, Loss: 0.6194670178804053\n",
      "Validation Loss: 1.0503652776990617, Total Accuracy: 8.33%\n",
      "Accuracy per class - G1: 90.24%, G2: 1.42%, G3: 5.95%\n",
      "EarlyStopping counter: 28 out of 40\n",
      "Epoch 30, Loss: 0.61541255734053\n",
      "Validation Loss: 1.0784495799314409, Total Accuracy: 7.56%\n",
      "Accuracy per class - G1: 90.24%, G2: 0.24%, G3: 5.95%\n",
      "EarlyStopping counter: 29 out of 40\n",
      "Epoch 31, Loss: 0.613677818013961\n",
      "Validation Loss: 1.0485646824042003, Total Accuracy: 8.49%\n",
      "Accuracy per class - G1: 90.24%, G2: 1.66%, G3: 5.95%\n",
      "EarlyStopping counter: 30 out of 40\n",
      "Epoch 32, Loss: 0.6081182155982557\n",
      "Validation Loss: 1.0869267221008028, Total Accuracy: 8.02%\n",
      "Accuracy per class - G1: 90.24%, G2: 1.66%, G3: 4.32%\n",
      "EarlyStopping counter: 31 out of 40\n",
      "Epoch 33, Loss: 0.6051303701228407\n",
      "Validation Loss: 1.0836242799248015, Total Accuracy: 7.25%\n",
      "Accuracy per class - G1: 80.49%, G2: 0.71%, G3: 5.95%\n",
      "EarlyStopping counter: 32 out of 40\n",
      "Epoch 34, Loss: 0.6078812957528126\n",
      "Validation Loss: 1.0561757598604475, Total Accuracy: 9.10%\n",
      "Accuracy per class - G1: 90.24%, G2: 2.13%, G3: 7.03%\n",
      "EarlyStopping counter: 33 out of 40\n",
      "Epoch 35, Loss: 0.6017355462872839\n",
      "Validation Loss: 1.0714096008312135, Total Accuracy: 8.18%\n",
      "Accuracy per class - G1: 85.37%, G2: 1.90%, G3: 5.41%\n",
      "EarlyStopping counter: 34 out of 40\n",
      "Epoch 36, Loss: 0.6061946710190141\n",
      "Validation Loss: 1.0959649611087072, Total Accuracy: 8.49%\n",
      "Accuracy per class - G1: 95.12%, G2: 1.42%, G3: 5.41%\n",
      "EarlyStopping counter: 35 out of 40\n",
      "Epoch 37, Loss: 0.5954554684190865\n",
      "Validation Loss: 1.0491976184504372, Total Accuracy: 9.10%\n",
      "Accuracy per class - G1: 87.80%, G2: 2.13%, G3: 7.57%\n",
      "EarlyStopping counter: 36 out of 40\n",
      "Epoch 38, Loss: 0.6010144518082401\n",
      "Validation Loss: 1.08689593346346, Total Accuracy: 8.95%\n",
      "Accuracy per class - G1: 95.12%, G2: 1.90%, G3: 5.95%\n",
      "EarlyStopping counter: 37 out of 40\n",
      "Epoch 39, Loss: 0.5984947139240173\n",
      "Validation Loss: 1.0649364242951076, Total Accuracy: 7.87%\n",
      "Accuracy per class - G1: 92.68%, G2: 1.42%, G3: 3.78%\n",
      "EarlyStopping counter: 38 out of 40\n",
      "Epoch 40, Loss: 0.5924211435289268\n",
      "Validation Loss: 1.111101093746367, Total Accuracy: 7.87%\n",
      "Accuracy per class - G1: 85.37%, G2: 0.71%, G3: 7.03%\n",
      "EarlyStopping counter: 39 out of 40\n",
      "Epoch 41, Loss: 0.5923657018736185\n",
      "Validation Loss: 1.0554755670683724, Total Accuracy: 9.10%\n",
      "Accuracy per class - G1: 87.80%, G2: 3.32%, G3: 4.86%\n",
      "EarlyStopping counter: 40 out of 40\n",
      "Early stopping\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\u001b[34m\u001b[1mwandb\u001b[0m:                                                                                \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run history:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run summary:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc 87.80488\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc 99.5935\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc 3.31754\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc 5.80411\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc 4.86486\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc 5.63003\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy 9.10494\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy 14.47468\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss 0.59237\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss 1.05548\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View run \u001b[33m1optuna_run_11 microsoft/resnet-18 Frozen Layers Nooversampling Focallo12\u001b[0m at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/io0kxyyj\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View project at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Synced 5 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Find logs at: \u001b[35m\u001b[1m./wandb/run-20241009_210814-io0kxyyj/logs\u001b[0m\n",
      "[I 2024-10-09 21:26:50,383] Trial 11 finished with value: 0.07355739647108117 and parameters: {'weight_decay': 5.108775526169702e-07, 'focal_loss': 2.323865207013246}. Best is trial 7 with value: 0.29790585093823324.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Tracking run with wandb version 0.18.3\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run data is saved locally in \u001b[35m\u001b[1m/kaggle/working/wandb/run-20241009_212650-9xboi795\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run \u001b[1m`wandb offline`\u001b[0m to turn off syncing.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Syncing run \u001b[33m1optuna_run_12 microsoft/resnet-18 Frozen Layers Nooversampling Focallo13\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View project at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View run at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/9xboi795\u001b[0m\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Epoch 1, Loss: 0.4898576596415187\n",
      "Validation Loss: 0.4375287180855161, Total Accuracy: 47.07%\n",
      "Accuracy per class - G1: 36.59%, G2: 58.29%, G3: 23.78%\n",
      "Validation loss decreased (inf --> 9.188103).  Saving model ...\n",
      "Epoch 2, Loss: 0.4826237009950431\n",
      "Validation Loss: 0.42097955090659006, Total Accuracy: 49.07%\n",
      "Accuracy per class - G1: 9.76%, G2: 66.35%, G3: 18.38%\n",
      "Validation loss decreased (9.188103 --> 8.840571).  Saving model ...\n",
      "Epoch 3, Loss: 0.46222530251525973\n",
      "Validation Loss: 0.41385727127393085, Total Accuracy: 51.85%\n",
      "Accuracy per class - G1: 9.76%, G2: 71.09%, G3: 17.30%\n",
      "Validation loss decreased (8.840571 --> 8.691003).  Saving model ...\n",
      "Epoch 4, Loss: 0.456468242837722\n",
      "Validation Loss: 0.4121394753456116, Total Accuracy: 50.00%\n",
      "Accuracy per class - G1: 12.20%, G2: 67.06%, G3: 19.46%\n",
      "Validation loss decreased (8.691003 --> 8.654929).  Saving model ...\n",
      "Epoch 5, Loss: 0.4467297307698123\n",
      "Validation Loss: 0.4140840939113072, Total Accuracy: 48.61%\n",
      "Accuracy per class - G1: 19.51%, G2: 63.51%, G3: 21.08%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 6, Loss: 0.43554016229618026\n",
      "Validation Loss: 0.4140172856194632, Total Accuracy: 51.54%\n",
      "Accuracy per class - G1: 24.39%, G2: 65.88%, G3: 24.86%\n",
      "EarlyStopping counter: 2 out of 40\n",
      "Epoch 7, Loss: 0.418765027120889\n",
      "Validation Loss: 0.4064546014581408, Total Accuracy: 51.54%\n",
      "Accuracy per class - G1: 14.63%, G2: 67.30%, G3: 23.78%\n",
      "Validation loss decreased (8.654929 --> 8.535547).  Saving model ...\n",
      "Epoch 8, Loss: 0.40829938506505575\n",
      "Validation Loss: 0.4163772946312314, Total Accuracy: 50.62%\n",
      "Accuracy per class - G1: 12.20%, G2: 64.69%, G3: 27.03%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 9, Loss: 0.3988598725163793\n",
      "Validation Loss: 0.40610885549159276, Total Accuracy: 50.31%\n",
      "Accuracy per class - G1: 21.95%, G2: 65.40%, G3: 22.16%\n",
      "Validation loss decreased (8.535547 --> 8.528286).  Saving model ...\n",
      "Epoch 10, Loss: 0.39238385802291964\n",
      "Validation Loss: 0.3980421338762556, Total Accuracy: 52.01%\n",
      "Accuracy per class - G1: 17.07%, G2: 66.82%, G3: 25.95%\n",
      "Validation loss decreased (8.528286 --> 8.358885).  Saving model ...\n",
      "Epoch 11, Loss: 0.38514351378004236\n",
      "Validation Loss: 0.42791596196946646, Total Accuracy: 47.84%\n",
      "Accuracy per class - G1: 29.27%, G2: 60.90%, G3: 22.16%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 12, Loss: 0.3793289147945772\n",
      "Validation Loss: 0.4121274387552625, Total Accuracy: 51.08%\n",
      "Accuracy per class - G1: 7.32%, G2: 67.77%, G3: 22.70%\n",
      "EarlyStopping counter: 2 out of 40\n",
      "Epoch 13, Loss: 0.3780262050140335\n",
      "Validation Loss: 0.4279353455418632, Total Accuracy: 45.68%\n",
      "Accuracy per class - G1: 9.76%, G2: 58.29%, G3: 24.86%\n",
      "EarlyStopping counter: 3 out of 40\n",
      "Epoch 14, Loss: 0.368028734462807\n",
      "Validation Loss: 0.42038320288771674, Total Accuracy: 49.54%\n",
      "Accuracy per class - G1: 12.20%, G2: 64.45%, G3: 23.78%\n",
      "EarlyStopping counter: 4 out of 40\n",
      "Epoch 15, Loss: 0.36118028321898127\n",
      "Validation Loss: 0.4271005725576764, Total Accuracy: 44.44%\n",
      "Accuracy per class - G1: 14.63%, G2: 57.58%, G3: 21.08%\n",
      "EarlyStopping counter: 5 out of 40\n",
      "Epoch 16, Loss: 0.3574744947703488\n",
      "Validation Loss: 0.43788466992832364, Total Accuracy: 44.91%\n",
      "Accuracy per class - G1: 14.63%, G2: 60.43%, G3: 16.22%\n",
      "EarlyStopping counter: 6 out of 40\n",
      "Epoch 17, Loss: 0.34788544386266224\n",
      "Validation Loss: 0.4469769923459916, Total Accuracy: 41.36%\n",
      "Accuracy per class - G1: 7.32%, G2: 54.27%, G3: 19.46%\n",
      "EarlyStopping counter: 7 out of 40\n",
      "Epoch 18, Loss: 0.3384375076696097\n",
      "Validation Loss: 0.42335603421642665, Total Accuracy: 47.53%\n",
      "Accuracy per class - G1: 12.20%, G2: 59.95%, G3: 27.03%\n",
      "EarlyStopping counter: 8 out of 40\n",
      "Epoch 19, Loss: 0.33836189271455785\n",
      "Validation Loss: 0.43262789221037, Total Accuracy: 42.28%\n",
      "Accuracy per class - G1: 14.63%, G2: 53.79%, G3: 22.16%\n",
      "EarlyStopping counter: 9 out of 40\n",
      "Epoch 20, Loss: 0.32921240703169125\n",
      "Validation Loss: 0.43711671446050915, Total Accuracy: 42.59%\n",
      "Accuracy per class - G1: 19.51%, G2: 55.21%, G3: 18.92%\n",
      "EarlyStopping counter: 10 out of 40\n",
      "Epoch 21, Loss: 0.32616709136819266\n",
      "Validation Loss: 0.4460318081435703, Total Accuracy: 42.13%\n",
      "Accuracy per class - G1: 17.07%, G2: 54.50%, G3: 19.46%\n",
      "EarlyStopping counter: 11 out of 40\n",
      "Epoch 22, Loss: 0.32073093950748444\n",
      "Validation Loss: 0.4543059106384005, Total Accuracy: 41.82%\n",
      "Accuracy per class - G1: 9.76%, G2: 52.61%, G3: 24.32%\n",
      "EarlyStopping counter: 12 out of 40\n",
      "Epoch 23, Loss: 0.31880499655941885\n",
      "Validation Loss: 0.444734187353225, Total Accuracy: 41.36%\n",
      "Accuracy per class - G1: 19.51%, G2: 53.08%, G3: 19.46%\n",
      "EarlyStopping counter: 13 out of 40\n",
      "Epoch 24, Loss: 0.3121674071593457\n",
      "Validation Loss: 0.4437547613467489, Total Accuracy: 41.82%\n",
      "Accuracy per class - G1: 17.07%, G2: 51.66%, G3: 24.86%\n",
      "EarlyStopping counter: 14 out of 40\n",
      "Epoch 25, Loss: 0.31336134456726444\n",
      "Validation Loss: 0.45106647979645503, Total Accuracy: 42.75%\n",
      "Accuracy per class - G1: 19.51%, G2: 54.50%, G3: 21.08%\n",
      "EarlyStopping counter: 15 out of 40\n",
      "Epoch 26, Loss: 0.30269311835248786\n",
      "Validation Loss: 0.4509033042760122, Total Accuracy: 40.43%\n",
      "Accuracy per class - G1: 19.51%, G2: 49.76%, G3: 23.78%\n",
      "EarlyStopping counter: 16 out of 40\n",
      "Epoch 27, Loss: 0.2998796410589333\n",
      "Validation Loss: 0.48665545667920795, Total Accuracy: 37.19%\n",
      "Accuracy per class - G1: 14.63%, G2: 46.68%, G3: 20.54%\n",
      "EarlyStopping counter: 17 out of 40\n",
      "Epoch 28, Loss: 0.29846474743751156\n",
      "Validation Loss: 0.46678329152720316, Total Accuracy: 39.97%\n",
      "Accuracy per class - G1: 14.63%, G2: 47.63%, G3: 28.11%\n",
      "EarlyStopping counter: 18 out of 40\n",
      "Epoch 29, Loss: 0.2882174449153693\n",
      "Validation Loss: 0.4699291973596528, Total Accuracy: 39.20%\n",
      "Accuracy per class - G1: 21.95%, G2: 50.00%, G3: 18.38%\n",
      "EarlyStopping counter: 19 out of 40\n",
      "Epoch 30, Loss: 0.2844628632427698\n",
      "Validation Loss: 0.4610326573962257, Total Accuracy: 39.35%\n",
      "Accuracy per class - G1: 24.39%, G2: 49.05%, G3: 20.54%\n",
      "EarlyStopping counter: 20 out of 40\n",
      "Epoch 31, Loss: 0.28388171472463264\n",
      "Validation Loss: 0.4989514485711143, Total Accuracy: 36.27%\n",
      "Accuracy per class - G1: 19.51%, G2: 43.84%, G3: 22.70%\n",
      "EarlyStopping counter: 21 out of 40\n",
      "Epoch 32, Loss: 0.2804904246186636\n",
      "Validation Loss: 0.4927291650147665, Total Accuracy: 35.34%\n",
      "Accuracy per class - G1: 14.63%, G2: 44.79%, G3: 18.38%\n",
      "EarlyStopping counter: 22 out of 40\n",
      "Epoch 33, Loss: 0.27880729537412346\n",
      "Validation Loss: 0.4705812448547, Total Accuracy: 39.35%\n",
      "Accuracy per class - G1: 21.95%, G2: 47.87%, G3: 23.78%\n",
      "EarlyStopping counter: 23 out of 40\n",
      "Epoch 34, Loss: 0.2814259864838727\n",
      "Validation Loss: 0.4859831177052997, Total Accuracy: 37.65%\n",
      "Accuracy per class - G1: 9.76%, G2: 46.68%, G3: 23.24%\n",
      "EarlyStopping counter: 24 out of 40\n",
      "Epoch 35, Loss: 0.27698487958994256\n",
      "Validation Loss: 0.5028064328999746, Total Accuracy: 36.57%\n",
      "Accuracy per class - G1: 19.51%, G2: 45.26%, G3: 20.54%\n",
      "EarlyStopping counter: 25 out of 40\n",
      "Epoch 36, Loss: 0.27648925835109617\n",
      "Validation Loss: 0.4940856099128723, Total Accuracy: 37.96%\n",
      "Accuracy per class - G1: 19.51%, G2: 47.63%, G3: 20.00%\n",
      "EarlyStopping counter: 26 out of 40\n",
      "Epoch 37, Loss: 0.2787507571369769\n",
      "Validation Loss: 0.4986059374752499, Total Accuracy: 36.27%\n",
      "Accuracy per class - G1: 14.63%, G2: 44.31%, G3: 22.70%\n",
      "EarlyStopping counter: 27 out of 40\n",
      "Epoch 38, Loss: 0.27794575978474445\n",
      "Validation Loss: 0.5018663690203712, Total Accuracy: 36.73%\n",
      "Accuracy per class - G1: 17.07%, G2: 46.45%, G3: 18.92%\n",
      "EarlyStopping counter: 28 out of 40\n",
      "Epoch 39, Loss: 0.2718517875455948\n",
      "Validation Loss: 0.48596917447589694, Total Accuracy: 40.12%\n",
      "Accuracy per class - G1: 19.51%, G2: 47.87%, G3: 27.03%\n",
      "EarlyStopping counter: 29 out of 40\n",
      "Epoch 40, Loss: 0.2773092270615589\n",
      "Validation Loss: 0.4976848193577358, Total Accuracy: 35.65%\n",
      "Accuracy per class - G1: 17.07%, G2: 45.50%, G3: 17.30%\n",
      "EarlyStopping counter: 30 out of 40\n",
      "Epoch 41, Loss: 0.2711649856653558\n",
      "Validation Loss: 0.5032769338715644, Total Accuracy: 35.19%\n",
      "Accuracy per class - G1: 12.20%, G2: 45.02%, G3: 17.84%\n",
      "EarlyStopping counter: 31 out of 40\n",
      "Epoch 42, Loss: 0.2698594996009965\n",
      "Validation Loss: 0.4907395463614237, Total Accuracy: 37.35%\n",
      "Accuracy per class - G1: 14.63%, G2: 47.87%, G3: 18.38%\n",
      "EarlyStopping counter: 32 out of 40\n",
      "Epoch 43, Loss: 0.2721211531435151\n",
      "Validation Loss: 0.4991672748611087, Total Accuracy: 35.80%\n",
      "Accuracy per class - G1: 19.51%, G2: 44.55%, G3: 19.46%\n",
      "EarlyStopping counter: 33 out of 40\n",
      "Epoch 44, Loss: 0.2718572313167963\n",
      "Validation Loss: 0.49569914099716006, Total Accuracy: 36.88%\n",
      "Accuracy per class - G1: 7.32%, G2: 45.73%, G3: 23.24%\n",
      "EarlyStopping counter: 34 out of 40\n",
      "Epoch 45, Loss: 0.2709549649293164\n",
      "Validation Loss: 0.49928177893161774, Total Accuracy: 34.72%\n",
      "Accuracy per class - G1: 9.76%, G2: 42.89%, G3: 21.62%\n",
      "EarlyStopping counter: 35 out of 40\n",
      "Epoch 46, Loss: 0.26437740261296194\n",
      "Validation Loss: 0.4962813527811141, Total Accuracy: 37.19%\n",
      "Accuracy per class - G1: 14.63%, G2: 43.60%, G3: 27.57%\n",
      "EarlyStopping counter: 36 out of 40\n",
      "Epoch 47, Loss: 0.26749571026807806\n",
      "Validation Loss: 0.4848934497152056, Total Accuracy: 37.96%\n",
      "Accuracy per class - G1: 14.63%, G2: 44.55%, G3: 28.11%\n",
      "EarlyStopping counter: 37 out of 40\n",
      "Epoch 48, Loss: 0.26855960829430314\n",
      "Validation Loss: 0.5005446566002709, Total Accuracy: 36.57%\n",
      "Accuracy per class - G1: 14.63%, G2: 44.31%, G3: 23.78%\n",
      "EarlyStopping counter: 38 out of 40\n",
      "Epoch 49, Loss: 0.26724570881889526\n",
      "Validation Loss: 0.5094295725935981, Total Accuracy: 35.80%\n",
      "Accuracy per class - G1: 9.76%, G2: 45.26%, G3: 20.00%\n",
      "EarlyStopping counter: 39 out of 40\n",
      "Epoch 50, Loss: 0.2642700625471322\n",
      "Validation Loss: 0.49694294127680005, Total Accuracy: 35.34%\n",
      "Accuracy per class - G1: 17.07%, G2: 44.79%, G3: 17.84%\n",
      "EarlyStopping counter: 40 out of 40\n",
      "Early stopping\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\u001b[34m\u001b[1mwandb\u001b[0m:                                                                                \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run history:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run summary:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc 17.07317\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc 84.55285\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc 44.78673\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc 84.82467\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc 17.83784\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc 51.60858\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy 35.33951\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy 75.43462\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss 0.26427\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss 0.49694\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View run \u001b[33m1optuna_run_12 microsoft/resnet-18 Frozen Layers Nooversampling Focallo13\u001b[0m at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/9xboi795\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View project at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Synced 5 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Find logs at: \u001b[35m\u001b[1m./wandb/run-20241009_212650-9xboi795/logs\u001b[0m\n",
      "[I 2024-10-09 21:49:18,169] Trial 12 finished with value: 0.2550313547510947 and parameters: {'weight_decay': 5.505299208029184e-07, 'focal_loss': 2.2192067161327365}. Best is trial 7 with value: 0.29790585093823324.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Tracking run with wandb version 0.18.3\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run data is saved locally in \u001b[35m\u001b[1m/kaggle/working/wandb/run-20241009_214918-64wgtuwy\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run \u001b[1m`wandb offline`\u001b[0m to turn off syncing.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Syncing run \u001b[33m1optuna_run_13 microsoft/resnet-18 Frozen Layers Nooversampling Focallo14\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View project at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View run at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/64wgtuwy\u001b[0m\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Epoch 1, Loss: 1.2013888071818524\n",
      "Validation Loss: 1.0863685991082872, Total Accuracy: 15.74%\n",
      "Accuracy per class - G1: 87.80%, G2: 15.64%, G3: 0.00%\n",
      "Validation loss decreased (inf --> 22.813741).  Saving model ...\n",
      "Epoch 2, Loss: 1.1910619053495937\n",
      "Validation Loss: 1.1634720815789132, Total Accuracy: 9.10%\n",
      "Accuracy per class - G1: 73.17%, G2: 6.64%, G3: 0.54%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 3, Loss: 1.1736450942165881\n",
      "Validation Loss: 1.1002193433897836, Total Accuracy: 9.10%\n",
      "Accuracy per class - G1: 75.61%, G2: 5.92%, G3: 1.62%\n",
      "EarlyStopping counter: 2 out of 40\n",
      "Epoch 4, Loss: 1.1506708400795258\n",
      "Validation Loss: 1.1722600147837685, Total Accuracy: 7.41%\n",
      "Accuracy per class - G1: 82.93%, G2: 3.32%, G3: 0.00%\n",
      "EarlyStopping counter: 3 out of 40\n",
      "Epoch 5, Loss: 1.128575789641185\n",
      "Validation Loss: 1.2200010610478265, Total Accuracy: 7.41%\n",
      "Accuracy per class - G1: 78.05%, G2: 3.32%, G3: 1.08%\n",
      "EarlyStopping counter: 4 out of 40\n",
      "Epoch 6, Loss: 1.1235306995460785\n",
      "Validation Loss: 1.195304593869618, Total Accuracy: 6.48%\n",
      "Accuracy per class - G1: 92.68%, G2: 0.95%, G3: 0.00%\n",
      "EarlyStopping counter: 5 out of 40\n",
      "Epoch 7, Loss: 1.1018408084490212\n",
      "Validation Loss: 1.1717007869765872, Total Accuracy: 6.48%\n",
      "Accuracy per class - G1: 87.80%, G2: 1.18%, G3: 0.54%\n",
      "EarlyStopping counter: 6 out of 40\n",
      "Epoch 8, Loss: 1.0781267594142132\n",
      "Validation Loss: 1.24829105536143, Total Accuracy: 5.71%\n",
      "Accuracy per class - G1: 82.93%, G2: 0.47%, G3: 0.54%\n",
      "EarlyStopping counter: 7 out of 40\n",
      "Epoch 9, Loss: 1.0639956421162708\n",
      "Validation Loss: 1.1942511420874369, Total Accuracy: 6.17%\n",
      "Accuracy per class - G1: 85.37%, G2: 0.71%, G3: 1.08%\n",
      "EarlyStopping counter: 8 out of 40\n",
      "Epoch 10, Loss: 1.0562220093715622\n",
      "Validation Loss: 1.2191980264726139, Total Accuracy: 6.17%\n",
      "Accuracy per class - G1: 92.68%, G2: 0.24%, G3: 0.54%\n",
      "EarlyStopping counter: 9 out of 40\n",
      "Epoch 11, Loss: 1.0352702973836876\n",
      "Validation Loss: 1.189085018776712, Total Accuracy: 6.17%\n",
      "Accuracy per class - G1: 85.37%, G2: 0.71%, G3: 1.08%\n",
      "EarlyStopping counter: 10 out of 40\n",
      "Epoch 12, Loss: 1.0151959169341858\n",
      "Validation Loss: 1.1943243585881733, Total Accuracy: 6.02%\n",
      "Accuracy per class - G1: 90.24%, G2: 0.24%, G3: 0.54%\n",
      "EarlyStopping counter: 11 out of 40\n",
      "Epoch 13, Loss: 1.0073607176183217\n",
      "Validation Loss: 1.2063242523443132, Total Accuracy: 5.71%\n",
      "Accuracy per class - G1: 80.49%, G2: 0.00%, G3: 2.16%\n",
      "EarlyStopping counter: 12 out of 40\n",
      "Epoch 14, Loss: 0.9924579758241953\n",
      "Validation Loss: 1.2571356005611873, Total Accuracy: 5.86%\n",
      "Accuracy per class - G1: 85.37%, G2: 0.00%, G3: 1.62%\n",
      "EarlyStopping counter: 13 out of 40\n",
      "Epoch 15, Loss: 0.9834978436849203\n",
      "Validation Loss: 1.206279951901663, Total Accuracy: 5.86%\n",
      "Accuracy per class - G1: 87.80%, G2: 0.24%, G3: 0.54%\n",
      "EarlyStopping counter: 14 out of 40\n",
      "Epoch 16, Loss: 0.9759723357407444\n",
      "Validation Loss: 1.2681514940091543, Total Accuracy: 6.33%\n",
      "Accuracy per class - G1: 92.68%, G2: 0.00%, G3: 1.62%\n",
      "EarlyStopping counter: 15 out of 40\n",
      "Epoch 17, Loss: 0.9499810273388782\n",
      "Validation Loss: 1.296383770448821, Total Accuracy: 5.71%\n",
      "Accuracy per class - G1: 85.37%, G2: 0.00%, G3: 1.08%\n",
      "EarlyStopping counter: 16 out of 40\n",
      "Epoch 18, Loss: 0.95448373096535\n",
      "Validation Loss: 1.3342987504743395, Total Accuracy: 6.02%\n",
      "Accuracy per class - G1: 82.93%, G2: 0.00%, G3: 2.70%\n",
      "EarlyStopping counter: 17 out of 40\n",
      "Epoch 19, Loss: 0.9349511775625757\n",
      "Validation Loss: 1.3088553597529728, Total Accuracy: 5.71%\n",
      "Accuracy per class - G1: 85.37%, G2: 0.00%, G3: 1.08%\n",
      "EarlyStopping counter: 18 out of 40\n",
      "Epoch 20, Loss: 0.9205679340534899\n",
      "Validation Loss: 1.326487829997426, Total Accuracy: 6.02%\n",
      "Accuracy per class - G1: 92.68%, G2: 0.00%, G3: 0.54%\n",
      "EarlyStopping counter: 19 out of 40\n",
      "Epoch 21, Loss: 0.9034177567585405\n",
      "Validation Loss: 1.3374722472258977, Total Accuracy: 5.71%\n",
      "Accuracy per class - G1: 85.37%, G2: 0.24%, G3: 0.54%\n",
      "EarlyStopping counter: 20 out of 40\n",
      "Epoch 22, Loss: 0.8966635207095778\n",
      "Validation Loss: 1.3428428190804662, Total Accuracy: 5.86%\n",
      "Accuracy per class - G1: 92.68%, G2: 0.00%, G3: 0.00%\n",
      "EarlyStopping counter: 21 out of 40\n",
      "Epoch 23, Loss: 0.8905759575855301\n",
      "Validation Loss: 1.3429452489529337, Total Accuracy: 6.64%\n",
      "Accuracy per class - G1: 97.56%, G2: 0.47%, G3: 0.54%\n",
      "EarlyStopping counter: 22 out of 40\n",
      "Epoch 24, Loss: 0.8825494144336287\n",
      "Validation Loss: 1.3412396623974754, Total Accuracy: 5.09%\n",
      "Accuracy per class - G1: 80.49%, G2: 0.00%, G3: 0.00%\n",
      "EarlyStopping counter: 23 out of 40\n",
      "Epoch 25, Loss: 0.8804051789892725\n",
      "Validation Loss: 1.3613483352320535, Total Accuracy: 6.64%\n",
      "Accuracy per class - G1: 85.37%, G2: 0.47%, G3: 3.24%\n",
      "EarlyStopping counter: 24 out of 40\n",
      "Epoch 26, Loss: 0.8817694194345589\n",
      "Validation Loss: 1.3064086483347983, Total Accuracy: 6.17%\n",
      "Accuracy per class - G1: 90.24%, G2: 0.24%, G3: 1.08%\n",
      "EarlyStopping counter: 25 out of 40\n",
      "Epoch 27, Loss: 0.8851149879306196\n",
      "Validation Loss: 1.3616137093021756, Total Accuracy: 5.40%\n",
      "Accuracy per class - G1: 85.37%, G2: 0.00%, G3: 0.00%\n",
      "EarlyStopping counter: 26 out of 40\n",
      "Epoch 28, Loss: 0.8879439155739474\n",
      "Validation Loss: 1.35097347874017, Total Accuracy: 6.17%\n",
      "Accuracy per class - G1: 92.68%, G2: 0.00%, G3: 1.08%\n",
      "EarlyStopping counter: 27 out of 40\n",
      "Epoch 29, Loss: 0.8832585567451385\n",
      "Validation Loss: 1.4118008187838964, Total Accuracy: 5.56%\n",
      "Accuracy per class - G1: 85.37%, G2: 0.24%, G3: 0.00%\n",
      "EarlyStopping counter: 28 out of 40\n",
      "Epoch 30, Loss: 0.8711939059108137\n",
      "Validation Loss: 1.4173678074564253, Total Accuracy: 5.40%\n",
      "Accuracy per class - G1: 82.93%, G2: 0.00%, G3: 0.54%\n",
      "EarlyStopping counter: 29 out of 40\n",
      "Epoch 31, Loss: 0.8734539819050984\n",
      "Validation Loss: 1.3896783285197758, Total Accuracy: 5.86%\n",
      "Accuracy per class - G1: 87.80%, G2: 0.24%, G3: 0.54%\n",
      "EarlyStopping counter: 30 out of 40\n",
      "Epoch 32, Loss: 0.8700102459953492\n",
      "Validation Loss: 1.437211594411305, Total Accuracy: 5.71%\n",
      "Accuracy per class - G1: 85.37%, G2: 0.00%, G3: 1.08%\n",
      "EarlyStopping counter: 31 out of 40\n",
      "Epoch 33, Loss: 0.8727585752326322\n",
      "Validation Loss: 1.3930993938729876, Total Accuracy: 6.17%\n",
      "Accuracy per class - G1: 95.12%, G2: 0.24%, G3: 0.00%\n",
      "EarlyStopping counter: 32 out of 40\n",
      "Epoch 34, Loss: 0.8673666593540146\n",
      "Validation Loss: 1.413924256960551, Total Accuracy: 5.86%\n",
      "Accuracy per class - G1: 87.80%, G2: 0.24%, G3: 0.54%\n",
      "EarlyStopping counter: 33 out of 40\n",
      "Epoch 35, Loss: 0.8595543281141534\n",
      "Validation Loss: 1.4050175625653494, Total Accuracy: 6.17%\n",
      "Accuracy per class - G1: 92.68%, G2: 0.00%, G3: 1.08%\n",
      "EarlyStopping counter: 34 out of 40\n",
      "Epoch 36, Loss: 0.8593283640332969\n",
      "Validation Loss: 1.329872686238516, Total Accuracy: 5.71%\n",
      "Accuracy per class - G1: 82.93%, G2: 0.47%, G3: 0.54%\n",
      "EarlyStopping counter: 35 out of 40\n",
      "Epoch 37, Loss: 0.8565120488764292\n",
      "Validation Loss: 1.4313289877914248, Total Accuracy: 5.71%\n",
      "Accuracy per class - G1: 90.24%, G2: 0.00%, G3: 0.00%\n",
      "EarlyStopping counter: 36 out of 40\n",
      "Epoch 38, Loss: 0.8530686361243925\n",
      "Validation Loss: 1.4186098689124698, Total Accuracy: 5.56%\n",
      "Accuracy per class - G1: 87.80%, G2: 0.00%, G3: 0.00%\n",
      "EarlyStopping counter: 37 out of 40\n",
      "Epoch 39, Loss: 0.8537148309041218\n",
      "Validation Loss: 1.3329409616334098, Total Accuracy: 6.17%\n",
      "Accuracy per class - G1: 85.37%, G2: 0.71%, G3: 1.08%\n",
      "EarlyStopping counter: 38 out of 40\n",
      "Epoch 40, Loss: 0.8506816999021783\n",
      "Validation Loss: 1.407771334761665, Total Accuracy: 5.71%\n",
      "Accuracy per class - G1: 85.37%, G2: 0.00%, G3: 1.08%\n",
      "EarlyStopping counter: 39 out of 40\n",
      "Epoch 41, Loss: 0.8486319844981274\n",
      "Validation Loss: 1.4380879324106943, Total Accuracy: 5.86%\n",
      "Accuracy per class - G1: 87.80%, G2: 0.00%, G3: 1.08%\n",
      "EarlyStopping counter: 40 out of 40\n",
      "Early stopping\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\u001b[34m\u001b[1mwandb\u001b[0m:                                                                                \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run history:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run summary:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc 87.80488\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc 100\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc 0\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc 1.20919\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc 1.08108\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc 3.6193\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy 5.8642\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy 11.07332\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss 0.84863\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss 1.43809\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View run \u001b[33m1optuna_run_13 microsoft/resnet-18 Frozen Layers Nooversampling Focallo14\u001b[0m at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/64wgtuwy\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View project at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Synced 5 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Find logs at: \u001b[35m\u001b[1m./wandb/run-20241009_214918-64wgtuwy/logs\u001b[0m\n",
      "[I 2024-10-09 22:07:25,277] Trial 13 finished with value: 0.04565681194757696 and parameters: {'weight_decay': 1.1935414680687574e-06, 'focal_loss': 2.4805344635760793}. Best is trial 7 with value: 0.29790585093823324.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Tracking run with wandb version 0.18.3\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run data is saved locally in \u001b[35m\u001b[1m/kaggle/working/wandb/run-20241009_220725-v0n1zftg\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run \u001b[1m`wandb offline`\u001b[0m to turn off syncing.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Syncing run \u001b[33m1optuna_run_14 microsoft/resnet-18 Frozen Layers Nooversampling Focallo15\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View project at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View run at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/v0n1zftg\u001b[0m\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Epoch 1, Loss: 0.43119619625160494\n",
      "Validation Loss: 0.590856405950728, Total Accuracy: 34.57%\n",
      "Accuracy per class - G1: 0.00%, G2: 21.56%, G3: 71.89%\n",
      "Validation loss decreased (inf --> 12.407985).  Saving model ...\n",
      "Epoch 2, Loss: 0.418736090502107\n",
      "Validation Loss: 0.5541414802982694, Total Accuracy: 35.65%\n",
      "Accuracy per class - G1: 0.00%, G2: 23.70%, G3: 70.81%\n",
      "Validation loss decreased (12.407985 --> 11.636971).  Saving model ...\n",
      "Epoch 3, Loss: 0.41333818184324056\n",
      "Validation Loss: 0.5778721003305345, Total Accuracy: 36.73%\n",
      "Accuracy per class - G1: 2.44%, G2: 23.70%, G3: 74.05%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 4, Loss: 0.4061588217695075\n",
      "Validation Loss: 0.5921635201999119, Total Accuracy: 34.57%\n",
      "Accuracy per class - G1: 0.00%, G2: 19.43%, G3: 76.76%\n",
      "EarlyStopping counter: 2 out of 40\n",
      "Epoch 5, Loss: 0.3920843716127327\n",
      "Validation Loss: 0.6018782094830558, Total Accuracy: 34.10%\n",
      "Accuracy per class - G1: 0.00%, G2: 22.27%, G3: 68.65%\n",
      "EarlyStopping counter: 3 out of 40\n",
      "Epoch 6, Loss: 0.38227625245071317\n",
      "Validation Loss: 0.5789905098222551, Total Accuracy: 36.27%\n",
      "Accuracy per class - G1: 0.00%, G2: 24.17%, G3: 71.89%\n",
      "EarlyStopping counter: 4 out of 40\n",
      "Epoch 7, Loss: 0.3722462481762989\n",
      "Validation Loss: 0.6100392582870665, Total Accuracy: 34.72%\n",
      "Accuracy per class - G1: 2.44%, G2: 20.85%, G3: 73.51%\n",
      "EarlyStopping counter: 5 out of 40\n",
      "Epoch 8, Loss: 0.37038408776363696\n",
      "Validation Loss: 0.6088357340721857, Total Accuracy: 35.80%\n",
      "Accuracy per class - G1: 0.00%, G2: 22.27%, G3: 74.59%\n",
      "EarlyStopping counter: 6 out of 40\n",
      "Epoch 9, Loss: 0.3604237760405943\n",
      "Validation Loss: 0.6108293072098777, Total Accuracy: 35.96%\n",
      "Accuracy per class - G1: 2.44%, G2: 22.04%, G3: 75.14%\n",
      "EarlyStopping counter: 7 out of 40\n",
      "Epoch 10, Loss: 0.35914496646588107\n",
      "Validation Loss: 0.5733014252923784, Total Accuracy: 38.12%\n",
      "Accuracy per class - G1: 0.00%, G2: 26.30%, G3: 73.51%\n",
      "EarlyStopping counter: 8 out of 40\n",
      "Epoch 11, Loss: 0.3509377221386117\n",
      "Validation Loss: 0.6353940481231326, Total Accuracy: 37.35%\n",
      "Accuracy per class - G1: 7.32%, G2: 24.64%, G3: 72.97%\n",
      "EarlyStopping counter: 9 out of 40\n",
      "Epoch 12, Loss: 0.3424112563391766\n",
      "Validation Loss: 0.5848915917532784, Total Accuracy: 35.96%\n",
      "Accuracy per class - G1: 0.00%, G2: 25.83%, G3: 67.03%\n",
      "EarlyStopping counter: 10 out of 40\n",
      "Epoch 13, Loss: 0.3354726453502494\n",
      "Validation Loss: 0.617122389730953, Total Accuracy: 35.49%\n",
      "Accuracy per class - G1: 0.00%, G2: 23.46%, G3: 70.81%\n",
      "EarlyStopping counter: 11 out of 40\n",
      "Epoch 14, Loss: 0.3255153982395149\n",
      "Validation Loss: 0.6025729413543429, Total Accuracy: 35.49%\n",
      "Accuracy per class - G1: 0.00%, G2: 23.70%, G3: 70.27%\n",
      "EarlyStopping counter: 12 out of 40\n",
      "Epoch 15, Loss: 0.3241001394498779\n",
      "Validation Loss: 0.640692562574432, Total Accuracy: 31.48%\n",
      "Accuracy per class - G1: 0.00%, G2: 20.85%, G3: 62.70%\n",
      "EarlyStopping counter: 13 out of 40\n",
      "Epoch 16, Loss: 0.31035755036107027\n",
      "Validation Loss: 0.6355908882050287, Total Accuracy: 36.27%\n",
      "Accuracy per class - G1: 0.00%, G2: 23.46%, G3: 73.51%\n",
      "EarlyStopping counter: 14 out of 40\n",
      "Epoch 17, Loss: 0.3147116319601794\n",
      "Validation Loss: 0.6354817343609673, Total Accuracy: 35.49%\n",
      "Accuracy per class - G1: 2.44%, G2: 23.70%, G3: 69.73%\n",
      "EarlyStopping counter: 15 out of 40\n",
      "Epoch 18, Loss: 0.3095602919179273\n",
      "Validation Loss: 0.6496120989322662, Total Accuracy: 34.41%\n",
      "Accuracy per class - G1: 2.44%, G2: 22.51%, G3: 68.65%\n",
      "EarlyStopping counter: 16 out of 40\n",
      "Epoch 19, Loss: 0.30138103663921356\n",
      "Validation Loss: 0.6802699686515898, Total Accuracy: 32.72%\n",
      "Accuracy per class - G1: 9.76%, G2: 18.48%, G3: 70.27%\n",
      "EarlyStopping counter: 17 out of 40\n",
      "Epoch 20, Loss: 0.29982016190706967\n",
      "Validation Loss: 0.6665204131887073, Total Accuracy: 33.49%\n",
      "Accuracy per class - G1: 2.44%, G2: 21.33%, G3: 68.11%\n",
      "EarlyStopping counter: 18 out of 40\n",
      "Epoch 21, Loss: 0.291895436235221\n",
      "Validation Loss: 0.6908292742002577, Total Accuracy: 33.49%\n",
      "Accuracy per class - G1: 0.00%, G2: 22.27%, G3: 66.49%\n",
      "EarlyStopping counter: 19 out of 40\n",
      "Epoch 22, Loss: 0.28691172976809814\n",
      "Validation Loss: 0.6435301623174122, Total Accuracy: 35.80%\n",
      "Accuracy per class - G1: 0.00%, G2: 24.64%, G3: 69.19%\n",
      "EarlyStopping counter: 20 out of 40\n",
      "Epoch 23, Loss: 0.2846204033458089\n",
      "Validation Loss: 0.690292755762736, Total Accuracy: 33.64%\n",
      "Accuracy per class - G1: 2.44%, G2: 21.33%, G3: 68.65%\n",
      "EarlyStopping counter: 21 out of 40\n",
      "Epoch 24, Loss: 0.27915771161935415\n",
      "Validation Loss: 0.7120774076098487, Total Accuracy: 33.49%\n",
      "Accuracy per class - G1: 4.88%, G2: 20.62%, G3: 69.19%\n",
      "EarlyStopping counter: 22 out of 40\n",
      "Epoch 25, Loss: 0.27772358257368385\n",
      "Validation Loss: 0.6935494520834514, Total Accuracy: 33.33%\n",
      "Accuracy per class - G1: 0.00%, G2: 22.27%, G3: 65.95%\n",
      "EarlyStopping counter: 23 out of 40\n",
      "Epoch 26, Loss: 0.2782184666538813\n",
      "Validation Loss: 0.6735625884362629, Total Accuracy: 35.03%\n",
      "Accuracy per class - G1: 7.32%, G2: 23.22%, G3: 68.11%\n",
      "EarlyStopping counter: 24 out of 40\n",
      "Epoch 27, Loss: 0.28067435916647854\n",
      "Validation Loss: 0.7054933572099322, Total Accuracy: 32.10%\n",
      "Accuracy per class - G1: 0.00%, G2: 21.33%, G3: 63.78%\n",
      "EarlyStopping counter: 25 out of 40\n",
      "Epoch 28, Loss: 0.2711985107645931\n",
      "Validation Loss: 0.6837828783761888, Total Accuracy: 31.48%\n",
      "Accuracy per class - G1: 0.00%, G2: 19.91%, G3: 64.86%\n",
      "EarlyStopping counter: 26 out of 40\n",
      "Epoch 29, Loss: 0.27735135695302343\n",
      "Validation Loss: 0.6776208373762312, Total Accuracy: 32.56%\n",
      "Accuracy per class - G1: 2.44%, G2: 20.38%, G3: 67.03%\n",
      "EarlyStopping counter: 27 out of 40\n",
      "Epoch 30, Loss: 0.2736280240926398\n",
      "Validation Loss: 0.7232536332947868, Total Accuracy: 34.26%\n",
      "Accuracy per class - G1: 0.00%, G2: 22.04%, G3: 69.73%\n",
      "EarlyStopping counter: 28 out of 40\n",
      "Epoch 31, Loss: 0.27273005229162883\n",
      "Validation Loss: 0.696699932927177, Total Accuracy: 33.95%\n",
      "Accuracy per class - G1: 0.00%, G2: 21.56%, G3: 69.73%\n",
      "EarlyStopping counter: 29 out of 40\n",
      "Epoch 32, Loss: 0.2736249330891184\n",
      "Validation Loss: 0.6858027910902387, Total Accuracy: 33.95%\n",
      "Accuracy per class - G1: 2.44%, G2: 22.51%, G3: 67.03%\n",
      "EarlyStopping counter: 30 out of 40\n",
      "Epoch 33, Loss: 0.27262716767299605\n",
      "Validation Loss: 0.676626729113715, Total Accuracy: 33.49%\n",
      "Accuracy per class - G1: 0.00%, G2: 25.36%, G3: 59.46%\n",
      "EarlyStopping counter: 31 out of 40\n",
      "Epoch 34, Loss: 0.2683734157717372\n",
      "Validation Loss: 0.7060485936346508, Total Accuracy: 34.41%\n",
      "Accuracy per class - G1: 0.00%, G2: 24.17%, G3: 65.41%\n",
      "EarlyStopping counter: 32 out of 40\n",
      "Epoch 35, Loss: 0.2661758406334613\n",
      "Validation Loss: 0.7338291548547291, Total Accuracy: 32.25%\n",
      "Accuracy per class - G1: 9.76%, G2: 22.04%, G3: 60.54%\n",
      "EarlyStopping counter: 33 out of 40\n",
      "Epoch 36, Loss: 0.2670655988426094\n",
      "Validation Loss: 0.7324091650190807, Total Accuracy: 33.80%\n",
      "Accuracy per class - G1: 2.44%, G2: 22.04%, G3: 67.57%\n",
      "EarlyStopping counter: 34 out of 40\n",
      "Epoch 37, Loss: 0.2687423114317009\n",
      "Validation Loss: 0.6671330694641385, Total Accuracy: 34.26%\n",
      "Accuracy per class - G1: 0.00%, G2: 24.64%, G3: 63.78%\n",
      "EarlyStopping counter: 35 out of 40\n",
      "Epoch 38, Loss: 0.26451182437230303\n",
      "Validation Loss: 0.6799960746651604, Total Accuracy: 35.65%\n",
      "Accuracy per class - G1: 0.00%, G2: 24.17%, G3: 69.73%\n",
      "EarlyStopping counter: 36 out of 40\n",
      "Epoch 39, Loss: 0.2636399920805391\n",
      "Validation Loss: 0.7170403947432836, Total Accuracy: 32.25%\n",
      "Accuracy per class - G1: 0.00%, G2: 24.88%, G3: 56.22%\n",
      "EarlyStopping counter: 37 out of 40\n",
      "Epoch 40, Loss: 0.2661536576518093\n",
      "Validation Loss: 0.7227195068484261, Total Accuracy: 32.10%\n",
      "Accuracy per class - G1: 2.44%, G2: 22.75%, G3: 60.00%\n",
      "EarlyStopping counter: 38 out of 40\n",
      "Epoch 41, Loss: 0.2598703544901078\n",
      "Validation Loss: 0.7306316665240696, Total Accuracy: 33.02%\n",
      "Accuracy per class - G1: 2.44%, G2: 21.80%, G3: 65.41%\n",
      "EarlyStopping counter: 39 out of 40\n",
      "Epoch 42, Loss: 0.2629197351185672\n",
      "Validation Loss: 0.7175027011405855, Total Accuracy: 32.72%\n",
      "Accuracy per class - G1: 4.88%, G2: 22.51%, G3: 62.16%\n",
      "EarlyStopping counter: 40 out of 40\n",
      "Early stopping\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\u001b[34m\u001b[1mwandb\u001b[0m:                                                                                \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run history:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run summary:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc 4.87805\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc 27.64228\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc 22.51185\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc 60.39903\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc 62.16216\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc 91.15282\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy 32.71605\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy 66.02419\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss 0.26292\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss 0.7175\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View run \u001b[33m1optuna_run_14 microsoft/resnet-18 Frozen Layers Nooversampling Focallo15\u001b[0m at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/v0n1zftg\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View project at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Synced 5 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Find logs at: \u001b[35m\u001b[1m./wandb/run-20241009_220725-v0n1zftg/logs\u001b[0m\n",
      "[I 2024-10-09 22:26:18,201] Trial 14 finished with value: 0.23957439330638808 and parameters: {'weight_decay': 3.5947323108944543e-06, 'focal_loss': 2.19521594367048}. Best is trial 7 with value: 0.29790585093823324.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Tracking run with wandb version 0.18.3\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run data is saved locally in \u001b[35m\u001b[1m/kaggle/working/wandb/run-20241009_222618-s20wgo1v\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run \u001b[1m`wandb offline`\u001b[0m to turn off syncing.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Syncing run \u001b[33m1optuna_run_15 microsoft/resnet-18 Frozen Layers Nooversampling Focallo16\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View project at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View run at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/s20wgo1v\u001b[0m\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Epoch 1, Loss: 0.7321640353604971\n",
      "Validation Loss: 0.7304376017834459, Total Accuracy: 30.09%\n",
      "Accuracy per class - G1: 0.00%, G2: 2.37%, G3: 100.00%\n",
      "Validation loss decreased (inf --> 15.339190).  Saving model ...\n",
      "Epoch 2, Loss: 0.7193949157933155\n",
      "Validation Loss: 0.6981726625845546, Total Accuracy: 31.33%\n",
      "Accuracy per class - G1: 0.00%, G2: 4.50%, G3: 99.46%\n",
      "Validation loss decreased (15.339190 --> 14.661626).  Saving model ...\n",
      "Epoch 3, Loss: 0.7077627447714289\n",
      "Validation Loss: 0.7272542789578438, Total Accuracy: 30.25%\n",
      "Accuracy per class - G1: 0.00%, G2: 3.08%, G3: 98.92%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 4, Loss: 0.7002739841679493\n",
      "Validation Loss: 0.71476198289366, Total Accuracy: 30.40%\n",
      "Accuracy per class - G1: 0.00%, G2: 3.32%, G3: 98.92%\n",
      "EarlyStopping counter: 2 out of 40\n",
      "Epoch 5, Loss: 0.6766961902739054\n",
      "Validation Loss: 0.7183046404804502, Total Accuracy: 29.94%\n",
      "Accuracy per class - G1: 0.00%, G2: 2.37%, G3: 99.46%\n",
      "EarlyStopping counter: 3 out of 40\n",
      "Epoch 6, Loss: 0.6705758758338101\n",
      "Validation Loss: 0.7274895615520931, Total Accuracy: 29.94%\n",
      "Accuracy per class - G1: 0.00%, G2: 3.08%, G3: 97.84%\n",
      "EarlyStopping counter: 4 out of 40\n",
      "Epoch 7, Loss: 0.6614485666694412\n",
      "Validation Loss: 0.73506214274537, Total Accuracy: 31.94%\n",
      "Accuracy per class - G1: 0.00%, G2: 5.21%, G3: 100.00%\n",
      "EarlyStopping counter: 5 out of 40\n",
      "Epoch 8, Loss: 0.6548067629337311\n",
      "Validation Loss: 0.7545033189512435, Total Accuracy: 30.71%\n",
      "Accuracy per class - G1: 0.00%, G2: 3.32%, G3: 100.00%\n",
      "EarlyStopping counter: 6 out of 40\n",
      "Epoch 9, Loss: 0.6378809816866036\n",
      "Validation Loss: 0.7455158442968414, Total Accuracy: 29.48%\n",
      "Accuracy per class - G1: 0.00%, G2: 2.84%, G3: 96.76%\n",
      "EarlyStopping counter: 7 out of 40\n",
      "Epoch 10, Loss: 0.6289244574236582\n",
      "Validation Loss: 0.7261228419485546, Total Accuracy: 29.94%\n",
      "Accuracy per class - G1: 0.00%, G2: 3.08%, G3: 97.84%\n",
      "EarlyStopping counter: 8 out of 40\n",
      "Epoch 11, Loss: 0.6176848774214825\n",
      "Validation Loss: 0.7972640643517176, Total Accuracy: 30.25%\n",
      "Accuracy per class - G1: 0.00%, G2: 3.08%, G3: 98.92%\n",
      "EarlyStopping counter: 9 out of 40\n",
      "Epoch 12, Loss: 0.6105261032121727\n",
      "Validation Loss: 0.7416453141541708, Total Accuracy: 30.71%\n",
      "Accuracy per class - G1: 0.00%, G2: 3.55%, G3: 99.46%\n",
      "EarlyStopping counter: 10 out of 40\n",
      "Epoch 13, Loss: 0.6055492582809494\n",
      "Validation Loss: 0.7949423821909087, Total Accuracy: 30.71%\n",
      "Accuracy per class - G1: 0.00%, G2: 4.03%, G3: 98.38%\n",
      "EarlyStopping counter: 11 out of 40\n",
      "Epoch 14, Loss: 0.5888671724193068\n",
      "Validation Loss: 0.7528879131589618, Total Accuracy: 30.25%\n",
      "Accuracy per class - G1: 0.00%, G2: 3.08%, G3: 98.92%\n",
      "EarlyStopping counter: 12 out of 40\n",
      "Epoch 15, Loss: 0.5831365653549332\n",
      "Validation Loss: 0.7883080038286391, Total Accuracy: 30.56%\n",
      "Accuracy per class - G1: 0.00%, G2: 4.27%, G3: 97.30%\n",
      "EarlyStopping counter: 13 out of 40\n",
      "Epoch 16, Loss: 0.57680049071829\n",
      "Validation Loss: 0.8351495528504962, Total Accuracy: 29.48%\n",
      "Accuracy per class - G1: 0.00%, G2: 2.37%, G3: 97.84%\n",
      "EarlyStopping counter: 14 out of 40\n",
      "Epoch 17, Loss: 0.5715707317892328\n",
      "Validation Loss: 0.7659165454762322, Total Accuracy: 30.25%\n",
      "Accuracy per class - G1: 0.00%, G2: 3.55%, G3: 97.84%\n",
      "EarlyStopping counter: 15 out of 40\n",
      "Epoch 18, Loss: 0.5542476363928921\n",
      "Validation Loss: 0.859211437226761, Total Accuracy: 29.17%\n",
      "Accuracy per class - G1: 0.00%, G2: 1.42%, G3: 98.92%\n",
      "EarlyStopping counter: 16 out of 40\n",
      "Epoch 19, Loss: 0.556520640491003\n",
      "Validation Loss: 0.8241414849956831, Total Accuracy: 30.56%\n",
      "Accuracy per class - G1: 0.00%, G2: 3.79%, G3: 98.38%\n",
      "EarlyStopping counter: 17 out of 40\n",
      "Epoch 20, Loss: 0.5476999182298959\n",
      "Validation Loss: 0.8273051200168473, Total Accuracy: 29.17%\n",
      "Accuracy per class - G1: 0.00%, G2: 1.90%, G3: 97.84%\n",
      "EarlyStopping counter: 18 out of 40\n",
      "Epoch 21, Loss: 0.5437624181609556\n",
      "Validation Loss: 0.8052806538485345, Total Accuracy: 30.86%\n",
      "Accuracy per class - G1: 0.00%, G2: 4.27%, G3: 98.38%\n",
      "EarlyStopping counter: 19 out of 40\n",
      "Epoch 22, Loss: 0.5316634670079473\n",
      "Validation Loss: 0.8390689698003587, Total Accuracy: 29.78%\n",
      "Accuracy per class - G1: 0.00%, G2: 3.55%, G3: 96.22%\n",
      "EarlyStopping counter: 20 out of 40\n",
      "Epoch 23, Loss: 0.5264305712946926\n",
      "Validation Loss: 0.8543405646369571, Total Accuracy: 29.63%\n",
      "Accuracy per class - G1: 0.00%, G2: 2.61%, G3: 97.84%\n",
      "EarlyStopping counter: 21 out of 40\n",
      "Epoch 24, Loss: 0.5198009265474526\n",
      "Validation Loss: 0.8455764612271672, Total Accuracy: 29.94%\n",
      "Accuracy per class - G1: 0.00%, G2: 3.32%, G3: 97.30%\n",
      "EarlyStopping counter: 22 out of 40\n",
      "Epoch 25, Loss: 0.5233041364026357\n",
      "Validation Loss: 0.8477205690883455, Total Accuracy: 30.40%\n",
      "Accuracy per class - G1: 0.00%, G2: 3.32%, G3: 98.92%\n",
      "EarlyStopping counter: 23 out of 40\n",
      "Epoch 26, Loss: 0.5174216595758875\n",
      "Validation Loss: 0.8559892574946085, Total Accuracy: 29.17%\n",
      "Accuracy per class - G1: 0.00%, G2: 2.61%, G3: 96.22%\n",
      "EarlyStopping counter: 24 out of 40\n",
      "Epoch 27, Loss: 0.5169264017099358\n",
      "Validation Loss: 0.8384411210815111, Total Accuracy: 29.94%\n",
      "Accuracy per class - G1: 0.00%, G2: 3.55%, G3: 96.76%\n",
      "EarlyStopping counter: 25 out of 40\n",
      "Epoch 28, Loss: 0.5211388659046357\n",
      "Validation Loss: 0.8381474404817536, Total Accuracy: 30.09%\n",
      "Accuracy per class - G1: 0.00%, G2: 3.79%, G3: 96.76%\n",
      "EarlyStopping counter: 26 out of 40\n",
      "Epoch 29, Loss: 0.5204443166773003\n",
      "Validation Loss: 0.8274882781718459, Total Accuracy: 31.48%\n",
      "Accuracy per class - G1: 0.00%, G2: 4.98%, G3: 98.92%\n",
      "EarlyStopping counter: 27 out of 40\n",
      "Epoch 30, Loss: 0.5109867827001825\n",
      "Validation Loss: 0.8709669599220866, Total Accuracy: 29.94%\n",
      "Accuracy per class - G1: 0.00%, G2: 2.61%, G3: 98.92%\n",
      "EarlyStopping counter: 28 out of 40\n",
      "Epoch 31, Loss: 0.5042344820068543\n",
      "Validation Loss: 0.8467672868143945, Total Accuracy: 30.25%\n",
      "Accuracy per class - G1: 0.00%, G2: 3.79%, G3: 97.30%\n",
      "EarlyStopping counter: 29 out of 40\n",
      "Epoch 32, Loss: 0.5074911562793226\n",
      "Validation Loss: 0.8692766740208581, Total Accuracy: 30.56%\n",
      "Accuracy per class - G1: 0.00%, G2: 3.79%, G3: 98.38%\n",
      "EarlyStopping counter: 30 out of 40\n",
      "Epoch 33, Loss: 0.5097658627004509\n",
      "Validation Loss: 0.8611695227168855, Total Accuracy: 30.09%\n",
      "Accuracy per class - G1: 0.00%, G2: 2.84%, G3: 98.92%\n",
      "EarlyStopping counter: 31 out of 40\n",
      "Epoch 34, Loss: 0.503310300858624\n",
      "Validation Loss: 0.8816307492199398, Total Accuracy: 29.78%\n",
      "Accuracy per class - G1: 0.00%, G2: 2.84%, G3: 97.84%\n",
      "EarlyStopping counter: 32 out of 40\n",
      "Epoch 35, Loss: 0.5012350685625191\n",
      "Validation Loss: 0.8549387930404573, Total Accuracy: 29.94%\n",
      "Accuracy per class - G1: 0.00%, G2: 3.08%, G3: 97.84%\n",
      "EarlyStopping counter: 33 out of 40\n",
      "Epoch 36, Loss: 0.49626297045903034\n",
      "Validation Loss: 0.8728188404015133, Total Accuracy: 30.25%\n",
      "Accuracy per class - G1: 0.00%, G2: 2.61%, G3: 100.00%\n",
      "EarlyStopping counter: 34 out of 40\n",
      "Epoch 37, Loss: 0.4972034003361162\n",
      "Validation Loss: 0.8777212752472787, Total Accuracy: 31.17%\n",
      "Accuracy per class - G1: 0.00%, G2: 4.27%, G3: 99.46%\n",
      "EarlyStopping counter: 35 out of 40\n",
      "Epoch 38, Loss: 0.49971811383603565\n",
      "Validation Loss: 0.9079044872806186, Total Accuracy: 29.17%\n",
      "Accuracy per class - G1: 0.00%, G2: 1.18%, G3: 99.46%\n",
      "EarlyStopping counter: 36 out of 40\n",
      "Epoch 39, Loss: 0.49113554121500036\n",
      "Validation Loss: 0.8817057325726464, Total Accuracy: 29.63%\n",
      "Accuracy per class - G1: 0.00%, G2: 2.61%, G3: 97.84%\n",
      "EarlyStopping counter: 37 out of 40\n",
      "Epoch 40, Loss: 0.495601604142821\n",
      "Validation Loss: 0.8943233124556995, Total Accuracy: 29.63%\n",
      "Accuracy per class - G1: 0.00%, G2: 2.61%, G3: 97.84%\n",
      "EarlyStopping counter: 38 out of 40\n",
      "Epoch 41, Loss: 0.4911620706678873\n",
      "Validation Loss: 0.8917958037484259, Total Accuracy: 30.09%\n",
      "Accuracy per class - G1: 0.00%, G2: 3.32%, G3: 97.84%\n",
      "EarlyStopping counter: 39 out of 40\n",
      "Epoch 42, Loss: 0.48783832034432745\n",
      "Validation Loss: 0.8793742582201958, Total Accuracy: 29.17%\n",
      "Accuracy per class - G1: 0.00%, G2: 2.61%, G3: 96.22%\n",
      "EarlyStopping counter: 40 out of 40\n",
      "Early stopping\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\u001b[34m\u001b[1mwandb\u001b[0m:                                                                                \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run history:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run summary:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc 0\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc 8.13008\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc 2.60664\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc 12.63603\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc 96.21622\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc 99.19571\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy 29.16667\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy 36.62132\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss 0.48784\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss 0.87937\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View run \u001b[33m1optuna_run_15 microsoft/resnet-18 Frozen Layers Nooversampling Focallo16\u001b[0m at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/s20wgo1v\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View project at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Synced 5 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Find logs at: \u001b[35m\u001b[1m./wandb/run-20241009_222618-s20wgo1v/logs\u001b[0m\n",
      "[I 2024-10-09 22:45:24,281] Trial 15 finished with value: 0.1720437290491261 and parameters: {'weight_decay': 6.63920296805984e-07, 'focal_loss': 1.8007016251023218}. Best is trial 7 with value: 0.29790585093823324.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Tracking run with wandb version 0.18.3\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run data is saved locally in \u001b[35m\u001b[1m/kaggle/working/wandb/run-20241009_224524-vsscflmh\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run \u001b[1m`wandb offline`\u001b[0m to turn off syncing.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Syncing run \u001b[33m1optuna_run_16 microsoft/resnet-18 Frozen Layers Nooversampling Focallo17\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View project at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View run at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/vsscflmh\u001b[0m\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Epoch 1, Loss: 0.3786111653569233\n",
      "Validation Loss: 0.3324348192129816, Total Accuracy: 57.72%\n",
      "Accuracy per class - G1: 0.00%, G2: 65.88%, G3: 51.89%\n",
      "Validation loss decreased (inf --> 6.981131).  Saving model ...\n",
      "Epoch 2, Loss: 0.36619604100663977\n",
      "Validation Loss: 0.3366923743770236, Total Accuracy: 59.10%\n",
      "Accuracy per class - G1: 0.00%, G2: 66.82%, G3: 54.59%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 3, Loss: 0.35427498925163087\n",
      "Validation Loss: 0.3489382068316142, Total Accuracy: 54.94%\n",
      "Accuracy per class - G1: 0.00%, G2: 62.09%, G3: 50.81%\n",
      "EarlyStopping counter: 2 out of 40\n",
      "Epoch 4, Loss: 0.3410964760794697\n",
      "Validation Loss: 0.3548453205398151, Total Accuracy: 53.09%\n",
      "Accuracy per class - G1: 0.00%, G2: 57.58%, G3: 54.59%\n",
      "EarlyStopping counter: 3 out of 40\n",
      "Epoch 5, Loss: 0.32784276428710984\n",
      "Validation Loss: 0.3559958203917458, Total Accuracy: 51.70%\n",
      "Accuracy per class - G1: 0.00%, G2: 54.03%, G3: 57.84%\n",
      "EarlyStopping counter: 4 out of 40\n",
      "Epoch 6, Loss: 0.32796525290931566\n",
      "Validation Loss: 0.3675321177357719, Total Accuracy: 52.31%\n",
      "Accuracy per class - G1: 0.00%, G2: 58.29%, G3: 50.27%\n",
      "EarlyStopping counter: 5 out of 40\n",
      "Epoch 7, Loss: 0.3206231033945658\n",
      "Validation Loss: 0.3635289218454134, Total Accuracy: 55.56%\n",
      "Accuracy per class - G1: 0.00%, G2: 61.14%, G3: 55.14%\n",
      "EarlyStopping counter: 6 out of 40\n",
      "Epoch 8, Loss: 0.30677807295178794\n",
      "Validation Loss: 0.3654132542156038, Total Accuracy: 51.70%\n",
      "Accuracy per class - G1: 0.00%, G2: 55.45%, G3: 54.59%\n",
      "EarlyStopping counter: 7 out of 40\n",
      "Epoch 9, Loss: 0.2976396798369396\n",
      "Validation Loss: 0.37884434525455746, Total Accuracy: 50.00%\n",
      "Accuracy per class - G1: 0.00%, G2: 53.32%, G3: 53.51%\n",
      "EarlyStopping counter: 8 out of 40\n",
      "Epoch 10, Loss: 0.2906838985810797\n",
      "Validation Loss: 0.3852992008129756, Total Accuracy: 47.38%\n",
      "Accuracy per class - G1: 0.00%, G2: 50.71%, G3: 50.27%\n",
      "EarlyStopping counter: 9 out of 40\n",
      "Epoch 11, Loss: 0.29003198247358025\n",
      "Validation Loss: 0.37004502295028596, Total Accuracy: 49.07%\n",
      "Accuracy per class - G1: 0.00%, G2: 56.16%, G3: 43.78%\n",
      "EarlyStopping counter: 10 out of 40\n",
      "Epoch 12, Loss: 0.276704992515495\n",
      "Validation Loss: 0.3834970923406737, Total Accuracy: 49.07%\n",
      "Accuracy per class - G1: 0.00%, G2: 54.74%, G3: 47.03%\n",
      "EarlyStopping counter: 11 out of 40\n",
      "Epoch 13, Loss: 0.2734440177319998\n",
      "Validation Loss: 0.4148291406177339, Total Accuracy: 42.75%\n",
      "Accuracy per class - G1: 0.00%, G2: 43.84%, G3: 49.73%\n",
      "EarlyStopping counter: 12 out of 40\n",
      "Epoch 14, Loss: 0.26719747196479016\n",
      "Validation Loss: 0.4160540650288264, Total Accuracy: 45.37%\n",
      "Accuracy per class - G1: 0.00%, G2: 49.29%, G3: 46.49%\n",
      "EarlyStopping counter: 13 out of 40\n",
      "Epoch 15, Loss: 0.26007804795202\n",
      "Validation Loss: 0.40837225850139347, Total Accuracy: 43.52%\n",
      "Accuracy per class - G1: 0.00%, G2: 47.39%, G3: 44.32%\n",
      "EarlyStopping counter: 14 out of 40\n",
      "Epoch 16, Loss: 0.2563090949173433\n",
      "Validation Loss: 0.3964500388219243, Total Accuracy: 45.22%\n",
      "Accuracy per class - G1: 0.00%, G2: 48.82%, G3: 47.03%\n",
      "EarlyStopping counter: 15 out of 40\n",
      "Epoch 17, Loss: 0.25365439649805965\n",
      "Validation Loss: 0.4087416561586516, Total Accuracy: 48.30%\n",
      "Accuracy per class - G1: 0.00%, G2: 50.95%, G3: 52.97%\n",
      "EarlyStopping counter: 16 out of 40\n",
      "Epoch 18, Loss: 0.24772038786526185\n",
      "Validation Loss: 0.4179402930395944, Total Accuracy: 44.29%\n",
      "Accuracy per class - G1: 0.00%, G2: 47.63%, G3: 46.49%\n",
      "EarlyStopping counter: 17 out of 40\n",
      "Epoch 19, Loss: 0.2389756906104375\n",
      "Validation Loss: 0.4337353798605147, Total Accuracy: 43.52%\n",
      "Accuracy per class - G1: 0.00%, G2: 48.10%, G3: 42.70%\n",
      "EarlyStopping counter: 18 out of 40\n",
      "Epoch 20, Loss: 0.23597505024398666\n",
      "Validation Loss: 0.4412941432424954, Total Accuracy: 44.14%\n",
      "Accuracy per class - G1: 0.00%, G2: 45.97%, G3: 49.73%\n",
      "EarlyStopping counter: 19 out of 40\n",
      "Epoch 21, Loss: 0.23584261787943092\n",
      "Validation Loss: 0.44913293988931746, Total Accuracy: 42.13%\n",
      "Accuracy per class - G1: 0.00%, G2: 43.60%, G3: 48.11%\n",
      "EarlyStopping counter: 20 out of 40\n",
      "Epoch 22, Loss: 0.23424632165087275\n",
      "Validation Loss: 0.4418814405798912, Total Accuracy: 44.91%\n",
      "Accuracy per class - G1: 0.00%, G2: 48.82%, G3: 45.95%\n",
      "EarlyStopping counter: 21 out of 40\n",
      "Epoch 23, Loss: 0.23141356387052192\n",
      "Validation Loss: 0.4416842386126518, Total Accuracy: 42.28%\n",
      "Accuracy per class - G1: 0.00%, G2: 46.45%, G3: 42.16%\n",
      "EarlyStopping counter: 22 out of 40\n",
      "Epoch 24, Loss: 0.22335964333580202\n",
      "Validation Loss: 0.44658720174006056, Total Accuracy: 43.98%\n",
      "Accuracy per class - G1: 0.00%, G2: 47.16%, G3: 46.49%\n",
      "EarlyStopping counter: 23 out of 40\n",
      "Epoch 25, Loss: 0.22510578707758203\n",
      "Validation Loss: 0.46175512281202136, Total Accuracy: 40.12%\n",
      "Accuracy per class - G1: 0.00%, G2: 44.79%, G3: 38.38%\n",
      "EarlyStopping counter: 24 out of 40\n",
      "Epoch 26, Loss: 0.2258706604500851\n",
      "Validation Loss: 0.4556312876797858, Total Accuracy: 40.12%\n",
      "Accuracy per class - G1: 0.00%, G2: 44.08%, G3: 40.00%\n",
      "EarlyStopping counter: 25 out of 40\n",
      "Epoch 27, Loss: 0.22352718947881675\n",
      "Validation Loss: 0.4531309902667999, Total Accuracy: 40.28%\n",
      "Accuracy per class - G1: 0.00%, G2: 43.60%, G3: 41.62%\n",
      "EarlyStopping counter: 26 out of 40\n",
      "Epoch 28, Loss: 0.2266284336885774\n",
      "Validation Loss: 0.4663505419379189, Total Accuracy: 40.28%\n",
      "Accuracy per class - G1: 0.00%, G2: 45.02%, G3: 38.38%\n",
      "EarlyStopping counter: 27 out of 40\n",
      "Epoch 29, Loss: 0.21830952634294348\n",
      "Validation Loss: 0.4429536085753214, Total Accuracy: 41.51%\n",
      "Accuracy per class - G1: 0.00%, G2: 46.68%, G3: 38.92%\n",
      "EarlyStopping counter: 28 out of 40\n",
      "Epoch 30, Loss: 0.22369347458862396\n",
      "Validation Loss: 0.4568467310496739, Total Accuracy: 38.12%\n",
      "Accuracy per class - G1: 0.00%, G2: 42.65%, G3: 36.22%\n",
      "EarlyStopping counter: 29 out of 40\n",
      "Epoch 31, Loss: 0.222888903086444\n",
      "Validation Loss: 0.478549691538016, Total Accuracy: 39.35%\n",
      "Accuracy per class - G1: 0.00%, G2: 43.36%, G3: 38.92%\n",
      "EarlyStopping counter: 30 out of 40\n",
      "Epoch 32, Loss: 0.21458665847060193\n",
      "Validation Loss: 0.47632553960595814, Total Accuracy: 39.35%\n",
      "Accuracy per class - G1: 0.00%, G2: 42.42%, G3: 41.08%\n",
      "EarlyStopping counter: 31 out of 40\n",
      "Epoch 33, Loss: 0.2162948696010084\n",
      "Validation Loss: 0.477827750146389, Total Accuracy: 38.58%\n",
      "Accuracy per class - G1: 0.00%, G2: 39.81%, G3: 44.32%\n",
      "EarlyStopping counter: 32 out of 40\n",
      "Epoch 34, Loss: 0.21653530647955746\n",
      "Validation Loss: 0.4543006317246528, Total Accuracy: 44.75%\n",
      "Accuracy per class - G1: 0.00%, G2: 47.87%, G3: 47.57%\n",
      "EarlyStopping counter: 33 out of 40\n",
      "Epoch 35, Loss: 0.21900380034762693\n",
      "Validation Loss: 0.4415140620299748, Total Accuracy: 41.05%\n",
      "Accuracy per class - G1: 0.00%, G2: 44.55%, G3: 42.16%\n",
      "EarlyStopping counter: 34 out of 40\n",
      "Epoch 36, Loss: 0.2169056879468711\n",
      "Validation Loss: 0.47329632192850113, Total Accuracy: 39.35%\n",
      "Accuracy per class - G1: 0.00%, G2: 40.76%, G3: 44.86%\n",
      "EarlyStopping counter: 35 out of 40\n",
      "Epoch 37, Loss: 0.21157986428364214\n",
      "Validation Loss: 0.45355435070537387, Total Accuracy: 42.59%\n",
      "Accuracy per class - G1: 0.00%, G2: 48.10%, G3: 39.46%\n",
      "EarlyStopping counter: 36 out of 40\n",
      "Epoch 38, Loss: 0.20779917775148368\n",
      "Validation Loss: 0.4653523035702251, Total Accuracy: 38.27%\n",
      "Accuracy per class - G1: 0.00%, G2: 43.36%, G3: 35.14%\n",
      "EarlyStopping counter: 37 out of 40\n",
      "Epoch 39, Loss: 0.21383905554392252\n",
      "Validation Loss: 0.4551707871613048, Total Accuracy: 41.36%\n",
      "Accuracy per class - G1: 0.00%, G2: 46.21%, G3: 39.46%\n",
      "EarlyStopping counter: 38 out of 40\n",
      "Epoch 40, Loss: 0.21011021787143616\n",
      "Validation Loss: 0.46233551913783666, Total Accuracy: 37.65%\n",
      "Accuracy per class - G1: 0.00%, G2: 42.18%, G3: 35.68%\n",
      "EarlyStopping counter: 39 out of 40\n",
      "Epoch 41, Loss: 0.20750791426882687\n",
      "Validation Loss: 0.45482836486328215, Total Accuracy: 41.98%\n",
      "Accuracy per class - G1: 0.00%, G2: 47.39%, G3: 38.92%\n",
      "EarlyStopping counter: 40 out of 40\n",
      "Early stopping\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\u001b[34m\u001b[1mwandb\u001b[0m:                                                                                \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run history:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run summary:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc 0\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc 47.96748\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc 47.39336\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc 82.46675\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc 38.91892\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc 72.92225\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy 41.97531\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy 76.56841\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss 0.20751\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss 0.45483\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View run \u001b[33m1optuna_run_16 microsoft/resnet-18 Frozen Layers Nooversampling Focallo17\u001b[0m at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/vsscflmh\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View project at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Synced 5 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Find logs at: \u001b[35m\u001b[1m./wandb/run-20241009_224524-vsscflmh/logs\u001b[0m\n",
      "[I 2024-10-09 23:04:38,205] Trial 16 finished with value: 0.27345260083329753 and parameters: {'weight_decay': 2.2775949207735755e-06, 'focal_loss': 2.2004604001672425}. Best is trial 7 with value: 0.29790585093823324.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Tracking run with wandb version 0.18.3\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run data is saved locally in \u001b[35m\u001b[1m/kaggle/working/wandb/run-20241009_230438-cvkin6pz\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run \u001b[1m`wandb offline`\u001b[0m to turn off syncing.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Syncing run \u001b[33m1optuna_run_17 microsoft/resnet-18 Frozen Layers Nooversampling Focallo18\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View project at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View run at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/cvkin6pz\u001b[0m\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Epoch 1, Loss: 0.4414580221994814\n",
      "Validation Loss: 0.29611216813680674, Total Accuracy: 65.90%\n",
      "Accuracy per class - G1: 0.00%, G2: 99.53%, G3: 3.78%\n",
      "Validation loss decreased (inf --> 6.218356).  Saving model ...\n",
      "Epoch 2, Loss: 0.42314444679811775\n",
      "Validation Loss: 0.30008914647623897, Total Accuracy: 66.05%\n",
      "Accuracy per class - G1: 0.00%, G2: 99.76%, G3: 3.78%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 3, Loss: 0.41431040541235226\n",
      "Validation Loss: 0.29677706302720164, Total Accuracy: 66.05%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 3.24%\n",
      "EarlyStopping counter: 2 out of 40\n",
      "Epoch 4, Loss: 0.398805759398334\n",
      "Validation Loss: 0.29687645151058123, Total Accuracy: 66.20%\n",
      "Accuracy per class - G1: 0.00%, G2: 99.76%, G3: 4.32%\n",
      "EarlyStopping counter: 3 out of 40\n",
      "Epoch 5, Loss: 0.39467841099543743\n",
      "Validation Loss: 0.29757473954842206, Total Accuracy: 65.90%\n",
      "Accuracy per class - G1: 0.00%, G2: 99.76%, G3: 3.24%\n",
      "EarlyStopping counter: 4 out of 40\n",
      "Epoch 6, Loss: 0.3843243328562702\n",
      "Validation Loss: 0.2925391937384293, Total Accuracy: 65.90%\n",
      "Accuracy per class - G1: 0.00%, G2: 99.76%, G3: 3.24%\n",
      "Validation loss decreased (6.218356 --> 6.143323).  Saving model ...\n",
      "Epoch 7, Loss: 0.36808423410697155\n",
      "Validation Loss: 0.30540927561620873, Total Accuracy: 66.05%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 3.24%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 8, Loss: 0.36087503634303447\n",
      "Validation Loss: 0.2818195627824891, Total Accuracy: 66.20%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 3.78%\n",
      "Validation loss decreased (6.143323 --> 5.918211).  Saving model ...\n",
      "Epoch 9, Loss: 0.35070296547499047\n",
      "Validation Loss: 0.290619082305403, Total Accuracy: 66.05%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 3.24%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 10, Loss: 0.3462444633604532\n",
      "Validation Loss: 0.2927645929601221, Total Accuracy: 66.20%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 3.78%\n",
      "EarlyStopping counter: 2 out of 40\n",
      "Epoch 11, Loss: 0.3359985220504094\n",
      "Validation Loss: 0.2971520999535209, Total Accuracy: 65.74%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 2.16%\n",
      "EarlyStopping counter: 3 out of 40\n",
      "Epoch 12, Loss: 0.3286606529390956\n",
      "Validation Loss: 0.29505342431366444, Total Accuracy: 66.20%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 3.78%\n",
      "EarlyStopping counter: 4 out of 40\n",
      "Epoch 13, Loss: 0.32792703322617406\n",
      "Validation Loss: 0.2898783537426165, Total Accuracy: 65.59%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 1.62%\n",
      "EarlyStopping counter: 5 out of 40\n",
      "Epoch 14, Loss: 0.32012704355889054\n",
      "Validation Loss: 0.28953697550154867, Total Accuracy: 66.67%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 5.41%\n",
      "EarlyStopping counter: 6 out of 40\n",
      "Epoch 15, Loss: 0.30935902444713087\n",
      "Validation Loss: 0.28367178940347265, Total Accuracy: 66.51%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 4.86%\n",
      "EarlyStopping counter: 7 out of 40\n",
      "Epoch 16, Loss: 0.2976004279342042\n",
      "Validation Loss: 0.2932664379477501, Total Accuracy: 66.05%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 3.24%\n",
      "EarlyStopping counter: 8 out of 40\n",
      "Epoch 17, Loss: 0.2922067733773266\n",
      "Validation Loss: 0.2822243543785243, Total Accuracy: 66.36%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 4.32%\n",
      "EarlyStopping counter: 9 out of 40\n",
      "Epoch 18, Loss: 0.28295029717755604\n",
      "Validation Loss: 0.29547779590246226, Total Accuracy: 66.51%\n",
      "Accuracy per class - G1: 0.00%, G2: 99.76%, G3: 5.41%\n",
      "EarlyStopping counter: 10 out of 40\n",
      "Epoch 19, Loss: 0.2861513755766742\n",
      "Validation Loss: 0.2955147230642892, Total Accuracy: 66.82%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 5.95%\n",
      "EarlyStopping counter: 11 out of 40\n",
      "Epoch 20, Loss: 0.27251138241894274\n",
      "Validation Loss: 0.29427351022050496, Total Accuracy: 66.67%\n",
      "Accuracy per class - G1: 0.00%, G2: 99.76%, G3: 5.95%\n",
      "EarlyStopping counter: 12 out of 40\n",
      "Epoch 21, Loss: 0.2754765966211457\n",
      "Validation Loss: 0.28493322751351763, Total Accuracy: 66.51%\n",
      "Accuracy per class - G1: 0.00%, G2: 99.76%, G3: 5.41%\n",
      "EarlyStopping counter: 13 out of 40\n",
      "Epoch 22, Loss: 0.2631637012384024\n",
      "Validation Loss: 0.3007703579607464, Total Accuracy: 66.20%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 3.78%\n",
      "EarlyStopping counter: 14 out of 40\n",
      "Epoch 23, Loss: 0.26202841848134995\n",
      "Validation Loss: 0.29755355905564057, Total Accuracy: 66.05%\n",
      "Accuracy per class - G1: 0.00%, G2: 99.76%, G3: 3.78%\n",
      "EarlyStopping counter: 15 out of 40\n",
      "Epoch 24, Loss: 0.2553786779024515\n",
      "Validation Loss: 0.296780514752581, Total Accuracy: 66.05%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 3.24%\n",
      "EarlyStopping counter: 16 out of 40\n",
      "Epoch 25, Loss: 0.25100311071398745\n",
      "Validation Loss: 0.28722687491348814, Total Accuracy: 66.05%\n",
      "Accuracy per class - G1: 0.00%, G2: 99.76%, G3: 3.78%\n",
      "EarlyStopping counter: 17 out of 40\n",
      "Epoch 26, Loss: 0.24781574272965812\n",
      "Validation Loss: 0.3099411494497742, Total Accuracy: 65.90%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 2.70%\n",
      "EarlyStopping counter: 18 out of 40\n",
      "Epoch 27, Loss: 0.24051885073443494\n",
      "Validation Loss: 0.30047196912623586, Total Accuracy: 66.51%\n",
      "Accuracy per class - G1: 0.00%, G2: 99.76%, G3: 5.41%\n",
      "EarlyStopping counter: 19 out of 40\n",
      "Epoch 28, Loss: 0.23911192528454653\n",
      "Validation Loss: 0.2974468854566415, Total Accuracy: 66.67%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 5.41%\n",
      "EarlyStopping counter: 20 out of 40\n",
      "Epoch 29, Loss: 0.23302367769451027\n",
      "Validation Loss: 0.29124968631991316, Total Accuracy: 67.75%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 9.19%\n",
      "EarlyStopping counter: 21 out of 40\n",
      "Epoch 30, Loss: 0.2331530376371131\n",
      "Validation Loss: 0.28143077804928734, Total Accuracy: 67.44%\n",
      "Accuracy per class - G1: 0.00%, G2: 99.76%, G3: 8.65%\n",
      "Validation loss decreased (5.918211 --> 5.910046).  Saving model ...\n",
      "Epoch 31, Loss: 0.22957441524927874\n",
      "Validation Loss: 0.28721933785293785, Total Accuracy: 67.90%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 9.73%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 32, Loss: 0.22918650624622783\n",
      "Validation Loss: 0.3021900048922925, Total Accuracy: 66.67%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 5.41%\n",
      "EarlyStopping counter: 2 out of 40\n",
      "Epoch 33, Loss: 0.22876108859676914\n",
      "Validation Loss: 0.28753926055062384, Total Accuracy: 67.28%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 7.57%\n",
      "EarlyStopping counter: 3 out of 40\n",
      "Epoch 34, Loss: 0.22412146995943713\n",
      "Validation Loss: 0.2902039685064838, Total Accuracy: 66.51%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 4.86%\n",
      "EarlyStopping counter: 4 out of 40\n",
      "Epoch 35, Loss: 0.22805762210165162\n",
      "Validation Loss: 0.3045665725533451, Total Accuracy: 66.67%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 5.41%\n",
      "EarlyStopping counter: 5 out of 40\n",
      "Epoch 36, Loss: 0.21959418623921384\n",
      "Validation Loss: 0.2970401562218155, Total Accuracy: 67.13%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 7.03%\n",
      "EarlyStopping counter: 6 out of 40\n",
      "Epoch 37, Loss: 0.22628909430230956\n",
      "Validation Loss: 0.293400246295191, Total Accuracy: 65.74%\n",
      "Accuracy per class - G1: 0.00%, G2: 99.76%, G3: 2.70%\n",
      "EarlyStopping counter: 7 out of 40\n",
      "Epoch 38, Loss: 0.22386086938610997\n",
      "Validation Loss: 0.2836116771435454, Total Accuracy: 67.59%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 8.65%\n",
      "EarlyStopping counter: 8 out of 40\n",
      "Epoch 39, Loss: 0.22317795482385588\n",
      "Validation Loss: 0.28887053215432734, Total Accuracy: 67.28%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 7.57%\n",
      "EarlyStopping counter: 9 out of 40\n",
      "Epoch 40, Loss: 0.2185219510133008\n",
      "Validation Loss: 0.2955922515441974, Total Accuracy: 66.51%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 4.86%\n",
      "EarlyStopping counter: 10 out of 40\n",
      "Epoch 41, Loss: 0.21695107715316567\n",
      "Validation Loss: 0.3053101638243312, Total Accuracy: 66.67%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 5.41%\n",
      "EarlyStopping counter: 11 out of 40\n",
      "Epoch 42, Loss: 0.215204687721758\n",
      "Validation Loss: 0.2895409379686628, Total Accuracy: 66.67%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 5.41%\n",
      "EarlyStopping counter: 12 out of 40\n",
      "Epoch 43, Loss: 0.218729687473142\n",
      "Validation Loss: 0.2900388898061855, Total Accuracy: 66.82%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 5.95%\n",
      "EarlyStopping counter: 13 out of 40\n",
      "Epoch 44, Loss: 0.21512326409658752\n",
      "Validation Loss: 0.29500447612787994, Total Accuracy: 66.98%\n",
      "Accuracy per class - G1: 0.00%, G2: 99.76%, G3: 7.03%\n",
      "EarlyStopping counter: 14 out of 40\n",
      "Epoch 45, Loss: 0.21499371429882855\n",
      "Validation Loss: 0.28430204066847053, Total Accuracy: 66.20%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 3.78%\n",
      "EarlyStopping counter: 15 out of 40\n",
      "Epoch 46, Loss: 0.2118379160402769\n",
      "Validation Loss: 0.29518300756102517, Total Accuracy: 66.98%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 6.49%\n",
      "EarlyStopping counter: 16 out of 40\n",
      "Epoch 47, Loss: 0.21874947567661124\n",
      "Validation Loss: 0.3061004394576663, Total Accuracy: 66.82%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 5.95%\n",
      "EarlyStopping counter: 17 out of 40\n",
      "Epoch 48, Loss: 0.2106610555426184\n",
      "Validation Loss: 0.2929998032216515, Total Accuracy: 67.13%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 7.03%\n",
      "EarlyStopping counter: 18 out of 40\n",
      "Epoch 49, Loss: 0.20961954507483058\n",
      "Validation Loss: 0.3030187626857133, Total Accuracy: 66.82%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 5.95%\n",
      "EarlyStopping counter: 19 out of 40\n",
      "Epoch 50, Loss: 0.21055364303560142\n",
      "Validation Loss: 0.2957626116417703, Total Accuracy: 66.67%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 5.41%\n",
      "EarlyStopping counter: 20 out of 40\n",
      "Epoch 51, Loss: 0.2084256448300488\n",
      "Validation Loss: 0.30239521712064743, Total Accuracy: 66.51%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 4.86%\n",
      "EarlyStopping counter: 21 out of 40\n",
      "Epoch 52, Loss: 0.21143671627863345\n",
      "Validation Loss: 0.3206800671649121, Total Accuracy: 66.36%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 4.32%\n",
      "EarlyStopping counter: 22 out of 40\n",
      "Epoch 53, Loss: 0.20849190822925912\n",
      "Validation Loss: 0.30355763905459926, Total Accuracy: 66.36%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 4.32%\n",
      "EarlyStopping counter: 23 out of 40\n",
      "Epoch 54, Loss: 0.2079949008233576\n",
      "Validation Loss: 0.29640927183486165, Total Accuracy: 66.98%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 6.49%\n",
      "EarlyStopping counter: 24 out of 40\n",
      "Epoch 55, Loss: 0.21038516153054065\n",
      "Validation Loss: 0.3043439667671919, Total Accuracy: 66.51%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 4.86%\n",
      "EarlyStopping counter: 25 out of 40\n",
      "Epoch 56, Loss: 0.20734692472650343\n",
      "Validation Loss: 0.2937771050880353, Total Accuracy: 67.44%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 8.11%\n",
      "EarlyStopping counter: 26 out of 40\n",
      "Epoch 57, Loss: 0.20711015784237757\n",
      "Validation Loss: 0.3007390443235636, Total Accuracy: 65.90%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 2.70%\n",
      "EarlyStopping counter: 27 out of 40\n",
      "Epoch 58, Loss: 0.20666329257459526\n",
      "Validation Loss: 0.295422074872823, Total Accuracy: 66.20%\n",
      "Accuracy per class - G1: 0.00%, G2: 99.53%, G3: 4.86%\n",
      "EarlyStopping counter: 28 out of 40\n",
      "Epoch 59, Loss: 0.2094707239464105\n",
      "Validation Loss: 0.3053186350457725, Total Accuracy: 65.59%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 1.62%\n",
      "EarlyStopping counter: 29 out of 40\n",
      "Epoch 60, Loss: 0.20612020754670524\n",
      "Validation Loss: 0.28084468389196054, Total Accuracy: 66.67%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 5.41%\n",
      "Validation loss decreased (5.910046 --> 5.897738).  Saving model ...\n",
      "Epoch 61, Loss: 0.2076469907559544\n",
      "Validation Loss: 0.2953144572675228, Total Accuracy: 66.67%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 5.41%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 62, Loss: 0.20699425831616644\n",
      "Validation Loss: 0.3042416142388469, Total Accuracy: 66.36%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 4.32%\n",
      "EarlyStopping counter: 2 out of 40\n",
      "Epoch 63, Loss: 0.20464631161057806\n",
      "Validation Loss: 0.3027123795556171, Total Accuracy: 66.67%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 5.41%\n",
      "EarlyStopping counter: 3 out of 40\n",
      "Epoch 64, Loss: 0.2061248550034431\n",
      "Validation Loss: 0.30862601810977575, Total Accuracy: 66.20%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 3.78%\n",
      "EarlyStopping counter: 4 out of 40\n",
      "Epoch 65, Loss: 0.2066929246108216\n",
      "Validation Loss: 0.29078743872897966, Total Accuracy: 67.59%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 8.65%\n",
      "EarlyStopping counter: 5 out of 40\n",
      "Epoch 66, Loss: 0.2052641866436924\n",
      "Validation Loss: 0.30307909402818906, Total Accuracy: 66.98%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 6.49%\n",
      "EarlyStopping counter: 6 out of 40\n",
      "Epoch 67, Loss: 0.20720779689320598\n",
      "Validation Loss: 0.3027090322935865, Total Accuracy: 66.51%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 4.86%\n",
      "EarlyStopping counter: 7 out of 40\n",
      "Epoch 68, Loss: 0.2056924317436046\n",
      "Validation Loss: 0.285420327846493, Total Accuracy: 67.13%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 7.03%\n",
      "EarlyStopping counter: 8 out of 40\n",
      "Epoch 69, Loss: 0.2087707379496241\n",
      "Validation Loss: 0.2944170222395942, Total Accuracy: 66.51%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 4.86%\n",
      "EarlyStopping counter: 9 out of 40\n",
      "Epoch 70, Loss: 0.2050257146538022\n",
      "Validation Loss: 0.2964923483807416, Total Accuracy: 66.82%\n",
      "Accuracy per class - G1: 0.00%, G2: 99.76%, G3: 6.49%\n",
      "EarlyStopping counter: 10 out of 40\n",
      "Epoch 71, Loss: 0.20421629668359298\n",
      "Validation Loss: 0.29358172913392383, Total Accuracy: 67.59%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 8.65%\n",
      "EarlyStopping counter: 11 out of 40\n",
      "Epoch 72, Loss: 0.20417342487587986\n",
      "Validation Loss: 0.29280427701416467, Total Accuracy: 66.51%\n",
      "Accuracy per class - G1: 0.00%, G2: 99.53%, G3: 5.95%\n",
      "EarlyStopping counter: 12 out of 40\n",
      "Epoch 73, Loss: 0.2042909688260182\n",
      "Validation Loss: 0.29682673717893304, Total Accuracy: 65.74%\n",
      "Accuracy per class - G1: 0.00%, G2: 99.76%, G3: 2.70%\n",
      "EarlyStopping counter: 13 out of 40\n",
      "Epoch 74, Loss: 0.20125199441450187\n",
      "Validation Loss: 0.2971840902630772, Total Accuracy: 66.36%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 4.32%\n",
      "EarlyStopping counter: 14 out of 40\n",
      "Epoch 75, Loss: 0.20304734565048332\n",
      "Validation Loss: 0.2994143819170339, Total Accuracy: 66.51%\n",
      "Accuracy per class - G1: 0.00%, G2: 99.76%, G3: 5.41%\n",
      "EarlyStopping counter: 15 out of 40\n",
      "Epoch 76, Loss: 0.2021274264138865\n",
      "Validation Loss: 0.298521481365675, Total Accuracy: 66.36%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 4.32%\n",
      "EarlyStopping counter: 16 out of 40\n",
      "Epoch 77, Loss: 0.20260154114789272\n",
      "Validation Loss: 0.29399406022968744, Total Accuracy: 66.98%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 6.49%\n",
      "EarlyStopping counter: 17 out of 40\n",
      "Epoch 78, Loss: 0.2017414153340351\n",
      "Validation Loss: 0.3089282950829892, Total Accuracy: 65.90%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 2.70%\n",
      "EarlyStopping counter: 18 out of 40\n",
      "Epoch 79, Loss: 0.20478131370731148\n",
      "Validation Loss: 0.29400281980633736, Total Accuracy: 67.13%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 7.03%\n",
      "EarlyStopping counter: 19 out of 40\n",
      "Epoch 80, Loss: 0.19960958052830524\n",
      "Validation Loss: 0.30031652464753106, Total Accuracy: 66.36%\n",
      "Accuracy per class - G1: 0.00%, G2: 99.76%, G3: 4.86%\n",
      "EarlyStopping counter: 20 out of 40\n",
      "Epoch 81, Loss: 0.20264801706176205\n",
      "Validation Loss: 0.29746909874180955, Total Accuracy: 66.36%\n",
      "Accuracy per class - G1: 0.00%, G2: 99.53%, G3: 5.41%\n",
      "EarlyStopping counter: 21 out of 40\n",
      "Epoch 82, Loss: 0.2020156953528703\n",
      "Validation Loss: 0.29223143673014074, Total Accuracy: 66.67%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 5.41%\n",
      "EarlyStopping counter: 22 out of 40\n",
      "Epoch 83, Loss: 0.2027748245072652\n",
      "Validation Loss: 0.30249257093029364, Total Accuracy: 66.05%\n",
      "Accuracy per class - G1: 0.00%, G2: 99.05%, G3: 5.41%\n",
      "EarlyStopping counter: 23 out of 40\n",
      "Epoch 84, Loss: 0.19896890824458685\n",
      "Validation Loss: 0.29373518954075517, Total Accuracy: 67.13%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 7.03%\n",
      "EarlyStopping counter: 24 out of 40\n",
      "Epoch 85, Loss: 0.20140938550592904\n",
      "Validation Loss: 0.3086481520994788, Total Accuracy: 65.90%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 2.70%\n",
      "EarlyStopping counter: 25 out of 40\n",
      "Epoch 86, Loss: 0.1994824325104794\n",
      "Validation Loss: 0.28309946320950985, Total Accuracy: 66.98%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 6.49%\n",
      "EarlyStopping counter: 26 out of 40\n",
      "Epoch 87, Loss: 0.1972737583410309\n",
      "Validation Loss: 0.29907064397065414, Total Accuracy: 67.44%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 8.11%\n",
      "EarlyStopping counter: 27 out of 40\n",
      "Epoch 88, Loss: 0.1989078453506332\n",
      "Validation Loss: 0.3049642883595966, Total Accuracy: 66.20%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 3.78%\n",
      "EarlyStopping counter: 28 out of 40\n",
      "Epoch 89, Loss: 0.2016432305057365\n",
      "Validation Loss: 0.30519383688945145, Total Accuracy: 65.90%\n",
      "Accuracy per class - G1: 0.00%, G2: 99.76%, G3: 3.24%\n",
      "EarlyStopping counter: 29 out of 40\n",
      "Epoch 90, Loss: 0.20164375976625695\n",
      "Validation Loss: 0.29062640356520814, Total Accuracy: 66.36%\n",
      "Accuracy per class - G1: 0.00%, G2: 99.53%, G3: 5.41%\n",
      "EarlyStopping counter: 30 out of 40\n",
      "Epoch 91, Loss: 0.20343764664897\n",
      "Validation Loss: 0.3103346446795123, Total Accuracy: 66.36%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 4.32%\n",
      "EarlyStopping counter: 31 out of 40\n",
      "Epoch 92, Loss: 0.1971449516264789\n",
      "Validation Loss: 0.2996492062118791, Total Accuracy: 66.82%\n",
      "Accuracy per class - G1: 0.00%, G2: 99.76%, G3: 6.49%\n",
      "EarlyStopping counter: 32 out of 40\n",
      "Epoch 93, Loss: 0.20066728900714093\n",
      "Validation Loss: 0.29599387145468165, Total Accuracy: 66.67%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 5.41%\n",
      "EarlyStopping counter: 33 out of 40\n",
      "Epoch 94, Loss: 0.1957018901425672\n",
      "Validation Loss: 0.2865766670022692, Total Accuracy: 67.59%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 8.65%\n",
      "EarlyStopping counter: 34 out of 40\n",
      "Epoch 95, Loss: 0.20345828637301203\n",
      "Validation Loss: 0.3023835550106707, Total Accuracy: 66.36%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 4.32%\n",
      "EarlyStopping counter: 35 out of 40\n",
      "Epoch 96, Loss: 0.19718645791332406\n",
      "Validation Loss: 0.30860075097353684, Total Accuracy: 66.51%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 4.86%\n",
      "EarlyStopping counter: 36 out of 40\n",
      "Epoch 97, Loss: 0.19835509943315782\n",
      "Validation Loss: 0.2989233772137335, Total Accuracy: 66.67%\n",
      "Accuracy per class - G1: 0.00%, G2: 99.76%, G3: 5.95%\n",
      "EarlyStopping counter: 37 out of 40\n",
      "Epoch 98, Loss: 0.20043945213757366\n",
      "Validation Loss: 0.29022177761154516, Total Accuracy: 66.20%\n",
      "Accuracy per class - G1: 0.00%, G2: 99.29%, G3: 5.41%\n",
      "EarlyStopping counter: 38 out of 40\n",
      "Epoch 99, Loss: 0.19779199559286417\n",
      "Validation Loss: 0.3135417103767395, Total Accuracy: 66.36%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 4.32%\n",
      "EarlyStopping counter: 39 out of 40\n",
      "Epoch 100, Loss: 0.19248235360326538\n",
      "Validation Loss: 0.29343122749456335, Total Accuracy: 67.44%\n",
      "Accuracy per class - G1: 0.00%, G2: 100.00%, G3: 8.11%\n",
      "EarlyStopping counter: 40 out of 40\n",
      "Early stopping\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\u001b[34m\u001b[1mwandb\u001b[0m:                                                                                \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run history:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run summary:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc 0\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc 48.78049\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc 100\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc 98.79081\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc 8.10811\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc 19.57105\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy 67.43827\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy 71.8065\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss 0.19248\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss 0.29343\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View run \u001b[33m1optuna_run_17 microsoft/resnet-18 Frozen Layers Nooversampling Focallo18\u001b[0m at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/cvkin6pz\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View project at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Synced 5 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Find logs at: \u001b[35m\u001b[1m./wandb/run-20241009_230438-cvkin6pz/logs\u001b[0m\n",
      "[I 2024-10-09 23:51:25,024] Trial 17 finished with value: 0.31396825396825395 and parameters: {'weight_decay': 1.135742424497311e-06, 'focal_loss': 2.484510733897033}. Best is trial 17 with value: 0.31396825396825395.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Tracking run with wandb version 0.18.3\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run data is saved locally in \u001b[35m\u001b[1m/kaggle/working/wandb/run-20241009_235125-c4rcuu42\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run \u001b[1m`wandb offline`\u001b[0m to turn off syncing.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Syncing run \u001b[33m1optuna_run_18 microsoft/resnet-18 Frozen Layers Nooversampling Focallo19\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View project at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View run at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/c4rcuu42\u001b[0m\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Epoch 1, Loss: 0.7457466506096254\n",
      "Validation Loss: 0.8739271926737967, Total Accuracy: 10.49%\n",
      "Accuracy per class - G1: 97.56%, G2: 4.98%, G3: 3.78%\n",
      "Validation loss decreased (inf --> 18.352471).  Saving model ...\n",
      "Epoch 2, Loss: 0.7366699088050659\n",
      "Validation Loss: 0.8662251184384028, Total Accuracy: 10.34%\n",
      "Accuracy per class - G1: 100.00%, G2: 5.92%, G3: 0.54%\n",
      "Validation loss decreased (18.352471 --> 18.190727).  Saving model ...\n",
      "Epoch 3, Loss: 0.720482441316168\n",
      "Validation Loss: 0.8887066401186443, Total Accuracy: 9.88%\n",
      "Accuracy per class - G1: 100.00%, G2: 5.21%, G3: 0.54%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 4, Loss: 0.711344789309674\n",
      "Validation Loss: 0.9230538847900572, Total Accuracy: 9.10%\n",
      "Accuracy per class - G1: 100.00%, G2: 4.03%, G3: 0.54%\n",
      "EarlyStopping counter: 2 out of 40\n",
      "Epoch 5, Loss: 0.692296578941575\n",
      "Validation Loss: 0.8906203430323374, Total Accuracy: 10.03%\n",
      "Accuracy per class - G1: 100.00%, G2: 5.21%, G3: 1.08%\n",
      "EarlyStopping counter: 3 out of 40\n",
      "Epoch 6, Loss: 0.6885715988745172\n",
      "Validation Loss: 0.9277537578628177, Total Accuracy: 9.72%\n",
      "Accuracy per class - G1: 100.00%, G2: 4.98%, G3: 0.54%\n",
      "EarlyStopping counter: 4 out of 40\n",
      "Epoch 7, Loss: 0.6693404891404761\n",
      "Validation Loss: 0.9414654551517396, Total Accuracy: 8.18%\n",
      "Accuracy per class - G1: 100.00%, G2: 2.37%, G3: 1.08%\n",
      "EarlyStopping counter: 5 out of 40\n",
      "Epoch 8, Loss: 0.6720477902745626\n",
      "Validation Loss: 0.914405807143166, Total Accuracy: 8.64%\n",
      "Accuracy per class - G1: 95.12%, G2: 3.32%, G3: 1.62%\n",
      "EarlyStopping counter: 6 out of 40\n",
      "Epoch 9, Loss: 0.6541896096195083\n",
      "Validation Loss: 0.9656322931959516, Total Accuracy: 8.49%\n",
      "Accuracy per class - G1: 100.00%, G2: 2.84%, G3: 1.08%\n",
      "EarlyStopping counter: 7 out of 40\n",
      "Epoch 10, Loss: 0.6482785272311016\n",
      "Validation Loss: 0.9487377667710895, Total Accuracy: 8.64%\n",
      "Accuracy per class - G1: 100.00%, G2: 3.32%, G3: 0.54%\n",
      "EarlyStopping counter: 8 out of 40\n",
      "Epoch 11, Loss: 0.6317039530679404\n",
      "Validation Loss: 0.9260094481564703, Total Accuracy: 8.18%\n",
      "Accuracy per class - G1: 97.56%, G2: 2.61%, G3: 1.08%\n",
      "EarlyStopping counter: 9 out of 40\n",
      "Epoch 12, Loss: 0.6270063023969351\n",
      "Validation Loss: 0.9673827123783884, Total Accuracy: 7.41%\n",
      "Accuracy per class - G1: 100.00%, G2: 1.42%, G3: 0.54%\n",
      "EarlyStopping counter: 10 out of 40\n",
      "Epoch 13, Loss: 0.6172772013997457\n",
      "Validation Loss: 0.9433099499770573, Total Accuracy: 7.87%\n",
      "Accuracy per class - G1: 100.00%, G2: 1.66%, G3: 1.62%\n",
      "EarlyStopping counter: 11 out of 40\n",
      "Epoch 14, Loss: 0.6074624747396952\n",
      "Validation Loss: 0.9678351577548754, Total Accuracy: 8.64%\n",
      "Accuracy per class - G1: 97.56%, G2: 2.84%, G3: 2.16%\n",
      "EarlyStopping counter: 12 out of 40\n",
      "Epoch 15, Loss: 0.6011632451091904\n",
      "Validation Loss: 0.9963836861508233, Total Accuracy: 7.10%\n",
      "Accuracy per class - G1: 100.00%, G2: 0.47%, G3: 1.62%\n",
      "EarlyStopping counter: 13 out of 40\n",
      "Epoch 16, Loss: 0.598179383809308\n",
      "Validation Loss: 0.9440380920256887, Total Accuracy: 7.41%\n",
      "Accuracy per class - G1: 97.56%, G2: 1.66%, G3: 0.54%\n",
      "EarlyStopping counter: 14 out of 40\n",
      "Epoch 17, Loss: 0.5818020349525543\n",
      "Validation Loss: 1.0095941864308857, Total Accuracy: 7.10%\n",
      "Accuracy per class - G1: 97.56%, G2: 0.71%, G3: 1.62%\n",
      "EarlyStopping counter: 15 out of 40\n",
      "Epoch 18, Loss: 0.5764000476842903\n",
      "Validation Loss: 1.0287423077083768, Total Accuracy: 6.94%\n",
      "Accuracy per class - G1: 92.68%, G2: 1.42%, G3: 0.54%\n",
      "EarlyStopping counter: 16 out of 40\n",
      "Epoch 19, Loss: 0.5707108680024204\n",
      "Validation Loss: 1.0219189879440127, Total Accuracy: 7.56%\n",
      "Accuracy per class - G1: 97.56%, G2: 1.66%, G3: 1.08%\n",
      "EarlyStopping counter: 17 out of 40\n",
      "Epoch 20, Loss: 0.5672632886702755\n",
      "Validation Loss: 1.0011938278164183, Total Accuracy: 7.25%\n",
      "Accuracy per class - G1: 95.12%, G2: 1.42%, G3: 1.08%\n",
      "EarlyStopping counter: 18 out of 40\n",
      "Epoch 21, Loss: 0.5529140036508261\n",
      "Validation Loss: 1.0093154595011757, Total Accuracy: 7.41%\n",
      "Accuracy per class - G1: 90.24%, G2: 1.66%, G3: 2.16%\n",
      "EarlyStopping counter: 19 out of 40\n",
      "Epoch 22, Loss: 0.551331280584795\n",
      "Validation Loss: 1.0382541478389786, Total Accuracy: 7.10%\n",
      "Accuracy per class - G1: 97.56%, G2: 1.18%, G3: 0.54%\n",
      "EarlyStopping counter: 20 out of 40\n",
      "Epoch 23, Loss: 0.5362065129251365\n",
      "Validation Loss: 1.0319730256284987, Total Accuracy: 7.56%\n",
      "Accuracy per class - G1: 100.00%, G2: 1.42%, G3: 1.08%\n",
      "EarlyStopping counter: 21 out of 40\n",
      "Epoch 24, Loss: 0.5440015760530909\n",
      "Validation Loss: 1.0143817116816838, Total Accuracy: 7.56%\n",
      "Accuracy per class - G1: 97.56%, G2: 1.90%, G3: 0.54%\n",
      "EarlyStopping counter: 22 out of 40\n",
      "Epoch 25, Loss: 0.5389454048800181\n",
      "Validation Loss: 1.0218407050484704, Total Accuracy: 7.56%\n",
      "Accuracy per class - G1: 97.56%, G2: 2.13%, G3: 0.00%\n",
      "EarlyStopping counter: 23 out of 40\n",
      "Epoch 26, Loss: 0.5362537320119789\n",
      "Validation Loss: 1.052656257436389, Total Accuracy: 7.10%\n",
      "Accuracy per class - G1: 97.56%, G2: 1.42%, G3: 0.00%\n",
      "EarlyStopping counter: 24 out of 40\n",
      "Epoch 27, Loss: 0.5303015310362161\n",
      "Validation Loss: 1.0136419836254347, Total Accuracy: 7.25%\n",
      "Accuracy per class - G1: 92.68%, G2: 1.90%, G3: 0.54%\n",
      "EarlyStopping counter: 25 out of 40\n",
      "Epoch 28, Loss: 0.5266657424978463\n",
      "Validation Loss: 1.0216612893910635, Total Accuracy: 7.10%\n",
      "Accuracy per class - G1: 97.56%, G2: 1.42%, G3: 0.00%\n",
      "EarlyStopping counter: 26 out of 40\n",
      "Epoch 29, Loss: 0.524715838662113\n",
      "Validation Loss: 0.9811385926746187, Total Accuracy: 7.72%\n",
      "Accuracy per class - G1: 92.68%, G2: 2.84%, G3: 0.00%\n",
      "EarlyStopping counter: 27 out of 40\n",
      "Epoch 30, Loss: 0.5264952728547245\n",
      "Validation Loss: 1.0345799383662997, Total Accuracy: 8.02%\n",
      "Accuracy per class - G1: 97.56%, G2: 2.61%, G3: 0.54%\n",
      "EarlyStopping counter: 28 out of 40\n",
      "Epoch 31, Loss: 0.5279117679021444\n",
      "Validation Loss: 1.0262024799982707, Total Accuracy: 8.02%\n",
      "Accuracy per class - G1: 97.56%, G2: 2.61%, G3: 0.54%\n",
      "EarlyStopping counter: 29 out of 40\n",
      "Epoch 32, Loss: 0.524245850293033\n",
      "Validation Loss: 1.0527362003922462, Total Accuracy: 6.79%\n",
      "Accuracy per class - G1: 92.68%, G2: 0.95%, G3: 1.08%\n",
      "EarlyStopping counter: 30 out of 40\n",
      "Epoch 33, Loss: 0.5239602880305555\n",
      "Validation Loss: 1.037424049561932, Total Accuracy: 8.02%\n",
      "Accuracy per class - G1: 95.12%, G2: 2.84%, G3: 0.54%\n",
      "EarlyStopping counter: 31 out of 40\n",
      "Epoch 34, Loss: 0.5158197100622108\n",
      "Validation Loss: 1.0281506407828558, Total Accuracy: 7.56%\n",
      "Accuracy per class - G1: 100.00%, G2: 1.90%, G3: 0.00%\n",
      "EarlyStopping counter: 32 out of 40\n",
      "Epoch 35, Loss: 0.5175610586821314\n",
      "Validation Loss: 1.068734497541473, Total Accuracy: 7.41%\n",
      "Accuracy per class - G1: 97.56%, G2: 1.66%, G3: 0.54%\n",
      "EarlyStopping counter: 33 out of 40\n",
      "Epoch 36, Loss: 0.520263852484255\n",
      "Validation Loss: 1.076331187571798, Total Accuracy: 8.64%\n",
      "Accuracy per class - G1: 100.00%, G2: 3.32%, G3: 0.54%\n",
      "EarlyStopping counter: 34 out of 40\n",
      "Epoch 37, Loss: 0.5135580746524305\n",
      "Validation Loss: 1.059686321233, Total Accuracy: 7.25%\n",
      "Accuracy per class - G1: 97.56%, G2: 1.66%, G3: 0.00%\n",
      "EarlyStopping counter: 35 out of 40\n",
      "Epoch 38, Loss: 0.5115957608424038\n",
      "Validation Loss: 1.0134409098398118, Total Accuracy: 7.41%\n",
      "Accuracy per class - G1: 92.68%, G2: 2.37%, G3: 0.00%\n",
      "EarlyStopping counter: 36 out of 40\n",
      "Epoch 39, Loss: 0.5131345495402094\n",
      "Validation Loss: 1.057869292086079, Total Accuracy: 7.41%\n",
      "Accuracy per class - G1: 100.00%, G2: 1.66%, G3: 0.00%\n",
      "EarlyStopping counter: 37 out of 40\n",
      "Epoch 40, Loss: 0.5147201903613217\n",
      "Validation Loss: 1.0249948820897512, Total Accuracy: 7.56%\n",
      "Accuracy per class - G1: 97.56%, G2: 2.13%, G3: 0.00%\n",
      "EarlyStopping counter: 38 out of 40\n",
      "Epoch 41, Loss: 0.5113452680139656\n",
      "Validation Loss: 1.042096774492945, Total Accuracy: 7.87%\n",
      "Accuracy per class - G1: 95.12%, G2: 2.61%, G3: 0.54%\n",
      "EarlyStopping counter: 39 out of 40\n",
      "Epoch 42, Loss: 0.514085482042956\n",
      "Validation Loss: 1.0194979121997243, Total Accuracy: 8.18%\n",
      "Accuracy per class - G1: 95.12%, G2: 2.84%, G3: 1.08%\n",
      "EarlyStopping counter: 40 out of 40\n",
      "Early stopping\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\u001b[34m\u001b[1mwandb\u001b[0m:                                                                                \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run history:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run summary:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc 95.12195\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc 99.18699\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc 2.8436\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc 9.12938\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc 1.08108\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc 25.73727\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy 8.17901\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy 22.18443\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss 0.51409\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss 1.0195\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View run \u001b[33m1optuna_run_18 microsoft/resnet-18 Frozen Layers Nooversampling Focallo19\u001b[0m at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/c4rcuu42\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View project at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Synced 5 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Find logs at: \u001b[35m\u001b[1m./wandb/run-20241009_235125-c4rcuu42/logs\u001b[0m\n",
      "[I 2024-10-10 00:10:22,268] Trial 18 finished with value: 0.057882056325357416 and parameters: {'weight_decay': 1.2055749379989824e-06, 'focal_loss': 2.482463879755223}. Best is trial 17 with value: 0.31396825396825395.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Tracking run with wandb version 0.18.3\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run data is saved locally in \u001b[35m\u001b[1m/kaggle/working/wandb/run-20241010_001022-9we7vsvd\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run \u001b[1m`wandb offline`\u001b[0m to turn off syncing.\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Syncing run \u001b[33m1optuna_run_19 microsoft/resnet-18 Frozen Layers Nooversampling Focallo20\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View project at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View run at \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/9we7vsvd\u001b[0m\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Epoch 1, Loss: 0.6525162839027773\n",
      "Validation Loss: 0.8535105302220299, Total Accuracy: 20.22%\n",
      "Accuracy per class - G1: 0.00%, G2: 4.98%, G3: 59.46%\n",
      "Validation loss decreased (inf --> 17.923721).  Saving model ...\n",
      "Epoch 2, Loss: 0.6280879572213415\n",
      "Validation Loss: 0.8203427209740594, Total Accuracy: 22.22%\n",
      "Accuracy per class - G1: 0.00%, G2: 6.87%, G3: 62.16%\n",
      "Validation loss decreased (17.923721 --> 17.227197).  Saving model ...\n",
      "Epoch 3, Loss: 0.6107850735446057\n",
      "Validation Loss: 0.8323897634233747, Total Accuracy: 21.60%\n",
      "Accuracy per class - G1: 0.00%, G2: 7.11%, G3: 59.46%\n",
      "EarlyStopping counter: 1 out of 40\n",
      "Epoch 4, Loss: 0.6059433264904711\n",
      "Validation Loss: 0.8928558500040145, Total Accuracy: 20.37%\n",
      "Accuracy per class - G1: 0.00%, G2: 4.74%, G3: 60.54%\n",
      "EarlyStopping counter: 2 out of 40\n",
      "Epoch 5, Loss: 0.5844773668122579\n",
      "Validation Loss: 0.8370761473973592, Total Accuracy: 19.75%\n",
      "Accuracy per class - G1: 0.00%, G2: 7.11%, G3: 52.97%\n",
      "EarlyStopping counter: 3 out of 40\n",
      "Epoch 6, Loss: 0.5795679293483137\n",
      "Validation Loss: 0.8527731639998299, Total Accuracy: 20.52%\n",
      "Accuracy per class - G1: 0.00%, G2: 5.21%, G3: 60.00%\n",
      "EarlyStopping counter: 4 out of 40\n",
      "Epoch 7, Loss: 0.5606719251856747\n",
      "Validation Loss: 0.8533261304809934, Total Accuracy: 20.52%\n",
      "Accuracy per class - G1: 0.00%, G2: 4.50%, G3: 61.62%\n",
      "EarlyStopping counter: 5 out of 40\n",
      "Epoch 8, Loss: 0.550733644919223\n",
      "Validation Loss: 0.8922847807407379, Total Accuracy: 22.38%\n",
      "Accuracy per class - G1: 0.00%, G2: 3.32%, G3: 70.81%\n",
      "EarlyStopping counter: 6 out of 40\n",
      "Epoch 9, Loss: 0.5419615787195872\n",
      "Validation Loss: 0.8558761520045144, Total Accuracy: 22.07%\n",
      "Accuracy per class - G1: 0.00%, G2: 4.27%, G3: 67.57%\n",
      "EarlyStopping counter: 7 out of 40\n",
      "Epoch 10, Loss: 0.5321640914463135\n",
      "Validation Loss: 0.8881093050752368, Total Accuracy: 22.69%\n",
      "Accuracy per class - G1: 0.00%, G2: 3.79%, G3: 70.81%\n",
      "EarlyStopping counter: 8 out of 40\n",
      "Epoch 11, Loss: 0.5235479714640652\n",
      "Validation Loss: 0.9015366548583621, Total Accuracy: 19.44%\n",
      "Accuracy per class - G1: 0.00%, G2: 4.27%, G3: 58.38%\n",
      "EarlyStopping counter: 9 out of 40\n",
      "Epoch 12, Loss: 0.5184189623378845\n",
      "Validation Loss: 0.8694386851219904, Total Accuracy: 20.99%\n",
      "Accuracy per class - G1: 0.00%, G2: 4.98%, G3: 62.16%\n",
      "EarlyStopping counter: 10 out of 40\n",
      "Epoch 13, Loss: 0.5073741728282837\n",
      "Validation Loss: 0.9145914245219458, Total Accuracy: 22.38%\n",
      "Accuracy per class - G1: 0.00%, G2: 4.27%, G3: 68.65%\n",
      "EarlyStopping counter: 11 out of 40\n",
      "Epoch 14, Loss: 0.5002336160964277\n",
      "Validation Loss: 0.916836801029387, Total Accuracy: 22.84%\n",
      "Accuracy per class - G1: 0.00%, G2: 3.79%, G3: 71.35%\n",
      "EarlyStopping counter: 12 out of 40\n",
      "Epoch 15, Loss: 0.4899422429412244\n",
      "Validation Loss: 0.9341550639697483, Total Accuracy: 22.69%\n",
      "Accuracy per class - G1: 0.00%, G2: 5.69%, G3: 66.49%\n",
      "EarlyStopping counter: 13 out of 40\n",
      "Epoch 16, Loss: 0.47814654693546066\n",
      "Validation Loss: 0.9013340288684482, Total Accuracy: 21.60%\n",
      "Accuracy per class - G1: 0.00%, G2: 2.84%, G3: 69.19%\n",
      "EarlyStopping counter: 14 out of 40\n",
      "Epoch 17, Loss: 0.4746449119355305\n",
      "Validation Loss: 0.900775018192473, Total Accuracy: 21.60%\n",
      "Accuracy per class - G1: 0.00%, G2: 2.84%, G3: 69.19%\n",
      "EarlyStopping counter: 15 out of 40\n",
      "Epoch 18, Loss: 0.46541065839399776\n",
      "Validation Loss: 0.9581819446313948, Total Accuracy: 22.38%\n",
      "Accuracy per class - G1: 0.00%, G2: 3.32%, G3: 70.81%\n",
      "EarlyStopping counter: 16 out of 40\n",
      "Epoch 19, Loss: 0.45974111197942713\n",
      "Validation Loss: 0.940530654929933, Total Accuracy: 23.15%\n",
      "Accuracy per class - G1: 0.00%, G2: 5.21%, G3: 69.19%\n",
      "EarlyStopping counter: 17 out of 40\n",
      "Epoch 20, Loss: 0.4570728084409093\n",
      "Validation Loss: 0.9213111656052726, Total Accuracy: 21.91%\n",
      "Accuracy per class - G1: 0.00%, G2: 4.03%, G3: 67.57%\n",
      "EarlyStopping counter: 18 out of 40\n",
      "Epoch 21, Loss: 0.45077496048915816\n",
      "Validation Loss: 0.9574275243849981, Total Accuracy: 23.46%\n",
      "Accuracy per class - G1: 0.00%, G2: 3.55%, G3: 74.05%\n",
      "EarlyStopping counter: 19 out of 40\n",
      "Epoch 22, Loss: 0.4375382378158799\n",
      "Validation Loss: 0.9583694097541627, Total Accuracy: 21.91%\n",
      "Accuracy per class - G1: 0.00%, G2: 3.55%, G3: 68.65%\n",
      "EarlyStopping counter: 20 out of 40\n",
      "Epoch 23, Loss: 0.43420279492814856\n",
      "Validation Loss: 0.9472191802092961, Total Accuracy: 22.38%\n",
      "Accuracy per class - G1: 0.00%, G2: 3.32%, G3: 70.81%\n",
      "EarlyStopping counter: 21 out of 40\n",
      "Epoch 24, Loss: 0.42973190007439577\n",
      "Validation Loss: 0.9411735321794238, Total Accuracy: 20.83%\n",
      "Accuracy per class - G1: 0.00%, G2: 4.27%, G3: 63.24%\n",
      "EarlyStopping counter: 22 out of 40\n",
      "Epoch 25, Loss: 0.4301497605909784\n",
      "Validation Loss: 0.9852757964815412, Total Accuracy: 22.99%\n",
      "Accuracy per class - G1: 0.00%, G2: 3.79%, G3: 71.89%\n",
      "EarlyStopping counter: 23 out of 40\n",
      "Epoch 26, Loss: 0.424104886241706\n",
      "Validation Loss: 0.940701078800928, Total Accuracy: 23.30%\n",
      "Accuracy per class - G1: 0.00%, G2: 3.79%, G3: 72.97%\n",
      "EarlyStopping counter: 24 out of 40\n",
      "Epoch 27, Loss: 0.42661659042519257\n",
      "Validation Loss: 0.973818282286326, Total Accuracy: 22.84%\n",
      "Accuracy per class - G1: 0.00%, G2: 4.03%, G3: 70.81%\n",
      "EarlyStopping counter: 25 out of 40\n",
      "Epoch 28, Loss: 0.42380710933581894\n",
      "Validation Loss: 1.0197627885001046, Total Accuracy: 22.38%\n",
      "Accuracy per class - G1: 0.00%, G2: 4.27%, G3: 68.65%\n",
      "EarlyStopping counter: 26 out of 40\n",
      "Epoch 29, Loss: 0.4217014862112252\n",
      "Validation Loss: 0.9817217176868802, Total Accuracy: 21.45%\n",
      "Accuracy per class - G1: 0.00%, G2: 4.50%, G3: 64.86%\n",
      "EarlyStopping counter: 27 out of 40\n",
      "Epoch 30, Loss: 0.42024588908057614\n",
      "Validation Loss: 0.9812181194623312, Total Accuracy: 25.31%\n",
      "Accuracy per class - G1: 0.00%, G2: 5.69%, G3: 75.68%\n",
      "EarlyStopping counter: 28 out of 40\n",
      "Epoch 31, Loss: 0.42633347805724087\n",
      "Validation Loss: 0.9615047261828468, Total Accuracy: 22.53%\n",
      "Accuracy per class - G1: 0.00%, G2: 3.79%, G3: 70.27%\n",
      "EarlyStopping counter: 29 out of 40\n",
      "Epoch 32, Loss: 0.418223419821406\n",
      "Validation Loss: 0.9889218126024518, Total Accuracy: 23.30%\n",
      "Accuracy per class - G1: 0.00%, G2: 4.50%, G3: 71.35%\n",
      "EarlyStopping counter: 30 out of 40\n",
      "Epoch 33, Loss: 0.4134353025850043\n",
      "Validation Loss: 0.9500085243156978, Total Accuracy: 21.91%\n",
      "Accuracy per class - G1: 0.00%, G2: 4.27%, G3: 67.03%\n",
      "EarlyStopping counter: 31 out of 40\n",
      "Epoch 34, Loss: 0.41765564608286665\n",
      "Validation Loss: 0.9804789807115283, Total Accuracy: 22.22%\n",
      "Accuracy per class - G1: 0.00%, G2: 3.79%, G3: 69.19%\n",
      "EarlyStopping counter: 32 out of 40\n",
      "Epoch 35, Loss: 0.41176027957215366\n",
      "Validation Loss: 0.9992268667334602, Total Accuracy: 21.14%\n",
      "Accuracy per class - G1: 0.00%, G2: 3.55%, G3: 65.95%\n",
      "EarlyStopping counter: 33 out of 40\n",
      "Epoch 36, Loss: 0.4138369165271161\n",
      "Validation Loss: 0.9759247515882764, Total Accuracy: 23.15%\n",
      "Accuracy per class - G1: 0.00%, G2: 4.03%, G3: 71.89%\n",
      "EarlyStopping counter: 34 out of 40\n",
      "Epoch 37, Loss: 0.4153156804751201\n",
      "Validation Loss: 1.0151877843198323, Total Accuracy: 22.22%\n",
      "Accuracy per class - G1: 0.00%, G2: 4.74%, G3: 67.03%\n",
      "EarlyStopping counter: 35 out of 40\n",
      "Epoch 38, Loss: 0.4097993065075702\n",
      "Validation Loss: 0.9680769117105574, Total Accuracy: 22.99%\n",
      "Accuracy per class - G1: 0.00%, G2: 6.16%, G3: 66.49%\n",
      "EarlyStopping counter: 36 out of 40\n",
      "Epoch 39, Loss: 0.41330029124236967\n",
      "Validation Loss: 1.034852493376959, Total Accuracy: 23.77%\n",
      "Accuracy per class - G1: 0.00%, G2: 3.79%, G3: 74.59%\n",
      "EarlyStopping counter: 37 out of 40\n",
      "Epoch 40, Loss: 0.4058581335716937\n",
      "Validation Loss: 0.9761762803509122, Total Accuracy: 22.53%\n",
      "Accuracy per class - G1: 0.00%, G2: 5.69%, G3: 65.95%\n",
      "EarlyStopping counter: 38 out of 40\n",
      "Epoch 41, Loss: 0.40690914514553117\n",
      "Validation Loss: 0.9805050463903517, Total Accuracy: 23.15%\n",
      "Accuracy per class - G1: 0.00%, G2: 5.21%, G3: 69.19%\n",
      "EarlyStopping counter: 39 out of 40\n",
      "Epoch 42, Loss: 0.40883198200938214\n",
      "Validation Loss: 0.9846601585547129, Total Accuracy: 22.69%\n",
      "Accuracy per class - G1: 0.00%, G2: 4.27%, G3: 69.73%\n",
      "EarlyStopping counter: 40 out of 40\n",
      "Early stopping\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\u001b[34m\u001b[1mwandb\u001b[0m:                                                                                \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run history:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Run summary:\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G1_Acc 0\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G1_TrainAcc 37.39837\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G2_Acc 4.2654\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G2_TrainAcc 35.79202\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:          G3_Acc 69.72973\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:     G3_TrainAcc 95.04021\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Total Accuracy 22.68519\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  Train Accuracy 52.6455\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:      Train loss 0.40883\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Validation Loss 0.98466\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: \n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View run \u001b[33m1optuna_run_19 microsoft/resnet-18 Frozen Layers Nooversampling Focallo20\u001b[0m at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training/runs/9we7vsvd\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m:  View project at: \u001b[34m\u001b[4mhttps://wandb.ai/pietro-caforio-politecnico-di-milano/optuna_unimodal_ct_training\u001b[0m\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Synced 5 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)\n",
      "\u001b[34m\u001b[1mwandb\u001b[0m: Find logs at: \u001b[35m\u001b[1m./wandb/run-20241010_001022-9we7vsvd/logs\u001b[0m\n",
      "[I 2024-10-10 00:29:23,439] Trial 19 finished with value: 0.15958644282343704 and parameters: {'weight_decay': 1.1389897447298304e-06, 'focal_loss': 1.6716284936902186}. Best is trial 17 with value: 0.31396825396825395.\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Best hyperparameters:  {'weight_decay': 1.135742424497311e-06, 'focal_loss': 2.484510733897033}\n"
     ]
    }
   ],
   "source": [
    "import optuna\n",
    "from optuna.trial import TrialState\n",
    "from torch.utils.data import DataLoader, Subset\n",
    "from collections import Counter \n",
    "from sklearn.metrics import f1_score\n",
    "from sklearn.model_selection import train_test_split\n",
    "#from optuna.integration.wandb import WeightsAndBiasesCallback\n",
    "\n",
    "# Define the objective function for Optuna\n",
    "def objective(trial):\n",
    "    # Suggest hyperparameters to be tuned by Optuna\n",
    "    config = {\n",
    "        \"learning_rate\": 1e-7,\n",
    "        \"weight_decay\": trial.suggest_float(\"weight_decay\", 5e-7, 5e-6, log=True),\n",
    "        \"reduce_lr_factor\": 0.25,\n",
    "        \"patience\": 20,\n",
    "        \"early_stop_patience\": 40,\n",
    "        \"focal_loss\": trial.suggest_float(\"focal_loss\", 1.5, 2.5),  # Focal loss gamma can vary from 0 (CrossEntropy) to 5\n",
    "        \"epochs\": 600,  # Fixing the number of epochs to avoid very long runs\n",
    "        \"class_weights\": None,\n",
    "        \"run_name\": f\"1optuna_run_{trial.number} microsoft/resnet-18 Frozen Layers Nooversampling Focallos\",\n",
    "        \"architecture\": \"microsoft/resnet-18\",\n",
    "        \"augmentation\": False\n",
    "    }\n",
    "\n",
    "    # Use k-fold cross-validation\n",
    "    k_folds = 5 #In order to obtain a split of 20-80\n",
    "    batch_size = 32\n",
    "\n",
    "    # Initialize the k-fold cross-validation\n",
    "    #I'm forced to use this crossvalidation function because there's no other functions able to perform stratified and grouped train-test split\n",
    "    gkf = StratifiedGroupKFold(n_splits=k_folds)  \n",
    "    patient_ids = [info.split(\"/\")[0].split(\"_\")[0] for info in train_dataset.items]\n",
    "    labels = [train_dataset.labels[patient_id] for patient_id in patient_ids]\n",
    "    indices = list(range(len(patient_ids)))\n",
    "    \n",
    "    #train_indices, test_indices = train_test_split(\n",
    "    #    range(len(labels)),          # Indices of the dataset\n",
    "    #    test_size=0.2,                # Split ratio (e.g., 20% for testing)\n",
    "    #    stratify=labels,              # Use the labels for stratification\n",
    "    #    random_state=42               # For reproducibility\n",
    "    #)\n",
    "    \n",
    "        \n",
    "    train_indices, test_indices = next(gkf.split(indices, labels, groups=patient_ids))\n",
    "    val_scores = []\n",
    "    \n",
    "    \n",
    "    train_subset = Subset(train_dataset, train_indices)\n",
    "    val_subset = Subset(train_dataset, test_indices)\n",
    "    \n",
    "    subset_weights = []\n",
    "    sampler = None\n",
    "    \n",
    "    if config[\"augmentation\"]:\n",
    "        subset_weights = train_dataset.compute_subset_weights(train_indices)\n",
    "        # Create a sampler for the subset based on the calculated weights\n",
    "        sampler = WeightedRandomSampler(subset_weights, num_samples=len(subset_weights), replacement=True)\n",
    "    \n",
    "    train_loader = DataLoader(dataset=train_subset, batch_size=batch_size, shuffle = True) \\\n",
    "        if not config[\"augmentation\"] else DataLoader(dataset=train_subset, batch_size=batch_size, sampler = sampler)\n",
    "    val_loader = DataLoader(dataset=val_subset, batch_size=batch_size, shuffle=False)\n",
    "\n",
    "    # Prepare the model for each fold\n",
    "    model = ResNetForImageClassification.from_pretrained(config[\"architecture\"])\n",
    "    model.classifier[-1] = nn.Linear(model.classifier[-1].in_features, UnimodalCTDataset.num_classes)\n",
    "    #Freeze first layers\n",
    "    for name, param in model.named_parameters():\n",
    "        if \"resnet.encoder.stages.3\" in name:\n",
    "            param.requires_grad = True\n",
    "        else:\n",
    "            param.requires_grad = False\n",
    "\n",
    "    device = torch.device(\"cuda\" if torch.cuda.is_available() else \"cpu\")\n",
    "    model.to(device)\n",
    "\n",
    "    run_name = list(config[\"run_name\"])\n",
    "    run_name[-1] = str(trial.number + 1)\n",
    "    config[\"run_name\"] = ''.join(run_name)\n",
    "\n",
    "    # Train the model for the current fold\n",
    "    train(model, train_loader, val_loader, config, run_name=config[\"run_name\"])\n",
    "\n",
    "    # After training, evaluate on the validation set\n",
    "    f1 = evaluate(model, val_loader, device)\n",
    "    \n",
    "    return f1\n",
    "\n",
    "# Define the evaluation function\n",
    "def evaluate(model, val_loader, device):\n",
    "    model.eval()\n",
    "    val_labels = []\n",
    "    val_predictions = []\n",
    "    \n",
    "    with torch.no_grad():\n",
    "        for batch in val_loader:\n",
    "            frames = batch['frame'].float().to(device)\n",
    "            labels = batch['label'].long().to(device)\n",
    "            outputs = model(frames)\n",
    "            \n",
    "            _, predicted = torch.max(outputs.logits, 1)\n",
    "            val_labels.extend(labels.cpu().tolist())\n",
    "            val_predictions.extend(predicted.cpu().tolist())\n",
    "\n",
    "    # Calculate macro-averaged F1-score across all classes\n",
    "    f1 = f1_score(val_labels, val_predictions, average='macro')\n",
    "    return f1\n",
    "\n",
    "\n",
    "# Create an Optuna study and optimize\n",
    "study = optuna.create_study(direction=\"maximize\")  # Maximizing f1-score\n",
    "study.optimize(objective, n_trials=20)  \n",
    "\n",
    "# Print the best hyperparameters found by Optuna\n",
    "print(\"Best hyperparameters: \", study.best_params)\n"
   ]
  }
 ],
 "metadata": {
  "kaggle": {
   "accelerator": "gpu",
   "dataSources": [
    {
     "datasetId": 5758221,
     "sourceId": 9516694,
     "sourceType": "datasetVersion"
    },
    {
     "datasetId": 5664308,
     "sourceId": 9547833,
     "sourceType": "datasetVersion"
    }
   ],
   "dockerImageVersionId": 30787,
   "isGpuEnabled": true,
   "isInternetEnabled": true,
   "language": "python",
   "sourceType": "notebook"
  },
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.14"
  },
  "papermill": {
   "default_parameters": {},
   "duration": 25169.15168,
   "end_time": "2024-10-10T00:29:25.870383",
   "environment_variables": {},
   "exception": null,
   "input_path": "__notebook__.ipynb",
   "output_path": "__notebook__.ipynb",
   "parameters": {},
   "start_time": "2024-10-09T17:29:56.718703",
   "version": "2.6.0"
  },
  "widgets": {
   "application/vnd.jupyter.widget-state+json": {
    "state": {
     "068b0fec6cac401881602b731ed57f62": {
      "model_module": "@jupyter-widgets/controls",
      "model_module_version": "1.5.0",
      "model_name": "HBoxModel",
      "state": {
       "_dom_classes": [],
       "_model_module": "@jupyter-widgets/controls",
       "_model_module_version": "1.5.0",
       "_model_name": "HBoxModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/controls",
       "_view_module_version": "1.5.0",
       "_view_name": "HBoxView",
       "box_style": "",
       "children": [
        "IPY_MODEL_ab61aa1f71184d01872cda4e2993e6fd",
        "IPY_MODEL_c26b5f0414094d41968b0dbc0bd4611c",
        "IPY_MODEL_714fae5e31a848189c042db516ceff39"
       ],
       "layout": "IPY_MODEL_781d8219bcdf4c21803aa60211966d4d"
      }
     },
     "1ef0ba8b67264e4da651db1226812351": {
      "model_module": "@jupyter-widgets/controls",
      "model_module_version": "1.5.0",
      "model_name": "DescriptionStyleModel",
      "state": {
       "_model_module": "@jupyter-widgets/controls",
       "_model_module_version": "1.5.0",
       "_model_name": "DescriptionStyleModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/base",
       "_view_module_version": "1.2.0",
       "_view_name": "StyleView",
       "description_width": ""
      }
     },
     "2838d08c1e7746d997b5b79e1ea8396c": {
      "model_module": "@jupyter-widgets/base",
      "model_module_version": "1.2.0",
      "model_name": "LayoutModel",
      "state": {
       "_model_module": "@jupyter-widgets/base",
       "_model_module_version": "1.2.0",
       "_model_name": "LayoutModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/base",
       "_view_module_version": "1.2.0",
       "_view_name": "LayoutView",
       "align_content": null,
       "align_items": null,
       "align_self": null,
       "border": null,
       "bottom": null,
       "display": null,
       "flex": null,
       "flex_flow": null,
       "grid_area": null,
       "grid_auto_columns": null,
       "grid_auto_flow": null,
       "grid_auto_rows": null,
       "grid_column": null,
       "grid_gap": null,
       "grid_row": null,
       "grid_template_areas": null,
       "grid_template_columns": null,
       "grid_template_rows": null,
       "height": null,
       "justify_content": null,
       "justify_items": null,
       "left": null,
       "margin": null,
       "max_height": null,
       "max_width": null,
       "min_height": null,
       "min_width": null,
       "object_fit": null,
       "object_position": null,
       "order": null,
       "overflow": null,
       "overflow_x": null,
       "overflow_y": null,
       "padding": null,
       "right": null,
       "top": null,
       "visibility": null,
       "width": null
      }
     },
     "44b4d886c36146578acd7f8e889e23cb": {
      "model_module": "@jupyter-widgets/controls",
      "model_module_version": "1.5.0",
      "model_name": "DescriptionStyleModel",
      "state": {
       "_model_module": "@jupyter-widgets/controls",
       "_model_module_version": "1.5.0",
       "_model_name": "DescriptionStyleModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/base",
       "_view_module_version": "1.2.0",
       "_view_name": "StyleView",
       "description_width": ""
      }
     },
     "6e472b45afe3461c973b7575502c5197": {
      "model_module": "@jupyter-widgets/controls",
      "model_module_version": "1.5.0",
      "model_name": "DescriptionStyleModel",
      "state": {
       "_model_module": "@jupyter-widgets/controls",
       "_model_module_version": "1.5.0",
       "_model_name": "DescriptionStyleModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/base",
       "_view_module_version": "1.2.0",
       "_view_name": "StyleView",
       "description_width": ""
      }
     },
     "70e4b2a4103b44a0bb98b17fca9caef8": {
      "model_module": "@jupyter-widgets/controls",
      "model_module_version": "1.5.0",
      "model_name": "ProgressStyleModel",
      "state": {
       "_model_module": "@jupyter-widgets/controls",
       "_model_module_version": "1.5.0",
       "_model_name": "ProgressStyleModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/base",
       "_view_module_version": "1.2.0",
       "_view_name": "StyleView",
       "bar_color": null,
       "description_width": ""
      }
     },
     "714fae5e31a848189c042db516ceff39": {
      "model_module": "@jupyter-widgets/controls",
      "model_module_version": "1.5.0",
      "model_name": "HTMLModel",
      "state": {
       "_dom_classes": [],
       "_model_module": "@jupyter-widgets/controls",
       "_model_module_version": "1.5.0",
       "_model_name": "HTMLModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/controls",
       "_view_module_version": "1.5.0",
       "_view_name": "HTMLView",
       "description": "",
       "description_tooltip": null,
       "layout": "IPY_MODEL_c4b989afe146479d89ad27f2e0f0d9e9",
       "placeholder": "",
       "style": "IPY_MODEL_1ef0ba8b67264e4da651db1226812351",
       "value": "69.5k/69.5k[00:00&lt;00:00,831kB/s]"
      }
     },
     "75d6e1a41e8e448196df831a7bdd11b2": {
      "model_module": "@jupyter-widgets/base",
      "model_module_version": "1.2.0",
      "model_name": "LayoutModel",
      "state": {
       "_model_module": "@jupyter-widgets/base",
       "_model_module_version": "1.2.0",
       "_model_name": "LayoutModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/base",
       "_view_module_version": "1.2.0",
       "_view_name": "LayoutView",
       "align_content": null,
       "align_items": null,
       "align_self": null,
       "border": null,
       "bottom": null,
       "display": null,
       "flex": null,
       "flex_flow": null,
       "grid_area": null,
       "grid_auto_columns": null,
       "grid_auto_flow": null,
       "grid_auto_rows": null,
       "grid_column": null,
       "grid_gap": null,
       "grid_row": null,
       "grid_template_areas": null,
       "grid_template_columns": null,
       "grid_template_rows": null,
       "height": null,
       "justify_content": null,
       "justify_items": null,
       "left": null,
       "margin": null,
       "max_height": null,
       "max_width": null,
       "min_height": null,
       "min_width": null,
       "object_fit": null,
       "object_position": null,
       "order": null,
       "overflow": null,
       "overflow_x": null,
       "overflow_y": null,
       "padding": null,
       "right": null,
       "top": null,
       "visibility": null,
       "width": null
      }
     },
     "781d8219bcdf4c21803aa60211966d4d": {
      "model_module": "@jupyter-widgets/base",
      "model_module_version": "1.2.0",
      "model_name": "LayoutModel",
      "state": {
       "_model_module": "@jupyter-widgets/base",
       "_model_module_version": "1.2.0",
       "_model_name": "LayoutModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/base",
       "_view_module_version": "1.2.0",
       "_view_name": "LayoutView",
       "align_content": null,
       "align_items": null,
       "align_self": null,
       "border": null,
       "bottom": null,
       "display": null,
       "flex": null,
       "flex_flow": null,
       "grid_area": null,
       "grid_auto_columns": null,
       "grid_auto_flow": null,
       "grid_auto_rows": null,
       "grid_column": null,
       "grid_gap": null,
       "grid_row": null,
       "grid_template_areas": null,
       "grid_template_columns": null,
       "grid_template_rows": null,
       "height": null,
       "justify_content": null,
       "justify_items": null,
       "left": null,
       "margin": null,
       "max_height": null,
       "max_width": null,
       "min_height": null,
       "min_width": null,
       "object_fit": null,
       "object_position": null,
       "order": null,
       "overflow": null,
       "overflow_x": null,
       "overflow_y": null,
       "padding": null,
       "right": null,
       "top": null,
       "visibility": null,
       "width": null
      }
     },
     "7bc0cbafe7294c5c8793f51d7a0e79ba": {
      "model_module": "@jupyter-widgets/controls",
      "model_module_version": "1.5.0",
      "model_name": "HBoxModel",
      "state": {
       "_dom_classes": [],
       "_model_module": "@jupyter-widgets/controls",
       "_model_module_version": "1.5.0",
       "_model_name": "HBoxModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/controls",
       "_view_module_version": "1.5.0",
       "_view_name": "HBoxView",
       "box_style": "",
       "children": [
        "IPY_MODEL_a6bf8eaaff684692a0d1d2ce310bb01b",
        "IPY_MODEL_e12c5147c1374f25a6b6e3220ea6b077",
        "IPY_MODEL_e65233f55ac847eba860198f54ed43e2"
       ],
       "layout": "IPY_MODEL_2838d08c1e7746d997b5b79e1ea8396c"
      }
     },
     "85bdfe4d25a14ed2b6d3765a76108ddf": {
      "model_module": "@jupyter-widgets/base",
      "model_module_version": "1.2.0",
      "model_name": "LayoutModel",
      "state": {
       "_model_module": "@jupyter-widgets/base",
       "_model_module_version": "1.2.0",
       "_model_name": "LayoutModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/base",
       "_view_module_version": "1.2.0",
       "_view_name": "LayoutView",
       "align_content": null,
       "align_items": null,
       "align_self": null,
       "border": null,
       "bottom": null,
       "display": null,
       "flex": null,
       "flex_flow": null,
       "grid_area": null,
       "grid_auto_columns": null,
       "grid_auto_flow": null,
       "grid_auto_rows": null,
       "grid_column": null,
       "grid_gap": null,
       "grid_row": null,
       "grid_template_areas": null,
       "grid_template_columns": null,
       "grid_template_rows": null,
       "height": null,
       "justify_content": null,
       "justify_items": null,
       "left": null,
       "margin": null,
       "max_height": null,
       "max_width": null,
       "min_height": null,
       "min_width": null,
       "object_fit": null,
       "object_position": null,
       "order": null,
       "overflow": null,
       "overflow_x": null,
       "overflow_y": null,
       "padding": null,
       "right": null,
       "top": null,
       "visibility": null,
       "width": null
      }
     },
     "a6bf8eaaff684692a0d1d2ce310bb01b": {
      "model_module": "@jupyter-widgets/controls",
      "model_module_version": "1.5.0",
      "model_name": "HTMLModel",
      "state": {
       "_dom_classes": [],
       "_model_module": "@jupyter-widgets/controls",
       "_model_module_version": "1.5.0",
       "_model_name": "HTMLModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/controls",
       "_view_module_version": "1.5.0",
       "_view_name": "HTMLView",
       "description": "",
       "description_tooltip": null,
       "layout": "IPY_MODEL_b1606f34da354ba3acd2a55af6c277fb",
       "placeholder": "",
       "style": "IPY_MODEL_bddffa9f910d4976bd2b36483087d00c",
       "value": "model.safetensors:100%"
      }
     },
     "ab61aa1f71184d01872cda4e2993e6fd": {
      "model_module": "@jupyter-widgets/controls",
      "model_module_version": "1.5.0",
      "model_name": "HTMLModel",
      "state": {
       "_dom_classes": [],
       "_model_module": "@jupyter-widgets/controls",
       "_model_module_version": "1.5.0",
       "_model_name": "HTMLModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/controls",
       "_view_module_version": "1.5.0",
       "_view_name": "HTMLView",
       "description": "",
       "description_tooltip": null,
       "layout": "IPY_MODEL_f5d094d836c64cb28a442186ae2f3938",
       "placeholder": "",
       "style": "IPY_MODEL_6e472b45afe3461c973b7575502c5197",
       "value": "config.json:100%"
      }
     },
     "b1606f34da354ba3acd2a55af6c277fb": {
      "model_module": "@jupyter-widgets/base",
      "model_module_version": "1.2.0",
      "model_name": "LayoutModel",
      "state": {
       "_model_module": "@jupyter-widgets/base",
       "_model_module_version": "1.2.0",
       "_model_name": "LayoutModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/base",
       "_view_module_version": "1.2.0",
       "_view_name": "LayoutView",
       "align_content": null,
       "align_items": null,
       "align_self": null,
       "border": null,
       "bottom": null,
       "display": null,
       "flex": null,
       "flex_flow": null,
       "grid_area": null,
       "grid_auto_columns": null,
       "grid_auto_flow": null,
       "grid_auto_rows": null,
       "grid_column": null,
       "grid_gap": null,
       "grid_row": null,
       "grid_template_areas": null,
       "grid_template_columns": null,
       "grid_template_rows": null,
       "height": null,
       "justify_content": null,
       "justify_items": null,
       "left": null,
       "margin": null,
       "max_height": null,
       "max_width": null,
       "min_height": null,
       "min_width": null,
       "object_fit": null,
       "object_position": null,
       "order": null,
       "overflow": null,
       "overflow_x": null,
       "overflow_y": null,
       "padding": null,
       "right": null,
       "top": null,
       "visibility": null,
       "width": null
      }
     },
     "bddffa9f910d4976bd2b36483087d00c": {
      "model_module": "@jupyter-widgets/controls",
      "model_module_version": "1.5.0",
      "model_name": "DescriptionStyleModel",
      "state": {
       "_model_module": "@jupyter-widgets/controls",
       "_model_module_version": "1.5.0",
       "_model_name": "DescriptionStyleModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/base",
       "_view_module_version": "1.2.0",
       "_view_name": "StyleView",
       "description_width": ""
      }
     },
     "c26b5f0414094d41968b0dbc0bd4611c": {
      "model_module": "@jupyter-widgets/controls",
      "model_module_version": "1.5.0",
      "model_name": "FloatProgressModel",
      "state": {
       "_dom_classes": [],
       "_model_module": "@jupyter-widgets/controls",
       "_model_module_version": "1.5.0",
       "_model_name": "FloatProgressModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/controls",
       "_view_module_version": "1.5.0",
       "_view_name": "ProgressView",
       "bar_style": "success",
       "description": "",
       "description_tooltip": null,
       "layout": "IPY_MODEL_85bdfe4d25a14ed2b6d3765a76108ddf",
       "max": 69548.0,
       "min": 0.0,
       "orientation": "horizontal",
       "style": "IPY_MODEL_ee93bddb8a744d2cb0190693620e120e",
       "value": 69548.0
      }
     },
     "c4b989afe146479d89ad27f2e0f0d9e9": {
      "model_module": "@jupyter-widgets/base",
      "model_module_version": "1.2.0",
      "model_name": "LayoutModel",
      "state": {
       "_model_module": "@jupyter-widgets/base",
       "_model_module_version": "1.2.0",
       "_model_name": "LayoutModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/base",
       "_view_module_version": "1.2.0",
       "_view_name": "LayoutView",
       "align_content": null,
       "align_items": null,
       "align_self": null,
       "border": null,
       "bottom": null,
       "display": null,
       "flex": null,
       "flex_flow": null,
       "grid_area": null,
       "grid_auto_columns": null,
       "grid_auto_flow": null,
       "grid_auto_rows": null,
       "grid_column": null,
       "grid_gap": null,
       "grid_row": null,
       "grid_template_areas": null,
       "grid_template_columns": null,
       "grid_template_rows": null,
       "height": null,
       "justify_content": null,
       "justify_items": null,
       "left": null,
       "margin": null,
       "max_height": null,
       "max_width": null,
       "min_height": null,
       "min_width": null,
       "object_fit": null,
       "object_position": null,
       "order": null,
       "overflow": null,
       "overflow_x": null,
       "overflow_y": null,
       "padding": null,
       "right": null,
       "top": null,
       "visibility": null,
       "width": null
      }
     },
     "e11c6bcdb7664fc5889f271eb4321513": {
      "model_module": "@jupyter-widgets/base",
      "model_module_version": "1.2.0",
      "model_name": "LayoutModel",
      "state": {
       "_model_module": "@jupyter-widgets/base",
       "_model_module_version": "1.2.0",
       "_model_name": "LayoutModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/base",
       "_view_module_version": "1.2.0",
       "_view_name": "LayoutView",
       "align_content": null,
       "align_items": null,
       "align_self": null,
       "border": null,
       "bottom": null,
       "display": null,
       "flex": null,
       "flex_flow": null,
       "grid_area": null,
       "grid_auto_columns": null,
       "grid_auto_flow": null,
       "grid_auto_rows": null,
       "grid_column": null,
       "grid_gap": null,
       "grid_row": null,
       "grid_template_areas": null,
       "grid_template_columns": null,
       "grid_template_rows": null,
       "height": null,
       "justify_content": null,
       "justify_items": null,
       "left": null,
       "margin": null,
       "max_height": null,
       "max_width": null,
       "min_height": null,
       "min_width": null,
       "object_fit": null,
       "object_position": null,
       "order": null,
       "overflow": null,
       "overflow_x": null,
       "overflow_y": null,
       "padding": null,
       "right": null,
       "top": null,
       "visibility": null,
       "width": null
      }
     },
     "e12c5147c1374f25a6b6e3220ea6b077": {
      "model_module": "@jupyter-widgets/controls",
      "model_module_version": "1.5.0",
      "model_name": "FloatProgressModel",
      "state": {
       "_dom_classes": [],
       "_model_module": "@jupyter-widgets/controls",
       "_model_module_version": "1.5.0",
       "_model_name": "FloatProgressModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/controls",
       "_view_module_version": "1.5.0",
       "_view_name": "ProgressView",
       "bar_style": "success",
       "description": "",
       "description_tooltip": null,
       "layout": "IPY_MODEL_75d6e1a41e8e448196df831a7bdd11b2",
       "max": 46812324.0,
       "min": 0.0,
       "orientation": "horizontal",
       "style": "IPY_MODEL_70e4b2a4103b44a0bb98b17fca9caef8",
       "value": 46812324.0
      }
     },
     "e65233f55ac847eba860198f54ed43e2": {
      "model_module": "@jupyter-widgets/controls",
      "model_module_version": "1.5.0",
      "model_name": "HTMLModel",
      "state": {
       "_dom_classes": [],
       "_model_module": "@jupyter-widgets/controls",
       "_model_module_version": "1.5.0",
       "_model_name": "HTMLModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/controls",
       "_view_module_version": "1.5.0",
       "_view_name": "HTMLView",
       "description": "",
       "description_tooltip": null,
       "layout": "IPY_MODEL_e11c6bcdb7664fc5889f271eb4321513",
       "placeholder": "",
       "style": "IPY_MODEL_44b4d886c36146578acd7f8e889e23cb",
       "value": "46.8M/46.8M[00:00&lt;00:00,132MB/s]"
      }
     },
     "ee93bddb8a744d2cb0190693620e120e": {
      "model_module": "@jupyter-widgets/controls",
      "model_module_version": "1.5.0",
      "model_name": "ProgressStyleModel",
      "state": {
       "_model_module": "@jupyter-widgets/controls",
       "_model_module_version": "1.5.0",
       "_model_name": "ProgressStyleModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/base",
       "_view_module_version": "1.2.0",
       "_view_name": "StyleView",
       "bar_color": null,
       "description_width": ""
      }
     },
     "f5d094d836c64cb28a442186ae2f3938": {
      "model_module": "@jupyter-widgets/base",
      "model_module_version": "1.2.0",
      "model_name": "LayoutModel",
      "state": {
       "_model_module": "@jupyter-widgets/base",
       "_model_module_version": "1.2.0",
       "_model_name": "LayoutModel",
       "_view_count": null,
       "_view_module": "@jupyter-widgets/base",
       "_view_module_version": "1.2.0",
       "_view_name": "LayoutView",
       "align_content": null,
       "align_items": null,
       "align_self": null,
       "border": null,
       "bottom": null,
       "display": null,
       "flex": null,
       "flex_flow": null,
       "grid_area": null,
       "grid_auto_columns": null,
       "grid_auto_flow": null,
       "grid_auto_rows": null,
       "grid_column": null,
       "grid_gap": null,
       "grid_row": null,
       "grid_template_areas": null,
       "grid_template_columns": null,
       "grid_template_rows": null,
       "height": null,
       "justify_content": null,
       "justify_items": null,
       "left": null,
       "margin": null,
       "max_height": null,
       "max_width": null,
       "min_height": null,
       "min_width": null,
       "object_fit": null,
       "object_position": null,
       "order": null,
       "overflow": null,
       "overflow_x": null,
       "overflow_y": null,
       "padding": null,
       "right": null,
       "top": null,
       "visibility": null,
       "width": null
      }
     }
    },
    "version_major": 2,
    "version_minor": 0
   }
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
